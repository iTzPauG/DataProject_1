{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-12-03T18:07:05.574942Z", "invocation_id": "07284832-38ce-49bd-aebe-4e7629720ce8", "invocation_started_at": "2025-12-03T18:07:02.252810Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-03T18:07:04.939453Z", "completed_at": "2025-12-03T18:07:04.969130Z"}, {"name": "execute", "started_at": "2025-12-03T18:07:04.970924Z", "completed_at": "2025-12-03T18:07:05.107208Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.17399287223815918, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.data_project_1.stg_air_quality_valencia", "compiled": true, "compiled_code": "-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. \n--1) DESPIVOTEAMOS:\n--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)\n--Necesitamos calcular promedios de forma gen\u00e9rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.\n-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.\nWITH raw_data AS (\n    SELECT\n        objectid,\n        nombre,\n        direccion,\n        tipozona,\n        fecha_carg,\n        so2,\n        no2,\n        o3,\n        co,\n        pm10,\n        pm25,\n        lon,\n        lat\n    FROM \"data_project_1\".\"public\".\"estaciones\"\n),\n\nunpivoted_data AS (\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'SO2' AS pollutant_type,\n        so2 AS concentration_ug_m3\n    FROM raw_data\n    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000\n\n    UNION ALL\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'NO2' AS pollutant_type,\n        no2 AS concentration_ug_m3\n    FROM raw_data\n    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000\n\n    UNION ALL\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'O3' AS pollutant_type,\n        o3 AS concentration_ug_m3\n    FROM raw_data\n    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000\n\n    UNION ALL\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'CO' AS pollutant_type,\n        co AS concentration_ug_m3\n    FROM raw_data\n    WHERE co IS NOT NULL AND co >= 0 AND co < 50\n\n    UNION ALL\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'PM10' AS pollutant_type,\n        pm10 AS concentration_ug_m3\n    FROM raw_data\n    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000\n\n    UNION ALL\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'PM25' AS pollutant_type,\n        pm25 AS concentration_ug_m3\n    FROM raw_data\n    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000\n)\n\nSELECT\n    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,\n    location_id,\n    station_name,\n    station_address,\n    zona_type,\n    measurement_timestamp,\n    lon AS longitude,\n    lat AS latitude,\n    pollutant_type,\n    concentration_ug_m3,\n    CASE\n        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'\n        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg\u00e1nicos'\n        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon\u00f3xido'\n        ELSE 'Otro'\n    END AS pollutant_category\nFROM unpivoted_data\nWHERE concentration_ug_m3 >= 0", "relation_name": "\"data_project_1\".\"public\".\"stg_air_quality_valencia\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-03T18:07:05.130255Z", "completed_at": "2025-12-03T18:07:05.182975Z"}, {"name": "execute", "started_at": "2025-12-03T18:07:05.204691Z", "completed_at": "2025-12-03T18:07:05.353539Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.23779082298278809, "adapter_response": {"_message": "SELECT 132", "code": "SELECT", "rows_affected": 132}, "message": "SELECT 132", "failures": null, "unique_id": "model.data_project_1.int_air_quality_daily", "compiled": true, "compiled_code": "\n\nWITH base AS (\n    SELECT\n        location_id,\n        station_name,\n        pollutant_type,\n        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,\n        concentration_ug_m3\n    FROM \"data_project_1\".\"public\".\"stg_air_quality_valencia\"\n),\n\ndaily AS (\n    SELECT\n        location_id,\n        station_name,\n        pollutant_type,\n        measurement_day,\n        AVG(concentration_ug_m3) AS avg_daily,\n        MAX(concentration_ug_m3) AS max_daily,\n        MIN(concentration_ug_m3) AS min_daily,\n        COUNT(*) AS num_measurements\n    FROM base\n    GROUP BY \n        location_id, \n        station_name, \n        pollutant_type, \n        measurement_day\n),\n\nvariation AS (\n    SELECT\n        *,\n        avg_daily - LAG(avg_daily) OVER (\n            PARTITION BY location_id, pollutant_type\n            ORDER BY measurement_day\n        ) AS variation_vs_prev_day\n    FROM daily\n)\n\nSELECT *\nFROM variation", "relation_name": "\"data_project_1\".\"public\".\"int_air_quality_daily\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-03T18:07:05.146254Z", "completed_at": "2025-12-03T18:07:05.181981Z"}, {"name": "execute", "started_at": "2025-12-03T18:07:05.185640Z", "completed_at": "2025-12-03T18:07:05.380544Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.2615504264831543, "adapter_response": {"_message": "SELECT 44", "code": "SELECT", "rows_affected": 44}, "message": "SELECT 44", "failures": null, "unique_id": "model.data_project_1.int_air_quality_monthly", "compiled": true, "compiled_code": "\n\nWITH base AS (\n    SELECT\n        location_id,\n        station_name,\n        pollutant_type,\n        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,\n        concentration_ug_m3\n    FROM \"data_project_1\".\"public\".\"stg_air_quality_valencia\"\n),\n\nmonthly AS (\n    SELECT\n        location_id,\n        station_name,\n        pollutant_type,\n        measurement_month,\n        AVG(concentration_ug_m3) AS avg_monthly,\n        MAX(concentration_ug_m3) AS max_monthly,\n        MIN(concentration_ug_m3) AS min_monthly,\n        COUNT(*) AS num_measurements\n    FROM base\n    GROUP BY \n        location_id,\n        station_name,\n        pollutant_type,\n        measurement_month\n),\n\nvariation AS (\n    SELECT\n        monthly.*,\n        avg_monthly \n            - LAG(avg_monthly) OVER (\n                PARTITION BY location_id, pollutant_type\n                ORDER BY measurement_month\n            ) AS variation_vs_prev_month\n    FROM monthly\n)\n\nSELECT *\nFROM variation", "relation_name": "\"data_project_1\".\"public\".\"int_air_quality_monthly\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-03T18:07:05.136405Z", "completed_at": "2025-12-03T18:07:05.191275Z"}, {"name": "execute", "started_at": "2025-12-03T18:07:05.210644Z", "completed_at": "2025-12-03T18:07:05.383213Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.26673078536987305, "adapter_response": {"_message": "SELECT 704", "code": "SELECT", "rows_affected": 704}, "message": "SELECT 704", "failures": null, "unique_id": "model.data_project_1.int_air_quality_hourly", "compiled": true, "compiled_code": "\n\nWITH base AS (\n    SELECT\n        location_id,\n        station_name,\n        pollutant_type,\n        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,\n        concentration_ug_m3\n    FROM \"data_project_1\".\"public\".\"stg_air_quality_valencia\"\n),\n\nhourly AS (\n    SELECT\n        location_id,\n        station_name,\n        pollutant_type,\n        measurement_hour,\n        AVG(concentration_ug_m3) AS avg_hourly,\n        MAX(concentration_ug_m3) AS max_hourly,\n        MIN(concentration_ug_m3) AS min_hourly,\n        COUNT(*) AS num_measurements\n    FROM base\n    GROUP BY \n        location_id,\n        station_name,\n        pollutant_type,\n        measurement_hour\n),\n\nvariation AS (\n    SELECT\n        hourly.*,\n        avg_hourly \n            - LAG(avg_hourly) OVER (\n                PARTITION BY location_id, pollutant_type\n                ORDER BY measurement_hour\n            ) AS variation_vs_prev_hour\n    FROM hourly\n)\n\nSELECT *\nFROM variation", "relation_name": "\"data_project_1\".\"public\".\"int_air_quality_hourly\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-03T18:07:05.385220Z", "completed_at": "2025-12-03T18:07:05.400246Z"}, {"name": "execute", "started_at": "2025-12-03T18:07:05.402879Z", "completed_at": "2025-12-03T18:07:05.525704Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.14897465705871582, "adapter_response": {"_message": "SELECT 132", "code": "SELECT", "rows_affected": 132}, "message": "SELECT 132", "failures": null, "unique_id": "model.data_project_1.mart_air_quality_daily", "compiled": true, "compiled_code": "\n\nSELECT\n    location_id,\n    station_name,\n    pollutant_type,\n    measurement_day,\n    avg_daily,\n    max_daily,\n    min_daily,\n    num_measurements,\n    variation_vs_prev_day\nFROM \"data_project_1\".\"public\".\"int_air_quality_daily\"\n--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m\u00e1ximos, m\u00ednimos y variaciones respecto al d\u00eda anterior. Es \u00fatil para an\u00e1lisis diarios y reportes de cumplimiento.", "relation_name": "\"data_project_1\".\"public\".\"mart_air_quality_daily\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-03T18:07:05.409417Z", "completed_at": "2025-12-03T18:07:05.424681Z"}, {"name": "execute", "started_at": "2025-12-03T18:07:05.426702Z", "completed_at": "2025-12-03T18:07:05.529340Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.13431262969970703, "adapter_response": {"_message": "SELECT 704", "code": "SELECT", "rows_affected": 704}, "message": "SELECT 704", "failures": null, "unique_id": "model.data_project_1.mart_air_quality_hourly", "compiled": true, "compiled_code": "\n\nSELECT\n    location_id,\n    station_name,\n    pollutant_type,\n    measurement_hour,\n    avg_hourly,\n    max_hourly,\n    min_hourly,\n    num_measurements,\n    variation_vs_prev_hour\nFROM \"data_project_1\".\"public\".\"int_air_quality_hourly\"\n--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m\u00e1ximos, m\u00ednimos y variaciones respecto a la hora anterior. Es \u00fatil para an\u00e1lisis detallados y monitoreo en tiempo real.", "relation_name": "\"data_project_1\".\"public\".\"mart_air_quality_hourly\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-03T18:07:05.406286Z", "completed_at": "2025-12-03T18:07:05.420433Z"}, {"name": "execute", "started_at": "2025-12-03T18:07:05.421986Z", "completed_at": "2025-12-03T18:07:05.531535Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.1368882656097412, "adapter_response": {"_message": "SELECT 44", "code": "SELECT", "rows_affected": 44}, "message": "SELECT 44", "failures": null, "unique_id": "model.data_project_1.mart_air_quality_monthly", "compiled": true, "compiled_code": "\n\nSELECT\n    location_id,\n    station_name,\n    pollutant_type,\n    measurement_month,\n    avg_monthly,\n    max_monthly,\n    min_monthly,\n    num_measurements,\n    variation_vs_prev_month\nFROM \"data_project_1\".\"public\".\"int_air_quality_monthly\"", "relation_name": "\"data_project_1\".\"public\".\"mart_air_quality_monthly\"", "batch_results": null}], "elapsed_time": 0.8515965938568115, "args": {"print": true, "profiles_dir": "/usr/app/dbt/dbt", "quiet": false, "empty": false, "version_check": true, "require_resource_names_without_spaces": true, "source_freshness_run_project_hooks": true, "strict_mode": false, "macro_debugging": false, "require_explicit_package_overrides_for_builtin_materializations": true, "skip_nodes_if_on_run_start_fails": false, "write_json": true, "show_all_deprecations": false, "upload_to_artifacts_ingest_api": false, "defer": false, "log_format_file": "debug", "send_anonymous_usage_stats": true, "static_parser": true, "printer_width": 80, "introspect": true, "show_resource_report": false, "log_level_file": "debug", "log_file_max_bytes": 10485760, "require_yaml_configuration_for_mf_time_spines": false, "indirect_selection": "eager", "state_modified_compare_vars": false, "partial_parse": true, "require_generic_test_arguments_property": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "populate_cache": true, "validate_macro_args": false, "log_format": "default", "project_dir": "/usr/app/dbt/dbt", "log_level": "info", "select": [], "state_modified_compare_more_unrendered_values": false, "use_colors_file": true, "vars": {}, "require_nested_cumulative_type_params": false, "favor_state": false, "use_fast_test_edges": false, "use_colors": true, "which": "run", "log_path": "/usr/app/dbt/dbt/logs", "require_batched_execution_for_custom_microbatch_strategy": false, "exclude": [], "cache_selected_only": false, "require_all_warnings_handled_by_warn_error": false, "partial_parse_file_diff": true, "invocation_command": "dbt run"}}