{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-12-02T22:22:51.617730Z", "invocation_id": "52f73a23-12e1-47c7-add7-8b6be477beff", "invocation_started_at": "2025-12-02T22:22:49.315650Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-02T22:22:51.398348Z", "completed_at": "2025-12-02T22:22:51.427644Z"}, {"name": "execute", "started_at": "2025-12-02T22:22:51.429583Z", "completed_at": "2025-12-02T22:22:51.574230Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.19319844245910645, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.data_project_1.stg_air_quality_valencia", "compiled": true, "compiled_code": "-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. \n--1) DESPIVOTEAMOS:\n--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)\n--Necesitamos calcular promedios de forma gen\u00e9rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.\n-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.\nWITH raw_data AS (\n    SELECT\n        objectid,\n        nombre,\n        direccion,\n        tipozona,\n        fecha_carg,\n        so2,\n        no2,\n        o3,\n        co,\n        pm10,\n        pm25,\n        lon,\n        lat\n    FROM \"data_project_1\".\"public\".\"estaciones\"\n),\n\nunpivoted_data AS (\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'SO2' AS pollutant_type,\n        so2 AS concentration_ug_m3\n    FROM raw_data\n    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000\n\n    UNION ALL\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'NO2' AS pollutant_type,\n        no2 AS concentration_ug_m3\n    FROM raw_data\n    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000\n\n    UNION ALL\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'O3' AS pollutant_type,\n        o3 AS concentration_ug_m3\n    FROM raw_data\n    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000\n\n    UNION ALL\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'CO' AS pollutant_type,\n        co AS concentration_ug_m3\n    FROM raw_data\n    WHERE co IS NOT NULL AND co >= 0 AND co < 50\n\n    UNION ALL\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'PM10' AS pollutant_type,\n        pm10 AS concentration_ug_m3\n    FROM raw_data\n    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000\n\n    UNION ALL\n\n    SELECT\n        objectid AS location_id,\n        nombre AS station_name,\n        direccion AS station_address,\n        tipozona AS zona_type,\n        lon,\n        lat,\n        fecha_carg AS measurement_timestamp,\n        'PM25' AS pollutant_type,\n        pm25 AS concentration_ug_m3\n    FROM raw_data\n    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000\n)\n\nSELECT\n    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,\n    location_id,\n    station_name,\n    station_address,\n    zona_type,\n    measurement_timestamp,\n    lon AS longitude,\n    lat AS latitude,\n    pollutant_type,\n    concentration_ug_m3,\n    CASE\n        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'\n        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg\u00e1nicos'\n        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon\u00f3xido'\n        ELSE 'Otro'\n    END AS pollutant_category\nFROM unpivoted_data\nWHERE concentration_ug_m3 >= 0", "relation_name": "\"data_project_1\".\"public\".\"stg_air_quality_valencia\"", "batch_results": null}], "elapsed_time": 0.4720897674560547, "args": {"indirect_selection": "eager", "defer": false, "require_nested_cumulative_type_params": false, "vars": {}, "source_freshness_run_project_hooks": true, "show_all_deprecations": false, "require_yaml_configuration_for_mf_time_spines": false, "printer_width": 80, "state_modified_compare_vars": false, "invocation_command": "dbt run", "upload_to_artifacts_ingest_api": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "exclude": [], "log_file_max_bytes": 10485760, "macro_debugging": false, "state_modified_compare_more_unrendered_values": false, "select": [], "show_resource_report": false, "quiet": false, "cache_selected_only": false, "print": true, "favor_state": false, "require_generic_test_arguments_property": true, "static_parser": true, "strict_mode": false, "partial_parse_file_diff": true, "log_level": "info", "version_check": true, "log_format": "default", "project_dir": "/usr/app/dbt/dbt", "partial_parse": true, "empty": false, "use_fast_test_edges": false, "profiles_dir": "/usr/app/dbt/dbt", "populate_cache": true, "skip_nodes_if_on_run_start_fails": false, "use_colors": true, "which": "run", "send_anonymous_usage_stats": true, "introspect": true, "log_path": "/usr/app/dbt/dbt/logs", "require_resource_names_without_spaces": true, "require_explicit_package_overrides_for_builtin_materializations": true, "write_json": true, "log_format_file": "debug", "require_all_warnings_handled_by_warn_error": false, "use_colors_file": true, "require_batched_execution_for_custom_microbatch_strategy": false, "validate_macro_args": false, "log_level_file": "debug"}}