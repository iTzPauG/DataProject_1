[0m18:04:19.468037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae5fa80d0>]}
[0m18:04:19.591338 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:19.600454 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:19.710554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae5f3a350>]}
[0m18:04:19.711829 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:04:19.712719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae5318f10>]}
[0m18:04:19.714946 [info ] [MainThread]: 
[0m18:04:19.715854 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:19.716680 [info ] [MainThread]: 
[0m18:04:19.717688 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:04:19.721848 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:04:19.797019 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:04:19.798301 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:04:19.799148 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:19.811883 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.013 seconds
[0m18:04:19.814096 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:04:19.816544 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:04:19.822170 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:19.823124 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:04:19.823941 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:19.831407 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m18:04:19.832548 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:19.833388 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:04:19.838617 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.004 seconds
[0m18:04:19.840511 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:04:19.841454 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:04:19.846924 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:19.848044 [debug] [MainThread]: On master: BEGIN
[0m18:04:19.848809 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:04:19.856285 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m18:04:19.857208 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:19.858062 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:04:19.864291 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m18:04:19.866435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae8710510>]}
[0m18:04:19.867438 [debug] [MainThread]: On master: ROLLBACK
[0m18:04:19.868434 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:19.869203 [debug] [MainThread]: On master: BEGIN
[0m18:04:19.870189 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:04:19.870992 [debug] [MainThread]: On master: COMMIT
[0m18:04:19.871607 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:19.872321 [debug] [MainThread]: On master: COMMIT
[0m18:04:19.873100 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:19.873774 [debug] [MainThread]: On master: Close
[0m18:04:19.878529 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:04:19.879595 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:04:19.880690 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:04:19.881608 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:04:19.896678 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.904636 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:04:19.929562 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.937970 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.938857 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:04:19.939965 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:19.948171 [debug] [Thread-1 (]: SQL status: BEGIN in 0.008 seconds
[0m18:04:19.949367 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.950222 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:04:19.956627 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m18:04:19.962406 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.963314 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:04:19.964971 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:19.967755 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.968542 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:04:19.970169 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:19.981219 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:19.982133 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.982786 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:19.987406 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m18:04:19.992479 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:04:19.996685 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.997448 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:04:20.001238 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m18:04:20.003869 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:04:20.005947 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae45e58d0>]}
[0m18:04:20.006987 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.12s]
[0m18:04:20.007928 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:04:20.009344 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:04:20.009756 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:04:20.010035 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:04:20.010761 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:04:20.011593 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:04:20.012441 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:04:20.013281 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:04:20.014062 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:04:20.015034 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:04:20.015790 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:04:20.016471 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:04:20.017118 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:04:20.021397 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:04:20.024267 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.027210 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.032504 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:04:20.032842 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:04:20.038834 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:04:20.048638 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.052506 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.055810 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:04:20.061089 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.061484 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.062235 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:04:20.062530 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.063072 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:04:20.063734 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:04:20.064596 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:04:20.065395 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:04:20.066779 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:04:20.073648 [debug] [Thread-2 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:20.074405 [debug] [Thread-4 (]: SQL status: BEGIN in 0.009 seconds
[0m18:04:20.074710 [debug] [Thread-3 (]: SQL status: BEGIN in 0.008 seconds
[0m18:04:20.075309 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.076183 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.077035 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.077727 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:04:20.078444 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:04:20.079144 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:04:20.088486 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.008 seconds
[0m18:04:20.094703 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.095087 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.014 seconds
[0m18:04:20.095392 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.015 seconds
[0m18:04:20.096219 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:04:20.100590 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.103402 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.104790 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:04:20.105110 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.105756 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:04:20.107129 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.109681 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.111484 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.113769 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.114654 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:04:20.117327 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.118054 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:04:20.119229 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:04:20.119529 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.120551 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:04:20.121222 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:04:20.122236 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:20.123764 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:20.125380 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:20.126694 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.128157 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.128993 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.130173 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:20.130940 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:20.131802 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:20.143944 [debug] [Thread-2 (]: SQL status: COMMIT in 0.011 seconds
[0m18:04:20.144652 [debug] [Thread-4 (]: SQL status: COMMIT in 0.011 seconds
[0m18:04:20.144979 [debug] [Thread-3 (]: SQL status: COMMIT in 0.012 seconds
[0m18:04:20.147736 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:04:20.150253 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:04:20.154378 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:04:20.158280 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.159898 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.161192 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.162127 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:04:20.163042 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:04:20.163990 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:04:20.170598 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:20.171065 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:04:20.171833 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:04:20.173394 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:04:20.175872 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:04:20.177685 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:04:20.178995 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae435d690>]}
[0m18:04:20.179944 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae43f9490>]}
[0m18:04:20.180928 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae4585590>]}
[0m18:04:20.181980 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.16s]
[0m18:04:20.183226 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.17s]
[0m18:04:20.184280 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.17s]
[0m18:04:20.185349 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:04:20.186432 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:04:20.187567 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:04:20.188900 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:04:20.189897 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:04:20.191183 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:04:20.192173 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:04:20.193272 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:04:20.194276 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:04:20.195717 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m18:04:20.196771 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m18:04:20.197836 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m18:04:20.198687 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:04:20.199656 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:04:20.201140 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:04:20.205705 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.209894 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.213341 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.221509 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:04:20.221912 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:04:20.222330 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:04:20.225678 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.229397 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.232711 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.238431 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.239720 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:04:20.240504 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.241681 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.242578 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:20.243573 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:04:20.244576 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:04:20.246458 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:04:20.247502 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:04:20.253732 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:20.256301 [debug] [Thread-4 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:20.256742 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.257674 [debug] [Thread-2 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:20.258012 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.258934 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:04:20.260140 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.261149 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:04:20.262787 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:04:20.267863 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.004 seconds
[0m18:04:20.268932 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.005 seconds
[0m18:04:20.269278 [debug] [Thread-1 (]: SQL status: SELECT 704 in 0.007 seconds
[0m18:04:20.273420 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.277165 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.280249 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.281245 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:04:20.282604 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:04:20.283542 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:04:20.285212 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.286423 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.286755 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.289712 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.293921 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.297262 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.298544 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:04:20.299716 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:04:20.301196 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:04:20.303133 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.304130 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.305193 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.306810 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:20.309178 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:20.310801 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:20.311680 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.312646 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.313550 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.314488 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:20.315447 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:20.316385 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:20.320421 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m18:04:20.323718 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:04:20.324127 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m18:04:20.324421 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m18:04:20.325498 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.327910 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:04:20.331925 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:04:20.333270 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:04:20.334399 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.335454 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.336828 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:04:20.337606 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:04:20.340397 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:04:20.342658 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:04:20.343235 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:20.344283 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae42e8a10>]}
[0m18:04:20.344605 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:04:20.345853 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:04:20.346972 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.15s]
[0m18:04:20.348634 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:04:20.349724 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae41239d0>]}
[0m18:04:20.350494 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:04:20.351452 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae4128e90>]}
[0m18:04:20.352340 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.15s]
[0m18:04:20.354167 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.15s]
[0m18:04:20.355012 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:04:20.355847 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:04:20.359285 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:20.360278 [debug] [MainThread]: On master: BEGIN
[0m18:04:20.360996 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:04:20.368248 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m18:04:20.369355 [debug] [MainThread]: On master: COMMIT
[0m18:04:20.370074 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:20.370783 [debug] [MainThread]: On master: COMMIT
[0m18:04:20.371607 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:20.372330 [debug] [MainThread]: On master: Close
[0m18:04:20.373221 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:04:20.374171 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:04:20.375166 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_daily' was properly closed.
[0m18:04:20.376073 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:04:20.376983 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:04:20.377911 [info ] [MainThread]: 
[0m18:04:20.378730 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.66 seconds (0.66s).
[0m18:04:20.380338 [debug] [MainThread]: Command end result
[0m18:04:20.424117 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:20.429497 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:20.438602 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:04:20.439519 [info ] [MainThread]: 
[0m18:04:20.440437 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:04:20.441264 [info ] [MainThread]: 
[0m18:04:20.442192 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:04:20.443902 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.6049418, "process_in_blocks": "0", "process_kernel_time": 0.642838, "process_mem_max_rss": "131720", "process_out_blocks": "0", "process_user_time": 2.3102}
[0m18:04:20.445095 [debug] [MainThread]: Command `dbt run` succeeded at 18:04:20.444990 after 2.61 seconds
[0m18:04:20.446045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae770a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae770a790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae67d5e50>]}
[0m18:04:20.446902 [debug] [MainThread]: Flushing usage events
[0m18:04:21.131697 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:04:23.897850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39a8f2150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39a8fe750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39a8f0490>]}


============================== 18:04:23.904820 | 73574422-1aa5-411a-a800-f24673275761 ==============================
[0m18:04:23.904820 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:04:23.908107 [debug] [MainThread]: running dbt with arguments {'log_path': '/usr/app/dbt/dbt/logs', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'empty': 'False', 'fail_fast': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'write_json': 'True', 'introspect': 'True', 'no_print': 'None', 'use_colors': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'version_check': 'True', 'static_parser': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m18:04:24.096673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a399da6510>]}
[0m18:04:24.153536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3999a9fd0>]}
[0m18:04:24.156479 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:04:24.353280 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:04:26.840450 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:04:26.841921 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:04:26.887106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39a89ec90>]}
[0m18:04:27.276195 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:27.294234 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:27.434305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39910b5d0>]}
[0m18:04:27.436167 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:04:27.437666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39999bc90>]}
[0m18:04:27.440381 [info ] [MainThread]: 
[0m18:04:27.441795 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:27.443642 [info ] [MainThread]: 
[0m18:04:27.445585 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:04:27.451473 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:04:27.538211 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:04:27.541613 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:04:27.543982 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:27.562693 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.019 seconds
[0m18:04:27.567712 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:04:27.571742 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:04:27.580080 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:27.582368 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:04:27.585676 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:27.597998 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m18:04:27.601319 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:27.603454 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:04:27.614351 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.007 seconds
[0m18:04:27.619738 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:04:27.622100 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:04:27.632675 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:27.638569 [debug] [MainThread]: On master: BEGIN
[0m18:04:27.644243 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:04:27.656777 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m18:04:27.661120 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:27.664176 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:04:27.677242 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m18:04:27.683824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3977dde50>]}
[0m18:04:27.685849 [debug] [MainThread]: On master: ROLLBACK
[0m18:04:27.690287 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:27.691634 [debug] [MainThread]: On master: BEGIN
[0m18:04:27.693217 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:04:27.697101 [debug] [MainThread]: On master: COMMIT
[0m18:04:27.700690 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:27.702073 [debug] [MainThread]: On master: COMMIT
[0m18:04:27.703860 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:27.706411 [debug] [MainThread]: On master: Close
[0m18:04:27.715526 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:04:27.718165 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:04:27.722012 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:04:27.726495 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:04:27.747692 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.785335 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:04:27.816360 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.834666 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.838896 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:04:27.842807 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:27.853472 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:27.855431 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.858615 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:04:27.870528 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m18:04:27.879748 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.882093 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:04:27.885512 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:04:27.891280 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.893811 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:04:27.900311 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:27.916274 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:27.919039 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.921849 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:27.926107 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m18:04:27.932998 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:04:27.939325 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.941154 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:04:27.948412 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m18:04:27.953644 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:04:27.956378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39760e510>]}
[0m18:04:27.958391 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.23s]
[0m18:04:27.960330 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:04:27.962602 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:04:27.962896 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:04:27.963244 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:04:27.964598 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:04:27.966433 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:04:27.967930 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:04:27.970148 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:04:27.971802 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:04:27.973768 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:04:27.975438 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:04:27.976755 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:04:27.978451 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:04:27.985605 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:04:27.990924 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:27.995533 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.005477 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:04:28.006175 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:04:28.012796 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:04:28.025425 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.030130 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:04:28.033962 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.044690 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.046451 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.047082 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:04:28.048287 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:04:28.048723 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.050568 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:04:28.052307 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:04:28.053657 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:04:28.058098 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:04:28.064544 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m18:04:28.066468 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.066921 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m18:04:28.068228 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:04:28.069288 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:28.070007 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.071955 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.073171 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:04:28.075373 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:04:28.079920 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.009 seconds
[0m18:04:28.089437 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.090088 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m18:04:28.091431 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:04:28.092336 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.015 seconds
[0m18:04:28.099998 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.103977 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.108219 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.110353 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:04:28.114634 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.116213 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:04:28.118314 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.119234 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:04:28.121307 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.124973 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.127635 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.132044 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.134280 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:04:28.136277 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:28.137423 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:04:28.139995 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.140601 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.143283 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.146116 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:28.150336 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:28.153514 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:28.156780 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.159472 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.161131 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:28.162263 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m18:04:28.163121 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:28.168076 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m18:04:28.172396 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:04:28.178990 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:04:28.179536 [debug] [Thread-4 (]: SQL status: COMMIT in 0.005 seconds
[0m18:04:28.185189 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.189172 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.197227 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:04:28.200132 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:04:28.203800 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:04:28.211275 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.218994 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:04:28.221372 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.007 seconds
[0m18:04:28.222913 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:04:28.227654 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:04:28.228083 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:28.230777 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:04:28.233375 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39afaa390>]}
[0m18:04:28.236205 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:04:28.238745 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3945b0fd0>]}
[0m18:04:28.240738 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.26s]
[0m18:04:28.244564 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39451ba90>]}
[0m18:04:28.246255 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.27s]
[0m18:04:28.248436 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:04:28.252092 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.27s]
[0m18:04:28.253764 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:04:28.257523 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:04:28.259160 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:04:28.262288 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:04:28.264012 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:04:28.266794 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:04:28.267683 [info ] [Thread-2 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:04:28.269603 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_monthly)
[0m18:04:28.271712 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:04:28.274570 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m18:04:28.277031 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:04:28.279687 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m18:04:28.281395 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:04:28.286477 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.288130 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:04:28.292900 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.303896 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.313367 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:04:28.317817 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.318529 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:04:28.320262 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:04:28.325023 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.329131 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.336296 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.338651 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:04:28.340021 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.340483 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:28.341774 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:04:28.345468 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.348091 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:04:28.349663 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:04:28.352373 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m18:04:28.353142 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:04:28.355684 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.358526 [debug] [Thread-2 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:28.359253 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:04:28.360820 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.364203 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:28.365342 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:04:28.366085 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.004 seconds
[0m18:04:28.367365 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.374061 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.374481 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.006 seconds
[0m18:04:28.375411 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:04:28.376891 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:04:28.380840 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.383760 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.384061 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:04:28.388236 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.388695 [debug] [Thread-3 (]: SQL status: SELECT 704 in 0.006 seconds
[0m18:04:28.390497 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.390798 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:04:28.394304 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.398285 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.400407 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.401072 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:04:28.402525 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:04:28.404521 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:28.406615 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.407517 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:04:28.407966 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.411543 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.413166 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:28.414755 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:28.415984 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:04:28.416969 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.420426 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.420836 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:28.422896 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:28.424706 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.425816 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:28.427348 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m18:04:28.432294 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:04:28.432878 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m18:04:28.433241 [debug] [Thread-2 (]: SQL status: COMMIT in 0.009 seconds
[0m18:04:28.434438 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.437534 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:04:28.441542 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:04:28.442841 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:04:28.445105 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.447148 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.450735 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:04:28.452456 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:04:28.454728 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:28.458376 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:04:28.459402 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:04:28.460812 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3944b7790>]}
[0m18:04:28.462972 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:04:28.463364 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.009 seconds
[0m18:04:28.464493 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.19s]
[0m18:04:28.465811 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3944d2550>]}
[0m18:04:28.468360 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:04:28.469598 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:04:28.471322 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.19s]
[0m18:04:28.473576 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3944d2150>]}
[0m18:04:28.476322 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:04:28.478645 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.20s]
[0m18:04:28.481652 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:04:28.485647 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:28.486960 [debug] [MainThread]: On master: BEGIN
[0m18:04:28.488089 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:04:28.497485 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m18:04:28.498658 [debug] [MainThread]: On master: COMMIT
[0m18:04:28.500054 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:28.501703 [debug] [MainThread]: On master: COMMIT
[0m18:04:28.503964 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:28.506304 [debug] [MainThread]: On master: Close
[0m18:04:28.509159 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:04:28.511198 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:04:28.512264 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:04:28.513084 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:04:28.514269 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:04:28.515293 [info ] [MainThread]: 
[0m18:04:28.516324 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.07 seconds (1.07s).
[0m18:04:28.519001 [debug] [MainThread]: Command end result
[0m18:04:28.654435 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:28.672137 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:28.703011 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:04:28.706855 [info ] [MainThread]: 
[0m18:04:28.711314 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:04:28.713883 [info ] [MainThread]: 
[0m18:04:28.715629 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:04:28.718721 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.7075634, "process_in_blocks": "0", "process_kernel_time": 0.813964, "process_mem_max_rss": "131124", "process_out_blocks": "0", "process_user_time": 2.370196}
[0m18:04:28.723209 [debug] [MainThread]: Command `dbt run` succeeded at 18:04:28.723012 after 4.71 seconds
[0m18:04:28.729115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39f3f7910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39f1aecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39f1aeb90>]}
[0m18:04:28.731938 [debug] [MainThread]: Flushing usage events
[0m18:04:29.507458 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:04:33.186831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f7946f3e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f7946fe310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f794b07410>]}


============================== 18:04:33.199338 | a8f7e056-5cc2-492e-9047-4227633ea6b2 ==============================
[0m18:04:33.199338 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:04:33.202099 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'fail_fast': 'False', 'empty': 'False', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'quiet': 'False', 'log_format': 'default', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'write_json': 'True', 'introspect': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'static_parser': 'True', 'printer_width': '80', 'use_colors': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'log_path': '/usr/app/dbt/dbt/logs'}
[0m18:04:33.408381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f794a24550>]}
[0m18:04:33.460860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f7946fe990>]}
[0m18:04:33.465196 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:04:33.605872 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:04:35.772200 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:04:35.773371 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:04:35.814726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f793570a90>]}
[0m18:04:35.999144 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:36.006931 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:36.191680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f793c9f550>]}
[0m18:04:36.194349 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:04:36.196036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f792d500d0>]}
[0m18:04:36.203621 [info ] [MainThread]: 
[0m18:04:36.205979 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:36.207466 [info ] [MainThread]: 
[0m18:04:36.209087 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:04:36.215812 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:04:36.369227 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:04:36.371167 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:04:36.372782 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:36.388312 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m18:04:36.390834 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:04:36.394164 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:04:36.400965 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:36.402067 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:04:36.403282 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:36.412771 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m18:04:36.414059 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:36.415085 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:04:36.422350 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.006 seconds
[0m18:04:36.425535 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:04:36.426899 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:04:36.433916 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:36.435088 [debug] [MainThread]: On master: BEGIN
[0m18:04:36.436057 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:04:36.447352 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m18:04:36.448636 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:36.449706 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:04:36.456930 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m18:04:36.459707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f794dce3d0>]}
[0m18:04:36.460878 [debug] [MainThread]: On master: ROLLBACK
[0m18:04:36.462012 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:36.463223 [debug] [MainThread]: On master: BEGIN
[0m18:04:36.464541 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:04:36.465689 [debug] [MainThread]: On master: COMMIT
[0m18:04:36.466626 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:36.467549 [debug] [MainThread]: On master: COMMIT
[0m18:04:36.468676 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:36.469645 [debug] [MainThread]: On master: Close
[0m18:04:36.476661 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:04:36.482261 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:04:36.483619 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:04:36.484655 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:04:36.504337 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.573659 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:04:36.608755 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.627002 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.628569 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:04:36.630010 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:36.640118 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:36.641401 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.642576 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:04:36.649863 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m18:04:36.659436 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.661437 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:04:36.665280 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:04:36.671399 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.673184 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:04:36.675949 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.690648 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:36.692750 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.696359 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:36.705294 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m18:04:36.712470 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:04:36.718432 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.722509 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:04:36.728634 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m18:04:36.733197 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:04:36.736074 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f79297f810>]}
[0m18:04:36.739913 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.25s]
[0m18:04:36.741729 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:04:36.743971 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:04:36.744407 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:04:36.744815 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:04:36.755613 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:04:36.762449 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:04:36.767252 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:04:36.769537 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:04:36.771707 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:04:36.774360 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:04:36.776233 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:04:36.784047 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:04:36.785450 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:04:36.790630 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:04:36.794752 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.798625 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.808823 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:04:36.809254 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:04:36.815532 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:04:36.828222 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:04:36.837520 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.841606 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.858041 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.860926 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:36.862826 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:04:36.864392 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:04:36.864966 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.865914 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:04:36.867202 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:04:36.868993 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:04:36.873045 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:04:36.878459 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m18:04:36.879905 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m18:04:36.881393 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.882848 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:36.884318 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:36.884734 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:04:36.885808 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:04:36.886968 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.901501 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.013 seconds
[0m18:04:36.921101 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:04:36.922398 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m18:04:36.929895 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.939325 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:36.940525 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:04:36.941771 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:04:36.943835 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.944299 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.947401 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.947724 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.015 seconds
[0m18:04:36.952398 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:36.953433 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:04:36.956786 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.957709 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:04:36.959079 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:04:36.959349 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.960797 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.961154 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.962571 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:36.964139 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:36.969915 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.970970 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.971870 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:36.972780 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:04:36.973693 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:36.974603 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:36.976076 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.978257 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:36.979685 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.981929 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:36.986157 [debug] [Thread-2 (]: SQL status: COMMIT in 0.010 seconds
[0m18:04:36.989857 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:04:36.990273 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m18:04:36.990600 [debug] [Thread-3 (]: SQL status: COMMIT in 0.014 seconds
[0m18:04:36.993845 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.996358 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:04:36.999886 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:04:37.001580 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:04:37.002792 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:37.003945 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:37.005567 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:04:37.006496 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:04:37.009574 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:37.011289 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:04:37.012414 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f79473b8d0>]}
[0m18:04:37.013582 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.24s]
[0m18:04:37.020010 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:04:37.022369 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.015 seconds
[0m18:04:37.026680 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.019 seconds
[0m18:04:37.044216 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:04:37.050645 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:04:37.049564 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:04:37.047625 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:04:37.051956 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_monthly)
[0m18:04:37.054345 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f7915dfe10>]}
[0m18:04:37.056205 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f790231090>]}
[0m18:04:37.057788 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:04:37.059722 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.28s]
[0m18:04:37.061343 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.28s]
[0m18:04:37.067081 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.076343 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:04:37.082458 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:04:37.097983 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:04:37.100848 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:04:37.104403 [info ] [Thread-2 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:04:37.107286 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:04:37.110288 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m18:04:37.117156 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m18:04:37.119090 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:04:37.120408 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:04:37.126113 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.126488 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:04:37.130445 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.138347 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.149149 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:04:37.150397 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:04:37.154990 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.161566 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.162006 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.165217 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:04:37.166638 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:37.171298 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.172662 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:04:37.175291 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.175741 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:04:37.177509 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:37.179002 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:04:37.182376 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.183971 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:04:37.185599 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:04:37.188222 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m18:04:37.191835 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.193258 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.004 seconds
[0m18:04:37.193589 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:04:37.195244 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:37.199977 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.201615 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.202556 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:04:37.203539 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:04:37.204134 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.003 seconds
[0m18:04:37.204990 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:37.208242 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.208664 [debug] [Thread-3 (]: SQL status: SELECT 704 in 0.004 seconds
[0m18:04:37.211764 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.212880 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:04:37.216312 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.217185 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:04:37.218617 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:37.218942 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:04:37.223287 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.223596 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m18:04:37.226044 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:04:37.226415 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:37.227985 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:37.229697 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:37.233325 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.234546 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.237546 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:37.238478 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:04:37.239433 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:37.240499 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.241865 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:37.243043 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:37.244868 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:37.245980 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m18:04:37.246543 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.249324 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:04:37.250496 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:37.251806 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.253266 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:04:37.257319 [debug] [Thread-2 (]: SQL status: COMMIT in 0.012 seconds
[0m18:04:37.260442 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:04:37.261779 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.262705 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:04:37.268897 [debug] [Thread-3 (]: SQL status: COMMIT in 0.016 seconds
[0m18:04:37.269244 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.015 seconds
[0m18:04:37.273288 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:04:37.275202 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:04:37.276302 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.277563 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f7902c6190>]}
[0m18:04:37.278467 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:04:37.279938 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.23s]
[0m18:04:37.280509 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.017 seconds
[0m18:04:37.282504 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:04:37.284628 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:04:37.285912 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:37.287188 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f790117090>]}
[0m18:04:37.288645 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:04:37.289835 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.18s]
[0m18:04:37.296414 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f790117b90>]}
[0m18:04:37.301625 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:04:37.303103 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.18s]
[0m18:04:37.305150 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:04:37.308382 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:37.309571 [debug] [MainThread]: On master: BEGIN
[0m18:04:37.310799 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:04:37.321236 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m18:04:37.326536 [debug] [MainThread]: On master: COMMIT
[0m18:04:37.328500 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:37.330988 [debug] [MainThread]: On master: COMMIT
[0m18:04:37.332719 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:37.348076 [debug] [MainThread]: On master: Close
[0m18:04:37.351276 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:04:37.352794 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:04:37.354281 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:04:37.355511 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:04:37.357651 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:04:37.359098 [info ] [MainThread]: 
[0m18:04:37.361113 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.15 seconds (1.15s).
[0m18:04:37.364100 [debug] [MainThread]: Command end result
[0m18:04:37.439710 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:37.448360 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:37.494473 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:04:37.500046 [info ] [MainThread]: 
[0m18:04:37.508684 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:04:37.511539 [info ] [MainThread]: 
[0m18:04:37.514464 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:04:37.518449 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.4973617, "process_in_blocks": "0", "process_kernel_time": 0.892743, "process_mem_max_rss": "131428", "process_out_blocks": "0", "process_user_time": 2.398476}
[0m18:04:37.520952 [debug] [MainThread]: Command `dbt run` succeeded at 18:04:37.520747 after 4.50 seconds
[0m18:04:37.523950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f798f7f8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f798f9ab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f798f9a9d0>]}
[0m18:04:37.526251 [debug] [MainThread]: Flushing usage events
[0m18:04:38.228703 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:04:42.448096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6686dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6686fa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6686e350>]}


============================== 18:04:42.459081 | 544ca202-1690-42d5-a0fa-5fe062709a6d ==============================
[0m18:04:42.459081 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:04:42.471414 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'empty': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'printer_width': '80', 'write_json': 'True', 'invocation_command': 'dbt run', 'use_colors': 'True', 'fail_fast': 'False', 'quiet': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'partial_parse': 'True', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'static_parser': 'True', 'no_print': 'None', 'introspect': 'True', 'target_path': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'log_cache_events': 'False'}
[0m18:04:42.658511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac65566110>]}
[0m18:04:42.710819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac69598ad0>]}
[0m18:04:42.712967 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:04:42.824396 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:04:44.948519 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:04:44.950410 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:04:44.987320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac64d67d10>]}
[0m18:04:45.105748 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:45.113535 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:45.278863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac65911490>]}
[0m18:04:45.286730 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:04:45.292351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac645dcd90>]}
[0m18:04:45.301140 [info ] [MainThread]: 
[0m18:04:45.305600 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:45.310663 [info ] [MainThread]: 
[0m18:04:45.316386 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:04:45.329761 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:04:45.442345 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:04:45.444441 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:04:45.446817 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:45.461109 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.014 seconds
[0m18:04:45.466581 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:04:45.471836 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:04:45.478795 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:45.480161 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:04:45.481499 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:45.490923 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m18:04:45.492652 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:45.494144 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:04:45.502961 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.007 seconds
[0m18:04:45.506373 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:04:45.508107 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:04:45.514646 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:45.516460 [debug] [MainThread]: On master: BEGIN
[0m18:04:45.518609 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:04:45.529817 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m18:04:45.534009 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:45.536155 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:04:45.546280 [debug] [MainThread]: SQL status: SELECT 1 in 0.009 seconds
[0m18:04:45.549172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6684e650>]}
[0m18:04:45.550525 [debug] [MainThread]: On master: ROLLBACK
[0m18:04:45.554394 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:45.555652 [debug] [MainThread]: On master: BEGIN
[0m18:04:45.557462 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:04:45.558696 [debug] [MainThread]: On master: COMMIT
[0m18:04:45.559738 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:45.560993 [debug] [MainThread]: On master: COMMIT
[0m18:04:45.562223 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:45.563421 [debug] [MainThread]: On master: Close
[0m18:04:45.575094 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:04:45.578975 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:04:45.581299 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:04:45.585642 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:04:45.605609 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.630939 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:04:45.655008 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.668370 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.671027 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:04:45.672942 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:45.684831 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m18:04:45.687515 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.690501 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:04:45.699889 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m18:04:45.707879 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.709193 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:04:45.711650 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:45.716359 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.718009 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:04:45.721372 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:04:45.737785 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:45.739636 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.741019 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:45.755587 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m18:04:45.763384 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:04:45.768766 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.770897 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:04:45.777001 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m18:04:45.780822 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:04:45.785211 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6553e850>]}
[0m18:04:45.787570 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.20s]
[0m18:04:45.789362 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:04:45.791837 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:04:45.792370 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:04:45.792671 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:04:45.793604 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:04:45.794788 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:04:45.795748 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:04:45.796741 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:04:45.797665 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:04:45.798735 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:04:45.799899 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:04:45.801055 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:04:45.801917 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:04:45.806295 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:04:45.810547 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:45.813451 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:45.821936 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:04:45.822473 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:04:45.828865 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:04:45.845578 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:45.852027 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:45.857334 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:04:45.871020 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:45.872391 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:45.873299 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:04:45.874075 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:45.874944 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:04:45.876207 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:04:45.877757 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:04:45.878775 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:04:45.880842 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:04:45.888487 [debug] [Thread-4 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:45.889750 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:45.890500 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:04:45.891658 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:45.892663 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:45.893353 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:04:46.220696 [debug] [Thread-2 (]: SQL status: BEGIN in 0.344 seconds
[0m18:04:46.224496 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:46.226245 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:04:46.527427 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.633 seconds
[0m18:04:46.534375 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.305 seconds
[0m18:04:46.534980 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.643 seconds
[0m18:04:46.545127 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:46.552382 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:46.558147 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:46.560409 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:04:46.562314 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:04:46.564024 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:04:46.565543 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:46.565840 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:46.567015 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:04:46.569428 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:46.572457 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:46.575172 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:46.576074 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:04:46.576870 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:04:46.577764 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:04:46.579682 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:46.580471 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:46.581101 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:04:46.582120 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:46.583510 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:46.584839 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:46.585605 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:46.586751 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:46.587879 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:46.588966 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:46.592636 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:46.593759 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:46.733982 [debug] [Thread-3 (]: SQL status: COMMIT in 0.139 seconds
[0m18:04:46.742283 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:04:46.743049 [debug] [Thread-4 (]: SQL status: COMMIT in 0.147 seconds
[0m18:04:46.743599 [debug] [Thread-2 (]: SQL status: COMMIT in 0.148 seconds
[0m18:04:46.748782 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:46.752662 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:04:46.758177 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:04:46.759905 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:04:46.762181 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:46.764144 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:46.770296 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:04:46.771607 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:04:46.840776 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.075 seconds
[0m18:04:46.844255 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.069 seconds
[0m18:04:46.844774 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.071 seconds
[0m18:04:46.860025 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:04:46.876465 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:04:46.884669 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:04:46.887010 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6553e850>]}
[0m18:04:46.888818 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac636f7a90>]}
[0m18:04:46.890785 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac66875d50>]}
[0m18:04:46.892842 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 1.09s]
[0m18:04:46.895028 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 1.09s]
[0m18:04:46.896633 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 1.09s]
[0m18:04:46.898451 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:04:46.900204 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:04:46.901998 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:04:46.903957 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:04:46.905443 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:04:46.906852 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:04:46.907963 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:04:46.909249 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:04:46.910638 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:04:46.911780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m18:04:46.912844 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:04:46.914009 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m18:04:46.915156 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:04:46.916145 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:04:46.917155 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:04:46.920412 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:46.925075 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:46.929665 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:46.936622 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:04:46.937108 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:04:46.942148 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:46.942772 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:04:46.954306 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:46.963121 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.071936 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.072704 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.074768 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:04:47.082251 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.085661 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:04:47.099872 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:47.104227 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:04:47.110814 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:04:47.125589 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:04:47.157013 [debug] [Thread-1 (]: SQL status: BEGIN in 0.057 seconds
[0m18:04:47.165782 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.169303 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:04:47.170528 [debug] [Thread-2 (]: SQL status: BEGIN in 0.060 seconds
[0m18:04:47.170967 [debug] [Thread-3 (]: SQL status: BEGIN in 0.045 seconds
[0m18:04:47.175442 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.177153 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.178820 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.006 seconds
[0m18:04:47.179216 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:04:47.188059 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:04:47.192627 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.197647 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:04:47.199691 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.223799 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.228398 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:04:47.238858 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.244509 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:47.247553 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.263147 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:47.350688 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.156 seconds
[0m18:04:47.352522 [debug] [Thread-2 (]: SQL status: SELECT 704 in 0.158 seconds
[0m18:04:47.359611 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.370237 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.374090 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:04:47.376685 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:04:47.379769 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.381093 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.385743 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.391208 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.392884 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:04:47.394339 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:04:47.396495 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.398194 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.400131 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:47.403410 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:47.405236 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.407040 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.408478 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:47.409866 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:47.450421 [debug] [Thread-1 (]: SQL status: COMMIT in 0.172 seconds
[0m18:04:47.457372 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:04:47.459867 [debug] [Thread-2 (]: SQL status: COMMIT in 0.048 seconds
[0m18:04:47.460529 [debug] [Thread-3 (]: SQL status: COMMIT in 0.049 seconds
[0m18:04:47.464860 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.473228 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:04:47.479494 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:04:47.483950 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:04:47.486964 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.488837 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.493638 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:04:47.498498 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:04:47.670160 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.179 seconds
[0m18:04:47.671733 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.165 seconds
[0m18:04:47.672260 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.170 seconds
[0m18:04:47.686876 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:04:47.690974 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:04:47.695938 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:04:47.698901 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac603c0b50>]}
[0m18:04:47.701136 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac603d6310>]}
[0m18:04:47.703719 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac603e0050>]}
[0m18:04:47.705773 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.79s]
[0m18:04:47.708015 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.79s]
[0m18:04:47.709836 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.79s]
[0m18:04:47.711259 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:04:47.712509 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:04:47.713542 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:04:47.718754 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:47.719814 [debug] [MainThread]: On master: BEGIN
[0m18:04:47.721008 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:04:47.729439 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m18:04:47.730642 [debug] [MainThread]: On master: COMMIT
[0m18:04:47.732009 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:47.733092 [debug] [MainThread]: On master: COMMIT
[0m18:04:47.734156 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:47.735813 [debug] [MainThread]: On master: Close
[0m18:04:47.737137 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:04:47.738178 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:04:47.739325 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:04:47.740748 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:04:47.741987 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:04:47.743186 [info ] [MainThread]: 
[0m18:04:47.744207 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 2.43 seconds (2.43s).
[0m18:04:47.746579 [debug] [MainThread]: Command end result
[0m18:04:47.817491 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:47.824747 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:47.836340 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:04:47.837245 [info ] [MainThread]: 
[0m18:04:47.838360 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:04:47.839238 [info ] [MainThread]: 
[0m18:04:47.840244 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:04:47.888347 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.5555024, "process_in_blocks": "0", "process_kernel_time": 0.945867, "process_mem_max_rss": "131428", "process_out_blocks": "0", "process_user_time": 2.847611}
[0m18:04:47.892695 [debug] [MainThread]: Command `dbt run` succeeded at 18:04:47.892283 after 5.56 seconds
[0m18:04:47.901687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6b127890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6b142950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6b143610>]}
[0m18:04:47.907714 [debug] [MainThread]: Flushing usage events
[0m18:04:48.785163 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:04:55.650777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bde05a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bde66450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bde205d0>]}


============================== 18:04:55.657562 | 48b1ac31-cb25-4f70-97f5-36f756604408 ==============================
[0m18:04:55.657562 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:04:55.659491 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'debug': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'use_colors': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'indirect_selection': 'eager', 'log_format': 'default', 'no_print': 'None', 'version_check': 'True', 'log_cache_events': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'static_parser': 'True', 'invocation_command': 'dbt run', 'quiet': 'False', 'empty': 'False', 'log_path': '/usr/app/dbt/dbt/logs'}
[0m18:04:55.830816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bcffe250>]}
[0m18:04:55.885596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9c0b76690>]}
[0m18:04:55.888478 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:04:56.085668 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:04:58.388794 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:04:58.396164 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:04:58.439051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bc38ae50>]}
[0m18:04:58.628274 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:58.638926 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:58.781983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bcb0d710>]}
[0m18:04:58.784229 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:04:58.785746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bdfa4090>]}
[0m18:04:58.791776 [info ] [MainThread]: 
[0m18:04:58.794234 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:58.796759 [info ] [MainThread]: 
[0m18:04:58.803890 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:04:58.812342 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:04:58.876549 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:04:58.879259 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:04:58.880782 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:58.898212 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m18:04:58.901963 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:04:58.907223 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:04:58.914504 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:58.915635 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:04:58.916958 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:58.926845 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m18:04:58.928214 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:58.929283 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:04:58.935859 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.005 seconds
[0m18:04:58.938860 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:04:58.941712 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:04:58.949410 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:58.950475 [debug] [MainThread]: On master: BEGIN
[0m18:04:58.951398 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:04:58.960642 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m18:04:58.962209 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:58.963672 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:04:58.974413 [debug] [MainThread]: SQL status: SELECT 1 in 0.009 seconds
[0m18:04:58.977428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9be4f2750>]}
[0m18:04:58.979079 [debug] [MainThread]: On master: ROLLBACK
[0m18:04:58.980668 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:58.981802 [debug] [MainThread]: On master: BEGIN
[0m18:04:58.983444 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m18:04:58.984763 [debug] [MainThread]: On master: COMMIT
[0m18:04:58.986313 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:58.987897 [debug] [MainThread]: On master: COMMIT
[0m18:04:58.989446 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:58.990479 [debug] [MainThread]: On master: Close
[0m18:04:59.009519 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:04:59.011054 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:04:59.013089 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:04:59.014159 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:04:59.032469 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.044678 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:04:59.071401 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.082412 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.084591 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:04:59.085755 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:59.096300 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:59.097819 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.099269 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:04:59.108067 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m18:04:59.115161 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.116251 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:04:59.118492 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.122685 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.147039 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:04:59.152357 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.169655 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:59.175432 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.186167 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:59.195569 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m18:04:59.206490 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:04:59.215896 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.224730 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:04:59.238362 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.008 seconds
[0m18:04:59.250242 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:04:59.254903 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bde5b250>]}
[0m18:04:59.258505 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.24s]
[0m18:04:59.261348 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:04:59.264784 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:04:59.265432 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:04:59.266091 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:04:59.268229 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:04:59.270650 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:04:59.274443 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:04:59.276816 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:04:59.279053 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:04:59.281488 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:04:59.291467 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:04:59.298106 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:04:59.305803 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:04:59.317434 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:04:59.329968 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.347013 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.409490 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:04:59.413758 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:04:59.443215 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.443826 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:04:59.454421 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:04:59.477713 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.498240 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.499129 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.505210 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:04:59.507317 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.508378 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:04:59.524526 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:04:59.526554 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:04:59.528160 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:04:59.530617 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:04:59.537281 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m18:04:59.540271 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.542457 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:04:59.543365 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m18:04:59.545726 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.547089 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:04:59.561322 [debug] [Thread-2 (]: SQL status: BEGIN in 0.030 seconds
[0m18:04:59.561900 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.013 seconds
[0m18:04:59.562189 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.018 seconds
[0m18:04:59.563507 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.570266 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.575981 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.590058 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:04:59.591615 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:04:59.593031 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:04:59.596180 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.597961 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.602588 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.608194 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.610366 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:04:59.614501 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:04:59.617299 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.618926 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.621966 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:59.622608 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.028 seconds
[0m18:04:59.627998 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:59.630265 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.636392 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.642740 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.645019 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:59.647231 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:04:59.649219 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:59.652735 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.658791 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.660742 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:04:59.662607 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.665086 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:59.666298 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.667637 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:59.668120 [debug] [Thread-3 (]: SQL status: COMMIT in 0.017 seconds
[0m18:04:59.669319 [debug] [Thread-4 (]: SQL status: COMMIT in 0.015 seconds
[0m18:04:59.672848 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:04:59.677219 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:04:59.682207 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.682594 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m18:04:59.684382 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.686123 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:04:59.692148 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:04:59.693982 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:04:59.696990 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.698993 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:04:59.715343 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.020 seconds
[0m18:04:59.719353 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:04:59.721154 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bcb0e150>]}
[0m18:04:59.723378 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.44s]
[0m18:04:59.725064 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:04:59.726993 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:04:59.729378 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.029 seconds
[0m18:04:59.728855 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:04:59.730076 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.032 seconds
[0m18:04:59.732710 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:04:59.740930 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m18:04:59.753245 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:04:59.765044 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9b82dfe10>]}
[0m18:04:59.773542 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:04:59.782079 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9b82e45d0>]}
[0m18:04:59.788972 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.48s]
[0m18:04:59.795807 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.797718 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.50s]
[0m18:04:59.799507 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:04:59.802105 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:04:59.803798 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:04:59.805190 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:04:59.806579 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:04:59.808262 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:04:59.813775 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:04:59.817952 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m18:04:59.821016 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:04:59.824949 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:04:59.826546 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:04:59.830723 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.833689 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:59.836461 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:59.849794 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:04:59.858790 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:59.859147 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:04:59.867126 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.874342 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:59.877137 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:04:59.891690 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:59.893420 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:59.902937 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:04:59.907685 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:04:59.916353 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m18:04:59.918730 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.921176 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m18:04:59.924144 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:59.924795 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:04:59.926200 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:59.927498 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:04:59.932299 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.003 seconds
[0m18:04:59.933581 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:04:59.934887 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:04:59.941096 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.946723 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:04:59.948460 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.951206 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.953147 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:04:59.954067 [debug] [Thread-2 (]: SQL status: BEGIN in 0.019 seconds
[0m18:04:59.955159 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.956251 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:59.958382 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:59.960407 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.959474 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:04:59.961771 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.020 seconds
[0m18:04:59.977139 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:05:00.009929 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:00.013862 [debug] [Thread-2 (]: SQL status: SELECT 704 in 0.012 seconds
[0m18:05:00.029767 [debug] [Thread-1 (]: SQL status: COMMIT in 0.011 seconds
[0m18:05:00.031585 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:05:00.040345 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:00.044302 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:05:00.047377 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:00.048686 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:05:00.051613 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:00.057075 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:00.060259 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:00.061412 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:05:00.063540 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:05:00.068321 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:00.072685 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:00.073292 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:05:00.074865 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:05:00.076445 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:00.078996 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:00.081332 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:05:00.083004 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:00.087270 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:00.092147 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9b82e5d90>]}
[0m18:05:00.095822 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:00.097905 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:00.100139 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.35s]
[0m18:05:00.110379 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m18:05:00.111797 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:00.113982 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:05:00.118940 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:05:00.140002 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:00.140734 [debug] [Thread-2 (]: SQL status: COMMIT in 0.012 seconds
[0m18:05:00.142825 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:05:00.162146 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:05:00.176349 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:05:00.189131 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:00.194139 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:05:00.198262 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:05:00.202909 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9b81c8fd0>]}
[0m18:05:00.207492 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.39s]
[0m18:05:00.210866 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:05:00.216553 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:05:00.219785 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:05:00.224668 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9b81a5950>]}
[0m18:05:00.226807 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.41s]
[0m18:05:00.228925 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:05:00.233215 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:00.235112 [debug] [MainThread]: On master: BEGIN
[0m18:05:00.236568 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:05:00.249959 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m18:05:00.251730 [debug] [MainThread]: On master: COMMIT
[0m18:05:00.253337 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:00.255257 [debug] [MainThread]: On master: COMMIT
[0m18:05:00.262308 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:05:00.267816 [debug] [MainThread]: On master: Close
[0m18:05:00.272091 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:05:00.273831 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:05:00.275662 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:05:00.277564 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:05:00.279366 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:05:00.281348 [info ] [MainThread]: 
[0m18:05:00.283249 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.48 seconds (1.48s).
[0m18:05:00.286611 [debug] [MainThread]: Command end result
[0m18:05:00.430869 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:05:00.454139 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:05:00.482218 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:05:00.484685 [info ] [MainThread]: 
[0m18:05:00.488014 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:05:00.490575 [info ] [MainThread]: 
[0m18:05:00.492509 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:05:00.495754 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.8838515, "process_in_blocks": "0", "process_kernel_time": 0.751838, "process_mem_max_rss": "131472", "process_out_blocks": "0", "process_user_time": 2.46799}
[0m18:05:00.498194 [debug] [MainThread]: Command `dbt run` succeeded at 18:05:00.497983 after 4.89 seconds
[0m18:05:00.500339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9be160b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9c270f810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9c272aa50>]}
[0m18:05:00.502577 [debug] [MainThread]: Flushing usage events
[0m18:05:01.378943 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:05:10.308677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e9223fc9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e9223e3f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e92243e610>]}


============================== 18:05:10.321013 | 981c36fe-6752-4cf2-8f9d-6440b8da91f7 ==============================
[0m18:05:10.321013 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:05:10.325651 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'use_colors': 'True', 'invocation_command': 'dbt run', 'log_cache_events': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'empty': 'False', 'introspect': 'True', 'printer_width': '80', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'target_path': 'None'}
[0m18:05:10.581779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e92175d690>]}
[0m18:05:10.632788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e925140750>]}
[0m18:05:10.637563 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:05:10.789764 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:05:13.475059 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:05:13.476706 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:05:13.519856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e920f640d0>]}
[0m18:05:13.651841 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:05:13.664702 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:05:13.777536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e921736890>]}
[0m18:05:13.780288 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:05:13.782851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e920368150>]}
[0m18:05:13.788557 [info ] [MainThread]: 
[0m18:05:13.791445 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:05:13.793567 [info ] [MainThread]: 
[0m18:05:13.796360 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:05:13.803668 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:05:13.884793 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:05:13.886585 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:05:13.887727 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:05:13.907216 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.019 seconds
[0m18:05:13.910909 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:05:13.916132 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:05:13.925691 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:05:13.927278 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:05:13.928748 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:05:13.939650 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m18:05:13.941668 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:05:13.943412 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:05:13.952774 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.007 seconds
[0m18:05:13.956850 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:05:13.958761 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:05:13.969402 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:13.971026 [debug] [MainThread]: On master: BEGIN
[0m18:05:13.972761 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:05:13.988223 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m18:05:13.990298 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:13.992351 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:05:14.001344 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m18:05:14.004718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e9229a9c10>]}
[0m18:05:14.006393 [debug] [MainThread]: On master: ROLLBACK
[0m18:05:14.008355 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:14.009860 [debug] [MainThread]: On master: BEGIN
[0m18:05:14.011672 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:05:14.013425 [debug] [MainThread]: On master: COMMIT
[0m18:05:14.014596 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:14.015907 [debug] [MainThread]: On master: COMMIT
[0m18:05:14.017365 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:05:14.018866 [debug] [MainThread]: On master: Close
[0m18:05:14.029327 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:05:14.031463 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:05:14.033377 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:05:14.034859 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:05:14.056376 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.073032 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:05:14.114683 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.130295 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.131659 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:05:14.133243 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:14.142500 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m18:05:14.144211 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.145671 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:05:14.153443 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m18:05:14.160527 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.162116 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:05:14.164632 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.168331 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.169520 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:05:14.171518 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.186999 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:05:14.188746 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.189747 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:05:14.201302 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m18:05:14.208479 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:05:14.213951 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.215870 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:05:14.220686 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m18:05:14.223431 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:05:14.227184 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e91f112590>]}
[0m18:05:14.228952 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.19s]
[0m18:05:14.230146 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:05:14.231982 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:05:14.232307 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:05:14.232587 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:05:14.233761 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:05:14.235023 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:05:14.236138 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:05:14.237358 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:05:14.238433 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:05:14.239817 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:05:14.241312 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:05:14.242570 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:05:14.243644 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:05:14.248898 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:05:14.253219 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.256805 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.266363 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:05:14.266915 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:05:14.273756 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:05:14.286903 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:05:14.290540 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.293808 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.302613 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.303111 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.304556 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:05:14.305599 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.305992 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:05:14.307465 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:05:14.308923 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:05:14.310645 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:05:14.313277 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:05:14.324245 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m18:05:14.326013 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.327653 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:05:14.328472 [debug] [Thread-3 (]: SQL status: BEGIN in 0.018 seconds
[0m18:05:14.330460 [debug] [Thread-2 (]: SQL status: BEGIN in 0.023 seconds
[0m18:05:14.330986 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.332532 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.334033 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:05:14.335469 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:05:14.339705 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.010 seconds
[0m18:05:14.346530 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.348044 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:05:14.349754 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.353763 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.354923 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:05:14.355356 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.018 seconds
[0m18:05:14.356957 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.019 seconds
[0m18:05:14.357375 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.360530 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.364429 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.366467 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:05:14.367568 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:05:14.368533 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:05:14.369496 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.371151 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.371987 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.372246 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:05:14.375365 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.379091 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.381294 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:05:14.382495 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:05:14.385702 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.386955 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.388537 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:05:14.390858 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:05:14.392317 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.394049 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.395254 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:05:14.395763 [debug] [Thread-4 (]: SQL status: COMMIT in 0.015 seconds
[0m18:05:14.396615 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:05:14.401534 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:05:14.408353 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.409019 [debug] [Thread-3 (]: SQL status: COMMIT in 0.011 seconds
[0m18:05:14.410700 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:05:14.415379 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:05:14.417202 [debug] [Thread-2 (]: SQL status: COMMIT in 0.014 seconds
[0m18:05:14.419367 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.425663 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:05:14.427787 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:05:14.430031 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.432758 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:05:14.448131 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.030 seconds
[0m18:05:14.450106 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.016 seconds
[0m18:05:14.450680 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.019 seconds
[0m18:05:14.452983 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:05:14.456486 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:05:14.459274 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:05:14.461688 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e8ffe00b50>]}
[0m18:05:14.463316 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e8ffe22190>]}
[0m18:05:14.464641 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e9222ee010>]}
[0m18:05:14.465992 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.22s]
[0m18:05:14.467333 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.22s]
[0m18:05:14.469361 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.23s]
[0m18:05:14.470593 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:05:14.472148 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:05:14.473673 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:05:14.475657 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:05:14.476847 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:05:14.478466 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:05:14.479682 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:05:14.481025 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:05:14.482504 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:05:14.483541 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m18:05:14.484831 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m18:05:14.485691 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m18:05:14.486538 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:05:14.488354 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:05:14.489483 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:05:14.492772 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.497394 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.500862 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.510718 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:05:14.511243 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:05:14.518036 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:05:14.520389 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.527522 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.532794 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.543270 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.544095 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.545654 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:05:14.546581 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.548124 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:05:14.549963 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:05:14.551919 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:05:14.553492 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:05:14.556562 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:14.566841 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m18:05:14.567729 [debug] [Thread-2 (]: SQL status: BEGIN in 0.018 seconds
[0m18:05:14.568961 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.569789 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m18:05:14.570538 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.571699 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:05:14.573063 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.574376 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:05:14.577774 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:05:14.589883 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.014 seconds
[0m18:05:14.590687 [debug] [Thread-1 (]: SQL status: SELECT 704 in 0.010 seconds
[0m18:05:14.590996 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.011 seconds
[0m18:05:14.595399 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.599609 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.603534 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.604966 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:05:14.606356 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:05:14.607519 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:05:14.609555 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.620050 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.010 seconds
[0m18:05:14.621122 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.625205 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.630224 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.634216 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.635527 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:05:14.636957 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:05:14.638331 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:05:14.640216 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.641377 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.642665 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:05:14.644261 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:14.646014 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:14.647600 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:05:14.648576 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.649821 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.651175 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.652350 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:14.653630 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:14.654891 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:05:14.669193 [debug] [Thread-4 (]: SQL status: COMMIT in 0.013 seconds
[0m18:05:14.673582 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:05:14.675234 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.676161 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:05:14.679436 [debug] [Thread-2 (]: SQL status: COMMIT in 0.022 seconds
[0m18:05:14.679843 [debug] [Thread-1 (]: SQL status: COMMIT in 0.023 seconds
[0m18:05:14.682723 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:05:14.686937 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:05:14.688985 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.690764 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.691284 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.014 seconds
[0m18:05:14.692409 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:05:14.693556 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:05:14.696019 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:05:14.701052 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e8ffd01710>]}
[0m18:05:14.702794 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.22s]
[0m18:05:14.704099 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:05:14.709288 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.012 seconds
[0m18:05:14.712238 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:05:14.714560 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e8ffd02ed0>]}
[0m18:05:14.716771 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.23s]
[0m18:05:14.718314 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:05:14.720114 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.022 seconds
[0m18:05:14.722797 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:05:14.725001 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e8ffeed310>]}
[0m18:05:14.739404 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.24s]
[0m18:05:14.741037 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:05:14.744766 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:14.746284 [debug] [MainThread]: On master: BEGIN
[0m18:05:14.747510 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:05:14.757691 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m18:05:14.759043 [debug] [MainThread]: On master: COMMIT
[0m18:05:14.760540 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:14.761691 [debug] [MainThread]: On master: COMMIT
[0m18:05:14.762985 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:05:14.764195 [debug] [MainThread]: On master: Close
[0m18:05:14.765870 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:05:14.766972 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:05:14.767947 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_daily' was properly closed.
[0m18:05:14.769005 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:05:14.769983 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:05:14.771017 [info ] [MainThread]: 
[0m18:05:14.772066 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m18:05:14.774051 [debug] [MainThread]: Command end result
[0m18:05:14.891393 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:05:14.905367 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:05:14.932981 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:05:14.934773 [info ] [MainThread]: 
[0m18:05:14.936441 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:05:14.938048 [info ] [MainThread]: 
[0m18:05:14.939817 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:05:14.943481 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.745429, "process_in_blocks": "0", "process_kernel_time": 0.729069, "process_mem_max_rss": "131444", "process_out_blocks": "0", "process_user_time": 2.29491}
[0m18:05:14.947059 [debug] [MainThread]: Command `dbt run` succeeded at 18:05:14.946856 after 4.75 seconds
[0m18:05:14.949559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e926cc3890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e926cdeb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e926cde9d0>]}
[0m18:05:14.951338 [debug] [MainThread]: Flushing usage events
[0m18:05:16.068214 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:05:31.361922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbda1a7750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd745a910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd7459fd0>]}


============================== 18:05:31.370418 | 83a18b06-aa6b-43ec-b6ac-f9428c4ed63d ==============================
[0m18:05:31.370418 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:05:31.375345 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'target_path': 'None', 'empty': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'warn_error': 'None', 'use_colors': 'True', 'introspect': 'True', 'printer_width': '80', 'invocation_command': 'dbt run', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'quiet': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'fail_fast': 'False'}
[0m18:05:31.576961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd65645d0>]}
[0m18:05:31.619022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbda1d28d0>]}
[0m18:05:31.621943 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:05:31.846608 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:05:34.280616 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:05:34.281771 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:05:34.319086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd5d08390>]}
[0m18:05:34.452763 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:05:34.477690 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:05:34.615338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd690cb50>]}
[0m18:05:34.617453 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:05:34.619596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd65c5590>]}
[0m18:05:34.624540 [info ] [MainThread]: 
[0m18:05:34.626449 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:05:34.628173 [info ] [MainThread]: 
[0m18:05:34.629851 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:05:34.637344 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:05:34.691865 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:05:34.695791 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:05:34.697686 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:05:34.714235 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m18:05:34.718070 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:05:34.723590 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:05:34.730378 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:05:34.733372 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:05:34.734814 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:05:34.745800 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m18:05:34.747309 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:05:34.748556 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:05:34.754124 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.004 seconds
[0m18:05:34.757189 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:05:34.758508 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:05:34.765072 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:34.766488 [debug] [MainThread]: On master: BEGIN
[0m18:05:34.768025 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:05:34.779532 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m18:05:34.780980 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:34.781867 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:05:34.788993 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m18:05:34.792053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd76c43d0>]}
[0m18:05:34.793809 [debug] [MainThread]: On master: ROLLBACK
[0m18:05:34.795829 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:34.798201 [debug] [MainThread]: On master: BEGIN
[0m18:05:34.801831 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:05:34.805751 [debug] [MainThread]: On master: COMMIT
[0m18:05:34.806824 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:34.807948 [debug] [MainThread]: On master: COMMIT
[0m18:05:34.809340 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:05:34.810446 [debug] [MainThread]: On master: Close
[0m18:05:34.819434 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:05:34.821549 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:05:34.824016 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:05:34.827260 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:05:34.844177 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.861949 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:05:34.885347 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.910594 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.912418 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:05:34.913985 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:34.924200 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m18:05:34.927219 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.929565 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:05:34.936498 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m18:05:34.944745 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.946482 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:05:34.949799 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:34.953524 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.954762 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:05:34.960238 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:34.976997 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:05:34.978814 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.979999 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:05:34.995995 [debug] [Thread-1 (]: SQL status: COMMIT in 0.014 seconds
[0m18:05:35.004780 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:05:35.012968 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:35.015401 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:05:35.026147 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.009 seconds
[0m18:05:35.031787 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:05:35.036179 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd4213350>]}
[0m18:05:35.038266 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.21s]
[0m18:05:35.041074 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:05:35.044299 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:05:35.044861 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:05:35.045537 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:05:35.047449 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:05:35.050012 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:05:35.051985 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:05:35.053842 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:05:35.056752 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:05:35.058328 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:05:35.059737 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:05:35.061481 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:05:35.065222 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:05:35.075323 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:05:35.082729 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.089705 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.113982 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:05:35.114901 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:05:35.124774 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:05:35.156716 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.157634 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:05:35.167842 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.179364 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.181185 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:05:35.181845 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.183184 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:05:35.183691 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.185460 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:05:35.189154 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:05:35.190894 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:05:35.192897 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:05:35.197737 [debug] [Thread-4 (]: SQL status: BEGIN in 0.014 seconds
[0m18:05:35.200245 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.202255 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:05:35.203294 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m18:05:35.203670 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:05:35.205262 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.206722 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.207981 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:05:35.209168 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:05:35.214208 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.010 seconds
[0m18:05:35.222113 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.224143 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.013 seconds
[0m18:05:35.224568 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:05:35.229488 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.229858 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.017 seconds
[0m18:05:35.231565 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.232272 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:05:35.236648 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.240313 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.242551 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.242894 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:05:35.244394 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:05:35.248280 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.250777 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.252270 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.252984 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:05:35.257578 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.259927 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:05:35.262579 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:05:35.262970 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.264008 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.266025 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.267846 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:05:35.269437 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:05:35.271200 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:05:35.272219 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.274234 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.275928 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:05:35.278704 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:05:35.283614 [debug] [Thread-4 (]: SQL status: COMMIT in 0.010 seconds
[0m18:05:35.286855 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:05:35.287312 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m18:05:35.287666 [debug] [Thread-2 (]: SQL status: COMMIT in 0.008 seconds
[0m18:05:35.290663 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.293395 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:05:35.297018 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:05:35.298520 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:05:35.300146 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.301228 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.302968 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:05:35.303907 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:05:35.305358 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.003 seconds
[0m18:05:35.308200 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:05:35.309702 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd412ecd0>]}
[0m18:05:35.311580 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.25s]
[0m18:05:35.313255 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:05:35.314562 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:05:35.316045 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:05:35.317286 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.012 seconds
[0m18:05:35.317866 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m18:05:35.320771 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:05:35.321944 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:05:35.323069 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd438b990>]}
[0m18:05:35.326333 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.328640 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.27s]
[0m18:05:35.329352 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.023 seconds
[0m18:05:35.331783 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:05:35.334542 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:05:35.336245 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:05:35.337458 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd412c990>]}
[0m18:05:35.338563 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:05:35.340081 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.28s]
[0m18:05:35.341904 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_daily)
[0m18:05:35.342610 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:05:35.344032 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:05:35.345301 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:05:35.348716 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.350374 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:05:35.352925 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.355018 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:05:35.357391 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:05:35.359013 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:05:35.363628 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.366198 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:05:35.367016 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.370796 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.372482 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:05:35.373667 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:05:35.375473 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:35.379935 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.386725 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.388400 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:05:35.389470 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.390348 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:05:35.390976 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m18:05:35.392602 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:05:35.395029 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.396687 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:05:35.398464 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:05:35.405594 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m18:05:35.406974 [debug] [Thread-1 (]: SQL status: SELECT 704 in 0.006 seconds
[0m18:05:35.407268 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.411372 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.412289 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m18:05:35.413139 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:05:35.414211 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:05:35.415051 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.418169 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.418916 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:05:35.422390 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.422678 [debug] [Thread-4 (]: SQL status: SELECT 132 in 0.007 seconds
[0m18:05:35.425206 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:05:35.430690 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.432431 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.433256 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:05:35.435939 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:35.438654 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.440444 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.445797 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.446172 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.022 seconds
[0m18:05:35.447332 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:35.449027 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:05:35.453233 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.456037 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.458388 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:05:35.461107 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:05:35.463278 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.463829 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m18:05:35.464115 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.468268 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.471432 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:05:35.472848 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:05:35.474371 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:05:35.476543 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.480135 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.481181 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:05:35.481953 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m18:05:35.487786 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:35.495320 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:05:35.496041 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:05:35.497671 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.500536 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.504422 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:05:35.506145 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:35.509226 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:05:35.511836 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd42b4910>]}
[0m18:05:35.515589 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m18:05:35.516500 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.19s]
[0m18:05:35.520620 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:05:35.525213 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:05:35.528186 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.528999 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.014 seconds
[0m18:05:35.533330 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:05:35.535705 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:05:35.538350 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbccfb6210>]}
[0m18:05:35.540756 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.20s]
[0m18:05:35.542661 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:05:35.553390 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.016 seconds
[0m18:05:35.556936 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:05:35.559016 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbccfb4050>]}
[0m18:05:35.561255 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.20s]
[0m18:05:35.562698 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:05:35.566757 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:35.568766 [debug] [MainThread]: On master: BEGIN
[0m18:05:35.569988 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:05:35.582691 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m18:05:35.585130 [debug] [MainThread]: On master: COMMIT
[0m18:05:35.586391 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:35.587843 [debug] [MainThread]: On master: COMMIT
[0m18:05:35.589670 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:05:35.590934 [debug] [MainThread]: On master: Close
[0m18:05:35.592834 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:05:35.594334 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:05:35.595402 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:05:35.596013 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:05:35.596912 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_monthly' was properly closed.
[0m18:05:35.597953 [info ] [MainThread]: 
[0m18:05:35.599232 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m18:05:35.601179 [debug] [MainThread]: Command end result
[0m18:05:35.666926 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:05:35.675494 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:05:35.687649 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:05:35.689597 [info ] [MainThread]: 
[0m18:05:35.690784 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:05:35.691877 [info ] [MainThread]: 
[0m18:05:35.693119 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:05:35.696254 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.4176793, "process_in_blocks": "0", "process_kernel_time": 0.74897, "process_mem_max_rss": "131884", "process_out_blocks": "0", "process_user_time": 2.206206}
[0m18:05:35.697695 [debug] [MainThread]: Command `dbt run` succeeded at 18:05:35.697564 after 4.42 seconds
[0m18:05:35.698803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbdbd73810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd933cf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbdbd8e890>]}
[0m18:05:35.699743 [debug] [MainThread]: Flushing usage events
[0m18:05:36.449833 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:06:04.344426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feaee53350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feaee53850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feaeea7e50>]}


============================== 18:06:04.350374 | 996297d5-ad61-4bd4-b85e-9185febc3c1c ==============================
[0m18:06:04.350374 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:06:04.353477 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'use_colors': 'True', 'printer_width': '80', 'quiet': 'False', 'partial_parse': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'introspect': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'indirect_selection': 'eager', 'write_json': 'True', 'debug': 'False', 'log_cache_events': 'False', 'version_check': 'True'}
[0m18:06:04.500908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feae131990>]}
[0m18:06:04.552965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feb1bae910>]}
[0m18:06:04.556330 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:06:04.743214 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:06:06.614342 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:06:06.616505 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:06:06.661566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fead984a50>]}
[0m18:06:06.858178 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:06:06.869211 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:06:06.989105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feae157790>]}
[0m18:06:06.991197 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:06:06.992978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fead147a50>]}
[0m18:06:06.997704 [info ] [MainThread]: 
[0m18:06:06.999716 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:06:07.001373 [info ] [MainThread]: 
[0m18:06:07.003423 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:06:07.010164 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:06:07.063078 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:06:07.064604 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:06:07.066063 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:06:07.085713 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.020 seconds
[0m18:06:07.088734 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:06:07.092046 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:06:07.098494 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:06:07.100510 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:06:07.102576 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:06:07.113977 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m18:06:07.115722 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:06:07.117198 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:06:07.126985 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.008 seconds
[0m18:06:07.129810 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:06:07.131799 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:06:07.140435 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.141873 [debug] [MainThread]: On master: BEGIN
[0m18:06:07.143116 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:06:07.155757 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m18:06:07.157353 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.158795 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:06:07.171702 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m18:06:07.174755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feacd86410>]}
[0m18:06:07.176538 [debug] [MainThread]: On master: ROLLBACK
[0m18:06:07.178223 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.179705 [debug] [MainThread]: On master: BEGIN
[0m18:06:07.181490 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:06:07.183053 [debug] [MainThread]: On master: COMMIT
[0m18:06:07.184613 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.185914 [debug] [MainThread]: On master: COMMIT
[0m18:06:07.187440 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:06:07.188555 [debug] [MainThread]: On master: Close
[0m18:06:07.200012 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:06:07.202322 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:06:07.206617 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:06:07.211464 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:06:07.246313 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.266397 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:06:07.293862 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.306531 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.307868 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:06:07.308988 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:06:07.321389 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m18:06:07.323300 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.325449 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:06:07.337336 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m18:06:07.347842 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.349895 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:06:07.353257 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:06:07.358641 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.360635 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:06:07.364151 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.385844 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:06:07.387973 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.389538 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:06:07.395257 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m18:06:07.403625 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:06:07.411936 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.413821 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:06:07.422085 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m18:06:07.426568 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:06:07.430711 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feabb06110>]}
[0m18:06:07.433307 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.22s]
[0m18:06:07.435588 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:06:07.438320 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:06:07.438826 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:06:07.439398 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:06:07.440900 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:06:07.442838 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:06:07.445084 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:06:07.447034 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:06:07.448562 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:06:07.450458 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:06:07.452569 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:06:07.454265 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:06:07.455960 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:06:07.463368 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:06:07.467369 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.471309 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.480962 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:06:07.482776 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:06:07.495169 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:06:07.513240 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:06:07.515359 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.521705 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.531650 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.533521 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.534135 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:06:07.535621 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:06:07.536080 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.537212 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:06:07.538693 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:06:07.540131 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:06:07.544760 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:06:07.553754 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m18:06:07.555322 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.555847 [debug] [Thread-2 (]: SQL status: BEGIN in 0.011 seconds
[0m18:06:07.556281 [debug] [Thread-4 (]: SQL status: BEGIN in 0.018 seconds
[0m18:06:07.556858 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:06:07.557809 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.558592 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.560133 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:06:07.561042 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:06:07.570776 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m18:06:07.576870 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.577306 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.015 seconds
[0m18:06:07.578583 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:06:07.583793 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.584063 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.021 seconds
[0m18:06:07.585582 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:06:07.586347 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:06:07.589418 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.592357 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.594025 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:06:07.594890 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:06:07.596183 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:06:07.599062 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.601069 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.602421 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:06:07.602692 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.606126 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.607859 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.608888 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:06:07.609855 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:06:07.611620 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:06:07.613138 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.615176 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.616698 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.618212 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:06:07.620234 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:06:07.621560 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:06:07.623878 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.626939 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:06:07.631309 [debug] [Thread-3 (]: SQL status: COMMIT in 0.008 seconds
[0m18:06:07.636178 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:06:07.636621 [debug] [Thread-2 (]: SQL status: COMMIT in 0.011 seconds
[0m18:06:07.637066 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m18:06:07.641630 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.645489 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:06:07.652479 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:06:07.653896 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:06:07.655810 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.657485 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.660474 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:06:07.662184 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:06:07.664605 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:06:07.669496 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:06:07.669960 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:06:07.671889 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feaee9ec90>]}
[0m18:06:07.672443 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:06:07.675298 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:06:07.677170 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.22s]
[0m18:06:07.679338 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:06:07.681265 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feabb24d10>]}
[0m18:06:07.682593 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:06:07.684398 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feabca26d0>]}
[0m18:06:07.686208 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.23s]
[0m18:06:07.688827 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:06:07.690214 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.24s]
[0m18:06:07.692270 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:06:07.694145 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:06:07.696086 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:06:07.697914 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:06:07.701066 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m18:06:07.703379 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:06:07.704927 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:06:07.706684 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:06:07.708583 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:06:07.710059 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:06:07.715447 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.721340 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m18:06:07.724794 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:06:07.728235 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:06:07.734060 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.739001 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.743882 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:06:07.749443 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.749876 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:06:07.755111 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.755445 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:06:07.759647 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.763199 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.768314 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.769127 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:06:07.771164 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:06:07.773085 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.773465 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:06:07.775342 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:06:07.776791 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:06:07.782448 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:06:07.787762 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m18:06:07.789249 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m18:06:07.791401 [debug] [Thread-2 (]: SQL status: BEGIN in 0.009 seconds
[0m18:06:07.792080 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.794275 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.796258 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.797834 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:06:07.801117 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:06:07.802876 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:06:07.809050 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.004 seconds
[0m18:06:07.815906 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.816367 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.010 seconds
[0m18:06:07.816687 [debug] [Thread-2 (]: SQL status: SELECT 704 in 0.009 seconds
[0m18:06:07.818577 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:06:07.824478 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.829540 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.832170 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.833264 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:06:07.836388 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:06:07.840533 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.843105 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.844450 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.845478 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:06:07.849517 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.853995 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.856868 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.858168 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:06:07.860062 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:06:07.862144 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:06:07.864151 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.864969 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:06:07.865866 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.868428 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:06:07.871226 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:06:07.872736 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:06:07.874085 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.875381 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.877887 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:06:07.879182 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:06:07.884256 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m18:06:07.888136 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:06:07.888619 [debug] [Thread-3 (]: SQL status: COMMIT in 0.008 seconds
[0m18:06:07.889168 [debug] [Thread-2 (]: SQL status: COMMIT in 0.008 seconds
[0m18:06:07.890590 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.893852 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:06:07.900060 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:06:07.901509 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:06:07.903285 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.904961 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.907427 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:06:07.909392 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:06:07.912450 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:06:07.914571 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:06:07.915383 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:06:07.916303 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fea8804710>]}
[0m18:06:07.916641 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:06:07.919046 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:06:07.920498 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.22s]
[0m18:06:07.922942 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:06:07.924834 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feae107110>]}
[0m18:06:07.926165 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:06:07.927546 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fea881b390>]}
[0m18:06:07.928644 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.20s]
[0m18:06:07.931253 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.22s]
[0m18:06:07.933011 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:06:07.934142 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:06:07.937507 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.938680 [debug] [MainThread]: On master: BEGIN
[0m18:06:07.939918 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:06:07.948252 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m18:06:07.951546 [debug] [MainThread]: On master: COMMIT
[0m18:06:07.954365 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.957218 [debug] [MainThread]: On master: COMMIT
[0m18:06:07.960201 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:06:07.962610 [debug] [MainThread]: On master: Close
[0m18:06:07.964316 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:06:07.966076 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:06:07.967696 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:06:07.971479 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:06:07.973389 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:06:07.974629 [info ] [MainThread]: 
[0m18:06:07.976040 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m18:06:07.977901 [debug] [MainThread]: Command end result
[0m18:06:08.043891 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:06:08.054176 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:06:08.069589 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:06:08.070796 [info ] [MainThread]: 
[0m18:06:08.072190 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:06:08.073546 [info ] [MainThread]: 
[0m18:06:08.074878 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:06:08.077067 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.7968097, "process_in_blocks": "0", "process_kernel_time": 0.641241, "process_mem_max_rss": "131236", "process_out_blocks": "0", "process_user_time": 2.207819}
[0m18:06:08.078448 [debug] [MainThread]: Command `dbt run` succeeded at 18:06:08.078304 after 3.80 seconds
[0m18:06:08.079780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feb368ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feb368ed10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feb373b8d0>]}
[0m18:06:08.081049 [debug] [MainThread]: Flushing usage events
[0m18:06:08.817359 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:07:02.264470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db0a06850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db09a5150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db09a5f50>]}


============================== 18:07:02.273912 | 07284832-38ce-49bd-aebe-4e7629720ce8 ==============================
[0m18:07:02.273912 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:07:02.276208 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error': 'None', 'indirect_selection': 'eager', 'quiet': 'False', 'partial_parse': 'True', 'no_print': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'write_json': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'debug': 'False', 'empty': 'False', 'static_parser': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'use_colors': 'True'}
[0m18:07:02.422236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db01864d0>]}
[0m18:07:02.485594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db3710350>]}
[0m18:07:02.487450 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:07:02.606733 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:07:04.452856 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:07:04.454639 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:07:04.492533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8daf5756d0>]}
[0m18:07:04.603514 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:07:04.613055 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:07:04.708812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8daf9cf850>]}
[0m18:07:04.711603 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:07:04.712745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dae967490>]}
[0m18:07:04.716784 [info ] [MainThread]: 
[0m18:07:04.718379 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:07:04.719576 [info ] [MainThread]: 
[0m18:07:04.721096 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:07:04.727275 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:07:04.783844 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:07:04.785843 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:07:04.787335 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:07:04.804031 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m18:07:04.807967 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:07:04.813572 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:07:04.821242 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:07:04.822886 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:07:04.824128 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:07:04.833832 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m18:07:04.835707 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:07:04.837349 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:07:04.843304 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.005 seconds
[0m18:07:04.851045 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:07:04.852754 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:07:04.859203 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:04.860879 [debug] [MainThread]: On master: BEGIN
[0m18:07:04.862129 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:07:04.871111 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m18:07:04.872818 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:04.874327 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:07:04.888176 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m18:07:04.890825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dad8a1f50>]}
[0m18:07:04.892332 [debug] [MainThread]: On master: ROLLBACK
[0m18:07:04.895862 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:04.897905 [debug] [MainThread]: On master: BEGIN
[0m18:07:04.900155 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:07:04.909746 [debug] [MainThread]: On master: COMMIT
[0m18:07:04.913680 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:04.917545 [debug] [MainThread]: On master: COMMIT
[0m18:07:04.921031 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:07:04.922225 [debug] [MainThread]: On master: Close
[0m18:07:04.928212 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:07:04.930601 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:07:04.934667 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:07:04.938414 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:07:04.952733 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:07:04.969506 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:07:04.994728 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.017133 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.018196 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:07:05.019056 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:05.028003 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m18:07:05.030513 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.032624 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:07:05.044660 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m18:07:05.052207 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.053556 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:07:05.055480 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.059093 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.060382 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:07:05.062898 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.075151 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:07:05.077377 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.080069 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:07:05.086381 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m18:07:05.092072 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:07:05.096986 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.097941 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:07:05.104848 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m18:07:05.107305 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:07:05.110034 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dad8cee10>]}
[0m18:07:05.111982 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.17s]
[0m18:07:05.113146 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:07:05.114984 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:07:05.115337 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:07:05.115631 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:07:05.116414 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:07:05.117688 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:07:05.119723 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:07:05.120962 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:07:05.122029 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:07:05.123509 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:07:05.124794 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:07:05.127570 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:07:05.129169 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:07:05.135530 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:07:05.139144 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.149455 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.182376 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:07:05.183265 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:07:05.191528 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:07:05.203657 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.208407 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:07:05.213083 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.226697 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.228503 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.230051 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:07:05.231390 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.231841 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:07:05.232869 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:07:05.233876 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:07:05.235793 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:07:05.239442 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:07:05.246509 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m18:07:05.248109 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.249817 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:07:05.251808 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m18:07:05.253486 [debug] [Thread-4 (]: SQL status: BEGIN in 0.018 seconds
[0m18:07:05.255227 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.261211 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.261929 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m18:07:05.266991 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:07:05.270441 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:07:05.277544 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.281208 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:07:05.283430 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.289721 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.291860 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:07:05.295439 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.295923 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.017 seconds
[0m18:07:05.297748 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:07:05.298311 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.018 seconds
[0m18:07:05.301446 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.303126 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.306295 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.308092 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:07:05.309540 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:07:05.310772 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:07:05.312785 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.314990 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.318662 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.319376 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m18:07:05.323632 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.324977 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:07:05.328853 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:07:05.330342 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:07:05.332187 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.335542 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.338938 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:07:05.339350 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:07:05.340263 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:07:05.341338 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.342893 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:07:05.345391 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:07:05.346989 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.348986 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:07:05.350898 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:07:05.351482 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m18:07:05.353640 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:07:05.353931 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m18:07:05.357295 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:07:05.358635 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac64b810>]}
[0m18:07:05.362482 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:07:05.364032 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.365566 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.24s]
[0m18:07:05.367206 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.368507 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:07:05.370320 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:07:05.372517 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:07:05.374728 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:07:05.376909 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:07:05.378132 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:07:05.378583 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m18:07:05.379260 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:07:05.380631 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:07:05.381520 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:07:05.383288 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:07:05.384672 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac503b50>]}
[0m18:07:05.387468 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.388759 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac6bee90>]}
[0m18:07:05.389799 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.26s]
[0m18:07:05.391825 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.27s]
[0m18:07:05.392871 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:07:05.393824 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:07:05.395163 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:07:05.396156 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:07:05.396774 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:07:05.397664 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:07:05.398851 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:07:05.399759 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m18:07:05.400352 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:07:05.400889 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:07:05.401821 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:07:05.405348 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.408224 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.411561 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.420623 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:07:05.424461 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.424850 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:07:05.425235 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.429503 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.430770 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:07:05.432878 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:05.435768 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.436778 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:07:05.437184 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.438019 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:07:05.439137 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:07:05.440818 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:07:05.441692 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m18:07:05.443303 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.444607 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:07:05.447038 [debug] [Thread-3 (]: SQL status: BEGIN in 0.009 seconds
[0m18:07:05.448382 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.449498 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:07:05.449824 [debug] [Thread-2 (]: SQL status: BEGIN in 0.009 seconds
[0m18:07:05.450066 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.004 seconds
[0m18:07:05.451683 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.456812 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.457133 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.006 seconds
[0m18:07:05.457981 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:07:05.459029 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:07:05.463381 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.466237 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.466532 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:07:05.470430 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.470706 [debug] [Thread-2 (]: SQL status: SELECT 704 in 0.006 seconds
[0m18:07:05.472185 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:07:05.472627 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.475317 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.476600 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:07:05.478845 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.480027 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:07:05.481829 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:07:05.482775 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:07:05.484281 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.484509 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.485632 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:07:05.486375 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:07:05.490053 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.491694 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:07:05.493741 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:07:05.494918 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.496478 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.496817 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:07:05.498476 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:07:05.500361 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.501074 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m18:07:05.501932 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:07:05.502446 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m18:07:05.505937 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:07:05.508836 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:07:05.509103 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m18:07:05.509976 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.511519 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.515682 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:07:05.516864 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:07:05.517586 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:07:05.518555 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.521475 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:07:05.523497 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:07:05.525863 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:07:05.526368 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:07:05.527004 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:07:05.527529 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac503d10>]}
[0m18:07:05.529473 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:07:05.531664 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:07:05.532976 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.15s]
[0m18:07:05.534227 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac5d1ed0>]}
[0m18:07:05.535853 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac5d0c50>]}
[0m18:07:05.537126 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:07:05.538572 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.13s]
[0m18:07:05.540122 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.14s]
[0m18:07:05.542767 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:07:05.543930 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:07:05.547610 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:05.548820 [debug] [MainThread]: On master: BEGIN
[0m18:07:05.549991 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:07:05.558419 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m18:07:05.560107 [debug] [MainThread]: On master: COMMIT
[0m18:07:05.561208 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:05.562581 [debug] [MainThread]: On master: COMMIT
[0m18:07:05.563818 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:07:05.565165 [debug] [MainThread]: On master: Close
[0m18:07:05.566417 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:07:05.567822 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:07:05.568874 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:07:05.570064 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:07:05.571276 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:07:05.572546 [info ] [MainThread]: 
[0m18:07:05.573898 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m18:07:05.576538 [debug] [MainThread]: Command end result
[0m18:07:05.729533 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:07:05.744085 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:07:05.758320 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:07:05.759694 [info ] [MainThread]: 
[0m18:07:05.760742 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:07:05.762401 [info ] [MainThread]: 
[0m18:07:05.763764 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:07:05.765936 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5792952, "process_in_blocks": "0", "process_kernel_time": 0.621299, "process_mem_max_rss": "130988", "process_out_blocks": "0", "process_user_time": 2.122773}
[0m18:07:05.767554 [debug] [MainThread]: Command `dbt run` succeeded at 18:07:05.767355 after 3.58 seconds
[0m18:07:05.769424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db09c49d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db550b910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db52c2b90>]}
[0m18:07:05.771144 [debug] [MainThread]: Flushing usage events
[0m18:07:06.589241 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:08:09.180380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1595f183d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1595a9bf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d15987b3cd0>]}


============================== 18:08:09.187447 | aeadfee4-b4e2-4333-a3fd-70c27ad59711 ==============================
[0m18:08:09.187447 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:08:09.190881 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'warn_error': 'None', 'version_check': 'True', 'no_print': 'None', 'debug': 'False', 'introspect': 'True', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'target_path': 'None', 'fail_fast': 'False', 'quiet': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'printer_width': '80', 'empty': 'False'}
[0m18:08:09.371827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d15950c9bd0>]}
[0m18:08:09.425172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1595154990>]}
[0m18:08:09.427454 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:08:09.598316 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:08:12.129063 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:08:12.131043 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:08:12.189246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d15949ac0d0>]}
[0m18:08:12.339440 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:08:12.349545 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:08:12.487342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d15949509d0>]}
[0m18:08:12.489744 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:08:12.493127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1593d1d850>]}
[0m18:08:12.496269 [info ] [MainThread]: 
[0m18:08:12.498990 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:08:12.501323 [info ] [MainThread]: 
[0m18:08:12.503936 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:08:12.509923 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:08:12.644623 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:08:12.647167 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:08:12.648661 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:08:12.673889 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.025 seconds
[0m18:08:12.677066 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:08:12.680302 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:08:12.688012 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:08:12.689560 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:08:12.690985 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:08:12.703663 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m18:08:12.705420 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:08:12.707034 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:08:12.714447 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.006 seconds
[0m18:08:12.717316 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:08:12.719309 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:08:12.727588 [debug] [MainThread]: Using postgres connection "master"
[0m18:08:12.729414 [debug] [MainThread]: On master: BEGIN
[0m18:08:12.730768 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:08:12.742498 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m18:08:12.744082 [debug] [MainThread]: Using postgres connection "master"
[0m18:08:12.745498 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:08:12.753362 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m18:08:12.756381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1595cda750>]}
[0m18:08:12.757895 [debug] [MainThread]: On master: ROLLBACK
[0m18:08:12.759532 [debug] [MainThread]: Using postgres connection "master"
[0m18:08:12.760698 [debug] [MainThread]: On master: BEGIN
[0m18:08:12.762169 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:08:12.763497 [debug] [MainThread]: On master: COMMIT
[0m18:08:12.764376 [debug] [MainThread]: Using postgres connection "master"
[0m18:08:12.765407 [debug] [MainThread]: On master: COMMIT
[0m18:08:12.766737 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:08:12.768886 [debug] [MainThread]: On master: Close
[0m18:08:12.776905 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:08:12.778660 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:08:12.780194 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:08:12.781459 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:08:12.799795 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:08:12.814044 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:08:12.840332 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:08:12.858053 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:08:12.859831 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:08:12.861402 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:08:12.873107 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m18:08:12.874574 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:08:12.876237 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:08:12.888797 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m18:08:12.896126 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:08:12.898422 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:08:12.905039 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m18:08:12.909460 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:08:12.910928 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:08:12.914603 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:08:12.935054 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:08:12.937576 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:08:12.939163 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:08:12.947079 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m18:08:12.955080 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:08:12.966883 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:08:12.971789 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:08:12.983084 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.007 seconds
[0m18:08:12.990501 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:08:12.994359 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1595c30bd0>]}
[0m18:08:12.997405 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.21s]
[0m18:08:12.999390 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:08:13.001825 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:08:13.002612 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:08:13.003249 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:08:13.004564 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:08:13.006530 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:08:13.008274 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:08:13.010113 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:08:13.012240 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:08:13.014789 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:08:13.016951 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:08:13.019679 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:08:13.021543 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:08:13.029333 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:08:13.034006 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:08:13.040775 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:08:13.053545 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:08:13.054943 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:08:13.056117 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:08:13.075957 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:08:13.079223 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:08:13.083559 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:08:13.095818 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:08:13.096388 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:08:13.097624 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:08:13.099044 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:08:13.102302 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:08:13.104556 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:08:13.106275 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:08:13.107704 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:08:13.110405 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:08:13.123822 [debug] [Thread-3 (]: SQL status: BEGIN in 0.019 seconds
[0m18:08:13.124358 [debug] [Thread-2 (]: SQL status: BEGIN in 0.017 seconds
[0m18:08:13.125954 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:08:13.126538 [debug] [Thread-4 (]: SQL status: BEGIN in 0.016 seconds
[0m18:08:13.127553 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:08:13.129004 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:08:13.130161 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:08:13.131476 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:08:13.134713 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:08:13.152805 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.019 seconds
[0m18:08:13.153709 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.017 seconds
[0m18:08:13.161267 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:08:13.161702 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.024 seconds
[0m18:08:13.166693 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:08:13.168899 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:08:13.175054 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:08:13.176927 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:08:13.179796 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:08:13.180199 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:08:13.182836 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.184098 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.188186 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:08:13.192022 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:08:13.195360 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:08:13.196628 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:08:13.197906 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:08:13.199058 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:08:13.202679 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.204482 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.205368 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.206569 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:08:13.208810 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:08:13.210677 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:08:13.211859 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:08:13.213310 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:08:13.216933 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:08:13.219016 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:08:13.221211 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:08:13.222654 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:08:13.245335 [debug] [Thread-3 (]: SQL status: COMMIT in 0.021 seconds
[0m18:08:13.247113 [debug] [Thread-4 (]: SQL status: COMMIT in 0.021 seconds
[0m18:08:13.247697 [debug] [Thread-2 (]: SQL status: COMMIT in 0.022 seconds
[0m18:08:13.250722 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:08:13.256675 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:08:13.264346 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:08:13.271843 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:08:13.274267 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:08:13.276169 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:08:13.278839 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:08:13.281448 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:08:13.283167 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:08:13.292868 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m18:08:13.296104 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:08:13.296499 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.010 seconds
[0m18:08:13.296879 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.009 seconds
[0m18:08:13.298337 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d159061a9d0>]}
[0m18:08:13.301580 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:08:13.304004 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:08:13.305797 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.29s]
[0m18:08:13.307669 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1590635210>]}
[0m18:08:13.309584 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d159511c210>]}
[0m18:08:13.312054 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:08:13.313849 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.30s]
[0m18:08:13.315637 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.30s]
[0m18:08:13.317927 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:08:13.318924 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:08:13.320609 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:08:13.321984 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:08:13.323649 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:08:13.324796 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:08:13.325773 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m18:08:13.327205 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:08:13.328710 [info ] [Thread-4 (]: 7 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:08:13.330995 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:08:13.332388 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m18:08:13.333610 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m18:08:13.337466 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:08:13.338924 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:08:13.340226 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:08:13.344862 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:08:13.349196 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:08:13.352824 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:08:13.357724 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:08:13.359363 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:08:13.361008 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:08:13.364023 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:08:13.367934 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:08:13.371161 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:08:13.372700 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:08:13.374377 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:08:13.374843 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:08:13.376250 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:08:13.377000 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:08:13.378303 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:08:13.379655 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:08:13.380780 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:08:13.383150 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m18:08:13.384668 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:08:13.385775 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:08:13.390811 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:08:13.392183 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m18:08:13.393094 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:08:13.393893 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.007 seconds
[0m18:08:13.394620 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:08:13.395782 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:08:13.401534 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:08:13.403370 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:08:13.405938 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:08:13.408881 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.414081 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:08:13.414546 [debug] [Thread-3 (]: SQL status: SELECT 704 in 0.010 seconds
[0m18:08:13.415088 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.008 seconds
[0m18:08:13.415915 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:08:13.420035 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:08:13.424650 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:08:13.427431 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.427905 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:08:13.429333 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:08:13.431778 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:08:13.434069 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.435468 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.436497 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:08:13.440535 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:08:13.444745 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:08:13.446273 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:08:13.447648 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:08:13.448990 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:08:13.454286 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.455706 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:08:13.457248 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:08:13.460163 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:08:13.462405 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:08:13.463978 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:08:13.464307 [debug] [Thread-1 (]: SQL status: COMMIT in 0.014 seconds
[0m18:08:13.465299 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:08:13.467418 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:08:13.472393 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:08:13.476642 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:08:13.477068 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m18:08:13.478174 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:08:13.478589 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m18:08:13.482356 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:08:13.489556 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:08:13.489974 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:08:13.491211 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:08:13.492857 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:08:13.495295 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:08:13.496660 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:08:13.498911 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:08:13.501649 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1590504b50>]}
[0m18:08:13.506159 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.18s]
[0m18:08:13.508023 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:08:13.510196 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m18:08:13.511071 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:08:13.512793 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:08:13.515565 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:08:13.517547 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d15906d8a10>]}
[0m18:08:13.519853 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aeadfee4-b4e2-4333-a3fd-70c27ad59711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d15906d8210>]}
[0m18:08:13.521517 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.19s]
[0m18:08:13.523774 [info ] [Thread-4 (]: 7 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.19s]
[0m18:08:13.525223 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:08:13.527010 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:08:13.532111 [debug] [MainThread]: Using postgres connection "master"
[0m18:08:13.534044 [debug] [MainThread]: On master: BEGIN
[0m18:08:13.535921 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:08:13.546405 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m18:08:13.548274 [debug] [MainThread]: On master: COMMIT
[0m18:08:13.549804 [debug] [MainThread]: Using postgres connection "master"
[0m18:08:13.552170 [debug] [MainThread]: On master: COMMIT
[0m18:08:13.554070 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:08:13.555596 [debug] [MainThread]: On master: Close
[0m18:08:13.556987 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:08:13.558239 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:08:13.559217 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:08:13.560374 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:08:13.561515 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_monthly' was properly closed.
[0m18:08:13.563295 [info ] [MainThread]: 
[0m18:08:13.564756 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.06 seconds (1.06s).
[0m18:08:13.567573 [debug] [MainThread]: Command end result
[0m18:08:13.642890 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:08:13.653914 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:08:13.666609 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:08:13.669138 [info ] [MainThread]: 
[0m18:08:13.671017 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:08:13.672247 [info ] [MainThread]: 
[0m18:08:13.673405 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:08:13.675671 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.5703835, "process_in_blocks": "0", "process_kernel_time": 1.000565, "process_mem_max_rss": "131700", "process_out_blocks": "0", "process_user_time": 2.465394}
[0m18:08:13.676845 [debug] [MainThread]: Command `dbt run` succeeded at 18:08:13.676718 after 4.57 seconds
[0m18:08:13.677976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1595e1cc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d159a373890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d159a38eb10>]}
[0m18:08:13.679420 [debug] [MainThread]: Flushing usage events
[0m18:08:14.480045 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:09:17.059102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6f384dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6f3e23d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6f3a4b50>]}


============================== 18:09:17.065386 | 4f196558-48d0-40fc-9ad9-19872044a80b ==============================
[0m18:09:17.065386 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:09:17.067239 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'log_format': 'default', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'empty': 'False', 'debug': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error': 'None', 'quiet': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None'}
[0m18:09:17.231663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6f384310>]}
[0m18:09:17.276821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6e7e5fd0>]}
[0m18:09:17.279672 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:09:17.436736 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:09:19.635099 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:09:19.636606 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:09:19.678634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6dfc7e10>]}
[0m18:09:19.788188 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:09:19.794672 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:09:19.902258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6e745950>]}
[0m18:09:19.903733 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:09:19.904977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6df06510>]}
[0m18:09:19.908107 [info ] [MainThread]: 
[0m18:09:19.909227 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:09:19.910295 [info ] [MainThread]: 
[0m18:09:19.911522 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:09:19.917796 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:09:20.017605 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:09:20.021027 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:09:20.022341 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:09:20.040642 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.018 seconds
[0m18:09:20.044050 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:09:20.047596 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:09:20.055478 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:09:20.056411 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:09:20.057296 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:09:20.067529 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m18:09:20.068824 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:09:20.069769 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:09:20.076317 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.006 seconds
[0m18:09:20.078343 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:09:20.079897 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:09:20.086681 [debug] [MainThread]: Using postgres connection "master"
[0m18:09:20.087736 [debug] [MainThread]: On master: BEGIN
[0m18:09:20.088713 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:09:20.097590 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m18:09:20.099144 [debug] [MainThread]: Using postgres connection "master"
[0m18:09:20.100238 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:09:20.106503 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m18:09:20.109581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6f395290>]}
[0m18:09:20.110931 [debug] [MainThread]: On master: ROLLBACK
[0m18:09:20.112352 [debug] [MainThread]: Using postgres connection "master"
[0m18:09:20.113389 [debug] [MainThread]: On master: BEGIN
[0m18:09:20.114737 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:09:20.116161 [debug] [MainThread]: On master: COMMIT
[0m18:09:20.117300 [debug] [MainThread]: Using postgres connection "master"
[0m18:09:20.118097 [debug] [MainThread]: On master: COMMIT
[0m18:09:20.119304 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:09:20.120342 [debug] [MainThread]: On master: Close
[0m18:09:20.127764 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:09:20.129710 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:09:20.131114 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:09:20.132076 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:09:20.151248 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:09:20.161272 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:09:20.185965 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:09:20.196814 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:09:20.198077 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:09:20.199913 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:20.209993 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m18:09:20.211305 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:09:20.212510 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:09:20.225063 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m18:09:20.231698 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:09:20.232900 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:09:20.235520 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:09:20.238450 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:09:20.239363 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:09:20.241352 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:09:20.257420 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:09:20.258873 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:09:20.259814 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:09:20.273779 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m18:09:20.281152 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:09:20.288935 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:09:20.289984 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:09:20.302919 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.012 seconds
[0m18:09:20.306225 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:09:20.308567 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6c129f50>]}
[0m18:09:20.310184 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.18s]
[0m18:09:20.312332 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:09:20.314084 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:09:20.314430 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:09:20.314993 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:09:20.316308 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:09:20.317494 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:09:20.318642 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:09:20.319852 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:09:20.320724 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:09:20.321678 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:09:20.322568 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:09:20.323496 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:09:20.324284 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:09:20.328301 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:09:20.331260 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:09:20.335820 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:09:20.343657 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:09:20.344230 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:09:20.344863 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:09:20.363716 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:09:20.368341 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:09:20.371482 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:09:20.379250 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:09:20.379858 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:09:20.381014 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:09:20.382325 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:09:20.382699 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:09:20.383675 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:09:20.384501 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:09:20.385404 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:09:20.387027 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:09:20.400967 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m18:09:20.402010 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m18:09:20.402517 [debug] [Thread-2 (]: SQL status: BEGIN in 0.019 seconds
[0m18:09:20.402886 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:09:20.403650 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:09:20.404415 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:09:20.405166 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:09:20.406029 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:09:20.406991 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:09:20.421933 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.013 seconds
[0m18:09:20.422302 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.014 seconds
[0m18:09:20.427580 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:09:20.427885 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.019 seconds
[0m18:09:20.431306 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:09:20.432416 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:09:20.435115 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:09:20.436180 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:09:20.437977 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:09:20.438457 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:09:20.442735 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:09:20.443121 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m18:09:20.444369 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:09:20.444646 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:09:20.447155 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:09:20.452234 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:09:20.453950 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:09:20.454283 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:09:20.455244 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:09:20.456847 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:09:20.458219 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:09:20.459022 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:09:20.459809 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:09:20.461205 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:09:20.462513 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:09:20.463446 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:09:20.464238 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:09:20.465449 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:09:20.467391 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:09:20.468417 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:09:20.474238 [debug] [Thread-2 (]: SQL status: COMMIT in 0.008 seconds
[0m18:09:20.475404 [debug] [Thread-4 (]: SQL status: COMMIT in 0.005 seconds
[0m18:09:20.475794 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m18:09:20.479974 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:09:20.484501 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:09:20.489392 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:09:20.494370 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:09:20.495949 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:09:20.497410 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:09:20.499130 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:09:20.500471 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:09:20.501710 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:09:20.509229 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:09:20.510697 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:09:20.511283 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.008 seconds
[0m18:09:20.513079 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:09:20.515138 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:09:20.516976 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:09:20.519654 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6c1072d0>]}
[0m18:09:20.521289 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6e77c590>]}
[0m18:09:20.524425 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6eac1a50>]}
[0m18:09:20.526032 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.20s]
[0m18:09:20.528155 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.20s]
[0m18:09:20.529769 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.20s]
[0m18:09:20.530887 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:09:20.533138 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:09:20.534210 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:09:20.535556 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:09:20.536598 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:09:20.537587 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:09:20.538347 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:09:20.539680 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:09:20.540578 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:09:20.541482 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m18:09:20.542302 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_daily)
[0m18:09:20.543425 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:09:20.544404 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:09:20.545198 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:09:20.546211 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:09:20.551870 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:09:20.583099 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:09:20.589212 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:09:20.598777 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:09:20.600133 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:09:20.604067 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:09:20.604428 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:09:20.610397 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:09:20.618642 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:09:20.631283 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:09:20.634615 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:09:20.636954 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:09:20.638716 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:09:20.639361 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:09:20.640754 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:09:20.642397 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:09:20.643592 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:09:20.646819 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:09:20.655288 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m18:09:20.655859 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m18:09:20.657267 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:09:20.658691 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:09:20.661251 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m18:09:20.661531 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:09:20.662464 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:09:20.663553 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:09:20.668473 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:09:20.669802 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.004 seconds
[0m18:09:20.676169 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:09:20.676474 [debug] [Thread-4 (]: SQL status: SELECT 132 in 0.009 seconds
[0m18:09:20.676723 [debug] [Thread-1 (]: SQL status: SELECT 704 in 0.006 seconds
[0m18:09:20.677530 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:09:20.680294 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:09:20.684147 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:09:20.686561 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:09:20.687133 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:09:20.688064 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:09:20.690823 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:09:20.692586 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:09:20.693077 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:09:20.693339 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:09:20.695938 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:09:20.697294 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:09:20.701002 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:09:20.702578 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:09:20.704846 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:09:20.706108 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:09:20.707732 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:09:20.708161 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:09:20.710662 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:09:20.710971 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:09:20.711655 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:09:20.712366 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:09:20.713625 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:09:20.716104 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:09:20.717840 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:09:20.720266 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:09:20.723401 [debug] [Thread-3 (]: SQL status: COMMIT in 0.008 seconds
[0m18:09:20.727489 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:09:20.727816 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m18:09:20.728127 [debug] [Thread-4 (]: SQL status: COMMIT in 0.009 seconds
[0m18:09:20.729196 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:09:20.731822 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:09:20.739260 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:09:20.740162 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:09:20.741258 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:09:20.742283 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:09:20.744189 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:09:20.745561 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:09:20.747565 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:09:20.752314 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:09:20.753456 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m18:09:20.754273 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f64ee8fd0>]}
[0m18:09:20.756856 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:09:20.759025 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.21s]
[0m18:09:20.759715 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.011 seconds
[0m18:09:20.761002 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f64d037d0>]}
[0m18:09:20.762229 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:09:20.764321 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:09:20.766161 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.22s]
[0m18:09:20.769168 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f196558-48d0-40fc-9ad9-19872044a80b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f64d08b10>]}
[0m18:09:20.770668 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:09:20.772114 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.23s]
[0m18:09:20.774030 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:09:20.776424 [debug] [MainThread]: Using postgres connection "master"
[0m18:09:20.777312 [debug] [MainThread]: On master: BEGIN
[0m18:09:20.778080 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:09:20.787857 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m18:09:20.789009 [debug] [MainThread]: On master: COMMIT
[0m18:09:20.789972 [debug] [MainThread]: Using postgres connection "master"
[0m18:09:20.790877 [debug] [MainThread]: On master: COMMIT
[0m18:09:20.791853 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:09:20.792749 [debug] [MainThread]: On master: Close
[0m18:09:20.794001 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:09:20.794976 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:09:20.796040 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:09:20.796900 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:09:20.800208 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_monthly' was properly closed.
[0m18:09:20.804906 [info ] [MainThread]: 
[0m18:09:20.822607 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.89 seconds (0.89s).
[0m18:09:20.825746 [debug] [MainThread]: Command end result
[0m18:09:20.882233 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:09:20.889083 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:09:20.903522 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:09:20.904379 [info ] [MainThread]: 
[0m18:09:20.905528 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:09:20.906819 [info ] [MainThread]: 
[0m18:09:20.907863 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:09:20.909443 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.916915, "process_in_blocks": "0", "process_kernel_time": 0.878383, "process_mem_max_rss": "131628", "process_out_blocks": "0", "process_user_time": 2.332823}
[0m18:09:20.910678 [debug] [MainThread]: Command `dbt run` succeeded at 18:09:20.910566 after 3.92 seconds
[0m18:09:20.911534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f6f70cd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f70249950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2f73eeb910>]}
[0m18:09:20.912355 [debug] [MainThread]: Flushing usage events
[0m18:09:21.680493 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:27:14.120156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe79e05d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe4d09d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe5030bd0>]}


============================== 18:27:14.127606 | 054f5e3e-46aa-45a6-b9ca-ae862841f9c5 ==============================
[0m18:27:14.127606 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:27:14.128730 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'no_print': 'None', 'fail_fast': 'False', 'quiet': 'False', 'target_path': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'use_colors': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'introspect': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'printer_width': '80'}
[0m18:27:14.293008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe41ca4d0>]}
[0m18:27:14.336727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe7a0aa10>]}
[0m18:27:14.339820 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:27:14.455773 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:27:16.611361 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:27:16.613307 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:27:16.649421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe4ca9550>]}
[0m18:27:16.848869 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:27:16.869226 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:27:17.037270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe3d06ad0>]}
[0m18:27:17.039755 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:27:17.041126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe3dce590>]}
[0m18:27:17.043590 [info ] [MainThread]: 
[0m18:27:17.044900 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:27:17.046120 [info ] [MainThread]: 
[0m18:27:17.047305 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:27:17.052045 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:27:17.137492 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:27:17.139407 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:27:17.141350 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:27:17.158337 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m18:27:17.160121 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:27:17.163067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:27:17.168011 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:27:17.168934 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:27:17.169749 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:27:17.178718 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m18:27:17.180435 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:27:17.181301 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:27:17.187985 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.006 seconds
[0m18:27:17.191183 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:27:17.192290 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:27:17.199769 [debug] [MainThread]: Using postgres connection "master"
[0m18:27:17.200825 [debug] [MainThread]: On master: BEGIN
[0m18:27:17.201766 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:27:17.210597 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m18:27:17.211829 [debug] [MainThread]: Using postgres connection "master"
[0m18:27:17.212673 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:27:17.220718 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m18:27:17.222849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe4caa750>]}
[0m18:27:17.224085 [debug] [MainThread]: On master: ROLLBACK
[0m18:27:17.225149 [debug] [MainThread]: Using postgres connection "master"
[0m18:27:17.226006 [debug] [MainThread]: On master: BEGIN
[0m18:27:17.227615 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:27:17.228762 [debug] [MainThread]: On master: COMMIT
[0m18:27:17.229929 [debug] [MainThread]: Using postgres connection "master"
[0m18:27:17.231399 [debug] [MainThread]: On master: COMMIT
[0m18:27:17.232373 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:27:17.233207 [debug] [MainThread]: On master: Close
[0m18:27:17.241278 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:27:17.242564 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:27:17.244057 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:27:17.245020 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:27:17.266038 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:27:17.277761 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:27:17.314276 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:27:17.337693 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:27:17.338935 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:27:17.339970 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:27:17.363024 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m18:27:17.364516 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:27:17.366142 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:27:17.388633 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.021 seconds
[0m18:27:17.397438 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:27:17.399018 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:27:17.401208 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:17.405097 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:27:17.406004 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:27:17.408025 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:17.432761 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:27:17.433986 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:27:17.435083 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:27:17.438088 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m18:27:17.457536 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:27:17.465483 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:27:17.466712 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:27:17.473322 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m18:27:17.479080 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:27:17.481969 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe1a37210>]}
[0m18:27:17.483449 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.24s]
[0m18:27:17.484952 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:27:17.486653 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:27:17.487139 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:27:17.487525 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:27:17.488536 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:27:17.493816 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:27:17.491973 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:27:17.490623 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:27:17.494776 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:27:17.495596 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:27:17.496501 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:27:17.500295 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:27:17.501153 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:27:17.501902 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:27:17.505839 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:27:17.519233 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:27:17.524851 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:27:17.541546 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:27:17.542424 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:27:17.546350 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:27:17.546657 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:27:17.550594 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:27:17.551946 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:27:17.552878 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:27:17.553709 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:27:17.556113 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:27:17.556896 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:27:17.557554 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:27:17.558298 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:27:17.558864 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:27:17.561535 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:27:17.581348 [debug] [Thread-4 (]: SQL status: BEGIN in 0.027 seconds
[0m18:27:17.584763 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:27:17.590498 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:27:17.600552 [debug] [Thread-3 (]: SQL status: BEGIN in 0.039 seconds
[0m18:27:17.603743 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:27:17.605971 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:27:17.609207 [debug] [Thread-2 (]: SQL status: BEGIN in 0.051 seconds
[0m18:27:17.613334 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:27:17.615933 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:27:17.652538 [debug] [Thread-4 (]: SQL status: SELECT 792 in 0.058 seconds
[0m18:27:17.658363 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:27:17.658683 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.048 seconds
[0m18:27:17.659137 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.039 seconds
[0m18:27:17.660559 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:27:17.664266 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:27:17.699995 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:27:17.714623 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:17.715982 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:27:17.717960 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:27:17.723778 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:27:17.726227 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:17.728585 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:27:17.729050 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:17.733817 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:27:17.738255 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:27:17.738663 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m18:27:17.739601 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:27:17.740822 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:27:17.743206 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:27:17.745601 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:17.747288 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:17.748264 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:27:17.750770 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:27:17.753223 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:27:17.754211 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:27:17.754962 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:27:17.755668 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:27:17.756960 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:27:17.758497 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:27:17.772291 [debug] [Thread-4 (]: SQL status: COMMIT in 0.016 seconds
[0m18:27:17.776173 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:27:17.780220 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:27:17.781030 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:27:17.782597 [debug] [Thread-2 (]: SQL status: COMMIT in 0.022 seconds
[0m18:27:17.782969 [debug] [Thread-3 (]: SQL status: COMMIT in 0.023 seconds
[0m18:27:17.785548 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:27:17.790019 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:27:17.791432 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:27:17.792537 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:27:17.793447 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.012 seconds
[0m18:27:17.793670 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:27:17.794565 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:27:17.796115 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:27:17.799262 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fd2700b90>]}
[0m18:27:17.800264 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 792[0m in 0.30s]
[0m18:27:17.801489 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:27:17.803036 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:27:17.803866 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:27:17.805003 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m18:27:17.806041 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:27:17.808836 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:27:17.812035 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.015 seconds
[0m18:27:17.813719 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:27:17.813956 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.016 seconds
[0m18:27:17.815269 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe1bf37d0>]}
[0m18:27:17.816571 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:27:17.818232 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.32s]
[0m18:27:17.819835 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe01d4510>]}
[0m18:27:17.828527 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:27:17.829243 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:27:17.833052 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.33s]
[0m18:27:17.837266 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:27:17.846922 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:27:17.853444 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:27:17.859221 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:27:17.870996 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:27:17.879836 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m18:27:17.884014 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:27:17.886070 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:27:17.887511 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m18:27:17.892189 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:27:17.894419 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:27:17.898091 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:27:17.901597 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:27:17.903911 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:27:17.907146 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:27:17.916069 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:27:17.917570 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:27:17.921029 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:27:17.925580 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:27:17.926450 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m18:27:17.929602 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:27:17.931791 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:27:17.936592 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:27:17.938411 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:27:17.938896 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:27:17.939736 [debug] [Thread-1 (]: SQL status: SELECT 792 in 0.006 seconds
[0m18:27:17.940158 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:27:17.941820 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:27:17.947763 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:27:17.951431 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:27:17.953114 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:27:17.956873 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:17.962526 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:27:17.963573 [debug] [Thread-4 (]: SQL status: BEGIN in 0.023 seconds
[0m18:27:17.964440 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m18:27:17.965027 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:27:17.966440 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:27:17.967942 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:27:17.969765 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:17.970669 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:27:17.972356 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:27:17.975397 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:27:17.979379 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:27:17.981454 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:27:17.982563 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.005 seconds
[0m18:27:17.983091 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.005 seconds
[0m18:27:17.989412 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:27:17.989733 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m18:27:17.994105 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:27:17.996233 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:27:18.000340 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:27:18.001947 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:27:18.004500 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:18.005643 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:27:18.007766 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:18.012386 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:27:18.013848 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:27:18.018639 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:27:18.020198 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:27:18.022664 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:27:18.024505 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:27:18.027118 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:27:18.028723 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:27:18.031486 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:27:18.033210 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:27:18.033727 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.012 seconds
[0m18:27:18.034906 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:27:18.036106 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:27:18.038816 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:27:18.040433 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:27:18.046635 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe1acc4d0>]}
[0m18:27:18.049585 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 792[0m in 0.24s]
[0m18:27:18.051125 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:27:18.060863 [debug] [Thread-4 (]: SQL status: COMMIT in 0.016 seconds
[0m18:27:18.064267 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:27:18.065591 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:27:18.066819 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:27:18.070619 [debug] [Thread-2 (]: SQL status: COMMIT in 0.023 seconds
[0m18:27:18.076656 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:27:18.078637 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:27:18.080064 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:27:18.081422 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.013 seconds
[0m18:27:18.083899 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:27:18.085673 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fd27e5cd0>]}
[0m18:27:18.087866 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.21s]
[0m18:27:18.089580 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:27:18.099773 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.018 seconds
[0m18:27:18.103134 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:27:18.105668 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '054f5e3e-46aa-45a6-b9ca-ae862841f9c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fd27d51d0>]}
[0m18:27:18.107672 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.22s]
[0m18:27:18.110261 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:27:18.113803 [debug] [MainThread]: Using postgres connection "master"
[0m18:27:18.115180 [debug] [MainThread]: On master: BEGIN
[0m18:27:18.116555 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:27:18.129626 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m18:27:18.131508 [debug] [MainThread]: On master: COMMIT
[0m18:27:18.133112 [debug] [MainThread]: Using postgres connection "master"
[0m18:27:18.134343 [debug] [MainThread]: On master: COMMIT
[0m18:27:18.136121 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:27:18.137504 [debug] [MainThread]: On master: Close
[0m18:27:18.138822 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:27:18.140063 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:27:18.141489 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_daily' was properly closed.
[0m18:27:18.142885 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:27:18.144399 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:27:18.146133 [info ] [MainThread]: 
[0m18:27:18.147946 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.10 seconds (1.10s).
[0m18:27:18.151097 [debug] [MainThread]: Command end result
[0m18:27:18.240297 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:27:18.250542 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:27:18.267610 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:27:18.269076 [info ] [MainThread]: 
[0m18:27:18.271091 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:27:18.272770 [info ] [MainThread]: 
[0m18:27:18.274096 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:27:18.276087 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.2348084, "process_in_blocks": "0", "process_kernel_time": 1.286852, "process_mem_max_rss": "131728", "process_out_blocks": "0", "process_user_time": 2.276738}
[0m18:27:18.277682 [debug] [MainThread]: Command `dbt run` succeeded at 18:27:18.277555 after 4.24 seconds
[0m18:27:18.279237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe5b6d950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe980f910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713fe95c6cd0>]}
[0m18:27:18.280862 [debug] [MainThread]: Flushing usage events
[0m18:27:19.022017 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:28:21.536503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e2b6e290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e2bce890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e2eeca10>]}


============================== 18:28:21.547744 | c46df9fb-a6c2-4690-9c44-4c483934e4cf ==============================
[0m18:28:21.547744 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:28:21.550561 [debug] [MainThread]: running dbt with arguments {'log_path': '/usr/app/dbt/dbt/logs', 'printer_width': '80', 'partial_parse': 'True', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'empty': 'False', 'log_format': 'default', 'version_check': 'True', 'cache_selected_only': 'False', 'use_colors': 'True', 'warn_error': 'None', 'static_parser': 'True', 'invocation_command': 'dbt run', 'write_json': 'True', 'debug': 'False', 'fail_fast': 'False'}
[0m18:28:21.717416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e231e990>]}
[0m18:28:21.767063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e58eead0>]}
[0m18:28:21.773662 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:28:21.942346 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:28:24.732306 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:28:24.733326 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:28:24.769731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e173bf90>]}
[0m18:28:24.937719 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:28:24.953375 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:28:25.071447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e235a6d0>]}
[0m18:28:25.074896 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:28:25.076798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e5a12a10>]}
[0m18:28:25.082202 [info ] [MainThread]: 
[0m18:28:25.086840 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:28:25.092617 [info ] [MainThread]: 
[0m18:28:25.097087 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:28:25.106736 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:28:25.231110 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:28:25.233049 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:28:25.234355 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:28:25.247288 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.013 seconds
[0m18:28:25.249368 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:28:25.252236 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:28:25.258735 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:28:25.259833 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:28:25.260706 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:28:25.268236 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m18:28:25.269640 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:28:25.270670 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:28:25.277421 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.005 seconds
[0m18:28:25.280702 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:28:25.282029 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:28:25.289191 [debug] [MainThread]: Using postgres connection "master"
[0m18:28:25.290600 [debug] [MainThread]: On master: BEGIN
[0m18:28:25.291796 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:28:25.299581 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m18:28:25.301201 [debug] [MainThread]: Using postgres connection "master"
[0m18:28:25.302405 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:28:25.309338 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m18:28:25.312089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e32e3d50>]}
[0m18:28:25.313198 [debug] [MainThread]: On master: ROLLBACK
[0m18:28:25.314375 [debug] [MainThread]: Using postgres connection "master"
[0m18:28:25.315209 [debug] [MainThread]: On master: BEGIN
[0m18:28:25.317868 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m18:28:25.318788 [debug] [MainThread]: On master: COMMIT
[0m18:28:25.319904 [debug] [MainThread]: Using postgres connection "master"
[0m18:28:25.320846 [debug] [MainThread]: On master: COMMIT
[0m18:28:25.322585 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:28:25.323414 [debug] [MainThread]: On master: Close
[0m18:28:25.329889 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:28:25.331195 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:28:25.332328 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:28:25.333372 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:28:25.348632 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:28:25.358025 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:28:25.382908 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:28:25.395952 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:28:25.399040 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:28:25.400549 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:28:25.408742 [debug] [Thread-1 (]: SQL status: BEGIN in 0.008 seconds
[0m18:28:25.410305 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:28:25.411278 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:28:25.420714 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m18:28:25.427043 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:28:25.428214 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:28:25.429965 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.432914 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:28:25.433733 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:28:25.435535 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.445925 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:28:25.446978 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:28:25.447771 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:28:25.450986 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m18:28:25.455718 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:28:25.460919 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:28:25.461836 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:28:25.467509 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m18:28:25.471125 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:28:25.474318 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60dfbb3510>]}
[0m18:28:25.476160 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.14s]
[0m18:28:25.477514 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:28:25.479242 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:28:25.479649 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:28:25.480007 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:28:25.480964 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:28:25.482038 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:28:25.483221 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:28:25.484406 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:28:25.485558 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:28:25.486869 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:28:25.487753 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:28:25.488892 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:28:25.489861 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:28:25.495071 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:28:25.498528 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:28:25.502119 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:28:25.509434 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:28:25.509905 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:28:25.516119 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:28:25.528708 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:28:25.532226 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:28:25.535300 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:28:25.544670 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:28:25.545335 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:28:25.545952 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:28:25.546582 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:28:25.547396 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:28:25.548261 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:28:25.548941 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:28:25.549670 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:28:25.550430 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:28:25.562317 [debug] [Thread-4 (]: SQL status: BEGIN in 0.012 seconds
[0m18:28:25.562822 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m18:28:25.563593 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m18:28:25.564090 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:28:25.564856 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:28:25.565753 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:28:25.566902 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:28:25.568924 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:28:25.569977 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:28:25.580605 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.009 seconds
[0m18:28:25.586781 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:28:25.587115 [debug] [Thread-4 (]: SQL status: SELECT 792 in 0.016 seconds
[0m18:28:25.587393 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.015 seconds
[0m18:28:25.588085 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:28:25.591916 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:28:25.594751 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:28:25.596523 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:28:25.596780 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.597603 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:28:25.599185 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.601481 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:28:25.604685 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:28:25.604976 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m18:28:25.605523 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:28:25.606317 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:28:25.609563 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:28:25.612431 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.613929 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.615182 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:28:25.619506 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:28:25.623387 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:28:25.626801 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:28:25.627438 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:28:25.628574 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:28:25.630209 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:28:25.633460 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:28:25.634713 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:28:25.636434 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:28:25.637933 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:28:25.639382 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m18:28:25.642877 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:28:25.643314 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m18:28:25.643715 [debug] [Thread-4 (]: SQL status: COMMIT in 0.006 seconds
[0m18:28:25.648866 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:28:25.651945 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:28:25.655313 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:28:25.656297 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:28:25.657681 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:28:25.659660 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:28:25.662507 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:28:25.663778 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:28:25.666775 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:28:25.669653 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:28:25.670845 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:28:25.671652 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60dc8407d0>]}
[0m18:28:25.673587 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:28:25.674319 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.009 seconds
[0m18:28:25.675507 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.18s]
[0m18:28:25.676931 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60dfad5550>]}
[0m18:28:25.679217 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:28:25.681018 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:28:25.682589 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 792[0m in 0.19s]
[0m18:28:25.683990 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e1f34750>]}
[0m18:28:25.685303 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:28:25.686332 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:28:25.687849 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.20s]
[0m18:28:25.688924 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:28:25.690381 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:28:25.691416 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:28:25.692558 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_monthly)
[0m18:28:25.693662 [info ] [Thread-2 (]: 6 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:28:25.696568 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:28:25.697334 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:28:25.698353 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m18:28:25.699284 [info ] [Thread-4 (]: 7 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:28:25.702363 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:28:25.703197 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:28:25.704120 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_daily)
[0m18:28:25.707738 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:28:25.709049 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:28:25.713156 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:28:25.714680 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:28:25.718246 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:28:25.719135 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:28:25.722198 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:28:25.722458 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:28:25.728210 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:28:25.729778 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:28:25.730710 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:28:25.731595 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:28:25.731976 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:28:25.733021 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:28:25.733338 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:28:25.735013 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:28:25.736043 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:28:25.737389 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:28:25.741010 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m18:28:25.743956 [debug] [Thread-2 (]: SQL status: BEGIN in 0.009 seconds
[0m18:28:25.744247 [debug] [Thread-4 (]: SQL status: BEGIN in 0.007 seconds
[0m18:28:25.744537 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:28:25.746179 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:28:25.746970 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:28:25.747824 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:28:25.748635 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:28:25.749339 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:28:25.753950 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.004 seconds
[0m18:28:25.755557 [debug] [Thread-4 (]: SQL status: SELECT 132 in 0.004 seconds
[0m18:28:25.759653 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:28:25.759998 [debug] [Thread-2 (]: SQL status: SELECT 792 in 0.009 seconds
[0m18:28:25.770797 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:28:25.775150 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:28:25.796118 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:28:25.798655 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:28:25.801383 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.802485 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:28:25.805028 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.809999 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:28:25.812943 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.816449 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:28:25.817528 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:28:25.821391 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:28:25.822514 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:28:25.825909 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.826379 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:28:25.828258 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:28:25.829476 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:28:25.831059 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:28:25.832964 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:28:25.834125 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:28:25.836447 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:28:25.837490 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:28:25.838572 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:28:25.840800 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:28:25.842119 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:28:25.844251 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:28:25.846095 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m18:28:25.849908 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:28:25.851518 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:28:25.851922 [debug] [Thread-4 (]: SQL status: COMMIT in 0.006 seconds
[0m18:28:25.852880 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:28:25.853329 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m18:28:25.856365 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:28:25.864916 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:28:25.865472 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m18:28:25.867269 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:28:25.869094 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:28:25.872247 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:28:25.874800 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:28:25.876035 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:28:25.877401 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60dc7ba850>]}
[0m18:28:25.881724 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.18s]
[0m18:28:25.882934 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:28:25.883808 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:28:25.885709 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:28:25.887644 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:28:25.889203 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:28:25.893232 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60dc7ee4d0>]}
[0m18:28:25.895715 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46df9fb-a6c2-4690-9c44-4c483934e4cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60dc7ef390>]}
[0m18:28:25.896881 [info ] [Thread-4 (]: 7 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.19s]
[0m18:28:25.899034 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 792[0m in 0.20s]
[0m18:28:25.900226 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:28:25.901409 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:28:25.909082 [debug] [MainThread]: Using postgres connection "master"
[0m18:28:25.914507 [debug] [MainThread]: On master: BEGIN
[0m18:28:25.920858 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:28:25.931000 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m18:28:25.933403 [debug] [MainThread]: On master: COMMIT
[0m18:28:25.935055 [debug] [MainThread]: Using postgres connection "master"
[0m18:28:25.936436 [debug] [MainThread]: On master: COMMIT
[0m18:28:25.937947 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:28:25.938961 [debug] [MainThread]: On master: Close
[0m18:28:25.940967 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:28:25.942947 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:28:25.947039 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_daily' was properly closed.
[0m18:28:25.948205 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:28:25.949284 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:28:25.950348 [info ] [MainThread]: 
[0m18:28:25.952120 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m18:28:25.954347 [debug] [MainThread]: Command end result
[0m18:28:26.042182 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:28:26.061267 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:28:26.076159 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:28:26.078340 [info ] [MainThread]: 
[0m18:28:26.080469 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:28:26.085898 [info ] [MainThread]: 
[0m18:28:26.090617 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:28:26.094053 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.7100883, "process_in_blocks": "0", "process_kernel_time": 0.86467, "process_mem_max_rss": "131708", "process_out_blocks": "0", "process_user_time": 2.173912}
[0m18:28:26.099151 [debug] [MainThread]: Command `dbt run` succeeded at 18:28:26.098976 after 4.72 seconds
[0m18:28:26.100542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e73ced90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e2b62b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60e747b8d0>]}
[0m18:28:26.101804 [debug] [MainThread]: Flushing usage events
[0m18:28:26.906623 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:05:47.833099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dadf5693d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dae1221890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dae10eff50>]}


============================== 22:05:47.843027 | 3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd ==============================
[0m22:05:47.843027 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:05:47.844217 [debug] [MainThread]: running dbt with arguments {'log_path': '/usr/app/dbt/dbt/logs', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'debug': 'False', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'quiet': 'False', 'target_path': 'None', 'use_colors': 'True', 'version_check': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'no_print': 'None', 'write_json': 'True', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'use_experimental_parser': 'False'}
[0m22:05:48.059359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71daddb36710>]}
[0m22:05:48.116233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dae1115090>]}
[0m22:05:48.119796 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:05:48.297949 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:05:50.759439 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:05:50.761816 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:05:50.802134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71daddb35190>]}
[0m22:05:50.941386 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:05:50.953257 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:05:51.082363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dadda9ccd0>]}
[0m22:05:51.084847 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:05:51.086922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dadc730150>]}
[0m22:05:51.091397 [info ] [MainThread]: 
[0m22:05:51.093265 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:05:51.094939 [info ] [MainThread]: 
[0m22:05:51.097940 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:05:51.103077 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:05:51.247576 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:05:51.249344 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:05:51.250694 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:05:51.340499 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.090 seconds
[0m22:05:51.343555 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:05:51.347350 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:05:51.352722 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:05:51.353877 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:05:51.355082 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:05:51.364502 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m22:05:51.366082 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:05:51.367616 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:05:51.427427 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.059 seconds
[0m22:05:51.430372 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:05:51.432056 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:05:51.438625 [debug] [MainThread]: Using postgres connection "master"
[0m22:05:51.439854 [debug] [MainThread]: On master: BEGIN
[0m22:05:51.440934 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:05:51.450829 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:05:51.452337 [debug] [MainThread]: Using postgres connection "master"
[0m22:05:51.453587 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:05:51.507170 [debug] [MainThread]: SQL status: SELECT 1 in 0.052 seconds
[0m22:05:51.511183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dadf40e310>]}
[0m22:05:51.513415 [debug] [MainThread]: On master: ROLLBACK
[0m22:05:51.515756 [debug] [MainThread]: Using postgres connection "master"
[0m22:05:51.517502 [debug] [MainThread]: On master: BEGIN
[0m22:05:51.519712 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:05:51.521918 [debug] [MainThread]: On master: COMMIT
[0m22:05:51.523979 [debug] [MainThread]: Using postgres connection "master"
[0m22:05:51.525241 [debug] [MainThread]: On master: COMMIT
[0m22:05:51.527133 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:05:51.529286 [debug] [MainThread]: On master: Close
[0m22:05:51.540006 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:05:51.543290 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:05:51.545216 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:05:51.546777 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:05:51.563885 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:05:51.579659 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:05:51.609358 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:05:51.625018 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:05:51.626192 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:05:51.627564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:05:51.636740 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m22:05:51.638332 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:05:51.639832 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:05:51.696230 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.055 seconds
[0m22:05:51.703605 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:05:51.705223 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:05:51.713671 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m22:05:51.717751 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:05:51.718700 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:05:51.724081 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m22:05:51.738560 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:05:51.740005 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:05:51.741286 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:05:51.745265 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:05:51.752195 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:05:51.757834 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:05:51.761288 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:05:51.779779 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.016 seconds
[0m22:05:51.783483 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:05:51.789061 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dade3f3c10>]}
[0m22:05:51.790977 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.24s]
[0m22:05:51.793244 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:05:51.796048 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:05:51.796871 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:05:51.797519 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:05:51.799156 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:05:51.800945 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:05:51.803414 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:05:51.804911 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:05:51.806279 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:05:51.808265 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:05:51.809903 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:05:51.811831 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:05:51.813784 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:05:51.819916 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:05:51.825576 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:05:51.830851 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:05:51.842291 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:05:51.842748 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:05:51.849532 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:05:51.858208 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:05:51.862094 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:05:51.866679 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:05:51.875599 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:05:51.876175 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:05:51.877406 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:05:51.878566 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:05:51.879156 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:05:51.880189 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:05:51.881336 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:05:51.882386 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:05:51.885472 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:05:51.897310 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m22:05:51.898052 [debug] [Thread-4 (]: SQL status: BEGIN in 0.018 seconds
[0m22:05:51.898567 [debug] [Thread-3 (]: SQL status: BEGIN in 0.017 seconds
[0m22:05:51.899361 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:05:51.900769 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:05:51.902024 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:05:51.903346 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:05:51.905098 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:05:51.906875 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:05:51.960995 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.052 seconds
[0m22:05:51.961501 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.051 seconds
[0m22:05:51.962076 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.052 seconds
[0m22:05:51.968858 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:05:51.976504 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:05:51.980265 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:05:51.981720 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:05:51.983590 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:05:51.985266 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:05:51.989757 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m22:05:51.990207 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:05:51.990811 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:05:51.995451 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:05:52.001858 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:05:52.005391 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:05:52.006806 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:05:52.008049 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:05:52.009578 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:05:52.012651 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:05:52.013702 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:05:52.015445 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:05:52.017620 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:05:52.022278 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:05:52.026856 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:05:52.029871 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:05:52.031595 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:05:52.033585 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:05:52.035220 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:05:52.036960 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:05:52.038313 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:05:52.042714 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m22:05:52.046636 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:05:52.047311 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m22:05:52.051853 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:05:52.052337 [debug] [Thread-4 (]: SQL status: COMMIT in 0.010 seconds
[0m22:05:52.055753 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:05:52.057120 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:05:52.061204 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:05:52.063555 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:05:52.066417 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:05:52.067635 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:05:52.068812 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:05:52.079096 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.009 seconds
[0m22:05:52.079552 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.014 seconds
[0m22:05:52.081638 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:05:52.081962 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.011 seconds
[0m22:05:52.083742 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:05:52.085522 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dabbf246d0>]}
[0m22:05:52.087886 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:05:52.089650 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dabbfce050>]}
[0m22:05:52.091118 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.28s]
[0m22:05:52.092952 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dadf40e310>]}
[0m22:05:52.094327 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.28s]
[0m22:05:52.095976 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:05:52.097403 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.29s]
[0m22:05:52.099046 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:05:52.100706 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:05:52.102683 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:05:52.104433 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:05:52.105813 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:05:52.108919 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:05:52.110031 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:05:52.111568 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m22:05:52.113517 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:05:52.115757 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m22:05:52.117270 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:05:52.119119 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m22:05:52.120516 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:05:52.125106 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:05:52.127160 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:05:52.134352 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:05:52.140652 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:05:52.148512 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:05:52.149804 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:05:52.152673 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:05:52.156685 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:05:52.157002 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:05:52.163181 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:05:52.171557 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:05:52.172168 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:05:52.173288 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:05:52.175438 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:05:52.175896 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:05:52.177284 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:05:52.178583 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:05:52.179834 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:05:52.182651 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:05:52.191353 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m22:05:52.192906 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:05:52.194133 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:05:52.194925 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m22:05:52.195511 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m22:05:52.201016 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:05:52.202197 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:05:52.202443 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.007 seconds
[0m22:05:52.203113 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:05:52.203907 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:05:52.207923 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:05:52.211246 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:05:52.213198 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.003 seconds
[0m22:05:52.213620 [debug] [Thread-2 (]: SQL status: SELECT 924 in 0.005 seconds
[0m22:05:52.213876 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:05:52.217603 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:05:52.221423 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:05:52.225667 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:05:52.226750 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:05:52.227671 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:05:52.228729 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:05:52.231479 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:05:52.232024 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:05:52.232411 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m22:05:52.235377 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:05:52.237152 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:05:52.241962 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:05:52.243705 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:05:52.245419 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:05:52.246718 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:05:52.248836 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:05:52.250420 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:05:52.251955 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:05:52.253972 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:05:52.260337 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:05:52.260886 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:05:52.262074 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:05:52.263287 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:05:52.267647 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:05:52.268900 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:05:52.271209 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:05:52.273028 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:05:52.276371 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m22:05:52.277062 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:05:52.277909 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m22:05:52.280757 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:05:52.288591 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:05:52.289368 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:05:52.290378 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:05:52.293410 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:05:52.296251 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:05:52.297508 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:05:52.298679 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:05:52.300351 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dabbeb4590>]}
[0m22:05:52.311055 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.19s]
[0m22:05:52.313689 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:05:52.314334 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:05:52.317410 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:05:52.317693 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.008 seconds
[0m22:05:52.319240 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dabbeb61d0>]}
[0m22:05:52.322053 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:05:52.323909 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.20s]
[0m22:05:52.326094 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8fb3a5-bfb3-42a2-ab9f-768bc89552dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dabbeb4950>]}
[0m22:05:52.328011 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:05:52.330496 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.21s]
[0m22:05:52.334830 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:05:52.337842 [debug] [MainThread]: Using postgres connection "master"
[0m22:05:52.339657 [debug] [MainThread]: On master: BEGIN
[0m22:05:52.340894 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:05:52.351069 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:05:52.352891 [debug] [MainThread]: On master: COMMIT
[0m22:05:52.354188 [debug] [MainThread]: Using postgres connection "master"
[0m22:05:52.356589 [debug] [MainThread]: On master: COMMIT
[0m22:05:52.358600 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:05:52.360527 [debug] [MainThread]: On master: Close
[0m22:05:52.362559 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:05:52.364480 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:05:52.367236 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:05:52.371771 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m22:05:52.374233 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:05:52.377225 [info ] [MainThread]: 
[0m22:05:52.379749 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.28 seconds (1.28s).
[0m22:05:52.383975 [debug] [MainThread]: Command end result
[0m22:05:52.467800 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:05:52.476407 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:05:52.490644 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:05:52.492158 [info ] [MainThread]: 
[0m22:05:52.493787 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:05:52.495340 [info ] [MainThread]: 
[0m22:05:52.496948 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:05:52.501004 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.7718687, "process_in_blocks": "2272", "process_kernel_time": 2.345316, "process_mem_max_rss": "130988", "process_out_blocks": "0", "process_user_time": 2.602337}
[0m22:05:52.502548 [debug] [MainThread]: Command `dbt run` succeeded at 22:05:52.502360 after 4.77 seconds
[0m22:05:52.503906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dae2caf890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dae2ccac10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dae2ccb5d0>]}
[0m22:05:52.505202 [debug] [MainThread]: Flushing usage events
[0m22:05:53.351910 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:05:56.840735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bf22f8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bf94d7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bf251450>]}


============================== 22:05:56.847982 | 07efaa2a-92bd-4704-a225-11e8b8117087 ==============================
[0m22:05:56.847982 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:05:56.850749 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/usr/app/dbt/dbt', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_format': 'default', 'write_json': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'fail_fast': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'printer_width': '80', 'warn_error': 'None', 'debug': 'False', 'quiet': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'invocation_command': 'dbt run', 'no_print': 'None', 'partial_parse': 'True', 'static_parser': 'True', 'indirect_selection': 'eager', 'introspect': 'True', 'empty': 'False'}
[0m22:05:57.004896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bf15f090>]}
[0m22:05:57.045996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021c1f9a510>]}
[0m22:05:57.048851 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:05:57.259104 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:05:59.756964 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:05:59.758983 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:05:59.802825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bdd74d10>]}
[0m22:05:59.938920 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:05:59.949927 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:00.086551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bf135390>]}
[0m22:06:00.088731 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:06:00.090347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bd165b90>]}
[0m22:06:00.095884 [info ] [MainThread]: 
[0m22:06:00.098298 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:06:00.100948 [info ] [MainThread]: 
[0m22:06:00.103108 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:06:00.109972 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:06:00.231262 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:06:00.233790 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:06:00.235987 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:06:00.258061 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.022 seconds
[0m22:06:00.262381 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:06:00.267232 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:06:00.277075 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:00.278856 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:06:00.280363 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:06:00.304457 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m22:06:00.306713 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:00.308648 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:06:00.318211 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.008 seconds
[0m22:06:00.322747 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:06:00.324927 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:06:00.335559 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:00.337846 [debug] [MainThread]: On master: BEGIN
[0m22:06:00.339424 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:06:00.363656 [debug] [MainThread]: SQL status: BEGIN in 0.024 seconds
[0m22:06:00.366003 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:00.368320 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:06:00.379550 [debug] [MainThread]: SQL status: SELECT 1 in 0.009 seconds
[0m22:06:00.382576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bf251250>]}
[0m22:06:00.384210 [debug] [MainThread]: On master: ROLLBACK
[0m22:06:00.402586 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:00.404815 [debug] [MainThread]: On master: BEGIN
[0m22:06:00.407347 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:06:00.409150 [debug] [MainThread]: On master: COMMIT
[0m22:06:00.410843 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:00.413575 [debug] [MainThread]: On master: COMMIT
[0m22:06:00.416319 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:00.419248 [debug] [MainThread]: On master: Close
[0m22:06:00.428892 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:06:00.431153 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:06:00.433754 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:06:00.435637 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:06:00.454305 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:00.483492 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:06:00.509935 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:00.531041 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:00.534938 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:06:00.536786 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:00.550257 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m22:06:00.552302 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:00.553938 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:06:00.569357 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.014 seconds
[0m22:06:00.579005 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:00.580711 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:06:00.583901 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:06:00.590092 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:00.591966 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:06:00.608888 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:06:00.628622 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:00.630978 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:00.633178 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:00.647325 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m22:06:00.657487 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:06:00.663693 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:00.677787 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:06:00.695179 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.014 seconds
[0m22:06:00.701343 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:06:00.705511 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021b7fb9a50>]}
[0m22:06:00.708075 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.27s]
[0m22:06:00.712662 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:06:00.716010 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:06:00.716562 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:06:00.716979 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:06:00.718900 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:06:00.721138 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:06:00.722943 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:06:00.724721 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:06:00.726378 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:06:00.728170 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:06:00.729598 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:06:00.731179 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:06:00.732577 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:06:00.738295 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:06:00.741942 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:00.745056 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:00.755553 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:06:00.756168 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:06:00.762759 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:06:00.776968 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:00.779906 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:06:00.783421 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:00.795400 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:00.796739 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:00.797393 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:06:00.798889 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:00.799297 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:06:00.800540 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:06:00.801767 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:06:00.803145 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:06:00.806079 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:06:00.815163 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m22:06:00.816743 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:00.817920 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:06:00.834438 [debug] [Thread-4 (]: SQL status: BEGIN in 0.031 seconds
[0m22:06:00.834844 [debug] [Thread-2 (]: SQL status: BEGIN in 0.029 seconds
[0m22:06:00.836121 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:00.836743 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.018 seconds
[0m22:06:00.837747 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:00.838853 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:06:00.844374 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:00.845877 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:06:00.849602 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:06:00.854346 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:00.861955 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:00.862575 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.015 seconds
[0m22:06:00.863337 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.011 seconds
[0m22:06:00.863730 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:06:00.866894 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:00.869828 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:00.871662 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:00.872362 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:06:00.873510 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:06:00.876015 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:00.878570 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:00.879721 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:00.880007 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:00.882875 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:00.885691 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:00.886988 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:00.888441 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:06:00.889779 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:06:00.892907 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:00.894347 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:00.895744 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:00.897641 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:00.899020 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:00.900852 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:00.901129 [debug] [Thread-3 (]: SQL status: COMMIT in 0.010 seconds
[0m22:06:00.902089 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:00.903396 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:00.906000 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:06:00.911248 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:00.912487 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:06:00.921601 [debug] [Thread-4 (]: SQL status: COMMIT in 0.014 seconds
[0m22:06:00.925441 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:06:00.927263 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:00.928780 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:06:00.932333 [debug] [Thread-2 (]: SQL status: COMMIT in 0.024 seconds
[0m22:06:00.932722 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.019 seconds
[0m22:06:00.936202 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:06:00.939018 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:06:00.941178 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:00.943221 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021b7e26610>]}
[0m22:06:00.944267 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.014 seconds
[0m22:06:00.944623 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:06:00.946390 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.22s]
[0m22:06:00.949645 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:06:00.952566 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:06:00.954937 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bf252610>]}
[0m22:06:00.956029 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:06:00.957288 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:06:00.958942 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.23s]
[0m22:06:00.961876 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:06:00.964335 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:06:00.966413 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:06:00.968686 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021b4df4250>]}
[0m22:06:00.970263 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m22:06:00.972487 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:06:00.973782 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.24s]
[0m22:06:00.975201 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:06:00.976301 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:06:00.977854 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:06:00.983143 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:00.984876 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m22:06:00.986914 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:06:00.989293 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:06:00.991726 [info ] [Thread-4 (]: 7 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:06:00.996760 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:00.999618 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m22:06:01.002324 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:06:01.006024 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:01.008173 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:06:01.008563 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:06:01.014611 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:01.019427 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:01.021060 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:06:01.027865 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:01.036664 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:01.037037 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:01.037866 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:06:01.038729 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:01.038967 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:06:01.039787 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:06:01.040564 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:06:01.041223 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:01.042692 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:06:01.050518 [debug] [Thread-3 (]: SQL status: BEGIN in 0.010 seconds
[0m22:06:01.051593 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m22:06:01.052482 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:01.053422 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m22:06:01.054237 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:01.055511 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:06:01.056962 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:01.058325 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:06:01.060601 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:06:01.064387 [debug] [Thread-3 (]: SQL status: SELECT 924 in 0.005 seconds
[0m22:06:01.069969 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:01.070413 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.008 seconds
[0m22:06:01.070842 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.007 seconds
[0m22:06:01.072527 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:06:01.075232 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:01.077876 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:01.079388 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:01.079796 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:06:01.081336 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:06:01.084964 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:01.086384 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:01.086914 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:01.087606 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:06:01.091108 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:01.093762 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:01.095416 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:01.095760 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:06:01.097340 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:06:01.099064 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:01.100505 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:01.101250 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:01.101581 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:01.103064 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:01.104121 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:01.107019 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:01.108431 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:01.110781 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:01.111807 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:01.113111 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:01.119569 [debug] [Thread-3 (]: SQL status: COMMIT in 0.010 seconds
[0m22:06:01.123755 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:06:01.125466 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:01.126856 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:06:01.130549 [debug] [Thread-4 (]: SQL status: COMMIT in 0.015 seconds
[0m22:06:01.130837 [debug] [Thread-1 (]: SQL status: COMMIT in 0.016 seconds
[0m22:06:01.133570 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:06:01.136973 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:06:01.138366 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:01.139755 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:01.141051 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:06:01.141468 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.013 seconds
[0m22:06:01.142515 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:06:01.146615 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:06:01.150012 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021b4cf4610>]}
[0m22:06:01.151945 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.17s]
[0m22:06:01.154208 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:06:01.162009 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.018 seconds
[0m22:06:01.166398 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:06:01.168466 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021b4cda390>]}
[0m22:06:01.170492 [info ] [Thread-4 (]: 7 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.17s]
[0m22:06:01.172472 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:06:01.173068 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.024 seconds
[0m22:06:01.176371 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:06:01.178983 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07efaa2a-92bd-4704-a225-11e8b8117087', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021b4cdac50>]}
[0m22:06:01.180817 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.21s]
[0m22:06:01.183185 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:06:01.187719 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:01.189448 [debug] [MainThread]: On master: BEGIN
[0m22:06:01.190624 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:06:01.212045 [debug] [MainThread]: SQL status: BEGIN in 0.021 seconds
[0m22:06:01.214689 [debug] [MainThread]: On master: COMMIT
[0m22:06:01.216584 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:01.218428 [debug] [MainThread]: On master: COMMIT
[0m22:06:01.219906 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:01.222033 [debug] [MainThread]: On master: Close
[0m22:06:01.223966 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:06:01.225269 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:06:01.226697 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:06:01.227736 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:06:01.228834 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_monthly' was properly closed.
[0m22:06:01.230048 [info ] [MainThread]: 
[0m22:06:01.232044 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.13 seconds (1.13s).
[0m22:06:01.234350 [debug] [MainThread]: Command end result
[0m22:06:01.358868 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:01.369820 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:01.389257 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:06:01.390747 [info ] [MainThread]: 
[0m22:06:01.392163 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:06:01.394957 [info ] [MainThread]: 
[0m22:06:01.397018 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:06:01.400291 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6413417, "process_in_blocks": "0", "process_kernel_time": 1.517634, "process_mem_max_rss": "130700", "process_out_blocks": "0", "process_user_time": 2.624067}
[0m22:06:01.402193 [debug] [MainThread]: Command `dbt run` succeeded at 22:06:01.402062 after 4.64 seconds
[0m22:06:01.404608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bf22ea10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021bf222d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7021c3a7add0>]}
[0m22:06:01.406018 [debug] [MainThread]: Flushing usage events
[0m22:06:02.075626 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:06:05.207189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3f6bf390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3f6beb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3f70a010>]}


============================== 22:06:05.214665 | 7bf41951-6ebe-4814-801d-8450be01bbc2 ==============================
[0m22:06:05.214665 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:06:05.216680 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'log_format': 'default', 'invocation_command': 'dbt run', 'debug': 'False', 'quiet': 'False', 'use_colors': 'True', 'no_print': 'None', 'introspect': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'use_experimental_parser': 'False', 'write_json': 'True', 'target_path': 'None', 'static_parser': 'True', 'cache_selected_only': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'fail_fast': 'False', 'partial_parse': 'True', 'empty': 'False', 'indirect_selection': 'eager'}
[0m22:06:05.368975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3e7112d0>]}
[0m22:06:05.407484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef4242d290>]}
[0m22:06:05.410570 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:06:05.584244 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:06:08.193319 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:06:08.194685 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:06:08.228129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3df84350>]}
[0m22:06:08.374885 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:08.384468 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:08.501296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3e711190>]}
[0m22:06:08.504163 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:06:08.506144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3df2dc50>]}
[0m22:06:08.510157 [info ] [MainThread]: 
[0m22:06:08.512009 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:06:08.513661 [info ] [MainThread]: 
[0m22:06:08.515846 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:06:08.521044 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:06:08.626637 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:06:08.628024 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:06:08.629106 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:06:08.645818 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m22:06:08.650294 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:06:08.654856 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:06:08.660708 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:08.662158 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:06:08.663670 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:06:08.674919 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m22:06:08.676759 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:08.677934 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:06:08.684481 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m22:06:08.687794 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:06:08.689489 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:06:08.695475 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:08.696825 [debug] [MainThread]: On master: BEGIN
[0m22:06:08.698036 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:06:08.708923 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:06:08.710727 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:08.712221 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:06:08.718652 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m22:06:08.721846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3f7bad50>]}
[0m22:06:08.723450 [debug] [MainThread]: On master: ROLLBACK
[0m22:06:08.725140 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:08.726153 [debug] [MainThread]: On master: BEGIN
[0m22:06:08.727400 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:06:08.728403 [debug] [MainThread]: On master: COMMIT
[0m22:06:08.729437 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:08.730475 [debug] [MainThread]: On master: COMMIT
[0m22:06:08.731728 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:08.732764 [debug] [MainThread]: On master: Close
[0m22:06:08.737293 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:06:08.738474 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:06:08.740005 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:06:08.741556 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:06:08.758390 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:08.769540 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:06:08.795143 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:08.807810 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:08.809315 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:06:08.810154 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:08.829132 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m22:06:08.830336 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:08.831461 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:06:08.842006 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m22:06:08.850654 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:08.852306 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:06:08.854532 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:08.858019 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:08.859333 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:06:08.861607 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:08.875139 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:08.881414 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:08.882457 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:08.900134 [debug] [Thread-1 (]: SQL status: COMMIT in 0.017 seconds
[0m22:06:08.912099 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:06:08.923913 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:08.925485 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:06:08.931973 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m22:06:08.939493 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:06:08.945146 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3dbfb190>]}
[0m22:06:08.948131 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.20s]
[0m22:06:08.950284 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:06:08.954548 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:06:08.955296 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:06:08.955868 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:06:08.959664 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:06:08.963721 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:06:08.965454 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:06:08.967483 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:06:08.970962 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:06:08.973262 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:06:08.974571 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:06:08.975721 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:06:08.976882 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:06:08.982383 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:06:08.987290 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:08.993342 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:09.021255 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:06:09.021920 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:06:09.028685 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:06:09.042187 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:06:09.048060 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:09.053959 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:09.064052 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:09.065336 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:09.065912 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:06:09.066513 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:09.067718 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:06:09.069292 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:06:09.070779 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:06:09.072914 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:06:09.076584 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:06:09.085896 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m22:06:09.087293 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:09.088785 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:06:09.101014 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m22:06:09.102017 [debug] [Thread-4 (]: SQL status: BEGIN in 0.026 seconds
[0m22:06:09.102448 [debug] [Thread-2 (]: SQL status: BEGIN in 0.030 seconds
[0m22:06:09.108095 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:09.109242 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:09.110044 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:09.110839 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:06:09.111952 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:06:09.113034 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:06:09.114817 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:09.119435 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:09.120982 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:06:09.123130 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:09.124721 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:09.125826 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:09.126950 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:09.132554 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m22:06:09.135731 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:06:09.143087 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:09.143565 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.029 seconds
[0m22:06:09.144762 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:06:09.145452 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.030 seconds
[0m22:06:09.148624 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:09.152474 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:09.153585 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:06:09.155125 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:06:09.156080 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:06:09.157703 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:09.158841 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:09.161261 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:06:09.164216 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:09.166954 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:09.170893 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3c4a4210>]}
[0m22:06:09.176211 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:06:09.179658 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:06:09.181976 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.20s]
[0m22:06:09.187900 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:09.190695 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:09.192172 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:06:09.201609 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:09.206003 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:09.209692 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:06:09.211607 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:09.212871 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:09.214489 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:06:09.215861 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:09.218646 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:09.225055 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m22:06:09.230926 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:06:09.235633 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:09.242868 [debug] [Thread-4 (]: SQL status: COMMIT in 0.015 seconds
[0m22:06:09.244628 [debug] [Thread-2 (]: SQL status: COMMIT in 0.016 seconds
[0m22:06:09.248036 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:06:09.250624 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:06:09.252314 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:09.253930 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:09.255848 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:06:09.256931 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:06:09.257780 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:06:09.263139 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:09.263480 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.004 seconds
[0m22:06:09.267304 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:06:09.267576 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.003 seconds
[0m22:06:09.268774 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3c4db750>]}
[0m22:06:09.271240 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:06:09.272917 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.30s]
[0m22:06:09.274603 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3c30f550>]}
[0m22:06:09.275754 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:06:09.277096 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.30s]
[0m22:06:09.278798 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:06:09.279684 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:06:09.280054 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:09.280939 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:06:09.282805 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:06:09.283833 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:06:09.284773 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m22:06:09.285526 [info ] [Thread-4 (]: 7 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:06:09.286619 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:09.287629 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:06:09.288914 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m22:06:09.293465 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:09.294428 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:06:09.297681 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:09.298516 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m22:06:09.299450 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:09.300138 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:06:09.303124 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:06:09.306920 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:09.307320 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:06:09.307609 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.007 seconds
[0m22:06:09.311749 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:09.314823 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:09.316635 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:06:09.318420 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:09.318861 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:09.319677 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:06:09.323524 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:09.323947 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:09.324739 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:06:09.325682 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:06:09.326745 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:06:09.329214 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:09.329464 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:06:09.331165 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:09.333124 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:09.334496 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:09.335683 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m22:06:09.336648 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:09.337057 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:06:09.338205 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:06:09.341033 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:06:09.341681 [debug] [Thread-4 (]: SQL status: BEGIN in 0.012 seconds
[0m22:06:09.343601 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:09.344767 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:09.345677 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:06:09.346532 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:06:09.361206 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.013 seconds
[0m22:06:09.361733 [debug] [Thread-3 (]: SQL status: SELECT 924 in 0.019 seconds
[0m22:06:09.366176 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:09.366505 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.019 seconds
[0m22:06:09.370185 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:09.371755 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:06:09.373545 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:06:09.374733 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:06:09.376293 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:09.376809 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3c383250>]}
[0m22:06:09.378041 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:09.381073 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:09.382395 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.15s]
[0m22:06:09.386100 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:09.386907 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:06:09.388251 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:06:09.389264 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:06:09.390832 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:09.393020 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:09.393402 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:06:09.394336 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:09.396117 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:09.396941 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:09.397638 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:09.398803 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:09.401936 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m22:06:09.404738 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:06:09.405912 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:09.406742 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:06:09.412745 [debug] [Thread-3 (]: SQL status: COMMIT in 0.013 seconds
[0m22:06:09.417102 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:06:09.418182 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:09.419113 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:06:09.423617 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.016 seconds
[0m22:06:09.426126 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:06:09.427693 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3c25a690>]}
[0m22:06:09.429212 [info ] [Thread-4 (]: 7 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.14s]
[0m22:06:09.431013 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:06:09.434392 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.015 seconds
[0m22:06:09.436782 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:06:09.438387 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bf41951-6ebe-4814-801d-8450be01bbc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3c25a3d0>]}
[0m22:06:09.440690 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.15s]
[0m22:06:09.442719 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:06:09.445804 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:09.449508 [debug] [MainThread]: On master: BEGIN
[0m22:06:09.451317 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:06:09.460592 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m22:06:09.461699 [debug] [MainThread]: On master: COMMIT
[0m22:06:09.462515 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:09.463476 [debug] [MainThread]: On master: COMMIT
[0m22:06:09.464560 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:09.465344 [debug] [MainThread]: On master: Close
[0m22:06:09.466261 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:06:09.467115 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:06:09.468053 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:06:09.468942 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:06:09.469672 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_monthly' was properly closed.
[0m22:06:09.471527 [info ] [MainThread]: 
[0m22:06:09.473111 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.96 seconds (0.96s).
[0m22:06:09.475063 [debug] [MainThread]: Command end result
[0m22:06:09.564416 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:09.581309 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:09.601685 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:06:09.603249 [info ] [MainThread]: 
[0m22:06:09.607720 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:06:09.609315 [info ] [MainThread]: 
[0m22:06:09.610856 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:06:09.621664 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.492937, "process_in_blocks": "0", "process_kernel_time": 1.312886, "process_mem_max_rss": "130564", "process_out_blocks": "0", "process_user_time": 2.368262}
[0m22:06:09.624181 [debug] [MainThread]: Command `dbt run` succeeded at 22:06:09.624011 after 4.50 seconds
[0m22:06:09.626259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3f6be950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef3f6dcf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ef43fc7890>]}
[0m22:06:09.628307 [debug] [MainThread]: Flushing usage events
[0m22:06:10.338289 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:06:13.436845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaa15480d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9e849e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9e849f90>]}


============================== 22:06:13.445933 | 4f35fc47-bc48-4980-939e-1dbef933c2f7 ==============================
[0m22:06:13.445933 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:06:13.447693 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/usr/app/dbt/dbt', 'target_path': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'static_parser': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'warn_error': 'None', 'log_format': 'default', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'no_print': 'None', 'printer_width': '80', 'version_check': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'invocation_command': 'dbt run', 'debug': 'False'}
[0m22:06:13.607597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9d93a890>]}
[0m22:06:13.652072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaa155d090>]}
[0m22:06:13.659226 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:06:13.808330 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:06:15.953937 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:06:15.955349 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:06:15.989099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9d93a750>]}
[0m22:06:16.129099 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:16.162901 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:16.287082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9d511950>]}
[0m22:06:16.289608 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:06:16.291520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9c10e5d0>]}
[0m22:06:16.296244 [info ] [MainThread]: 
[0m22:06:16.298132 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:06:16.300123 [info ] [MainThread]: 
[0m22:06:16.302022 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:06:16.308291 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:06:16.411779 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:06:16.413462 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:06:16.414738 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:06:16.428270 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.013 seconds
[0m22:06:16.430821 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:06:16.434160 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:06:16.444228 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:16.445776 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:06:16.447033 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:06:16.462160 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m22:06:16.464256 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:16.465717 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:06:16.473708 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m22:06:16.479330 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:06:16.481023 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:06:16.488465 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:16.490739 [debug] [MainThread]: On master: BEGIN
[0m22:06:16.492883 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:06:16.504107 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:06:16.505978 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:16.507304 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:06:16.515455 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m22:06:16.518455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9d1d5590>]}
[0m22:06:16.520152 [debug] [MainThread]: On master: ROLLBACK
[0m22:06:16.521893 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:16.523570 [debug] [MainThread]: On master: BEGIN
[0m22:06:16.525879 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:06:16.527238 [debug] [MainThread]: On master: COMMIT
[0m22:06:16.528749 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:16.530102 [debug] [MainThread]: On master: COMMIT
[0m22:06:16.531975 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:16.533479 [debug] [MainThread]: On master: Close
[0m22:06:16.558145 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:06:16.565083 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:06:16.567544 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:06:16.569821 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:06:16.600194 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:16.614515 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:06:16.648008 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:16.660795 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:16.662413 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:06:16.663583 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:16.674552 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m22:06:16.676484 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:16.678090 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:06:16.685534 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m22:06:16.691253 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:16.692608 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:06:16.694840 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:16.697743 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:16.698766 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:06:16.701203 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:16.717476 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:16.719213 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:16.720590 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:16.735231 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m22:06:16.745855 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:06:16.755447 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:16.757624 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:06:16.767467 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m22:06:16.772451 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:06:16.787272 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9ef6c310>]}
[0m22:06:16.789511 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.21s]
[0m22:06:16.791986 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:06:16.794935 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:06:16.795549 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:06:16.796047 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:06:16.797540 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:06:16.799836 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:06:16.801391 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:06:16.803129 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:06:16.804700 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:06:16.806464 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:06:16.807821 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:06:16.809037 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:06:16.810220 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:06:16.816843 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:06:16.823425 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:16.828081 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:16.845498 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:06:16.846292 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:06:16.852849 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:06:16.875589 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:16.880674 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:06:16.885783 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:16.897700 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:16.898321 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:16.899671 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:06:16.900261 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:16.901643 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:06:16.903095 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:06:16.904858 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:06:16.906178 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:06:16.910121 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:06:16.917980 [debug] [Thread-2 (]: SQL status: BEGIN in 0.015 seconds
[0m22:06:16.919851 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:16.921320 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:06:16.922497 [debug] [Thread-4 (]: SQL status: BEGIN in 0.016 seconds
[0m22:06:16.923528 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m22:06:16.924980 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:16.928045 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:16.929695 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:06:16.931801 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:06:16.935302 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.011 seconds
[0m22:06:16.947533 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:16.950579 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:06:16.952160 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.018 seconds
[0m22:06:16.953959 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:16.958566 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:16.958869 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.025 seconds
[0m22:06:16.962093 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:16.963333 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:06:16.967392 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:16.968196 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:06:16.970037 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:16.970830 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:06:16.972752 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:16.974961 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:16.977916 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:16.979901 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:16.980944 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:06:16.983926 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:16.985033 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:16.986859 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:06:16.987299 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:16.988284 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:16.989807 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:16.990718 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:16.993749 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:16.994782 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:16.995638 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:16.996511 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:16.997824 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:17.004221 [debug] [Thread-2 (]: SQL status: COMMIT in 0.012 seconds
[0m22:06:17.007696 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:06:17.013976 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:17.015715 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:06:17.016138 [debug] [Thread-4 (]: SQL status: COMMIT in 0.017 seconds
[0m22:06:17.016549 [debug] [Thread-3 (]: SQL status: COMMIT in 0.018 seconds
[0m22:06:17.021518 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:06:17.026084 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:06:17.027912 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:17.029491 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:17.030764 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:06:17.032291 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:06:17.036871 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.019 seconds
[0m22:06:17.039634 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:06:17.041227 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa98417cd0>]}
[0m22:06:17.043406 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.24s]
[0m22:06:17.045245 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:06:17.047181 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:06:17.048011 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.014 seconds
[0m22:06:17.048898 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:06:17.051094 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:06:17.052569 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_monthly)
[0m22:06:17.054223 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9843a3d0>]}
[0m22:06:17.055530 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:06:17.057479 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.25s]
[0m22:06:17.061845 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:17.062266 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.027 seconds
[0m22:06:17.063546 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:06:17.067549 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:06:17.069804 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:06:17.071205 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9841b9d0>]}
[0m22:06:17.072609 [info ] [Thread-2 (]: 6 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:06:17.074962 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.27s]
[0m22:06:17.076972 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m22:06:17.078150 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:06:17.078544 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:06:17.079931 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:06:17.085879 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:17.087762 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:06:17.090406 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:17.093956 [info ] [Thread-4 (]: 7 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:06:17.096830 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_daily)
[0m22:06:17.098403 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:06:17.102276 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:17.105719 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:17.106975 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:06:17.107381 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:06:17.112273 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:17.112619 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:06:17.113828 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:17.118834 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:17.126613 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:17.127376 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:17.128583 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:06:17.130386 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:06:17.131984 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:06:17.133949 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:06:17.141853 [debug] [Thread-1 (]: SQL status: BEGIN in 0.028 seconds
[0m22:06:17.143645 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:17.146005 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:06:17.146443 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m22:06:17.146799 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m22:06:17.149475 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:17.151245 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:17.151854 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.004 seconds
[0m22:06:17.153418 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:06:17.155730 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:06:17.159853 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:17.164355 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:06:17.167083 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:17.173720 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:17.174184 [debug] [Thread-4 (]: SQL status: SELECT 132 in 0.011 seconds
[0m22:06:17.174542 [debug] [Thread-2 (]: SQL status: SELECT 924 in 0.013 seconds
[0m22:06:17.175758 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:06:17.178755 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:17.182951 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:17.185083 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:17.185461 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:06:17.186617 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:06:17.189545 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:17.192436 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:17.193928 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:17.195139 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:17.200314 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:17.205130 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:17.206638 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:17.207921 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:06:17.208858 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:06:17.211132 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:17.212222 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:17.213317 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:17.215172 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:17.216636 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:17.217758 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:17.218844 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:17.220086 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:17.224092 [debug] [Thread-1 (]: SQL status: COMMIT in 0.014 seconds
[0m22:06:17.229039 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:06:17.230628 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:17.231923 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:06:17.235180 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m22:06:17.235655 [debug] [Thread-4 (]: SQL status: COMMIT in 0.014 seconds
[0m22:06:17.239328 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:06:17.239703 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:06:17.243191 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:06:17.244367 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:17.245950 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:06:17.246948 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:17.248066 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:06:17.249860 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa983b0a50>]}
[0m22:06:17.251110 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:06:17.253841 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.20s]
[0m22:06:17.256205 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:06:17.267084 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.015 seconds
[0m22:06:17.269627 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:06:17.272880 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa983c6b50>]}
[0m22:06:17.275439 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.20s]
[0m22:06:17.277703 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:06:17.278625 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.023 seconds
[0m22:06:17.282023 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:06:17.283685 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f35fc47-bc48-4980-939e-1dbef933c2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa983d4850>]}
[0m22:06:17.286033 [info ] [Thread-4 (]: 7 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.19s]
[0m22:06:17.287594 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:06:17.290492 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:17.292152 [debug] [MainThread]: On master: BEGIN
[0m22:06:17.293520 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:06:17.303780 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:06:17.305625 [debug] [MainThread]: On master: COMMIT
[0m22:06:17.307275 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:17.309030 [debug] [MainThread]: On master: COMMIT
[0m22:06:17.310810 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:17.312305 [debug] [MainThread]: On master: Close
[0m22:06:17.314395 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:06:17.316342 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:06:17.317791 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_daily' was properly closed.
[0m22:06:17.325806 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:06:17.327266 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:06:17.328749 [info ] [MainThread]: 
[0m22:06:17.330469 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.03 seconds (1.03s).
[0m22:06:17.333036 [debug] [MainThread]: Command end result
[0m22:06:17.415034 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:17.423476 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:17.438386 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:06:17.439872 [info ] [MainThread]: 
[0m22:06:17.441567 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:06:17.443158 [info ] [MainThread]: 
[0m22:06:17.444882 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:06:17.447786 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.095402, "process_in_blocks": "0", "process_kernel_time": 1.104726, "process_mem_max_rss": "131252", "process_out_blocks": "0", "process_user_time": 2.324444}
[0m22:06:17.449324 [debug] [MainThread]: Command `dbt run` succeeded at 22:06:17.449141 after 4.10 seconds
[0m22:06:17.450681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9e849f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa9e7de990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffaa30f7890>]}
[0m22:06:17.451952 [debug] [MainThread]: Flushing usage events
[0m22:06:18.120016 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:06:21.516589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cedeee7f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cedee97ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cedf2df5d0>]}


============================== 22:06:21.523157 | 58e30862-8e15-4836-b6a2-ff0701675e20 ==============================
[0m22:06:21.523157 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:06:21.525035 [debug] [MainThread]: running dbt with arguments {'log_path': '/usr/app/dbt/dbt/logs', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'use_colors': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'printer_width': '80', 'version_check': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'log_format': 'default', 'debug': 'False', 'partial_parse': 'True', 'warn_error': 'None', 'no_print': 'None', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'quiet': 'False'}
[0m22:06:21.697523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cede3b2b50>]}
[0m22:06:21.748456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cee1bf6bd0>]}
[0m22:06:21.751923 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:06:21.915524 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:06:23.923381 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:06:23.924673 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:06:23.967207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ceddf5bf50>]}
[0m22:06:24.064573 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:24.071627 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:24.216041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cede3f6750>]}
[0m22:06:24.218702 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:06:24.229404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cedcf142d0>]}
[0m22:06:24.234705 [info ] [MainThread]: 
[0m22:06:24.238724 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:06:24.240769 [info ] [MainThread]: 
[0m22:06:24.244189 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:06:24.252109 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:06:24.323319 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:06:24.325092 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:06:24.326426 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:06:24.342495 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m22:06:24.345680 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:06:24.349140 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:06:24.358560 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:24.361115 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:06:24.363471 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:06:24.378047 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m22:06:24.380338 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:24.382046 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:06:24.391767 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.008 seconds
[0m22:06:24.394330 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:06:24.395747 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:06:24.405876 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:24.407861 [debug] [MainThread]: On master: BEGIN
[0m22:06:24.409630 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:06:24.421897 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m22:06:24.423671 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:24.425232 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:06:24.433901 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m22:06:24.436469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cedeee5550>]}
[0m22:06:24.438258 [debug] [MainThread]: On master: ROLLBACK
[0m22:06:24.439783 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:24.440737 [debug] [MainThread]: On master: BEGIN
[0m22:06:24.441996 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:06:24.443041 [debug] [MainThread]: On master: COMMIT
[0m22:06:24.444065 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:24.444997 [debug] [MainThread]: On master: COMMIT
[0m22:06:24.446059 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:24.447134 [debug] [MainThread]: On master: Close
[0m22:06:24.454448 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:06:24.458430 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:06:24.459880 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:06:24.460998 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:06:24.479534 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:24.499460 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:06:24.528527 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:24.539704 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:24.541081 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:06:24.542653 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:24.551325 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m22:06:24.553378 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:24.554668 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:06:24.561753 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m22:06:24.567280 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:24.568220 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:06:24.571196 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:06:24.575251 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:24.576401 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:06:24.578455 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:24.590043 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:24.591281 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:24.592185 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:24.595454 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:06:24.600558 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:06:24.606438 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:24.607826 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:06:24.614699 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m22:06:24.618932 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:06:24.624746 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cedf5a7c10>]}
[0m22:06:24.626571 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.16s]
[0m22:06:24.629346 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:06:24.631070 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:06:24.631425 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:06:24.631922 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:06:24.633122 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:06:24.634657 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:06:24.637421 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:06:24.639170 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:06:24.640530 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:06:24.641675 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:06:24.642789 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:06:24.643856 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:06:24.644656 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:06:24.648662 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:06:24.651512 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:24.654644 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:24.662299 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:06:24.662719 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:06:24.668914 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:06:24.678601 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:24.681465 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:24.684459 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:06:24.691275 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:24.691764 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:24.692231 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:24.692951 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:06:24.693953 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:06:24.695537 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:06:24.696589 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:06:24.697282 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:06:24.698023 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:06:24.707142 [debug] [Thread-2 (]: SQL status: BEGIN in 0.010 seconds
[0m22:06:24.707930 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m22:06:24.708657 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:24.709987 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:24.711134 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:06:24.711942 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:06:24.722434 [debug] [Thread-3 (]: SQL status: BEGIN in 0.024 seconds
[0m22:06:24.723971 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:24.724917 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:06:24.726241 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.013 seconds
[0m22:06:24.731552 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:24.731880 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.018 seconds
[0m22:06:24.732485 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:06:24.736186 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:24.736452 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m22:06:24.737601 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:24.737857 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:06:24.740847 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:24.743843 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:24.745386 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:06:24.745648 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:24.746446 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:06:24.747722 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:24.749712 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:24.751721 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:24.754523 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:24.755328 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:06:24.756743 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:24.757544 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:06:24.758721 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:24.758962 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:24.759963 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:24.760201 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:24.761547 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:24.762818 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:24.764610 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:24.765354 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:24.766187 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:24.767026 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:24.779382 [debug] [Thread-2 (]: SQL status: COMMIT in 0.016 seconds
[0m22:06:24.782403 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:06:24.782764 [debug] [Thread-3 (]: SQL status: COMMIT in 0.014 seconds
[0m22:06:24.783079 [debug] [Thread-4 (]: SQL status: COMMIT in 0.015 seconds
[0m22:06:24.785710 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:24.787958 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:06:24.790894 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:06:24.791748 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:06:24.792713 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:24.794056 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:24.795684 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:06:24.796784 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:06:24.810759 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.016 seconds
[0m22:06:24.812361 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:06:24.813600 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cedbc1d390>]}
[0m22:06:24.815033 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.17s]
[0m22:06:24.816396 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:06:24.817918 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:06:24.819120 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:06:24.820300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_monthly)
[0m22:06:24.821116 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:06:24.821807 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.024 seconds
[0m22:06:24.824564 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:24.824834 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.026 seconds
[0m22:06:24.826296 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:06:24.830614 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:06:24.831915 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cedbdf9b10>]}
[0m22:06:24.833093 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ced8bf2550>]}
[0m22:06:24.835173 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.19s]
[0m22:06:24.836701 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.19s]
[0m22:06:24.837453 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:06:24.838116 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:06:24.839094 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:06:24.842556 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:24.843889 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:06:24.845092 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:06:24.847053 [info ] [Thread-2 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:06:24.848274 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:06:24.850874 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m22:06:24.852350 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m22:06:24.853432 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:06:24.854413 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:06:24.857710 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:24.858066 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:24.861090 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:24.862702 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:06:24.864514 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:24.867416 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:06:24.871074 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:24.871438 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:06:24.871730 [debug] [Thread-1 (]: SQL status: BEGIN in 0.007 seconds
[0m22:06:24.874965 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:24.875843 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:24.877354 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:06:24.892566 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.014 seconds
[0m22:06:24.896670 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:24.900935 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:06:24.901333 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:24.901763 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:24.903537 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:06:24.903943 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:24.904691 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:06:24.905517 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:06:24.908508 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:24.909753 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:06:24.911766 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:06:24.914643 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:24.916288 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:24.917530 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:24.918738 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:24.920635 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m22:06:24.921715 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:24.921986 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:06:24.922918 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:06:24.925902 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:06:24.927698 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:24.928308 [debug] [Thread-2 (]: SQL status: BEGIN in 0.023 seconds
[0m22:06:24.929494 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:06:24.930559 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:24.932090 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:06:24.945198 [debug] [Thread-3 (]: SQL status: SELECT 924 in 0.018 seconds
[0m22:06:24.945693 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.013 seconds
[0m22:06:24.950244 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:24.952552 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.021 seconds
[0m22:06:24.956336 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:24.958463 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:06:24.961368 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:06:24.963761 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:06:24.966617 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:24.968921 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cede3f7050>]}
[0m22:06:24.971588 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:24.975727 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:24.978198 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.15s]
[0m22:06:24.983460 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:24.985691 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:06:24.988053 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:06:24.990189 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:06:24.992963 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:24.996667 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:24.998968 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:25.001588 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:25.002909 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:25.004222 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:25.005719 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:25.008176 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:25.020470 [debug] [Thread-3 (]: SQL status: COMMIT in 0.011 seconds
[0m22:06:25.025054 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:06:25.027432 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:25.029391 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:06:25.031416 [debug] [Thread-2 (]: SQL status: COMMIT in 0.020 seconds
[0m22:06:25.037542 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:06:25.039888 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:25.041418 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:06:25.043553 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.013 seconds
[0m22:06:25.046809 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:06:25.048848 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:06:25.050844 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ced8abe2d0>]}
[0m22:06:25.053702 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:06:25.055736 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.20s]
[0m22:06:25.057473 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58e30862-8e15-4836-b6a2-ff0701675e20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ced8adaf50>]}
[0m22:06:25.058881 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:06:25.060710 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.21s]
[0m22:06:25.064626 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:06:25.067634 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:25.068724 [debug] [MainThread]: On master: BEGIN
[0m22:06:25.069945 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:06:25.094046 [debug] [MainThread]: SQL status: BEGIN in 0.024 seconds
[0m22:06:25.096711 [debug] [MainThread]: On master: COMMIT
[0m22:06:25.099396 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:25.101155 [debug] [MainThread]: On master: COMMIT
[0m22:06:25.103860 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:25.105164 [debug] [MainThread]: On master: Close
[0m22:06:25.106673 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:06:25.108024 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:06:25.109954 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:06:25.111207 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m22:06:25.112562 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:06:25.115347 [info ] [MainThread]: 
[0m22:06:25.118659 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m22:06:25.122381 [debug] [MainThread]: Command end result
[0m22:06:25.194253 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:25.202309 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:25.219272 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:06:25.221523 [info ] [MainThread]: 
[0m22:06:25.222912 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:06:25.224066 [info ] [MainThread]: 
[0m22:06:25.225729 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:06:25.228190 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.7823231, "process_in_blocks": "0", "process_kernel_time": 1.114697, "process_mem_max_rss": "130992", "process_out_blocks": "0", "process_user_time": 2.289649}
[0m22:06:25.230383 [debug] [MainThread]: Command `dbt run` succeeded at 22:06:25.230270 after 3.78 seconds
[0m22:06:25.231281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cee39f78d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cee37b2ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cee37b2c90>]}
[0m22:06:25.232322 [debug] [MainThread]: Flushing usage events
[0m22:06:26.068535 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:06:30.011468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee9819510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cceec5576d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cceec56ef10>]}


============================== 22:06:30.019104 | 8d63fc1b-bc12-4f08-8cd7-c500ec65822c ==============================
[0m22:06:30.019104 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:06:30.020858 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'log_format': 'default', 'fail_fast': 'False', 'introspect': 'True', 'debug': 'False', 'printer_width': '80', 'static_parser': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'write_json': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'target_path': 'None', 'profiles_dir': '/usr/app/dbt/dbt'}
[0m22:06:30.194211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee894dd50>]}
[0m22:06:30.237377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cceec586690>]}
[0m22:06:30.240043 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:06:30.393822 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:06:32.794708 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:06:32.796116 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:06:32.829848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee81c2e10>]}
[0m22:06:33.090638 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:33.109260 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:33.235543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee8925610>]}
[0m22:06:33.238295 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:06:33.241022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee85ad210>]}
[0m22:06:33.246925 [info ] [MainThread]: 
[0m22:06:33.253134 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:06:33.255475 [info ] [MainThread]: 
[0m22:06:33.258686 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:06:33.266121 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:06:33.378792 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:06:33.380526 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:06:33.381764 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:06:33.396651 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.015 seconds
[0m22:06:33.402362 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:06:33.405601 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:06:33.410453 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:33.412128 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:06:33.413213 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:06:33.427702 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m22:06:33.429839 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:33.439374 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:06:33.450320 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m22:06:33.457694 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:06:33.460345 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:06:33.468070 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:33.469369 [debug] [MainThread]: On master: BEGIN
[0m22:06:33.470522 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:06:33.487904 [debug] [MainThread]: SQL status: BEGIN in 0.017 seconds
[0m22:06:33.493026 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:33.498930 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:06:33.507628 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m22:06:33.511247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee9f8bed0>]}
[0m22:06:33.512895 [debug] [MainThread]: On master: ROLLBACK
[0m22:06:33.516016 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:33.517885 [debug] [MainThread]: On master: BEGIN
[0m22:06:33.520474 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:06:33.522362 [debug] [MainThread]: On master: COMMIT
[0m22:06:33.524175 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:33.525606 [debug] [MainThread]: On master: COMMIT
[0m22:06:33.527069 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:33.528297 [debug] [MainThread]: On master: Close
[0m22:06:33.536755 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:06:33.538692 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:06:33.540531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:06:33.541961 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:06:33.559270 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:33.573588 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:06:33.602284 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:33.620037 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:33.621699 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:06:33.623069 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:33.633347 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m22:06:33.635461 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:33.637355 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:06:33.644557 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m22:06:33.653453 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:33.661549 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:06:33.677049 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:33.688134 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:33.697399 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:06:33.705753 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:06:33.731579 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:33.732871 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:33.733703 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:33.736407 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:06:33.741718 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:06:33.746115 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:33.747327 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:06:33.765759 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.017 seconds
[0m22:06:33.768520 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:06:33.770632 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee6536d90>]}
[0m22:06:33.772138 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.23s]
[0m22:06:33.774651 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:06:33.777029 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:06:33.777539 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:06:33.777998 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:06:33.779260 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:06:33.781419 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:06:33.783209 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:06:33.784833 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:06:33.786137 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:06:33.787548 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:06:33.788776 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:06:33.790090 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:06:33.790876 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:06:33.794763 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:06:33.798063 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:33.826325 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:33.843091 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:06:33.844553 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:06:33.850402 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:06:33.865088 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:06:33.870173 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:33.875971 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:33.885961 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:33.886643 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:33.887723 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:06:33.888988 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:06:33.889729 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:33.890335 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:06:33.891220 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:06:33.892142 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:06:33.899493 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:06:33.902522 [debug] [Thread-2 (]: SQL status: BEGIN in 0.011 seconds
[0m22:06:33.903768 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m22:06:33.905031 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:33.906058 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:33.906906 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:06:33.907785 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:06:33.908837 [debug] [Thread-3 (]: SQL status: BEGIN in 0.009 seconds
[0m22:06:33.910193 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:33.911079 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:06:33.918269 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.010 seconds
[0m22:06:33.925414 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:33.925784 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.016 seconds
[0m22:06:33.926086 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.014 seconds
[0m22:06:33.926791 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:06:33.930924 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:33.934248 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:33.936792 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:06:33.937150 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:33.937736 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:06:33.939230 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:33.941533 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:33.944750 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:33.945051 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m22:06:33.945702 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:06:33.946890 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:06:33.950736 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:33.952925 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:33.953735 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:33.954416 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:06:33.956464 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:33.957939 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:33.959422 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:33.959658 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:33.960855 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:33.961804 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:33.963164 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:33.963985 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:33.965464 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:33.967421 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:33.981582 [debug] [Thread-2 (]: SQL status: COMMIT in 0.017 seconds
[0m22:06:33.984433 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:06:33.987562 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:33.988367 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:06:33.992100 [debug] [Thread-3 (]: SQL status: COMMIT in 0.024 seconds
[0m22:06:33.992481 [debug] [Thread-4 (]: SQL status: COMMIT in 0.026 seconds
[0m22:06:33.996275 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:06:33.996726 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.008 seconds
[0m22:06:34.001789 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:06:34.003389 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:34.005405 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:06:34.006508 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:34.007488 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:06:34.008597 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee430ae50>]}
[0m22:06:34.009490 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:06:34.011541 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.22s]
[0m22:06:34.014837 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:06:34.016254 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:06:34.018089 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:06:34.019409 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:06:34.021171 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:06:34.023684 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:06:34.024964 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:06:34.026225 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee44d1790>]}
[0m22:06:34.028211 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee6526bd0>]}
[0m22:06:34.029222 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_monthly)
[0m22:06:34.031196 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.24s]
[0m22:06:34.034036 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.24s]
[0m22:06:34.035472 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:06:34.036686 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:06:34.037728 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:06:34.040786 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:34.043139 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:06:34.044463 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:06:34.051029 [info ] [Thread-2 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:06:34.055494 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:06:34.058510 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m22:06:34.060140 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m22:06:34.061548 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:06:34.064489 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:06:34.070790 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:34.075341 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:34.075725 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:06:34.086147 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:34.094821 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:06:34.100236 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:34.100647 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:06:34.103234 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:34.106743 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:34.108292 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:06:34.110039 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:34.111252 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:34.115748 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:06:34.117820 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:06:34.124392 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:34.125479 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m22:06:34.125931 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:06:34.126722 [debug] [Thread-2 (]: SQL status: BEGIN in 0.009 seconds
[0m22:06:34.127363 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:34.130806 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:06:34.131764 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:34.132710 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:06:34.134572 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:06:34.140091 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.004 seconds
[0m22:06:34.141003 [debug] [Thread-3 (]: SQL status: BEGIN in 0.010 seconds
[0m22:06:34.144756 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:34.145777 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:34.146899 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:06:34.148021 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:06:34.149768 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:34.155606 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:34.156075 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.019 seconds
[0m22:06:34.156322 [debug] [Thread-3 (]: SQL status: SELECT 924 in 0.006 seconds
[0m22:06:34.156983 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:06:34.160695 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:34.164243 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:34.166638 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:34.167063 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:06:34.168359 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:06:34.171072 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:34.173421 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:34.174379 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:34.175300 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:34.178268 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:34.181819 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:34.182790 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:34.183999 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:06:34.184966 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:06:34.187127 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:34.187716 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:06:34.188003 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:34.189016 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:34.191547 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:06:34.194714 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:34.198140 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:34.199963 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:34.201221 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:34.202399 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:34.203717 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:06:34.204918 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:34.217400 [debug] [Thread-2 (]: SQL status: COMMIT in 0.011 seconds
[0m22:06:34.220870 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:06:34.222061 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:34.222923 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:06:34.230002 [debug] [Thread-3 (]: SQL status: COMMIT in 0.021 seconds
[0m22:06:34.230645 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.024 seconds
[0m22:06:34.234759 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:06:34.235287 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.010 seconds
[0m22:06:34.237314 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:06:34.238457 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:34.240652 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:06:34.241925 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee43ef010>]}
[0m22:06:34.242735 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:06:34.244191 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee43aed50>]}
[0m22:06:34.245418 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.21s]
[0m22:06:34.248062 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.19s]
[0m22:06:34.249283 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:06:34.250287 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:06:34.261675 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.014 seconds
[0m22:06:34.263706 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:06:34.264852 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d63fc1b-bc12-4f08-8cd7-c500ec65822c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee43e0210>]}
[0m22:06:34.265880 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.20s]
[0m22:06:34.267496 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:06:34.270084 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:34.271048 [debug] [MainThread]: On master: BEGIN
[0m22:06:34.271863 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:06:34.278785 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m22:06:34.280041 [debug] [MainThread]: On master: COMMIT
[0m22:06:34.280810 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:34.281730 [debug] [MainThread]: On master: COMMIT
[0m22:06:34.282653 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:34.283466 [debug] [MainThread]: On master: Close
[0m22:06:34.284311 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:06:34.285132 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:06:34.286595 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:06:34.287633 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m22:06:34.288595 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:06:34.289957 [info ] [MainThread]: 
[0m22:06:34.291336 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.03 seconds (1.03s).
[0m22:06:34.294193 [debug] [MainThread]: Command end result
[0m22:06:34.344985 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:34.354287 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:34.365123 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:06:34.366334 [info ] [MainThread]: 
[0m22:06:34.368036 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:06:34.369636 [info ] [MainThread]: 
[0m22:06:34.370953 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:06:34.373116 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.4399467, "process_in_blocks": "0", "process_kernel_time": 1.068169, "process_mem_max_rss": "131524", "process_out_blocks": "0", "process_user_time": 2.210861}
[0m22:06:34.374257 [debug] [MainThread]: Command `dbt run` succeeded at 22:06:34.374159 after 4.44 seconds
[0m22:06:34.375140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee9c902d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ccee9838e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cceee1138d0>]}
[0m22:06:34.376102 [debug] [MainThread]: Flushing usage events
[0m22:06:35.131963 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:06:40.836823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33cced990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33ce12f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33ccf6450>]}


============================== 22:06:40.851558 | d928ed94-6119-4756-b1b3-60d588f347a9 ==============================
[0m22:06:40.851558 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:06:40.855288 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'write_json': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'log_format': 'default', 'use_colors': 'True', 'empty': 'False', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'warn_error': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'introspect': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'static_parser': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'partial_parse': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'fail_fast': 'False'}
[0m22:06:41.034080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33c1a2010>]}
[0m22:06:41.098535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33fa08e10>]}
[0m22:06:41.104427 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:06:41.252768 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:06:44.007571 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:06:44.009224 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:06:44.055861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33b999fd0>]}
[0m22:06:44.173788 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:44.186610 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:44.321358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33c1004d0>]}
[0m22:06:44.323502 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:06:44.325322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33ad3f150>]}
[0m22:06:44.329978 [info ] [MainThread]: 
[0m22:06:44.332362 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:06:44.333949 [info ] [MainThread]: 
[0m22:06:44.336272 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:06:44.343675 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:06:44.425059 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:06:44.427423 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:06:44.429426 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:06:44.454384 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.025 seconds
[0m22:06:44.458488 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:06:44.463645 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:06:44.473382 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:44.475241 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:06:44.476791 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:06:44.490211 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m22:06:44.492215 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:44.493865 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:06:44.505209 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.009 seconds
[0m22:06:44.511187 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:06:44.513226 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:06:44.521420 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:44.522883 [debug] [MainThread]: On master: BEGIN
[0m22:06:44.524322 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:06:44.536741 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m22:06:44.538155 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:44.539691 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:06:44.549742 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m22:06:44.552900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33c1e9d50>]}
[0m22:06:44.554988 [debug] [MainThread]: On master: ROLLBACK
[0m22:06:44.560988 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:44.562610 [debug] [MainThread]: On master: BEGIN
[0m22:06:44.564571 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:06:44.566005 [debug] [MainThread]: On master: COMMIT
[0m22:06:44.567616 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:44.569410 [debug] [MainThread]: On master: COMMIT
[0m22:06:44.570911 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:44.572761 [debug] [MainThread]: On master: Close
[0m22:06:44.594866 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:06:44.597559 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:06:44.599823 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:06:44.601560 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:06:44.630671 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:44.653615 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:06:44.683694 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:44.698240 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:44.699319 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:06:44.700358 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:44.712228 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m22:06:44.714001 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:44.715353 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:06:44.741427 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.025 seconds
[0m22:06:44.752414 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:44.754390 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:06:44.758018 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:06:44.762640 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:44.764217 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:06:44.766897 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:44.779235 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:44.781157 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:44.782542 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:44.798682 [debug] [Thread-1 (]: SQL status: COMMIT in 0.015 seconds
[0m22:06:44.811056 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:06:44.819998 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:44.821426 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:06:44.838597 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.015 seconds
[0m22:06:44.844950 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:06:44.857457 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d339a08e90>]}
[0m22:06:44.859900 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.25s]
[0m22:06:44.862560 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:06:44.866063 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:06:44.866940 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:06:44.867720 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:06:44.869595 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:06:44.871521 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:06:44.873304 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:06:44.875068 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:06:44.878299 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:06:44.880187 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:06:44.881659 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:06:44.883142 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:06:44.884599 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:06:44.891062 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:06:44.896650 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:44.901428 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:44.912896 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:06:44.913462 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:06:44.920090 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:06:44.930979 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:06:44.934282 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:44.938152 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:44.948647 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:44.949334 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:44.950368 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:06:44.951501 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:44.951758 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:06:44.952995 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:06:44.954159 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:06:44.955270 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:06:44.957640 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:06:44.969441 [debug] [Thread-2 (]: SQL status: BEGIN in 0.016 seconds
[0m22:06:44.970082 [debug] [Thread-4 (]: SQL status: BEGIN in 0.012 seconds
[0m22:06:44.971275 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:44.972660 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:44.973954 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:06:44.975547 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:06:44.976057 [debug] [Thread-3 (]: SQL status: BEGIN in 0.021 seconds
[0m22:06:44.979327 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:44.980726 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:06:44.988639 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.011 seconds
[0m22:06:44.995674 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:44.996058 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.018 seconds
[0m22:06:44.997210 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:06:44.998250 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.016 seconds
[0m22:06:45.001617 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:45.005249 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:45.005525 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m22:06:45.006622 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:06:45.007726 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:06:45.010597 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:45.012673 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:45.013026 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:45.013921 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:06:45.016828 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:45.019631 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:45.021534 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:45.021919 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:06:45.023515 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:06:45.026839 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:45.029152 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:45.030887 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:45.031346 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:45.033454 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:45.035438 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:45.036703 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:45.038042 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:45.039400 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:45.041719 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:45.042842 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:45.053627 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m22:06:45.058284 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:06:45.063286 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:45.064650 [debug] [Thread-4 (]: SQL status: COMMIT in 0.021 seconds
[0m22:06:45.065093 [debug] [Thread-3 (]: SQL status: COMMIT in 0.020 seconds
[0m22:06:45.065562 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:06:45.068947 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:06:45.072711 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:06:45.075221 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:45.077329 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:45.078940 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:06:45.080128 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:06:45.095343 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.021 seconds
[0m22:06:45.096905 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.014 seconds
[0m22:06:45.097770 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.016 seconds
[0m22:06:45.099505 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:06:45.101809 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:06:45.103999 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:06:45.105827 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33ddebf50>]}
[0m22:06:45.107341 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d3381cdc90>]}
[0m22:06:45.109116 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d3381e4110>]}
[0m22:06:45.111333 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.23s]
[0m22:06:45.113497 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.23s]
[0m22:06:45.116034 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.23s]
[0m22:06:45.117856 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:06:45.119611 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:06:45.121240 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:06:45.123332 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:06:45.124755 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:06:45.126411 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:06:45.127877 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:06:45.129245 [info ] [Thread-2 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:06:45.130647 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:06:45.132254 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_monthly)
[0m22:06:45.133620 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m22:06:45.135157 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m22:06:45.136412 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:06:45.137793 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:06:45.139515 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:06:45.145526 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:45.149101 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:45.152786 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:45.163490 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:06:45.164106 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:06:45.168900 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:45.169265 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:06:45.172612 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:45.176885 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:45.183948 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:45.184843 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:45.185648 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:45.186591 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:06:45.188173 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:06:45.190570 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:06:45.191971 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:45.195280 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:06:45.197169 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:06:45.210015 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m22:06:45.210488 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m22:06:45.211236 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m22:06:45.211979 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:45.213487 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:45.215951 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:45.217335 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:06:45.219199 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:06:45.220668 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:06:45.225616 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.004 seconds
[0m22:06:45.231488 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:45.231841 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.008 seconds
[0m22:06:45.232272 [debug] [Thread-3 (]: SQL status: SELECT 924 in 0.010 seconds
[0m22:06:45.233409 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:06:45.237164 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:45.240436 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:45.242856 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:45.243988 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:06:45.246189 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:06:45.249447 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:45.252147 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:45.252643 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:45.254145 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:06:45.259247 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:45.263574 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:45.266002 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:45.266330 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:06:45.267403 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:06:45.269455 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:45.271195 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:45.271903 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:45.272563 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:45.274413 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:45.276173 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:45.277365 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:45.278401 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:45.279384 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:45.281901 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:45.282654 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:06:45.283829 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:45.287799 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:06:45.288221 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m22:06:45.290170 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:45.292764 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:06:45.293679 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:06:45.294932 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:45.296393 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:06:45.298639 [debug] [Thread-3 (]: SQL status: COMMIT in 0.010 seconds
[0m22:06:45.302593 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:06:45.302945 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:06:45.303226 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:06:45.304481 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:45.307804 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:06:45.309803 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:06:45.311347 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:06:45.312869 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d339bd8050>]}
[0m22:06:45.314164 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d32a7cb190>]}
[0m22:06:45.316305 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.18s]
[0m22:06:45.317885 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.18s]
[0m22:06:45.319278 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:06:45.319615 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.004 seconds
[0m22:06:45.320791 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:06:45.323147 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:06:45.325038 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd928ed94-6119-4756-b1b3-60d588f347a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33bd51b50>]}
[0m22:06:45.326650 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.19s]
[0m22:06:45.327998 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:06:45.330973 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:45.332119 [debug] [MainThread]: On master: BEGIN
[0m22:06:45.333344 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:06:45.343090 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:06:45.345128 [debug] [MainThread]: On master: COMMIT
[0m22:06:45.346975 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:45.348631 [debug] [MainThread]: On master: COMMIT
[0m22:06:45.350054 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:45.352110 [debug] [MainThread]: On master: Close
[0m22:06:45.353488 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:06:45.355558 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:06:45.356837 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:06:45.357803 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m22:06:45.359009 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:06:45.360390 [info ] [MainThread]: 
[0m22:06:45.362313 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.02 seconds (1.02s).
[0m22:06:45.364587 [debug] [MainThread]: Command end result
[0m22:06:45.464999 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:45.472286 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:45.482416 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:06:45.483205 [info ] [MainThread]: 
[0m22:06:45.484442 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:06:45.485743 [info ] [MainThread]: 
[0m22:06:45.486960 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:06:45.489246 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.818654, "process_in_blocks": "0", "process_kernel_time": 1.147368, "process_mem_max_rss": "131520", "process_out_blocks": "0", "process_user_time": 2.462959}
[0m22:06:45.490404 [debug] [MainThread]: Command `dbt run` succeeded at 22:06:45.490253 after 4.82 seconds
[0m22:06:45.491249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33cc95c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d33cc96150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77d3414f2e50>]}
[0m22:06:45.492148 [debug] [MainThread]: Flushing usage events
[0m22:06:46.086380 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:06:54.977807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d113070ff90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11306d9150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d113071ab10>]}


============================== 22:06:54.989203 | 7e060837-3f38-410f-82a0-8e1e891ce749 ==============================
[0m22:06:54.989203 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:06:54.992015 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'cache_selected_only': 'False', 'version_check': 'True', 'use_colors': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'debug': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'log_format': 'default', 'static_parser': 'True', 'empty': 'False', 'warn_error': 'None', 'target_path': 'None', 'log_cache_events': 'False', 'no_print': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'indirect_selection': 'eager', 'fail_fast': 'False'}
[0m22:06:55.194183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1130e28bd0>]}
[0m22:06:55.248314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d113341abd0>]}
[0m22:06:55.250565 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:06:55.437393 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:06:58.424570 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:06:58.426136 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:06:58.470260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d112f574d10>]}
[0m22:06:58.580464 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:58.593460 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:58.729278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11305bea10>]}
[0m22:06:58.731253 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:06:58.733074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d112ed7f6d0>]}
[0m22:06:58.736185 [info ] [MainThread]: 
[0m22:06:58.737266 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:06:58.738694 [info ] [MainThread]: 
[0m22:06:58.740658 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:06:58.745287 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:06:58.829148 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:06:58.830494 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:06:58.831747 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:06:58.847699 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m22:06:58.849942 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:06:58.853474 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:06:58.858982 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:58.859989 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:06:58.860948 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:06:58.869369 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m22:06:58.870778 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:06:58.871890 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:06:58.877260 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m22:06:58.879981 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:06:58.881059 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:06:58.887929 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:58.889121 [debug] [MainThread]: On master: BEGIN
[0m22:06:58.890812 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:06:58.898429 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m22:06:58.899828 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:58.901269 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:06:58.907444 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m22:06:58.909234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d112f9ede10>]}
[0m22:06:58.910017 [debug] [MainThread]: On master: ROLLBACK
[0m22:06:58.911336 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:58.912603 [debug] [MainThread]: On master: BEGIN
[0m22:06:58.914993 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:06:58.916836 [debug] [MainThread]: On master: COMMIT
[0m22:06:58.918003 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:58.919075 [debug] [MainThread]: On master: COMMIT
[0m22:06:58.920620 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:58.921356 [debug] [MainThread]: On master: Close
[0m22:06:58.926493 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:06:58.927851 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:06:58.928872 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:06:58.929914 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:06:58.947016 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:58.958636 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:06:58.987512 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:06:59.003375 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:59.004601 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:06:59.005552 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:59.013811 [debug] [Thread-1 (]: SQL status: BEGIN in 0.008 seconds
[0m22:06:59.016028 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:59.018364 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:06:59.027029 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m22:06:59.033687 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:59.035897 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:06:59.038638 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.042404 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:59.044072 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:06:59.046067 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.058504 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:59.060138 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:59.061390 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:06:59.064534 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:06:59.069921 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:06:59.075967 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:06:59.077397 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:06:59.082008 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m22:06:59.084756 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:06:59.087642 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d112d45aa90>]}
[0m22:06:59.088852 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.16s]
[0m22:06:59.090343 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:06:59.093045 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:06:59.093721 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:06:59.094237 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:06:59.095575 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:06:59.097423 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:06:59.098688 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:06:59.099879 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:06:59.101152 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:06:59.102363 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:06:59.103386 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:06:59.104513 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:06:59.105710 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:06:59.110835 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:06:59.113860 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:59.116990 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:59.126793 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:06:59.128438 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:06:59.139798 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:06:59.145522 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:06:59.147966 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:06:59.152808 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:06:59.161188 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:59.162488 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:59.163010 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:06:59.168313 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:59.169076 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:06:59.171312 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:06:59.172777 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:06:59.174153 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:06:59.176235 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:06:59.185192 [debug] [Thread-4 (]: SQL status: BEGIN in 0.014 seconds
[0m22:06:59.186316 [debug] [Thread-3 (]: SQL status: BEGIN in 0.012 seconds
[0m22:06:59.187458 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:59.188213 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m22:06:59.188831 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:59.189851 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:06:59.190824 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:59.191697 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:06:59.193543 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:06:59.206289 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m22:06:59.212942 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:59.213345 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.021 seconds
[0m22:06:59.213698 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.018 seconds
[0m22:06:59.214504 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:06:59.220155 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:59.223997 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:59.225507 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.228130 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:06:59.229316 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:06:59.233134 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:59.235055 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.235447 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.235931 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:06:59.238402 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:59.242134 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:59.243681 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:59.244522 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:06:59.245583 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:06:59.247064 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:59.248809 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:06:59.250227 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:59.250583 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.252366 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:59.253255 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:06:59.254701 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:59.255707 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:59.257890 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:59.258688 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m22:06:59.258932 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:06:59.259825 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:06:59.262227 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:06:59.265279 [debug] [Thread-4 (]: SQL status: COMMIT in 0.002 seconds
[0m22:06:59.268276 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:06:59.270565 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:06:59.271384 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:06:59.272345 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:06:59.273685 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:06:59.277419 [debug] [Thread-2 (]: SQL status: COMMIT in 0.012 seconds
[0m22:06:59.283571 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:06:59.283874 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.009 seconds
[0m22:06:59.284162 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.011 seconds
[0m22:06:59.285183 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:06:59.286692 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:06:59.288367 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:06:59.289405 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:06:59.290733 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d112c21ab90>]}
[0m22:06:59.291968 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d112d41fe10>]}
[0m22:06:59.294058 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.19s]
[0m22:06:59.295630 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.19s]
[0m22:06:59.298662 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:06:59.312598 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:06:59.314826 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:06:59.318542 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:06:59.321390 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:06:59.322974 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:06:59.324040 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d112d5c9ad0>]}
[0m22:06:59.325267 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:06:59.327170 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:06:59.328674 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.22s]
[0m22:06:59.330036 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m22:06:59.337309 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_daily)
[0m22:06:59.339842 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:06:59.341125 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:06:59.342777 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:06:59.345090 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:06:59.351533 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:59.354743 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:59.356569 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:06:59.360742 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m22:06:59.362078 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:06:59.369113 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:59.370510 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:06:59.371937 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:06:59.376106 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:06:59.381789 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:06:59.386584 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:06:59.389459 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:06:59.392175 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:59.393161 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:59.393663 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:06:59.395826 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:06:59.397021 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:06:59.397489 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:59.399148 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:06:59.402056 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:06:59.404464 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:06:59.409593 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m22:06:59.411116 [debug] [Thread-4 (]: SQL status: BEGIN in 0.012 seconds
[0m22:06:59.413110 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:59.414101 [debug] [Thread-3 (]: SQL status: BEGIN in 0.010 seconds
[0m22:06:59.416092 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:59.417336 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:06:59.418460 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:59.419687 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:06:59.421580 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:06:59.425933 [debug] [Thread-1 (]: SQL status: SELECT 924 in 0.005 seconds
[0m22:06:59.427286 [debug] [Thread-4 (]: SQL status: SELECT 132 in 0.005 seconds
[0m22:06:59.428048 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.004 seconds
[0m22:06:59.437353 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:59.442631 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:59.446901 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:59.449743 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:06:59.453053 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:06:59.456891 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:06:59.460019 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.460514 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.462033 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.466980 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:59.472614 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:59.477363 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:59.478569 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:06:59.479776 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:06:59.480806 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:06:59.483995 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.485972 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.486618 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:06:59.488249 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:59.490457 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:59.492207 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:59.493160 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:59.494070 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:59.495035 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:59.496054 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:06:59.496852 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:06:59.498234 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:06:59.502518 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:06:59.503919 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m22:06:59.506086 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:06:59.506375 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m22:06:59.508854 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:06:59.510404 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:06:59.513981 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:06:59.515348 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:06:59.517171 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:06:59.518735 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:06:59.519689 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:06:59.523326 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:06:59.524688 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m22:06:59.530376 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:06:59.530867 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.004 seconds
[0m22:06:59.531314 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:06:59.532664 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d112c125010>]}
[0m22:06:59.535585 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:06:59.537522 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:06:59.539580 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.20s]
[0m22:06:59.541797 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d112c11f890>]}
[0m22:06:59.543591 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e060837-3f38-410f-82a0-8e1e891ce749', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d112c11e990>]}
[0m22:06:59.544967 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:06:59.547625 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.18s]
[0m22:06:59.554383 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.21s]
[0m22:06:59.558594 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:06:59.560386 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:06:59.566696 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:59.568157 [debug] [MainThread]: On master: BEGIN
[0m22:06:59.569578 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:06:59.579063 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m22:06:59.581505 [debug] [MainThread]: On master: COMMIT
[0m22:06:59.583431 [debug] [MainThread]: Using postgres connection "master"
[0m22:06:59.584857 [debug] [MainThread]: On master: COMMIT
[0m22:06:59.586834 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:06:59.588593 [debug] [MainThread]: On master: Close
[0m22:06:59.590341 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:06:59.592636 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:06:59.594169 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:06:59.595335 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:06:59.596164 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_monthly' was properly closed.
[0m22:06:59.597120 [info ] [MainThread]: 
[0m22:06:59.599335 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.86 seconds (0.86s).
[0m22:06:59.602365 [debug] [MainThread]: Command end result
[0m22:06:59.669109 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:06:59.675780 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:06:59.686755 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:06:59.688402 [info ] [MainThread]: 
[0m22:06:59.689814 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:06:59.691051 [info ] [MainThread]: 
[0m22:06:59.692573 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:06:59.694580 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.8114448, "process_in_blocks": "0", "process_kernel_time": 1.058229, "process_mem_max_rss": "131572", "process_out_blocks": "0", "process_user_time": 2.214207}
[0m22:06:59.695971 [debug] [MainThread]: Command `dbt run` succeeded at 22:06:59.695872 after 4.81 seconds
[0m22:06:59.696976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1134faf8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1134f02d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1134f02dd0>]}
[0m22:06:59.698233 [debug] [MainThread]: Flushing usage events
[0m22:07:00.730867 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:07:18.828471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7006962b4c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700695faa790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700695f6d190>]}


============================== 22:07:18.846771 | 69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96 ==============================
[0m22:07:18.846771 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:07:18.848515 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/usr/app/dbt/dbt', 'debug': 'False', 'empty': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'warn_error': 'None', 'no_print': 'None', 'printer_width': '80', 'version_check': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'target_path': 'None', 'quiet': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True'}
[0m22:07:19.060133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700695f3e250>]}
[0m22:07:19.134469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700698cb4b10>]}
[0m22:07:19.137067 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:07:19.531326 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:07:21.814752 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:07:21.817239 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:07:21.865661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7006953adc10>]}
[0m22:07:22.044461 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:07:22.052364 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:07:22.207185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7006953e9410>]}
[0m22:07:22.209376 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:07:22.211559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700694f9b650>]}
[0m22:07:22.215899 [info ] [MainThread]: 
[0m22:07:22.217907 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:07:22.219206 [info ] [MainThread]: 
[0m22:07:22.221140 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:07:22.227628 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:07:22.512731 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:07:22.514610 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:07:22.516492 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:07:22.582772 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.066 seconds
[0m22:07:22.592520 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:07:22.602133 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:07:22.613775 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:07:22.615078 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:07:22.615987 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:07:22.626788 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m22:07:22.644904 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:07:22.647628 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:07:22.679661 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.030 seconds
[0m22:07:22.684276 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:07:22.686519 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:07:22.694210 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:22.695555 [debug] [MainThread]: On master: BEGIN
[0m22:07:22.698175 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:07:22.710099 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m22:07:22.711434 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:22.713170 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:07:22.728918 [debug] [MainThread]: SQL status: SELECT 1 in 0.014 seconds
[0m22:07:22.732324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700694f1e650>]}
[0m22:07:22.733822 [debug] [MainThread]: On master: ROLLBACK
[0m22:07:22.735268 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:22.736373 [debug] [MainThread]: On master: BEGIN
[0m22:07:22.737993 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:07:22.739228 [debug] [MainThread]: On master: COMMIT
[0m22:07:22.740310 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:22.741326 [debug] [MainThread]: On master: COMMIT
[0m22:07:22.742589 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:07:22.743962 [debug] [MainThread]: On master: Close
[0m22:07:22.759023 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:07:22.761473 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:07:22.763288 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:07:22.765321 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:07:22.783619 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:07:22.795042 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:07:22.822288 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:07:22.838816 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:22.839839 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:07:22.840869 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:07:22.853546 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m22:07:22.855086 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:22.856246 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:07:22.887871 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.030 seconds
[0m22:07:22.900286 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:22.901857 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:07:22.903863 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:22.910245 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:22.931429 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:07:22.935580 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:22.966021 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:07:22.969425 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:22.972530 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:07:22.980878 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m22:07:22.987696 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:07:22.997994 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:23.001352 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:07:23.007266 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m22:07:23.013566 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:07:23.017300 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700697089950>]}
[0m22:07:23.019454 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.25s]
[0m22:07:23.021255 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:07:23.023262 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:07:23.024031 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:07:23.025237 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:07:23.027964 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:07:23.029939 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:07:23.047277 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:07:23.051166 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:07:23.052939 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:07:23.061897 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:07:23.064855 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:07:23.066721 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:07:23.067969 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:07:23.079599 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:07:23.095059 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:07:23.108784 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:07:23.118841 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:07:23.120499 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:07:23.126507 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:07:23.173601 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:07:23.179599 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:07:23.191379 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:07:23.199490 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:23.200561 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:23.201044 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:07:23.201791 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:23.202668 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:07:23.203910 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:07:23.205147 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:07:23.206105 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:07:23.209146 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:07:23.228130 [debug] [Thread-4 (]: SQL status: BEGIN in 0.018 seconds
[0m22:07:23.241337 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:23.244524 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:07:23.255634 [debug] [Thread-3 (]: SQL status: BEGIN in 0.049 seconds
[0m22:07:23.257526 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:23.258844 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:07:23.282336 [debug] [Thread-2 (]: SQL status: BEGIN in 0.078 seconds
[0m22:07:23.284926 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:23.286963 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:07:23.342916 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.095 seconds
[0m22:07:23.344391 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.056 seconds
[0m22:07:23.351059 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:23.351356 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.090 seconds
[0m22:07:23.355423 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:23.356689 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:07:23.359397 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:23.360502 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:07:23.361930 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.362190 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:07:23.365602 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:23.365880 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m22:07:23.367632 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.368373 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:07:23.371518 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:23.374898 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:23.376626 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.377263 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:07:23.378642 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:07:23.380181 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:07:23.381880 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.382804 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.383097 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:23.384752 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:07:23.386789 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:07:23.387882 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:07:23.388695 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:23.389542 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:23.391467 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:07:23.392523 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:07:23.393081 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m22:07:23.395152 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m22:07:23.397617 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:07:23.397906 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m22:07:23.401617 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:07:23.404701 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:23.408087 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:07:23.410404 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:23.412439 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:07:23.414190 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:23.415500 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:07:23.417866 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:07:23.424165 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:07:23.425084 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:07:23.425386 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:07:23.426577 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:07:23.430440 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:07:23.438934 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:07:23.440437 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700692defad0>]}
[0m22:07:23.441859 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700692dd4f10>]}
[0m22:07:23.443820 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7006953e8c10>]}
[0m22:07:23.446285 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.39s]
[0m22:07:23.449265 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.39s]
[0m22:07:23.451366 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.38s]
[0m22:07:23.452530 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:07:23.460439 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:07:23.462190 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:07:23.463790 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:07:23.465083 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:07:23.466337 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:07:23.467307 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:07:23.468597 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:07:23.470182 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:07:23.471803 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m22:07:23.473080 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_daily)
[0m22:07:23.474856 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m22:07:23.476300 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:07:23.478369 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:07:23.479918 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:07:23.484685 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:07:23.491306 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:07:23.497216 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:07:23.506668 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:07:23.509060 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:07:23.511844 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:07:23.512144 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:07:23.516391 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:07:23.530265 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:07:23.540571 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:23.541241 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:23.542527 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:07:23.544466 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:07:23.545228 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:23.546173 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:07:23.547602 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:07:23.549136 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:07:23.555604 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:07:23.562991 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m22:07:23.566748 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:23.567690 [debug] [Thread-3 (]: SQL status: BEGIN in 0.012 seconds
[0m22:07:23.569581 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:07:23.570373 [debug] [Thread-4 (]: SQL status: BEGIN in 0.023 seconds
[0m22:07:23.572521 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:23.575623 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:23.577476 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:07:23.578656 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:07:23.581267 [debug] [Thread-1 (]: SQL status: SELECT 924 in 0.007 seconds
[0m22:07:23.588089 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:23.588448 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.008 seconds
[0m22:07:23.588733 [debug] [Thread-4 (]: SQL status: SELECT 132 in 0.006 seconds
[0m22:07:23.592339 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:07:23.598731 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:23.602639 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:23.604353 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.604712 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:07:23.606021 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:07:23.609785 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:23.611293 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.612207 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:07:23.612570 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.615429 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:23.617004 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.621065 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:23.623725 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:07:23.627884 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:07:23.629647 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:07:23.631912 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.632955 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:23.634841 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:23.636883 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:07:23.637929 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:07:23.639757 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:07:23.642142 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:23.647329 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:07:23.648142 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:23.649490 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:07:23.652848 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:07:23.654493 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:07:23.657158 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:23.657533 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m22:07:23.662104 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m22:07:23.663486 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:07:23.668325 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:07:23.671878 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:07:23.673802 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:23.674775 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:23.675963 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:07:23.677233 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:07:23.677937 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:07:23.682736 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:07:23.684024 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700692dc4e90>]}
[0m22:07:23.685486 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:07:23.685250 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.21s]
[0m22:07:23.687235 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:07:23.687493 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:07:23.688284 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:07:23.689822 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7006903a7c50>]}
[0m22:07:23.691565 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:07:23.717679 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.21s]
[0m22:07:23.719554 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69db3d60-4b2d-48a3-b5b9-1fdc3d8d6d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7006902dc690>]}
[0m22:07:23.721054 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:07:23.722718 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.25s]
[0m22:07:23.725912 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:07:23.730763 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:23.731934 [debug] [MainThread]: On master: BEGIN
[0m22:07:23.732962 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:07:23.741200 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m22:07:23.742641 [debug] [MainThread]: On master: COMMIT
[0m22:07:23.743990 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:23.745183 [debug] [MainThread]: On master: COMMIT
[0m22:07:23.746521 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:07:23.747628 [debug] [MainThread]: On master: Close
[0m22:07:23.748905 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:07:23.750045 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:07:23.751180 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:07:23.752165 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:07:23.753724 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_monthly' was properly closed.
[0m22:07:23.755295 [info ] [MainThread]: 
[0m22:07:23.757300 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.53 seconds (1.53s).
[0m22:07:23.761577 [debug] [MainThread]: Command end result
[0m22:07:23.854930 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:07:23.863282 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:07:23.875816 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:07:23.877640 [info ] [MainThread]: 
[0m22:07:23.879954 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:07:23.881436 [info ] [MainThread]: 
[0m22:07:23.882615 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:07:23.885416 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.1262164, "process_in_blocks": "768", "process_kernel_time": 2.400153, "process_mem_max_rss": "131460", "process_out_blocks": "0", "process_user_time": 2.482469}
[0m22:07:23.886746 [debug] [MainThread]: Command `dbt run` succeeded at 22:07:23.886587 after 5.13 seconds
[0m22:07:23.887921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700695f3c710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700695f3ea50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70069a857910>]}
[0m22:07:23.889137 [debug] [MainThread]: Flushing usage events
[0m22:07:24.607481 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:07:52.578013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e34d10fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e37b84f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e34d31190>]}


============================== 22:07:52.588544 | b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5 ==============================
[0m22:07:52.588544 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:07:52.594521 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'invocation_command': 'dbt run', 'log_cache_events': 'False', 'target_path': 'None', 'indirect_selection': 'eager', 'profiles_dir': '/usr/app/dbt/dbt', 'log_path': '/usr/app/dbt/dbt/logs', 'cache_selected_only': 'False', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'write_json': 'True', 'empty': 'False', 'warn_error': 'None', 'printer_width': '80', 'use_colors': 'True', 'fail_fast': 'False', 'version_check': 'True', 'partial_parse': 'True', 'debug': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'no_print': 'None'}
[0m22:07:52.871895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e34d01e90>]}
[0m22:07:52.943515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e3411b990>]}
[0m22:07:52.946095 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:07:53.129907 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:07:55.698027 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:07:55.699602 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:07:55.736974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e3354d550>]}
[0m22:07:55.874308 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:07:55.883804 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:07:56.009914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e34d14c10>]}
[0m22:07:56.013080 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:07:56.015606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e33dac2d0>]}
[0m22:07:56.018831 [info ] [MainThread]: 
[0m22:07:56.020278 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:07:56.021753 [info ] [MainThread]: 
[0m22:07:56.023935 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:07:56.030271 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:07:56.168636 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:07:56.170229 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:07:56.174910 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:07:56.233851 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.059 seconds
[0m22:07:56.242555 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:07:56.246284 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:07:56.255007 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:07:56.256244 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:07:56.257189 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:07:56.277458 [debug] [ThreadPool]: SQL status: BEGIN in 0.020 seconds
[0m22:07:56.279124 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:07:56.280805 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:07:56.326043 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.044 seconds
[0m22:07:56.330647 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:07:56.333310 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:07:56.339479 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:56.341520 [debug] [MainThread]: On master: BEGIN
[0m22:07:56.343372 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:07:56.393081 [debug] [MainThread]: SQL status: BEGIN in 0.050 seconds
[0m22:07:56.395543 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:56.397269 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:07:56.447326 [debug] [MainThread]: SQL status: SELECT 1 in 0.048 seconds
[0m22:07:56.450594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e354461d0>]}
[0m22:07:56.453154 [debug] [MainThread]: On master: ROLLBACK
[0m22:07:56.454601 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:56.455812 [debug] [MainThread]: On master: BEGIN
[0m22:07:56.457294 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:07:56.461101 [debug] [MainThread]: On master: COMMIT
[0m22:07:56.462684 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:56.464156 [debug] [MainThread]: On master: COMMIT
[0m22:07:56.465696 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:07:56.467252 [debug] [MainThread]: On master: Close
[0m22:07:56.482265 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:07:56.485064 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:07:56.487258 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:07:56.489084 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:07:56.507504 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:07:56.530948 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:07:56.558605 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:07:56.581690 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:56.583603 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:07:56.585094 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:07:56.627009 [debug] [Thread-1 (]: SQL status: BEGIN in 0.042 seconds
[0m22:07:56.631697 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:56.634631 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:07:56.662799 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.024 seconds
[0m22:07:56.671964 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:56.673376 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:07:56.675797 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:56.680395 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:56.683388 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:07:56.686153 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:56.705485 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:07:56.710888 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:56.713798 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:07:56.722712 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:07:56.730080 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:07:56.738887 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:07:56.740960 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:07:56.755794 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.010 seconds
[0m22:07:56.762317 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:07:56.768350 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e34129b10>]}
[0m22:07:56.772155 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.28s]
[0m22:07:56.775260 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:07:56.778062 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:07:56.779126 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:07:56.780701 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:07:56.782647 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:07:56.784391 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:07:56.786386 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:07:56.789936 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:07:56.791468 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:07:56.793408 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:07:56.796514 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:07:56.798275 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:07:56.799787 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:07:56.806922 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:07:56.815331 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:07:56.825524 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:07:56.852056 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:07:56.852535 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:07:56.858651 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:07:56.871178 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:07:56.878262 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:07:56.882760 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:07:56.898655 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:56.899198 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:56.900669 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:07:56.904739 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:56.905264 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:07:56.908185 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:07:56.912746 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:07:56.914771 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:07:56.923495 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:07:56.974783 [debug] [Thread-4 (]: SQL status: BEGIN in 0.060 seconds
[0m22:07:56.975189 [debug] [Thread-2 (]: SQL status: BEGIN in 0.067 seconds
[0m22:07:56.976921 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:56.978657 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:56.980543 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:07:56.981987 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:07:56.987627 [debug] [Thread-3 (]: SQL status: BEGIN in 0.064 seconds
[0m22:07:56.989388 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:56.991650 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:07:57.044569 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.060 seconds
[0m22:07:57.046822 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.064 seconds
[0m22:07:57.050751 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.057 seconds
[0m22:07:57.066082 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:57.070273 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:57.076828 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:57.079698 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:07:57.081144 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:07:57.083447 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:07:57.086526 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:57.087650 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:57.089488 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:57.100650 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:57.110583 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:57.117959 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:57.119930 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:07:57.121454 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:07:57.123240 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:07:57.126908 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:57.127538 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m22:07:57.129705 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:57.131405 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:07:57.133863 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:07:57.137220 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:07:57.138845 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:57.139919 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:57.141120 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:57.142428 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:07:57.143787 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:07:57.145211 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:07:57.148735 [debug] [Thread-4 (]: SQL status: COMMIT in 0.002 seconds
[0m22:07:57.149790 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m22:07:57.157230 [debug] [Thread-3 (]: SQL status: COMMIT in 0.008 seconds
[0m22:07:57.157524 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:07:57.160854 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:07:57.170920 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:07:57.175600 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:07:57.178744 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:07:57.181533 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:07:57.183398 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:07:57.185399 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:07:57.186668 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:07:57.194567 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:07:57.195745 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:07:57.198677 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:07:57.199058 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.008 seconds
[0m22:07:57.203422 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:07:57.208377 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e354086d0>]}
[0m22:07:57.213244 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:07:57.217027 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e301ee690>]}
[0m22:07:57.219273 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.42s]
[0m22:07:57.221676 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e31a01d10>]}
[0m22:07:57.223537 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.42s]
[0m22:07:57.225838 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:07:57.229243 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.43s]
[0m22:07:57.231198 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:07:57.234276 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:07:57.235303 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:07:57.237114 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:07:57.238403 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:07:57.241952 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:07:57.243299 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:07:57.246653 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m22:07:57.249292 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:07:57.251412 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m22:07:57.253210 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:07:57.254603 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m22:07:57.255863 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:07:57.260096 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:07:57.262824 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:07:57.267727 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:07:57.277662 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:07:57.296854 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:07:57.305658 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:07:57.309231 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:07:57.316081 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:07:57.324212 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:07:57.340764 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:07:57.350325 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:57.351090 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:57.353311 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:07:57.353894 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:57.355183 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:07:57.357013 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:07:57.358717 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:07:57.360257 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:07:57.364140 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:07:57.390297 [debug] [Thread-1 (]: SQL status: BEGIN in 0.032 seconds
[0m22:07:57.391938 [debug] [Thread-2 (]: SQL status: BEGIN in 0.032 seconds
[0m22:07:57.393279 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:57.395183 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:57.396641 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:07:57.397981 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:07:57.403402 [debug] [Thread-4 (]: SQL status: BEGIN in 0.039 seconds
[0m22:07:57.405341 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:57.406812 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:07:57.407305 [debug] [Thread-1 (]: SQL status: SELECT 924 in 0.007 seconds
[0m22:07:57.412925 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:57.414399 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:07:57.414979 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.006 seconds
[0m22:07:57.417379 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:57.422197 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:57.422713 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.021 seconds
[0m22:07:57.425740 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:57.426811 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:07:57.432582 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:57.434271 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:07:57.436888 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:57.437557 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:07:57.439278 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:07:57.449373 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:57.451493 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:57.453297 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:07:57.454488 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:07:57.457620 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:57.458680 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:57.460312 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:57.461336 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:07:57.462809 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:07:57.465926 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:07:57.467706 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:07:57.468954 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:57.469929 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:07:57.470956 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:07:57.474577 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:07:57.477626 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:07:57.479478 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:57.484659 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:07:57.485433 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m22:07:57.487511 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:07:57.489102 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:07:57.492104 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:07:57.495180 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m22:07:57.499171 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:07:57.505640 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:07:57.506032 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.009 seconds
[0m22:07:57.508405 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:07:57.512784 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:07:57.516247 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:07:57.518921 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:07:57.520746 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e227c0a90>]}
[0m22:07:57.524347 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:07:57.523859 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.27s]
[0m22:07:57.527699 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:07:57.528231 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:07:57.529618 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:07:57.531960 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e227d7d50>]}
[0m22:07:57.534632 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:07:57.539812 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.28s]
[0m22:07:57.542044 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4e630b5-0a4e-41fa-8e8f-cd5c2b037ff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e227e0610>]}
[0m22:07:57.543246 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:07:57.545373 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.29s]
[0m22:07:57.548625 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:07:57.553064 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:57.554784 [debug] [MainThread]: On master: BEGIN
[0m22:07:57.555612 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:07:57.566786 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:07:57.568452 [debug] [MainThread]: On master: COMMIT
[0m22:07:57.569409 [debug] [MainThread]: Using postgres connection "master"
[0m22:07:57.570921 [debug] [MainThread]: On master: COMMIT
[0m22:07:57.571952 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:07:57.572891 [debug] [MainThread]: On master: Close
[0m22:07:57.574013 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:07:57.574947 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:07:57.575882 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_daily' was properly closed.
[0m22:07:57.576867 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:07:57.578915 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:07:57.580449 [info ] [MainThread]: 
[0m22:07:57.582559 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.56 seconds (1.56s).
[0m22:07:57.585027 [debug] [MainThread]: Command end result
[0m22:07:57.670484 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:07:57.678855 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:07:57.697547 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:07:57.698541 [info ] [MainThread]: 
[0m22:07:57.699646 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:07:57.700944 [info ] [MainThread]: 
[0m22:07:57.702478 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:07:57.706371 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.2004113, "process_in_blocks": "1904", "process_kernel_time": 1.367577, "process_mem_max_rss": "130936", "process_out_blocks": "0", "process_user_time": 2.249254}
[0m22:07:57.708800 [debug] [MainThread]: Command `dbt run` succeeded at 22:07:57.708535 after 5.20 seconds
[0m22:07:57.710662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e34d004d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e31abda90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773e3961b910>]}
[0m22:07:57.712815 [debug] [MainThread]: Flushing usage events
[0m22:07:58.816360 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:08:52.657253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abfbffa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abfc620d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abfc61e50>]}


============================== 22:08:52.665887 | bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9 ==============================
[0m22:08:52.665887 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:08:52.667967 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'target_path': 'None', 'indirect_selection': 'eager', 'write_json': 'True', 'log_format': 'default', 'log_path': '/usr/app/dbt/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'debug': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'quiet': 'False', 'fail_fast': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'no_print': 'None'}
[0m22:08:52.817500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abfb3dbd0>]}
[0m22:08:52.859197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794ac29551d0>]}
[0m22:08:52.861508 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:08:53.019452 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:08:55.145600 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:08:55.147327 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:08:55.186500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abe775c10>]}
[0m22:08:55.353755 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:08:55.367313 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:08:55.485525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abdb0bc50>]}
[0m22:08:55.496921 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:08:55.508520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abefa8710>]}
[0m22:08:55.513233 [info ] [MainThread]: 
[0m22:08:55.515442 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:08:55.517151 [info ] [MainThread]: 
[0m22:08:55.519372 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:08:55.527270 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:08:55.600875 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:08:55.614481 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:08:55.616268 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:08:55.642798 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.026 seconds
[0m22:08:55.646007 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:08:55.651530 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:08:55.661460 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:08:55.667738 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:08:55.672016 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:08:55.686762 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m22:08:55.690469 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:08:55.694496 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:08:55.704436 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.009 seconds
[0m22:08:55.708746 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:08:55.715272 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:08:55.727211 [debug] [MainThread]: Using postgres connection "master"
[0m22:08:55.728757 [debug] [MainThread]: On master: BEGIN
[0m22:08:55.731618 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:08:55.745451 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m22:08:55.748284 [debug] [MainThread]: Using postgres connection "master"
[0m22:08:55.750331 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:08:55.757980 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m22:08:55.760743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abe72de50>]}
[0m22:08:55.763901 [debug] [MainThread]: On master: ROLLBACK
[0m22:08:55.765606 [debug] [MainThread]: Using postgres connection "master"
[0m22:08:55.767147 [debug] [MainThread]: On master: BEGIN
[0m22:08:55.768952 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:08:55.771572 [debug] [MainThread]: On master: COMMIT
[0m22:08:55.773346 [debug] [MainThread]: Using postgres connection "master"
[0m22:08:55.774743 [debug] [MainThread]: On master: COMMIT
[0m22:08:55.776973 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:08:55.778231 [debug] [MainThread]: On master: Close
[0m22:08:55.794416 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:08:55.796849 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:08:55.800309 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:08:55.801772 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:08:55.819381 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:08:55.834566 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:08:55.864093 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:08:55.888038 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:08:55.890385 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:08:55.892391 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:08:55.904867 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m22:08:55.910016 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:08:55.911550 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:08:55.924740 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m22:08:55.932423 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:08:55.939036 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:08:55.943447 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:08:55.949688 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:08:55.954714 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:08:55.961927 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:55.987652 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:08:55.994315 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:08:56.001652 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:08:56.025773 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:08:56.044315 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:08:56.051956 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:08:56.053553 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:08:56.068860 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.008 seconds
[0m22:08:56.074146 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:08:56.079154 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abcae2fd0>]}
[0m22:08:56.081056 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.28s]
[0m22:08:56.083953 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:08:56.086526 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:08:56.087046 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:08:56.087861 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:08:56.091320 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:08:56.094042 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:08:56.095779 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:08:56.097536 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:08:56.098734 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:08:56.099949 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:08:56.101136 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:08:56.102088 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:08:56.103246 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:08:56.117536 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:08:56.127254 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:08:56.130586 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:08:56.140702 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:08:56.141104 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:08:56.147345 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:08:56.164620 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:08:56.171113 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:08:56.177221 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:08:56.188215 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:08:56.190315 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:08:56.190674 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:08:56.191489 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:08:56.191754 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:08:56.193503 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:08:56.194461 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:08:56.195471 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:08:56.197318 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:08:56.227354 [debug] [Thread-4 (]: SQL status: BEGIN in 0.030 seconds
[0m22:08:56.228844 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:08:56.230062 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:08:56.237707 [debug] [Thread-2 (]: SQL status: BEGIN in 0.042 seconds
[0m22:08:56.242141 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:08:56.243455 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:08:56.246598 [debug] [Thread-3 (]: SQL status: BEGIN in 0.053 seconds
[0m22:08:56.248012 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:08:56.249279 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:08:56.278907 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.028 seconds
[0m22:08:56.287342 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.056 seconds
[0m22:08:56.290572 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:08:56.296786 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:08:56.297731 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:08:56.299043 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:08:56.301193 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:56.301508 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:56.304248 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:08:56.304842 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.060 seconds
[0m22:08:56.315662 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:08:56.316609 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:08:56.327534 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:08:56.328791 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:08:56.330560 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:56.331010 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:08:56.334161 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:08:56.334551 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:08:56.336619 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:56.337102 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:08:56.339670 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:08:56.349695 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:08:56.350648 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:08:56.351659 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:08:56.352496 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:08:56.354340 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:08:56.356134 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:56.359079 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:08:56.360217 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:08:56.361571 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:08:56.362567 [debug] [Thread-3 (]: SQL status: COMMIT in 0.009 seconds
[0m22:08:56.385229 [debug] [Thread-4 (]: SQL status: COMMIT in 0.029 seconds
[0m22:08:56.386873 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:08:56.387245 [debug] [Thread-2 (]: SQL status: COMMIT in 0.024 seconds
[0m22:08:56.397857 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:08:56.404587 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:08:56.415691 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:08:56.417069 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:08:56.417926 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:08:56.419636 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:08:56.420766 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:08:56.427576 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:08:56.429740 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.008 seconds
[0m22:08:56.434693 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:08:56.436539 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abef8d110>]}
[0m22:08:56.437998 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.34s]
[0m22:08:56.440934 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:08:56.443064 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:08:56.444066 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:08:56.445659 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m22:08:56.446897 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:08:56.451341 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:08:56.451954 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.022 seconds
[0m22:08:56.453142 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.021 seconds
[0m22:08:56.456374 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:08:56.459663 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:08:56.461903 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abc9f5fd0>]}
[0m22:08:56.463436 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abc91bd90>]}
[0m22:08:56.465410 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.36s]
[0m22:08:56.468365 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:08:56.467840 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.36s]
[0m22:08:56.469923 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:08:56.474585 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:08:56.475915 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:08:56.477676 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:08:56.480315 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:08:56.481169 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:08:56.482212 [info ] [Thread-4 (]: 7 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:08:56.484194 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m22:08:56.485439 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m22:08:56.487783 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:08:56.490654 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:08:56.491677 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:08:56.497125 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:08:56.501821 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:08:56.502989 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:08:56.507840 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:08:56.515274 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:08:56.522432 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:08:56.525169 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:08:56.532183 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:08:56.540170 [debug] [Thread-1 (]: SQL status: BEGIN in 0.032 seconds
[0m22:08:56.542518 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:08:56.545272 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:08:56.546339 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:08:56.547009 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:08:56.548284 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:08:56.549480 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:08:56.550571 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.003 seconds
[0m22:08:56.550890 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:08:56.551863 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:08:56.556351 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:08:56.561802 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:08:56.563879 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:56.567861 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:08:56.568817 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:08:56.570177 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:08:56.572224 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:08:56.573062 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:08:56.573934 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:08:56.576670 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:08:56.579208 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:08:56.580331 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:08:56.580676 [debug] [Thread-4 (]: SQL status: BEGIN in 0.029 seconds
[0m22:08:56.581370 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:08:56.582217 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:08:56.583335 [debug] [Thread-3 (]: SQL status: BEGIN in 0.032 seconds
[0m22:08:56.584130 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:08:56.584906 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:08:56.586362 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:08:56.586778 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m22:08:56.594732 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:08:56.595448 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.010 seconds
[0m22:08:56.596207 [debug] [Thread-3 (]: SQL status: SELECT 924 in 0.004 seconds
[0m22:08:56.596904 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794ab563f390>]}
[0m22:08:56.600717 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:08:56.611093 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:08:56.612759 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.15s]
[0m22:08:56.614323 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:08:56.616040 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:08:56.617902 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:08:56.620812 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:56.623298 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:56.629988 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:08:56.633560 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:08:56.635501 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:08:56.637170 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:08:56.641571 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:56.642894 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:08:56.645299 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:08:56.648468 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:08:56.650947 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:08:56.652604 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:08:56.654350 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:08:56.656604 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:08:56.660177 [debug] [Thread-4 (]: SQL status: COMMIT in 0.002 seconds
[0m22:08:56.661083 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m22:08:56.674367 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:08:56.681546 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:08:56.683258 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:08:56.684914 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:08:56.686905 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:08:56.688037 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:08:56.695629 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:08:56.698422 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:08:56.698796 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.009 seconds
[0m22:08:56.699851 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794abcaa0650>]}
[0m22:08:56.701722 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:08:56.703143 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.22s]
[0m22:08:56.709503 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebf1d7a-67fe-4a0c-92d3-7b1fb7827af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794ab5507f10>]}
[0m22:08:56.710771 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:08:56.712560 [info ] [Thread-4 (]: 7 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.22s]
[0m22:08:56.716734 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:08:56.719795 [debug] [MainThread]: Using postgres connection "master"
[0m22:08:56.721156 [debug] [MainThread]: On master: BEGIN
[0m22:08:56.723024 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:08:56.731499 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m22:08:56.732766 [debug] [MainThread]: On master: COMMIT
[0m22:08:56.733847 [debug] [MainThread]: Using postgres connection "master"
[0m22:08:56.734693 [debug] [MainThread]: On master: COMMIT
[0m22:08:56.735858 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:08:56.736793 [debug] [MainThread]: On master: Close
[0m22:08:56.737808 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:08:56.739362 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:08:56.740525 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:08:56.741355 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:08:56.742716 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_monthly' was properly closed.
[0m22:08:56.743864 [info ] [MainThread]: 
[0m22:08:56.745265 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.22 seconds (1.22s).
[0m22:08:56.747618 [debug] [MainThread]: Command end result
[0m22:08:56.805791 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:08:56.813411 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:08:56.826576 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:08:56.827874 [info ] [MainThread]: 
[0m22:08:56.829179 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:08:56.830657 [info ] [MainThread]: 
[0m22:08:56.831757 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:08:56.833968 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.257859, "process_in_blocks": "2504", "process_kernel_time": 0.934101, "process_mem_max_rss": "131192", "process_out_blocks": "0", "process_user_time": 2.363931}
[0m22:08:56.834969 [debug] [MainThread]: Command `dbt run` succeeded at 22:08:56.834847 after 4.26 seconds
[0m22:08:56.836282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794ac443ee10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794ac443ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794ac44ef890>]}
[0m22:08:56.837288 [debug] [MainThread]: Flushing usage events
[0m22:08:57.627776 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:10:00.078555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743dc2da90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743dc4ce90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743dc2e290>]}


============================== 22:10:00.089088 | b8914926-6dde-4f4a-8b8b-b9de5cba0dfd ==============================
[0m22:10:00.089088 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:10:00.090474 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'no_print': 'None', 'fail_fast': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'target_path': 'None', 'introspect': 'True', 'printer_width': '80', 'debug': 'False', 'empty': 'False', 'version_check': 'True', 'write_json': 'True', 'use_colors': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'invocation_command': 'dbt run', 'static_parser': 'True', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'log_path': '/usr/app/dbt/dbt/logs'}
[0m22:10:00.252423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743cdae190>]}
[0m22:10:00.301855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743c9c5ed0>]}
[0m22:10:00.305087 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:10:00.488950 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:10:02.674614 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:10:02.675875 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:10:02.713395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743c96e5d0>]}
[0m22:10:02.817758 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:10:02.825867 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:10:02.957614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743c108dd0>]}
[0m22:10:02.960371 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:10:02.962801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743b9d49d0>]}
[0m22:10:02.966285 [info ] [MainThread]: 
[0m22:10:02.967685 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:10:02.969453 [info ] [MainThread]: 
[0m22:10:02.971077 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:10:02.978598 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:10:03.016839 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:10:03.018348 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:10:03.019834 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:10:03.046370 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.026 seconds
[0m22:10:03.048448 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:10:03.052137 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:10:03.059102 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:10:03.060223 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:10:03.061107 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:10:03.069958 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m22:10:03.071385 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:10:03.072275 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:10:03.078296 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m22:10:03.080245 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:10:03.081274 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:10:03.087903 [debug] [MainThread]: Using postgres connection "master"
[0m22:10:03.089672 [debug] [MainThread]: On master: BEGIN
[0m22:10:03.091511 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:10:03.103147 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m22:10:03.107090 [debug] [MainThread]: Using postgres connection "master"
[0m22:10:03.109786 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:10:03.119690 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m22:10:03.123614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743decb310>]}
[0m22:10:03.125751 [debug] [MainThread]: On master: ROLLBACK
[0m22:10:03.127963 [debug] [MainThread]: Using postgres connection "master"
[0m22:10:03.129920 [debug] [MainThread]: On master: BEGIN
[0m22:10:03.132236 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:10:03.134236 [debug] [MainThread]: On master: COMMIT
[0m22:10:03.136359 [debug] [MainThread]: Using postgres connection "master"
[0m22:10:03.138281 [debug] [MainThread]: On master: COMMIT
[0m22:10:03.140100 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:10:03.141436 [debug] [MainThread]: On master: Close
[0m22:10:03.150662 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:10:03.153163 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:10:03.155222 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:10:03.156745 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:10:03.172936 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:10:03.182275 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:10:03.206287 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:10:03.215326 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:10:03.216222 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:10:03.217709 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:10:03.226313 [debug] [Thread-1 (]: SQL status: BEGIN in 0.008 seconds
[0m22:10:03.227578 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:10:03.228771 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:10:03.240177 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m22:10:03.247467 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:10:03.248647 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:10:03.250936 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:10:03.257577 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:10:03.258836 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:10:03.261038 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:10:03.275285 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:10:03.277157 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:10:03.278114 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:10:03.280682 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:10:03.286299 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:10:03.292831 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:10:03.294122 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:10:03.299510 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m22:10:03.302258 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:10:03.304695 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743eda08d0>]}
[0m22:10:03.310487 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.15s]
[0m22:10:03.313328 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:10:03.316755 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:10:03.317405 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:10:03.317944 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:10:03.319970 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:10:03.323781 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:10:03.326061 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:10:03.328164 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:10:03.330157 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:10:03.332029 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:10:03.333842 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:10:03.336227 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:10:03.337968 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:10:03.344171 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:10:03.348914 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:10:03.355019 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:10:03.367519 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:10:03.368406 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:10:03.380021 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:10:03.387739 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:10:03.392051 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:10:03.396667 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:10:03.408438 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:10:03.410199 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:10:03.410544 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:10:03.411568 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:10:03.412134 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:10:03.413076 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:10:03.414294 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:10:03.415406 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:10:03.420058 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:10:03.427408 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m22:10:03.428855 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:10:03.429958 [debug] [Thread-4 (]: SQL status: BEGIN in 0.017 seconds
[0m22:10:03.430401 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:10:03.430764 [debug] [Thread-2 (]: SQL status: BEGIN in 0.011 seconds
[0m22:10:03.431643 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:10:03.433411 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:10:03.434951 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:10:03.435876 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:10:03.446992 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.014 seconds
[0m22:10:03.454695 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:10:03.455109 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.018 seconds
[0m22:10:03.455435 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.017 seconds
[0m22:10:03.456291 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:10:03.460893 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:10:03.464013 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:10:03.465544 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:10:03.466142 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:10:03.466886 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:10:03.469738 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:10:03.471198 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:10:03.471538 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:10:03.472286 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:10:03.475730 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:10:03.478796 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:10:03.481498 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:10:03.480635 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:10:03.480368 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:10:03.482996 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:10:03.483698 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:10:03.484853 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:10:03.486934 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:10:03.488940 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:10:03.491144 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:10:03.492156 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:10:03.492964 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:10:03.493823 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:10:03.494682 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:10:03.495505 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:10:03.498073 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m22:10:03.500755 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:10:03.501060 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m22:10:03.501262 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m22:10:03.504857 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:10:03.508096 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:10:03.512278 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:10:03.513700 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:10:03.515271 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:10:03.516722 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:10:03.518877 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:10:03.519747 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:10:03.523855 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:10:03.525662 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:10:03.525902 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:10:03.526876 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743aace690>]}
[0m22:10:03.527182 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:10:03.529069 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:10:03.530839 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.20s]
[0m22:10:03.532461 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:10:03.534071 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70743aa58250>]}
[0m22:10:03.535335 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:10:03.537138 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7074237f38d0>]}
[0m22:10:03.538431 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.20s]
[0m22:10:03.539880 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:10:03.540704 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.21s]
[0m22:10:03.541822 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:10:03.543057 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:10:03.544443 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:10:03.545935 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:10:03.546895 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m22:10:03.548140 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:10:03.549002 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:10:03.552110 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:10:03.553252 [info ] [Thread-4 (]: 7 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:10:03.554768 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m22:10:03.558959 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:10:03.560252 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m22:10:03.561323 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:10:03.562923 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:10:03.566159 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:10:03.569592 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:10:03.572645 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:10:03.576363 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:10:03.577658 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:10:03.581239 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:10:03.581630 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:10:03.585839 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:10:03.587936 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:10:03.589295 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:10:03.589634 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:10:03.590897 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:10:03.591487 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:10:03.591995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:10:03.592830 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:10:03.593718 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:10:03.597673 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:10:03.601646 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m22:10:03.602868 [debug] [Thread-3 (]: SQL status: BEGIN in 0.010 seconds
[0m22:10:03.603362 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:10:03.606086 [debug] [Thread-4 (]: SQL status: BEGIN in 0.009 seconds
[0m22:10:03.628830 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:10:03.632020 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:10:03.645049 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:10:03.661011 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:10:03.676974 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:10:03.678331 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.006 seconds
[0m22:10:03.685296 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:10:03.685774 [debug] [Thread-3 (]: SQL status: SELECT 924 in 0.007 seconds
[0m22:10:03.687217 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:10:03.687632 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.008 seconds
[0m22:10:03.692011 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:10:03.693847 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:10:03.697329 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:10:03.698298 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:10:03.701211 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:10:03.703838 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:10:03.705870 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:10:03.706176 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:10:03.707842 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:10:03.708241 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:10:03.710872 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:10:03.713808 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:10:03.720117 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:10:03.722687 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:10:03.727640 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:10:03.729368 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:10:03.731297 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:10:03.731616 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:10:03.734301 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:10:03.735936 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:10:03.740404 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:10:03.743492 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:10:03.745717 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:10:03.751232 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:10:03.753585 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:10:03.755295 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:10:03.758399 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:10:03.760835 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:10:03.767730 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:10:03.768594 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m22:10:03.775698 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:10:03.778508 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:10:03.779756 [debug] [Thread-4 (]: SQL status: COMMIT in 0.011 seconds
[0m22:10:03.780276 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:10:03.781472 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.010 seconds
[0m22:10:03.786493 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:10:03.792695 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:10:03.795306 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:10:03.795962 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:10:03.805300 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7074236c0a50>]}
[0m22:10:03.806337 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:10:03.809247 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:10:03.811181 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.26s]
[0m22:10:03.813400 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7074236d6a90>]}
[0m22:10:03.814620 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:10:03.816002 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.004 seconds
[0m22:10:03.816408 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.26s]
[0m22:10:03.819988 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:10:03.821493 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:10:03.823030 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8914926-6dde-4f4a-8b8b-b9de5cba0dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7074236d6fd0>]}
[0m22:10:03.825317 [info ] [Thread-4 (]: 7 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.26s]
[0m22:10:03.826778 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:10:03.829774 [debug] [MainThread]: Using postgres connection "master"
[0m22:10:03.831018 [debug] [MainThread]: On master: BEGIN
[0m22:10:03.832192 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:10:03.841237 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m22:10:03.843072 [debug] [MainThread]: On master: COMMIT
[0m22:10:03.844038 [debug] [MainThread]: Using postgres connection "master"
[0m22:10:03.844886 [debug] [MainThread]: On master: COMMIT
[0m22:10:03.846065 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:10:03.846830 [debug] [MainThread]: On master: Close
[0m22:10:03.848073 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:10:03.849066 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:10:03.850018 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:10:03.851303 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:10:03.852288 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_monthly' was properly closed.
[0m22:10:03.853580 [info ] [MainThread]: 
[0m22:10:03.855521 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.88 seconds (0.88s).
[0m22:10:03.858295 [debug] [MainThread]: Command end result
[0m22:10:03.962577 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:10:03.971323 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:10:03.983007 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:10:03.985028 [info ] [MainThread]: 
[0m22:10:03.986899 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:10:03.988031 [info ] [MainThread]: 
[0m22:10:03.989122 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:10:03.991708 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.988723, "process_in_blocks": "6312", "process_kernel_time": 0.553034, "process_mem_max_rss": "131296", "process_out_blocks": "0", "process_user_time": 2.426987}
[0m22:10:03.992861 [debug] [MainThread]: Command `dbt run` succeeded at 22:10:03.992739 after 3.99 seconds
[0m22:10:03.993809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70744248add0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70744248ad50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707442537910>]}
[0m22:10:03.994751 [debug] [MainThread]: Flushing usage events
[0m22:10:04.724611 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:11:07.454540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85c91aa50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85c9269d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85c8e50d0>]}


============================== 22:11:07.463295 | a770c03e-17d6-4ffe-a836-08991ae872c1 ==============================
[0m22:11:07.463295 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:11:07.466163 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run', 'no_print': 'None', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'introspect': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'fail_fast': 'False', 'printer_width': '80', 'target_path': 'None', 'indirect_selection': 'eager', 'version_check': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'quiet': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'write_json': 'True', 'empty': 'False'}
[0m22:11:07.645522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85bf333d0>]}
[0m22:11:07.706411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85f62e550>]}
[0m22:11:07.708243 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:11:07.917690 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:11:10.495592 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:11:10.496792 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:11:10.538114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85b728f50>]}
[0m22:11:10.653058 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:11:10.661998 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:11:10.801357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85c7c9550>]}
[0m22:11:10.802670 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:11:10.805132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85ca21fd0>]}
[0m22:11:10.808245 [info ] [MainThread]: 
[0m22:11:10.809591 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:11:10.812701 [info ] [MainThread]: 
[0m22:11:10.815783 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:11:10.823419 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:11:10.882323 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:11:10.884240 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:11:10.886005 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:11:10.905489 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.019 seconds
[0m22:11:10.908495 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:11:10.912420 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:11:10.920279 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:11:10.921664 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:11:10.922911 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:11:10.942644 [debug] [ThreadPool]: SQL status: BEGIN in 0.020 seconds
[0m22:11:10.945737 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:11:10.947493 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:11:10.961120 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.011 seconds
[0m22:11:10.965093 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:11:10.967122 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:11:10.976125 [debug] [MainThread]: Using postgres connection "master"
[0m22:11:10.977895 [debug] [MainThread]: On master: BEGIN
[0m22:11:10.979672 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:11:10.992254 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m22:11:10.994342 [debug] [MainThread]: Using postgres connection "master"
[0m22:11:10.997104 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:11:11.007612 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m22:11:11.011149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85b7218d0>]}
[0m22:11:11.012832 [debug] [MainThread]: On master: ROLLBACK
[0m22:11:11.014820 [debug] [MainThread]: Using postgres connection "master"
[0m22:11:11.016686 [debug] [MainThread]: On master: BEGIN
[0m22:11:11.018736 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:11:11.020663 [debug] [MainThread]: On master: COMMIT
[0m22:11:11.022173 [debug] [MainThread]: Using postgres connection "master"
[0m22:11:11.023807 [debug] [MainThread]: On master: COMMIT
[0m22:11:11.025857 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:11:11.027480 [debug] [MainThread]: On master: Close
[0m22:11:11.035758 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:11:11.037708 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:11:11.039922 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:11:11.041783 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:11:11.061769 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:11:11.077626 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:11:11.105952 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:11:11.136083 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:11:11.138091 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:11:11.139473 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:11:11.162728 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m22:11:11.164940 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:11:11.167022 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:11:11.195237 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.026 seconds
[0m22:11:11.209163 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:11:11.211367 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:11:11.215108 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:11:11.221386 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:11:11.223200 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:11:11.226587 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:11:11.243919 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:11:11.246089 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:11:11.247597 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:11:11.251695 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:11:11.257631 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:11:11.263218 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:11:11.264888 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:11:11.283153 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.016 seconds
[0m22:11:11.290378 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:11:11.294749 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85c912450>]}
[0m22:11:11.296835 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.25s]
[0m22:11:11.299013 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:11:11.302244 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:11:11.303216 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:11:11.303733 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:11:11.305484 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:11:11.307830 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:11:11.309974 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:11:11.312671 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:11:11.314387 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:11:11.316552 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:11:11.318397 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:11:11.319735 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:11:11.321165 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:11:11.329001 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:11:11.333530 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:11:11.337936 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:11:11.360926 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:11:11.361671 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:11:11.368234 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:11:11.380620 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:11:11.385082 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:11:11.388588 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:11:11.399137 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:11:11.400606 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:11:11.401213 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:11:11.402100 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:11:11.403690 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:11:11.406214 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:11:11.406978 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:11:11.408693 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:11:11.411598 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:11:11.417428 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m22:11:11.418741 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:11:11.420201 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m22:11:11.420720 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:11:11.422211 [debug] [Thread-2 (]: SQL status: BEGIN in 0.011 seconds
[0m22:11:11.422489 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:11:11.424923 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:11:11.426732 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:11:11.428426 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:11:11.437547 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.014 seconds
[0m22:11:11.443808 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:11:11.445020 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:11:11.447015 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:11:11.452616 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:11:11.453128 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.022 seconds
[0m22:11:11.453802 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.024 seconds
[0m22:11:11.454473 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:11:11.457513 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:11:11.460706 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:11:11.463378 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:11:11.463781 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:11:11.464957 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:11:11.466921 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:11:11.468924 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:11:11.470072 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:11:11.470507 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:11:11.474640 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:11:11.479493 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:11:11.481561 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:11:11.483132 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:11:11.484878 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:11:11.490348 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:11:11.493313 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:11:11.495136 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:11:11.495540 [debug] [Thread-3 (]: SQL status: COMMIT in 0.007 seconds
[0m22:11:11.498458 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:11:11.500116 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:11:11.504393 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:11:11.505946 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:11:11.507405 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:11:11.513506 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:11:11.515133 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:11:11.517987 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:11:11.518679 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m22:11:11.525333 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:11:11.527092 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:11:11.528615 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:11:11.529912 [debug] [Thread-4 (]: SQL status: COMMIT in 0.010 seconds
[0m22:11:11.535396 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:11:11.535821 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.015 seconds
[0m22:11:11.537035 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:11:11.541572 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:11:11.543165 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:11:11.543578 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.013 seconds
[0m22:11:11.545669 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8584006d0>]}
[0m22:11:11.549658 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:11:11.551416 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.23s]
[0m22:11:11.553474 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a85841b850>]}
[0m22:11:11.555613 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:11:11.557330 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.24s]
[0m22:11:11.559024 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:11:11.560240 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:11:11.562027 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:11:11.563922 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.016 seconds
[0m22:11:11.564945 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:11:11.566041 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m22:11:11.569076 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:11:11.570574 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:11:11.572023 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:11:11.574695 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a858400a50>]}
[0m22:11:11.575954 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m22:11:11.581354 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:11:11.583105 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.26s]
[0m22:11:11.584411 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:11:11.588038 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:11:11.591929 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:11:11.593933 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:11:11.600225 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:11:11.602247 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m22:11:11.604519 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:11:11.605140 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:11:11.609583 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:11:11.610433 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:11:11.615816 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:11:11.622870 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:11:11.632998 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:11:11.633404 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:11:11.635806 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:11:11.641765 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:11:11.642161 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:11:11.643233 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:11:11.645831 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:11:11.652640 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:11:11.657679 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m22:11:11.659326 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:11:11.662356 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:11:11.664285 [debug] [Thread-3 (]: SQL status: BEGIN in 0.012 seconds
[0m22:11:11.667041 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:11:11.668631 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:11:11.670058 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:11:11.674455 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:11:11.676001 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:11:11.680695 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.016 seconds
[0m22:11:11.682067 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.003 seconds
[0m22:11:11.686963 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:11:11.691722 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:11:11.693143 [debug] [Thread-2 (]: SQL status: BEGIN in 0.017 seconds
[0m22:11:11.693671 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:11:11.695076 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:11:11.696756 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:11:11.698707 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:11:11.700191 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:11:11.701117 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:11:11.706338 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:11:11.710277 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:11:11.713302 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:11:11.714920 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:11:11.716506 [debug] [Thread-2 (]: SQL status: SELECT 924 in 0.004 seconds
[0m22:11:11.716862 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:11:11.718748 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:11:11.723000 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:11:11.726183 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:11:11.728319 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:11:11.730045 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:11:11.731442 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:11:11.733433 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:11:11.735483 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:11:11.736687 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:11:11.738450 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:11:11.742459 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:11:11.746766 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:11:11.749239 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:11:11.751836 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:11:11.753374 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:11:11.755299 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:11:11.761175 [debug] [Thread-1 (]: SQL status: COMMIT in 0.017 seconds
[0m22:11:11.766330 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:11:11.768303 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:11:11.769586 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:11:11.774110 [debug] [Thread-2 (]: SQL status: COMMIT in 0.017 seconds
[0m22:11:11.774473 [debug] [Thread-3 (]: SQL status: COMMIT in 0.029 seconds
[0m22:11:11.777965 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:11:11.782807 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:11:11.784957 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:11:11.785561 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.015 seconds
[0m22:11:11.787047 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:11:11.789127 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:11:11.791491 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:11:11.793068 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:11:11.796401 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8584ddd10>]}
[0m22:11:11.798944 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.23s]
[0m22:11:11.800229 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:11:11.806674 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.012 seconds
[0m22:11:11.810480 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:11:11.812496 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8584ddcd0>]}
[0m22:11:11.814468 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.21s]
[0m22:11:11.815813 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:11:11.817996 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.020 seconds
[0m22:11:11.819916 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:11:11.821935 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a770c03e-17d6-4ffe-a836-08991ae872c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8584de9d0>]}
[0m22:11:11.823488 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.25s]
[0m22:11:11.825645 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:11:11.829399 [debug] [MainThread]: Using postgres connection "master"
[0m22:11:11.830796 [debug] [MainThread]: On master: BEGIN
[0m22:11:11.831865 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:11:11.844228 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m22:11:11.846845 [debug] [MainThread]: On master: COMMIT
[0m22:11:11.848778 [debug] [MainThread]: Using postgres connection "master"
[0m22:11:11.850576 [debug] [MainThread]: On master: COMMIT
[0m22:11:11.852758 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:11:11.854979 [debug] [MainThread]: On master: Close
[0m22:11:11.857549 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:11:11.860611 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:11:11.862365 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:11:11.864032 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m22:11:11.865517 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:11:11.866716 [info ] [MainThread]: 
[0m22:11:11.868865 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.05 seconds (1.05s).
[0m22:11:11.871480 [debug] [MainThread]: Command end result
[0m22:11:11.933290 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:11:11.941659 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:11:11.952177 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:11:11.953192 [info ] [MainThread]: 
[0m22:11:11.954185 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:11:11.955670 [info ] [MainThread]: 
[0m22:11:11.956787 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:11:11.959662 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.5881443, "process_in_blocks": "0", "process_kernel_time": 0.949146, "process_mem_max_rss": "131212", "process_out_blocks": "0", "process_user_time": 2.498859}
[0m22:11:11.961293 [debug] [MainThread]: Command `dbt run` succeeded at 22:11:11.961103 after 4.59 seconds
[0m22:11:11.962740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8611bb8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a86110ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a86110edd0>]}
[0m22:11:11.963877 [debug] [MainThread]: Flushing usage events
[0m22:11:12.656704 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:12:15.471997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d53798b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d5387b5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d53404a90>]}


============================== 22:12:15.479136 | fc523564-d24e-4265-9cf3-59489bd2ce48 ==============================
[0m22:12:15.479136 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:12:15.482066 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'version_check': 'True', 'use_colors': 'True', 'partial_parse': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'fail_fast': 'False', 'introspect': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'target_path': 'None', 'write_json': 'True', 'empty': 'False', 'quiet': 'False', 'log_cache_events': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'send_anonymous_usage_stats': 'True'}
[0m22:12:15.672420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d53407350>]}
[0m22:12:15.720628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d521e1d90>]}
[0m22:12:15.724391 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:12:15.876321 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:12:18.141721 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:12:18.143480 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:12:18.186457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d52198090>]}
[0m22:12:18.343309 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:12:18.350967 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:12:18.444990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d534106d0>]}
[0m22:12:18.446828 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:12:18.448376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d519af850>]}
[0m22:12:18.451074 [info ] [MainThread]: 
[0m22:12:18.452451 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:12:18.455725 [info ] [MainThread]: 
[0m22:12:18.458193 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:12:18.463862 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:12:18.562779 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:12:18.564039 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:12:18.565050 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:12:18.582128 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m22:12:18.585553 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:12:18.589359 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:12:18.596128 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:12:18.597393 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:12:18.598478 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:12:18.617494 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m22:12:18.619061 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:12:18.621762 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:12:18.631858 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m22:12:18.634596 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:12:18.635729 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:12:18.643354 [debug] [MainThread]: Using postgres connection "master"
[0m22:12:18.644942 [debug] [MainThread]: On master: BEGIN
[0m22:12:18.648146 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:12:18.671765 [debug] [MainThread]: SQL status: BEGIN in 0.023 seconds
[0m22:12:18.673787 [debug] [MainThread]: Using postgres connection "master"
[0m22:12:18.675818 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:12:18.683560 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m22:12:18.692694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d52141b50>]}
[0m22:12:18.693771 [debug] [MainThread]: On master: ROLLBACK
[0m22:12:18.696671 [debug] [MainThread]: Using postgres connection "master"
[0m22:12:18.699166 [debug] [MainThread]: On master: BEGIN
[0m22:12:18.703489 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:12:18.705350 [debug] [MainThread]: On master: COMMIT
[0m22:12:18.706728 [debug] [MainThread]: Using postgres connection "master"
[0m22:12:18.707999 [debug] [MainThread]: On master: COMMIT
[0m22:12:18.709814 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:12:18.710898 [debug] [MainThread]: On master: Close
[0m22:12:18.728353 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:12:18.733828 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:12:18.736974 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:12:18.739076 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:12:18.767901 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:12:18.793933 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:12:18.824270 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:12:18.839615 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:12:18.841259 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:12:18.842491 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:12:18.855249 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m22:12:18.859720 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:12:18.861608 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:12:18.870165 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m22:12:18.879389 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:12:18.880664 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:12:18.883261 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:18.889969 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:12:18.891787 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:12:18.894870 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:18.912211 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:12:18.914163 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:12:18.915640 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:12:18.918809 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:12:18.926047 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:12:18.932254 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:12:18.933691 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:12:18.940312 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m22:12:18.943424 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:12:18.945973 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d53bcd7d0>]}
[0m22:12:18.947345 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.21s]
[0m22:12:18.948759 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:12:18.950560 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:12:18.950887 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:12:18.951251 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:12:18.952238 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:12:18.954502 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:12:18.956022 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:12:18.957459 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:12:18.958621 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:12:18.959821 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:12:18.960659 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:12:18.961834 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:12:18.963160 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:12:18.968489 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:12:18.972647 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:12:18.975864 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:12:18.983050 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:12:18.995645 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:12:18.999713 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:12:19.002970 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:12:19.003279 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:12:19.008426 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:12:19.014673 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:12:19.016076 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:12:19.017894 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:12:19.018240 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:12:19.020951 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:12:19.021992 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:12:19.022365 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:12:19.023257 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:12:19.025044 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:12:19.028486 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m22:12:19.030354 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:12:19.031315 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:12:19.031606 [debug] [Thread-2 (]: SQL status: BEGIN in 0.009 seconds
[0m22:12:19.033052 [debug] [Thread-3 (]: SQL status: BEGIN in 0.008 seconds
[0m22:12:19.033473 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:12:19.034636 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:12:19.035683 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:12:19.036806 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:12:19.045614 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.013 seconds
[0m22:12:19.051851 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:12:19.052248 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.012 seconds
[0m22:12:19.052660 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.014 seconds
[0m22:12:19.054533 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:12:19.059963 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:12:19.062716 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:12:19.064604 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:19.065067 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:12:19.066238 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:12:19.068843 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:12:19.070256 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:12:19.071495 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:19.071944 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:12:19.075749 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:12:19.078433 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:12:19.080103 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:19.080496 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:12:19.081750 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:12:19.084156 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:12:19.085777 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:19.086592 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:19.086970 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:12:19.090957 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:12:19.093475 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:12:19.095191 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:12:19.096504 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:12:19.097531 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:12:19.098952 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:12:19.101897 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:12:19.102562 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m22:12:19.109654 [debug] [Thread-3 (]: SQL status: COMMIT in 0.005 seconds
[0m22:12:19.110612 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m22:12:19.115731 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:12:19.124577 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:12:19.132032 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:12:19.239884 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:12:19.242474 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:12:19.244566 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:12:19.246913 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:12:19.248403 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:12:19.252834 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:12:19.259942 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.004 seconds
[0m22:12:19.261853 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:12:19.263191 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d5010b7d0>]}
[0m22:12:19.265035 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:12:19.264554 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.30s]
[0m22:12:19.266327 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.009 seconds
[0m22:12:19.268520 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:12:19.273110 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:12:19.276187 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:12:19.278862 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d5010b450>]}
[0m22:12:19.280691 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:12:19.285396 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d5346ba10>]}
[0m22:12:19.287735 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.32s]
[0m22:12:19.293431 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:12:19.296396 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.33s]
[0m22:12:19.299161 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:12:19.302475 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m22:12:19.304371 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:12:19.306699 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:12:19.308222 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:12:19.310411 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:12:19.311773 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:12:19.316570 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:12:19.319790 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:12:19.321810 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m22:12:19.327156 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m22:12:19.329239 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:12:19.331596 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:12:19.335489 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:12:19.340266 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:12:19.343902 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:12:19.350206 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:12:19.354199 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:12:19.359060 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:12:19.359550 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:12:19.365912 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:12:19.371192 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:12:19.373203 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:12:19.374492 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:12:19.374838 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:12:19.376701 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:12:19.379438 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:12:19.379778 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:12:19.380584 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:12:19.382954 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:12:19.386414 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m22:12:19.387584 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:12:19.388582 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:12:19.390106 [debug] [Thread-4 (]: SQL status: BEGIN in 0.010 seconds
[0m22:12:19.391375 [debug] [Thread-2 (]: SQL status: BEGIN in 0.009 seconds
[0m22:12:19.391693 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:12:19.392738 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:12:19.393845 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:12:19.394905 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:12:19.395821 [debug] [Thread-1 (]: SQL status: SELECT 924 in 0.006 seconds
[0m22:12:19.402503 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:12:19.403036 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.007 seconds
[0m22:12:19.403381 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.006 seconds
[0m22:12:19.404243 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:12:19.408187 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:12:19.412496 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:12:19.415238 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:19.416914 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:12:19.417943 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:12:19.421414 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:12:19.423647 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:19.424668 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:19.425079 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:12:19.429043 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:12:19.433002 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:12:19.435883 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:12:19.436595 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:12:19.438418 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:12:19.441125 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:19.442805 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:12:19.444614 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:12:19.445889 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:12:19.446849 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:12:19.449508 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:12:19.450794 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:12:19.452333 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:12:19.454108 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:12:19.456045 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:12:19.458466 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:12:19.461743 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m22:12:19.465607 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:12:19.467315 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:12:19.467893 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m22:12:19.469589 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:12:19.471740 [debug] [Thread-2 (]: SQL status: COMMIT in 0.010 seconds
[0m22:12:19.474133 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:12:19.478705 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:12:19.479260 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m22:12:19.480389 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:12:19.482164 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:12:19.484953 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:12:19.486275 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:12:19.487659 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:12:19.489216 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d48ee8f50>]}
[0m22:12:19.493616 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.19s]
[0m22:12:19.495365 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:12:19.501727 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.011 seconds
[0m22:12:19.502720 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.011 seconds
[0m22:12:19.504329 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:12:19.506262 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:12:19.508320 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d48d03290>]}
[0m22:12:19.509749 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc523564-d24e-4265-9cf3-59489bd2ce48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d48d08710>]}
[0m22:12:19.511141 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.19s]
[0m22:12:19.512599 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.18s]
[0m22:12:19.514026 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:12:19.515668 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:12:19.520596 [debug] [MainThread]: Using postgres connection "master"
[0m22:12:19.521728 [debug] [MainThread]: On master: BEGIN
[0m22:12:19.522664 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:12:19.531149 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m22:12:19.532557 [debug] [MainThread]: On master: COMMIT
[0m22:12:19.533769 [debug] [MainThread]: Using postgres connection "master"
[0m22:12:19.534729 [debug] [MainThread]: On master: COMMIT
[0m22:12:19.535982 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:12:19.536973 [debug] [MainThread]: On master: Close
[0m22:12:19.541912 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:12:19.543064 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:12:19.543954 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_daily' was properly closed.
[0m22:12:19.544694 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:12:19.545586 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:12:19.547158 [info ] [MainThread]: 
[0m22:12:19.548445 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.09 seconds (1.09s).
[0m22:12:19.550675 [debug] [MainThread]: Command end result
[0m22:12:19.611374 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:12:19.620370 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:12:19.633866 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:12:19.634960 [info ] [MainThread]: 
[0m22:12:19.636354 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:12:19.637587 [info ] [MainThread]: 
[0m22:12:19.639096 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:12:19.641691 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.2585993, "process_in_blocks": "0", "process_kernel_time": 1.372737, "process_mem_max_rss": "131360", "process_out_blocks": "0", "process_user_time": 2.378547}
[0m22:12:19.642991 [debug] [MainThread]: Command `dbt run` succeeded at 22:12:19.642791 after 4.26 seconds
[0m22:12:19.644056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d533fa8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d53798b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6d57f638d0>]}
[0m22:12:19.645073 [debug] [MainThread]: Flushing usage events
[0m22:12:20.373239 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:13:23.129554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754857b4ae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7548589b5c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754857f435d0>]}


============================== 22:13:23.135530 | 309552e1-6151-43fa-9bf5-22303eaae8f5 ==============================
[0m22:13:23.135530 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:13:23.136832 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'use_experimental_parser': 'False', 'quiet': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'cache_selected_only': 'False', 'no_print': 'None', 'write_json': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'version_check': 'True', 'static_parser': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'target_path': 'None', 'debug': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'log_path': '/usr/app/dbt/dbt/logs', 'fail_fast': 'False', 'empty': 'False'}
[0m22:13:23.298363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754857b10c50>]}
[0m22:13:23.350622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75485a85a990>]}
[0m22:13:23.353499 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:13:23.505956 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:13:25.821130 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:13:25.823839 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:13:25.871208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754856fd1c90>]}
[0m22:13:25.995287 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:13:26.005914 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:13:26.123259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754856f12c50>]}
[0m22:13:26.125446 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:13:26.127273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754857c67f90>]}
[0m22:13:26.130598 [info ] [MainThread]: 
[0m22:13:26.132653 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:13:26.134033 [info ] [MainThread]: 
[0m22:13:26.135649 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:13:26.140996 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:13:26.278165 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:13:26.279467 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:13:26.281137 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:26.296360 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.015 seconds
[0m22:13:26.298643 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:13:26.302674 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:13:26.310030 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:13:26.311153 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:13:26.312331 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:13:26.324459 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m22:13:26.327200 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:13:26.328572 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:13:26.336430 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.007 seconds
[0m22:13:26.340932 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:13:26.346617 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:13:26.354707 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:26.357116 [debug] [MainThread]: On master: BEGIN
[0m22:13:26.358020 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:13:26.369395 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:13:26.370855 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:26.371820 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:13:26.378894 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m22:13:26.381112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75485635d950>]}
[0m22:13:26.382246 [debug] [MainThread]: On master: ROLLBACK
[0m22:13:26.384357 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:26.385674 [debug] [MainThread]: On master: BEGIN
[0m22:13:26.388758 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:13:26.390088 [debug] [MainThread]: On master: COMMIT
[0m22:13:26.391546 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:26.392779 [debug] [MainThread]: On master: COMMIT
[0m22:13:26.394521 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:13:26.395657 [debug] [MainThread]: On master: Close
[0m22:13:26.402546 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:13:26.415739 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:13:26.421268 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:13:26.422880 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:13:26.444389 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:13:26.458617 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:13:26.490581 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:13:26.522498 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:13:26.523920 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:13:26.525083 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:13:26.553597 [debug] [Thread-1 (]: SQL status: BEGIN in 0.028 seconds
[0m22:13:26.556676 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:13:26.558857 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:13:26.570128 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m22:13:26.578794 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:13:26.580695 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:13:26.586348 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:13:26.592842 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:13:26.594436 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:13:26.596642 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:26.609069 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:13:26.610367 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:13:26.611250 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:13:26.614351 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:13:26.622556 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:13:26.626951 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:13:26.627917 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:13:26.639263 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.010 seconds
[0m22:13:26.644138 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:13:26.648949 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75485630c850>]}
[0m22:13:26.651678 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.22s]
[0m22:13:26.654147 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:13:26.656899 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:13:26.657637 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:13:26.658161 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:13:26.659088 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:13:26.661490 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:13:26.663944 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:13:26.665296 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:13:26.666846 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:13:26.668412 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:13:26.671543 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:13:26.673373 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:13:26.674430 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:13:26.679621 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:13:26.684126 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:13:26.700165 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:13:26.721212 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:13:26.723876 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:13:26.730055 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:13:26.742991 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:13:26.747748 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:13:26.754019 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:13:26.783871 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:13:26.784694 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:13:26.785443 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:13:26.786204 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:13:26.787664 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:13:26.789099 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:13:26.790790 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:13:26.791843 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:13:26.793143 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:13:26.804289 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m22:13:26.808777 [debug] [Thread-4 (]: SQL status: BEGIN in 0.017 seconds
[0m22:13:26.809582 [debug] [Thread-2 (]: SQL status: BEGIN in 0.016 seconds
[0m22:13:26.812121 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:13:26.813979 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:13:26.816076 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:13:26.817587 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:13:26.819390 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:13:26.820979 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:13:26.833732 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m22:13:26.841866 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:13:26.842390 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.017 seconds
[0m22:13:26.842841 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.019 seconds
[0m22:13:26.844061 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:13:26.850360 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:13:26.855602 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:13:26.858660 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:26.859527 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:13:26.861308 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:13:26.865090 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:13:26.868561 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:26.869076 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:26.870420 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:13:26.873708 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:13:26.877624 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:13:26.879545 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:13:26.880085 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:26.880923 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:13:26.883546 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:13:26.884021 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:13:26.887312 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:26.888068 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:13:26.890982 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:13:26.894773 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:13:26.896382 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:13:26.897701 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:13:26.898931 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:13:26.901829 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:13:26.903248 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:13:26.904593 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m22:13:26.905943 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m22:13:26.908947 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:13:26.909385 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m22:13:26.911645 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:13:26.917324 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:13:26.922394 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:13:26.923965 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:13:26.925351 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:13:26.927299 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:13:26.928570 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:13:26.931172 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:13:26.937652 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:13:26.940989 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:13:26.941507 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.008 seconds
[0m22:13:26.941910 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.007 seconds
[0m22:13:26.943467 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7548549d4a90>]}
[0m22:13:26.945459 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:13:26.947665 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:13:26.949634 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.28s]
[0m22:13:26.952075 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7548549db950>]}
[0m22:13:26.953482 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7548549cebd0>]}
[0m22:13:26.954779 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:13:26.956284 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.28s]
[0m22:13:26.957933 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.29s]
[0m22:13:26.959479 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:13:26.960157 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:13:26.961300 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:13:26.962719 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:13:26.964361 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:13:26.965645 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:13:26.966527 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m22:13:26.967551 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:13:26.968902 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:13:26.970251 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:13:26.971705 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m22:13:26.973005 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m22:13:26.976748 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:13:26.978096 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:13:26.979187 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:13:26.983851 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:13:26.988108 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:13:26.990349 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:13:26.996549 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:13:26.998764 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:13:26.999755 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:13:27.003271 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:13:27.007621 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:13:27.011615 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:13:27.012692 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:13:27.014055 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:13:27.014419 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:13:27.015671 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:13:27.016588 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:13:27.018474 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:13:27.019642 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:13:27.020502 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:13:27.024458 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m22:13:27.026540 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:13:27.027732 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:13:27.030050 [debug] [Thread-3 (]: SQL status: BEGIN in 0.010 seconds
[0m22:13:27.030922 [debug] [Thread-2 (]: SQL status: BEGIN in 0.010 seconds
[0m22:13:27.031984 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.003 seconds
[0m22:13:27.032304 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:13:27.033970 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:13:27.040980 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:13:27.041924 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:13:27.042994 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:13:27.044148 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:13:27.047542 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:27.048493 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.003 seconds
[0m22:13:27.052083 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:13:27.052639 [debug] [Thread-2 (]: SQL status: SELECT 924 in 0.007 seconds
[0m22:13:27.055857 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:13:27.057071 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:13:27.060214 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:13:27.061636 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:13:27.063343 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:13:27.063751 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:27.065894 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:27.067655 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:27.070296 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:13:27.075114 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:13:27.078546 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:13:27.080148 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:13:27.081284 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:13:27.082178 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:13:27.083294 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:13:27.085270 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:27.086536 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:27.089184 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:13:27.089581 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:13:27.091457 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:13:27.092518 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:13:27.096412 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:13:27.097764 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:13:27.099116 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:13:27.100295 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:13:27.101573 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:13:27.104339 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:13:27.104901 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m22:13:27.107446 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m22:13:27.109819 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:13:27.114189 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:13:27.114582 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.008 seconds
[0m22:13:27.115654 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:13:27.117397 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:13:27.120206 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:13:27.121772 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:13:27.122987 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:13:27.124579 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7548546bff10>]}
[0m22:13:27.127878 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.16s]
[0m22:13:27.129271 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:13:27.130137 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:13:27.131715 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:13:27.133088 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:13:27.135455 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:13:27.137346 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7548546da6d0>]}
[0m22:13:27.138567 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '309552e1-6151-43fa-9bf5-22303eaae8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7548546dbd50>]}
[0m22:13:27.139858 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.17s]
[0m22:13:27.141701 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.17s]
[0m22:13:27.143238 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:13:27.144850 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:13:27.148680 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:27.149730 [debug] [MainThread]: On master: BEGIN
[0m22:13:27.151036 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:13:27.161404 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:13:27.162811 [debug] [MainThread]: On master: COMMIT
[0m22:13:27.163932 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:27.165251 [debug] [MainThread]: On master: COMMIT
[0m22:13:27.166700 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:13:27.167720 [debug] [MainThread]: On master: Close
[0m22:13:27.169343 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:13:27.170254 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:13:27.171293 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:13:27.172484 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m22:13:27.173536 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:13:27.174911 [info ] [MainThread]: 
[0m22:13:27.176029 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.04 seconds (1.04s).
[0m22:13:27.177708 [debug] [MainThread]: Command end result
[0m22:13:27.239735 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:13:27.248411 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:13:27.262184 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:13:27.263658 [info ] [MainThread]: 
[0m22:13:27.265016 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:13:27.266130 [info ] [MainThread]: 
[0m22:13:27.267168 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:13:27.270136 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.2090225, "process_in_blocks": "0", "process_kernel_time": 1.223411, "process_mem_max_rss": "131936", "process_out_blocks": "0", "process_user_time": 2.351491}
[0m22:13:27.271885 [debug] [MainThread]: Command `dbt run` succeeded at 22:13:27.271698 after 4.21 seconds
[0m22:13:27.273590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75485c34edd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75485c65b8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75485c416a10>]}
[0m22:13:27.274849 [debug] [MainThread]: Flushing usage events
[0m22:13:27.918380 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:30.781080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a8b2fea90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a8b29a490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a8b2985d0>]}


============================== 22:14:30.788678 | 0b258a65-aa13-4e5c-a14c-efda059b9144 ==============================
[0m22:14:30.788678 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:14:30.790968 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'partial_parse': 'True', 'debug': 'False', 'write_json': 'True', 'warn_error': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'version_check': 'True', 'no_print': 'None', 'introspect': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'indirect_selection': 'eager', 'log_format': 'default', 'printer_width': '80', 'static_parser': 'True', 'target_path': 'None'}
[0m22:14:30.966563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a8b28e450>]}
[0m22:14:31.012534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a8e00e490>]}
[0m22:14:31.017512 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:14:31.204871 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:14:33.707277 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:14:33.708794 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:14:33.747872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a89b78d10>]}
[0m22:14:33.908708 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:14:33.925126 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:14:34.043508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a89ffbe50>]}
[0m22:14:34.045990 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m22:14:34.049342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a89bb7b90>]}
[0m22:14:34.055051 [info ] [MainThread]: 
[0m22:14:34.057597 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:14:34.059442 [info ] [MainThread]: 
[0m22:14:34.061383 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:14:34.067724 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:14:34.186985 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:14:34.188983 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:14:34.190476 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:14:34.210384 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.020 seconds
[0m22:14:34.212603 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:14:34.216033 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:14:34.225934 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:14:34.227701 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:14:34.228854 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:14:34.241764 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m22:14:34.246019 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:14:34.247965 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:14:34.259679 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.007 seconds
[0m22:14:34.264660 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:14:34.271995 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:14:34.287546 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:34.293445 [debug] [MainThread]: On master: BEGIN
[0m22:14:34.297576 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:14:34.325740 [debug] [MainThread]: SQL status: BEGIN in 0.028 seconds
[0m22:14:34.329161 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:34.331584 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:14:34.340436 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m22:14:34.344174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a893ebe10>]}
[0m22:14:34.346525 [debug] [MainThread]: On master: ROLLBACK
[0m22:14:34.348544 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:34.349884 [debug] [MainThread]: On master: BEGIN
[0m22:14:34.353280 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:14:34.355305 [debug] [MainThread]: On master: COMMIT
[0m22:14:34.358631 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:34.360285 [debug] [MainThread]: On master: COMMIT
[0m22:14:34.361988 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:14:34.363349 [debug] [MainThread]: On master: Close
[0m22:14:34.373705 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:14:34.376301 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:14:34.378847 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:14:34.380751 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:14:34.402335 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:14:34.448714 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:14:34.492616 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:14:34.516621 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:14:34.518951 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:14:34.523290 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:14:34.536148 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m22:14:34.537661 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:14:34.539356 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:14:34.553399 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m22:14:34.561124 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:14:34.562287 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:14:34.564389 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:34.568209 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:14:34.570085 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:14:34.576270 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:34.592493 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:14:34.594065 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:14:34.595543 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:14:34.598512 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:14:34.605996 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:14:34.610196 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:14:34.611464 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:14:34.617481 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m22:14:34.624057 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:14:34.630558 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a8a37d4d0>]}
[0m22:14:34.632550 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.25s]
[0m22:14:34.634863 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:14:34.637575 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m22:14:34.638194 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m22:14:34.639262 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m22:14:34.641865 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m22:14:34.643736 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m22:14:34.645286 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m22:14:34.646813 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m22:14:34.648100 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m22:14:34.649731 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m22:14:34.654003 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m22:14:34.658732 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m22:14:34.668962 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m22:14:34.676397 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m22:14:34.684241 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m22:14:34.690713 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m22:14:34.708816 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m22:14:34.709916 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m22:14:34.718199 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m22:14:34.733662 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m22:14:34.739379 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m22:14:34.744885 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m22:14:34.759897 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:14:34.760596 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:14:34.761635 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m22:14:34.762288 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:14:34.762924 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m22:14:34.764318 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:14:34.767655 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m22:14:34.769214 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:14:34.771390 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:14:34.783074 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m22:14:34.784446 [debug] [Thread-3 (]: SQL status: BEGIN in 0.020 seconds
[0m22:14:34.785938 [debug] [Thread-4 (]: SQL status: BEGIN in 0.014 seconds
[0m22:14:34.786857 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:14:34.788388 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:14:34.789666 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:14:34.790920 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m22:14:34.792362 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m22:14:34.793810 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m22:14:34.804666 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.009 seconds
[0m22:14:34.811941 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:14:34.812302 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.016 seconds
[0m22:14:34.813095 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m22:14:34.817737 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:14:34.818178 [debug] [Thread-4 (]: SQL status: SELECT 924 in 0.021 seconds
[0m22:14:34.820080 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m22:14:34.820437 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:34.823224 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:14:34.824668 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:14:34.826977 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:14:34.827778 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m22:14:34.830264 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:14:34.831537 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m22:14:34.832733 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:14:34.835172 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m22:14:34.837482 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:34.842515 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:14:34.845102 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:34.846588 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:14:34.847926 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m22:14:34.850979 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:14:34.853142 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:14:34.855381 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:34.856546 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:14:34.858393 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m22:14:34.860311 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:14:34.861718 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m22:14:34.864306 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:14:34.866338 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m22:14:34.867731 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m22:14:34.868172 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m22:14:34.871750 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m22:14:34.875908 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m22:14:34.880297 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m22:14:34.880647 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m22:14:34.881569 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m22:14:34.884220 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m22:14:34.888236 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m22:14:34.889636 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m22:14:34.892004 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m22:14:34.895472 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m22:14:34.896236 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:14:34.898199 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m22:14:34.898445 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.004 seconds
[0m22:14:34.899526 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a80e45810>]}
[0m22:14:34.901544 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:14:34.903572 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m22:14:34.905291 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.25s]
[0m22:14:34.909949 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m22:14:34.911890 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a83f18e10>]}
[0m22:14:34.913095 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m22:14:34.914530 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a80d07290>]}
[0m22:14:34.917149 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.27s]
[0m22:14:34.919470 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m22:14:34.920341 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 924[0m in 0.27s]
[0m22:14:34.922540 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m22:14:34.924259 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m22:14:34.926066 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m22:14:34.928323 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m22:14:34.929277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_monthly)
[0m22:14:34.930434 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m22:14:34.931242 [info ] [Thread-2 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m22:14:34.933296 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m22:14:34.936000 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m22:14:34.938990 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m22:14:34.944067 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m22:14:34.945290 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m22:14:34.946225 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m22:14:34.949185 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m22:14:34.954183 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m22:14:34.958115 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m22:14:34.962209 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m22:14:34.966941 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m22:14:34.967352 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m22:14:34.973402 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m22:14:34.973806 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m22:14:34.978197 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m22:14:34.981839 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:14:34.984418 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m22:14:34.985243 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:14:34.986854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:14:34.987860 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:14:34.988335 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m22:14:34.990317 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m22:14:34.991836 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:14:34.992912 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:14:34.998637 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m22:14:35.001734 [debug] [Thread-2 (]: SQL status: BEGIN in 0.010 seconds
[0m22:14:35.002151 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:14:35.002797 [debug] [Thread-3 (]: SQL status: BEGIN in 0.010 seconds
[0m22:14:35.005135 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:14:35.006990 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m22:14:35.008278 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:14:35.009101 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m22:14:35.011430 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m22:14:35.014564 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.004 seconds
[0m22:14:35.020061 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:14:35.020435 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.008 seconds
[0m22:14:35.020759 [debug] [Thread-3 (]: SQL status: SELECT 924 in 0.007 seconds
[0m22:14:35.021556 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m22:14:35.024814 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:14:35.028077 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:14:35.030438 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:35.031392 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m22:14:35.032813 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m22:14:35.037216 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:14:35.039869 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:35.041616 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:35.042219 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m22:14:35.045042 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:14:35.049199 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:14:35.051797 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:35.052157 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m22:14:35.053600 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m22:14:35.055999 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:14:35.058734 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:35.060358 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:35.061407 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:14:35.064083 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:14:35.066132 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:14:35.067555 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m22:14:35.068947 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:14:35.070353 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:14:35.072936 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m22:14:35.074280 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m22:14:35.075709 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m22:14:35.080277 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m22:14:35.080706 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m22:14:35.081121 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m22:14:35.082575 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m22:14:35.087357 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m22:14:35.092449 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m22:14:35.093864 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m22:14:35.095246 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m22:14:35.096567 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m22:14:35.099733 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m22:14:35.101220 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m22:14:35.103331 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:14:35.107062 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m22:14:35.109722 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.005 seconds
[0m22:14:35.110164 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m22:14:35.111029 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a80da8610>]}
[0m22:14:35.112923 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m22:14:35.115805 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m22:14:35.118496 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.18s]
[0m22:14:35.120524 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a80debe90>]}
[0m22:14:35.122219 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b258a65-aa13-4e5c-a14c-efda059b9144', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a80dea490>]}
[0m22:14:35.124054 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m22:14:35.126205 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 924[0m in 0.18s]
[0m22:14:35.127877 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.18s]
[0m22:14:35.130472 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m22:14:35.131924 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m22:14:35.137744 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:35.139272 [debug] [MainThread]: On master: BEGIN
[0m22:14:35.140944 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:14:35.152821 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m22:14:35.154888 [debug] [MainThread]: On master: COMMIT
[0m22:14:35.156466 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:35.157783 [debug] [MainThread]: On master: COMMIT
[0m22:14:35.159170 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:14:35.160194 [debug] [MainThread]: On master: Close
[0m22:14:35.161331 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:14:35.162643 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m22:14:35.163849 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m22:14:35.164680 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m22:14:35.165732 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m22:14:35.167967 [info ] [MainThread]: 
[0m22:14:35.169589 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.11 seconds (1.11s).
[0m22:14:35.172191 [debug] [MainThread]: Command end result
[0m22:14:35.247237 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:14:35.256927 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:14:35.272748 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:14:35.274440 [info ] [MainThread]: 
[0m22:14:35.276415 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:14:35.278115 [info ] [MainThread]: 
[0m22:14:35.279564 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m22:14:35.282533 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6115417, "process_in_blocks": "0", "process_kernel_time": 1.262104, "process_mem_max_rss": "131824", "process_out_blocks": "0", "process_user_time": 2.503983}
[0m22:14:35.288282 [debug] [MainThread]: Command `dbt run` succeeded at 22:14:35.288054 after 4.62 seconds
[0m22:14:35.290707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a8fb9b8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a8faeed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x795a8faeedd0>]}
[0m22:14:35.292632 [debug] [MainThread]: Flushing usage events
[0m22:14:35.996422 [debug] [MainThread]: An error was encountered while trying to flush usage events
