[0m18:04:19.468037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae5fa80d0>]}
[0m18:04:19.591338 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:19.600454 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:19.710554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae5f3a350>]}
[0m18:04:19.711829 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:04:19.712719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae5318f10>]}
[0m18:04:19.714946 [info ] [MainThread]: 
[0m18:04:19.715854 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:19.716680 [info ] [MainThread]: 
[0m18:04:19.717688 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:04:19.721848 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:04:19.797019 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:04:19.798301 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:04:19.799148 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:19.811883 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.013 seconds
[0m18:04:19.814096 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:04:19.816544 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:04:19.822170 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:19.823124 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:04:19.823941 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:19.831407 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m18:04:19.832548 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:19.833388 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:04:19.838617 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.004 seconds
[0m18:04:19.840511 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:04:19.841454 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:04:19.846924 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:19.848044 [debug] [MainThread]: On master: BEGIN
[0m18:04:19.848809 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:04:19.856285 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m18:04:19.857208 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:19.858062 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:04:19.864291 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m18:04:19.866435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae8710510>]}
[0m18:04:19.867438 [debug] [MainThread]: On master: ROLLBACK
[0m18:04:19.868434 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:19.869203 [debug] [MainThread]: On master: BEGIN
[0m18:04:19.870189 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:04:19.870992 [debug] [MainThread]: On master: COMMIT
[0m18:04:19.871607 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:19.872321 [debug] [MainThread]: On master: COMMIT
[0m18:04:19.873100 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:19.873774 [debug] [MainThread]: On master: Close
[0m18:04:19.878529 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:04:19.879595 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:04:19.880690 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:04:19.881608 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:04:19.896678 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.904636 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:04:19.929562 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.937970 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.938857 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:04:19.939965 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:19.948171 [debug] [Thread-1 (]: SQL status: BEGIN in 0.008 seconds
[0m18:04:19.949367 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.950222 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:04:19.956627 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m18:04:19.962406 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.963314 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:04:19.964971 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:19.967755 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.968542 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:04:19.970169 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:19.981219 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:19.982133 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.982786 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:19.987406 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m18:04:19.992479 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:04:19.996685 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:19.997448 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:04:20.001238 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m18:04:20.003869 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:04:20.005947 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae45e58d0>]}
[0m18:04:20.006987 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.12s]
[0m18:04:20.007928 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:04:20.009344 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:04:20.009756 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:04:20.010035 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:04:20.010761 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:04:20.011593 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:04:20.012441 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:04:20.013281 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:04:20.014062 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:04:20.015034 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:04:20.015790 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:04:20.016471 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:04:20.017118 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:04:20.021397 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:04:20.024267 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.027210 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.032504 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:04:20.032842 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:04:20.038834 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:04:20.048638 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.052506 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.055810 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:04:20.061089 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.061484 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.062235 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:04:20.062530 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.063072 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:04:20.063734 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:04:20.064596 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:04:20.065395 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:04:20.066779 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:04:20.073648 [debug] [Thread-2 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:20.074405 [debug] [Thread-4 (]: SQL status: BEGIN in 0.009 seconds
[0m18:04:20.074710 [debug] [Thread-3 (]: SQL status: BEGIN in 0.008 seconds
[0m18:04:20.075309 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.076183 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.077035 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.077727 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:04:20.078444 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:04:20.079144 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:04:20.088486 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.008 seconds
[0m18:04:20.094703 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.095087 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.014 seconds
[0m18:04:20.095392 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.015 seconds
[0m18:04:20.096219 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:04:20.100590 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.103402 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.104790 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:04:20.105110 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.105756 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:04:20.107129 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.109681 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.111484 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.113769 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.114654 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:04:20.117327 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.118054 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:04:20.119229 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:04:20.119529 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.120551 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:04:20.121222 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:04:20.122236 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:20.123764 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:20.125380 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:20.126694 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.128157 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.128993 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.130173 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:20.130940 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:20.131802 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:20.143944 [debug] [Thread-2 (]: SQL status: COMMIT in 0.011 seconds
[0m18:04:20.144652 [debug] [Thread-4 (]: SQL status: COMMIT in 0.011 seconds
[0m18:04:20.144979 [debug] [Thread-3 (]: SQL status: COMMIT in 0.012 seconds
[0m18:04:20.147736 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:04:20.150253 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:04:20.154378 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:04:20.158280 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:20.159898 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:20.161192 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:20.162127 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:04:20.163042 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:04:20.163990 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:04:20.170598 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:20.171065 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:04:20.171833 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:04:20.173394 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:04:20.175872 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:04:20.177685 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:04:20.178995 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae435d690>]}
[0m18:04:20.179944 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae43f9490>]}
[0m18:04:20.180928 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae4585590>]}
[0m18:04:20.181980 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.16s]
[0m18:04:20.183226 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.17s]
[0m18:04:20.184280 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.17s]
[0m18:04:20.185349 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:04:20.186432 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:04:20.187567 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:04:20.188900 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:04:20.189897 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:04:20.191183 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:04:20.192173 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:04:20.193272 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:04:20.194276 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:04:20.195717 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m18:04:20.196771 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m18:04:20.197836 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m18:04:20.198687 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:04:20.199656 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:04:20.201140 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:04:20.205705 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.209894 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.213341 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.221509 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:04:20.221912 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:04:20.222330 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:04:20.225678 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.229397 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.232711 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.238431 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.239720 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:04:20.240504 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.241681 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.242578 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:20.243573 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:04:20.244576 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:04:20.246458 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:04:20.247502 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:04:20.253732 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:20.256301 [debug] [Thread-4 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:20.256742 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.257674 [debug] [Thread-2 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:20.258012 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.258934 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:04:20.260140 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.261149 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:04:20.262787 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:04:20.267863 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.004 seconds
[0m18:04:20.268932 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.005 seconds
[0m18:04:20.269278 [debug] [Thread-1 (]: SQL status: SELECT 704 in 0.007 seconds
[0m18:04:20.273420 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.277165 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.280249 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.281245 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:04:20.282604 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:04:20.283542 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:04:20.285212 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.286423 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.286755 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.289712 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.293921 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.297262 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.298544 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:04:20.299716 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:04:20.301196 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:04:20.303133 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.304130 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.305193 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:20.306810 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:20.309178 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:20.310801 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:20.311680 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.312646 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.313550 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.314488 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:20.315447 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:20.316385 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:20.320421 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m18:04:20.323718 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:04:20.324127 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m18:04:20.324421 [debug] [Thread-2 (]: SQL status: COMMIT in 0.006 seconds
[0m18:04:20.325498 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:20.327910 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:04:20.331925 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:04:20.333270 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:04:20.334399 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:20.335454 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:20.336828 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:04:20.337606 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:04:20.340397 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:04:20.342658 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:04:20.343235 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:20.344283 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae42e8a10>]}
[0m18:04:20.344605 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:04:20.345853 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:04:20.346972 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.15s]
[0m18:04:20.348634 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:04:20.349724 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae41239d0>]}
[0m18:04:20.350494 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:04:20.351452 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01b5ca4-bbed-4079-8759-8da4223d964f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae4128e90>]}
[0m18:04:20.352340 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.15s]
[0m18:04:20.354167 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.15s]
[0m18:04:20.355012 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:04:20.355847 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:04:20.359285 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:20.360278 [debug] [MainThread]: On master: BEGIN
[0m18:04:20.360996 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:04:20.368248 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m18:04:20.369355 [debug] [MainThread]: On master: COMMIT
[0m18:04:20.370074 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:20.370783 [debug] [MainThread]: On master: COMMIT
[0m18:04:20.371607 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:20.372330 [debug] [MainThread]: On master: Close
[0m18:04:20.373221 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:04:20.374171 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:04:20.375166 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_daily' was properly closed.
[0m18:04:20.376073 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:04:20.376983 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:04:20.377911 [info ] [MainThread]: 
[0m18:04:20.378730 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.66 seconds (0.66s).
[0m18:04:20.380338 [debug] [MainThread]: Command end result
[0m18:04:20.424117 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:20.429497 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:20.438602 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:04:20.439519 [info ] [MainThread]: 
[0m18:04:20.440437 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:04:20.441264 [info ] [MainThread]: 
[0m18:04:20.442192 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:04:20.443902 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.6049418, "process_in_blocks": "0", "process_kernel_time": 0.642838, "process_mem_max_rss": "131720", "process_out_blocks": "0", "process_user_time": 2.3102}
[0m18:04:20.445095 [debug] [MainThread]: Command `dbt run` succeeded at 18:04:20.444990 after 2.61 seconds
[0m18:04:20.446045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae770a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae770a790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720ae67d5e50>]}
[0m18:04:20.446902 [debug] [MainThread]: Flushing usage events
[0m18:04:21.131697 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:04:23.897850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39a8f2150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39a8fe750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39a8f0490>]}


============================== 18:04:23.904820 | 73574422-1aa5-411a-a800-f24673275761 ==============================
[0m18:04:23.904820 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:04:23.908107 [debug] [MainThread]: running dbt with arguments {'log_path': '/usr/app/dbt/dbt/logs', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'empty': 'False', 'fail_fast': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'write_json': 'True', 'introspect': 'True', 'no_print': 'None', 'use_colors': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'version_check': 'True', 'static_parser': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m18:04:24.096673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a399da6510>]}
[0m18:04:24.153536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3999a9fd0>]}
[0m18:04:24.156479 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:04:24.353280 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:04:26.840450 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:04:26.841921 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:04:26.887106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39a89ec90>]}
[0m18:04:27.276195 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:27.294234 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:27.434305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39910b5d0>]}
[0m18:04:27.436167 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:04:27.437666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39999bc90>]}
[0m18:04:27.440381 [info ] [MainThread]: 
[0m18:04:27.441795 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:27.443642 [info ] [MainThread]: 
[0m18:04:27.445585 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:04:27.451473 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:04:27.538211 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:04:27.541613 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:04:27.543982 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:27.562693 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.019 seconds
[0m18:04:27.567712 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:04:27.571742 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:04:27.580080 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:27.582368 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:04:27.585676 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:27.597998 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m18:04:27.601319 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:27.603454 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:04:27.614351 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.007 seconds
[0m18:04:27.619738 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:04:27.622100 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:04:27.632675 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:27.638569 [debug] [MainThread]: On master: BEGIN
[0m18:04:27.644243 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:04:27.656777 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m18:04:27.661120 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:27.664176 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:04:27.677242 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m18:04:27.683824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3977dde50>]}
[0m18:04:27.685849 [debug] [MainThread]: On master: ROLLBACK
[0m18:04:27.690287 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:27.691634 [debug] [MainThread]: On master: BEGIN
[0m18:04:27.693217 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:04:27.697101 [debug] [MainThread]: On master: COMMIT
[0m18:04:27.700690 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:27.702073 [debug] [MainThread]: On master: COMMIT
[0m18:04:27.703860 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:27.706411 [debug] [MainThread]: On master: Close
[0m18:04:27.715526 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:04:27.718165 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:04:27.722012 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:04:27.726495 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:04:27.747692 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.785335 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:04:27.816360 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.834666 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.838896 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:04:27.842807 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:27.853472 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:27.855431 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.858615 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:04:27.870528 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m18:04:27.879748 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.882093 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:04:27.885512 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:04:27.891280 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.893811 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:04:27.900311 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:27.916274 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:27.919039 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.921849 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:27.926107 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m18:04:27.932998 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:04:27.939325 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:27.941154 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:04:27.948412 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m18:04:27.953644 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:04:27.956378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39760e510>]}
[0m18:04:27.958391 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.23s]
[0m18:04:27.960330 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:04:27.962602 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:04:27.962896 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:04:27.963244 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:04:27.964598 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:04:27.966433 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:04:27.967930 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:04:27.970148 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:04:27.971802 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:04:27.973768 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:04:27.975438 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:04:27.976755 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:04:27.978451 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:04:27.985605 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:04:27.990924 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:27.995533 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.005477 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:04:28.006175 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:04:28.012796 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:04:28.025425 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.030130 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:04:28.033962 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.044690 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.046451 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.047082 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:04:28.048287 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:04:28.048723 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.050568 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:04:28.052307 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:04:28.053657 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:04:28.058098 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:04:28.064544 [debug] [Thread-2 (]: SQL status: BEGIN in 0.014 seconds
[0m18:04:28.066468 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.066921 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m18:04:28.068228 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:04:28.069288 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:28.070007 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.071955 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.073171 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:04:28.075373 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:04:28.079920 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.009 seconds
[0m18:04:28.089437 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.090088 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m18:04:28.091431 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:04:28.092336 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.015 seconds
[0m18:04:28.099998 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.103977 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.108219 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.110353 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:04:28.114634 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.116213 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:04:28.118314 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.119234 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:04:28.121307 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.124973 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.127635 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.132044 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.134280 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:04:28.136277 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:28.137423 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:04:28.139995 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.140601 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.143283 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.146116 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:28.150336 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:28.153514 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:28.156780 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.159472 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.161131 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:28.162263 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m18:04:28.163121 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:28.168076 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m18:04:28.172396 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:04:28.178990 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:04:28.179536 [debug] [Thread-4 (]: SQL status: COMMIT in 0.005 seconds
[0m18:04:28.185189 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:28.189172 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:28.197227 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:04:28.200132 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:04:28.203800 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:04:28.211275 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:28.218994 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:04:28.221372 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.007 seconds
[0m18:04:28.222913 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:04:28.227654 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:04:28.228083 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:28.230777 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:04:28.233375 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39afaa390>]}
[0m18:04:28.236205 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:04:28.238745 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3945b0fd0>]}
[0m18:04:28.240738 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.26s]
[0m18:04:28.244564 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39451ba90>]}
[0m18:04:28.246255 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.27s]
[0m18:04:28.248436 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:04:28.252092 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.27s]
[0m18:04:28.253764 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:04:28.257523 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:04:28.259160 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:04:28.262288 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:04:28.264012 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:04:28.266794 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:04:28.267683 [info ] [Thread-2 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:04:28.269603 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_monthly)
[0m18:04:28.271712 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:04:28.274570 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m18:04:28.277031 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:04:28.279687 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m18:04:28.281395 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:04:28.286477 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.288130 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:04:28.292900 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.303896 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.313367 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:04:28.317817 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.318529 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:04:28.320262 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:04:28.325023 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.329131 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.336296 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.338651 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:04:28.340021 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.340483 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:28.341774 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:04:28.345468 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.348091 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:04:28.349663 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:04:28.352373 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m18:04:28.353142 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:04:28.355684 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.358526 [debug] [Thread-2 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:28.359253 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:04:28.360820 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.364203 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:28.365342 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:04:28.366085 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.004 seconds
[0m18:04:28.367365 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.374061 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.374481 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.006 seconds
[0m18:04:28.375411 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:04:28.376891 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:04:28.380840 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.383760 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.384061 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:04:28.388236 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.388695 [debug] [Thread-3 (]: SQL status: SELECT 704 in 0.006 seconds
[0m18:04:28.390497 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.390798 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:04:28.394304 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.398285 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.400407 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.401072 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:04:28.402525 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:04:28.404521 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:28.406615 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.407517 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:04:28.407966 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.411543 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.413166 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:28.414755 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:28.415984 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:04:28.416969 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.420426 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:28.420836 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:28.422896 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:28.424706 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.425816 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:28.427348 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m18:04:28.432294 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:04:28.432878 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m18:04:28.433241 [debug] [Thread-2 (]: SQL status: COMMIT in 0.009 seconds
[0m18:04:28.434438 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:28.437534 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:04:28.441542 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:04:28.442841 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:04:28.445105 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:28.447148 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:28.450735 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:04:28.452456 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:04:28.454728 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:28.458376 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:04:28.459402 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:04:28.460812 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3944b7790>]}
[0m18:04:28.462972 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:04:28.463364 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.009 seconds
[0m18:04:28.464493 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.19s]
[0m18:04:28.465811 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3944d2550>]}
[0m18:04:28.468360 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:04:28.469598 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:04:28.471322 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.19s]
[0m18:04:28.473576 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73574422-1aa5-411a-a800-f24673275761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a3944d2150>]}
[0m18:04:28.476322 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:04:28.478645 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.20s]
[0m18:04:28.481652 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:04:28.485647 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:28.486960 [debug] [MainThread]: On master: BEGIN
[0m18:04:28.488089 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:04:28.497485 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m18:04:28.498658 [debug] [MainThread]: On master: COMMIT
[0m18:04:28.500054 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:28.501703 [debug] [MainThread]: On master: COMMIT
[0m18:04:28.503964 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:28.506304 [debug] [MainThread]: On master: Close
[0m18:04:28.509159 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:04:28.511198 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:04:28.512264 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:04:28.513084 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:04:28.514269 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:04:28.515293 [info ] [MainThread]: 
[0m18:04:28.516324 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.07 seconds (1.07s).
[0m18:04:28.519001 [debug] [MainThread]: Command end result
[0m18:04:28.654435 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:28.672137 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:28.703011 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:04:28.706855 [info ] [MainThread]: 
[0m18:04:28.711314 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:04:28.713883 [info ] [MainThread]: 
[0m18:04:28.715629 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:04:28.718721 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.7075634, "process_in_blocks": "0", "process_kernel_time": 0.813964, "process_mem_max_rss": "131124", "process_out_blocks": "0", "process_user_time": 2.370196}
[0m18:04:28.723209 [debug] [MainThread]: Command `dbt run` succeeded at 18:04:28.723012 after 4.71 seconds
[0m18:04:28.729115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39f3f7910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39f1aecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a39f1aeb90>]}
[0m18:04:28.731938 [debug] [MainThread]: Flushing usage events
[0m18:04:29.507458 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:04:33.186831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f7946f3e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f7946fe310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f794b07410>]}


============================== 18:04:33.199338 | a8f7e056-5cc2-492e-9047-4227633ea6b2 ==============================
[0m18:04:33.199338 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:04:33.202099 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'fail_fast': 'False', 'empty': 'False', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'quiet': 'False', 'log_format': 'default', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'write_json': 'True', 'introspect': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'static_parser': 'True', 'printer_width': '80', 'use_colors': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'log_path': '/usr/app/dbt/dbt/logs'}
[0m18:04:33.408381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f794a24550>]}
[0m18:04:33.460860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f7946fe990>]}
[0m18:04:33.465196 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:04:33.605872 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:04:35.772200 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:04:35.773371 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:04:35.814726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f793570a90>]}
[0m18:04:35.999144 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:36.006931 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:36.191680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f793c9f550>]}
[0m18:04:36.194349 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:04:36.196036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f792d500d0>]}
[0m18:04:36.203621 [info ] [MainThread]: 
[0m18:04:36.205979 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:36.207466 [info ] [MainThread]: 
[0m18:04:36.209087 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:04:36.215812 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:04:36.369227 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:04:36.371167 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:04:36.372782 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:36.388312 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m18:04:36.390834 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:04:36.394164 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:04:36.400965 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:36.402067 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:04:36.403282 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:36.412771 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m18:04:36.414059 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:36.415085 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:04:36.422350 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.006 seconds
[0m18:04:36.425535 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:04:36.426899 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:04:36.433916 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:36.435088 [debug] [MainThread]: On master: BEGIN
[0m18:04:36.436057 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:04:36.447352 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m18:04:36.448636 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:36.449706 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:04:36.456930 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m18:04:36.459707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f794dce3d0>]}
[0m18:04:36.460878 [debug] [MainThread]: On master: ROLLBACK
[0m18:04:36.462012 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:36.463223 [debug] [MainThread]: On master: BEGIN
[0m18:04:36.464541 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:04:36.465689 [debug] [MainThread]: On master: COMMIT
[0m18:04:36.466626 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:36.467549 [debug] [MainThread]: On master: COMMIT
[0m18:04:36.468676 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:36.469645 [debug] [MainThread]: On master: Close
[0m18:04:36.476661 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:04:36.482261 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:04:36.483619 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:04:36.484655 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:04:36.504337 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.573659 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:04:36.608755 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.627002 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.628569 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:04:36.630010 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:36.640118 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:36.641401 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.642576 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:04:36.649863 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m18:04:36.659436 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.661437 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:04:36.665280 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:04:36.671399 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.673184 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:04:36.675949 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.690648 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:36.692750 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.696359 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:36.705294 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m18:04:36.712470 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:04:36.718432 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:36.722509 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:04:36.728634 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m18:04:36.733197 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:04:36.736074 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f79297f810>]}
[0m18:04:36.739913 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.25s]
[0m18:04:36.741729 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:04:36.743971 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:04:36.744407 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:04:36.744815 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:04:36.755613 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:04:36.762449 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:04:36.767252 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:04:36.769537 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:04:36.771707 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:04:36.774360 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:04:36.776233 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:04:36.784047 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:04:36.785450 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:04:36.790630 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:04:36.794752 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.798625 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.808823 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:04:36.809254 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:04:36.815532 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:04:36.828222 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:04:36.837520 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.841606 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.858041 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.860926 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:36.862826 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:04:36.864392 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:04:36.864966 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.865914 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:04:36.867202 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:04:36.868993 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:04:36.873045 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:04:36.878459 [debug] [Thread-2 (]: SQL status: BEGIN in 0.013 seconds
[0m18:04:36.879905 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m18:04:36.881393 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.882848 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:36.884318 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:36.884734 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:04:36.885808 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:04:36.886968 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.901501 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.013 seconds
[0m18:04:36.921101 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:04:36.922398 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m18:04:36.929895 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.939325 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:36.940525 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:04:36.941771 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:04:36.943835 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.944299 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.947401 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.947724 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.015 seconds
[0m18:04:36.952398 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:36.953433 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:04:36.956786 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.957709 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:04:36.959079 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:04:36.959349 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.960797 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.961154 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.962571 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:36.964139 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:36.969915 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.970970 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.971870 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:36.972780 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:04:36.973693 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:36.974603 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:36.976076 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:36.978257 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:36.979685 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:36.981929 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:36.986157 [debug] [Thread-2 (]: SQL status: COMMIT in 0.010 seconds
[0m18:04:36.989857 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:04:36.990273 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m18:04:36.990600 [debug] [Thread-3 (]: SQL status: COMMIT in 0.014 seconds
[0m18:04:36.993845 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:36.996358 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:04:36.999886 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:04:37.001580 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:04:37.002792 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:37.003945 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:37.005567 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:04:37.006496 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:04:37.009574 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:37.011289 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:04:37.012414 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f79473b8d0>]}
[0m18:04:37.013582 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.24s]
[0m18:04:37.020010 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:04:37.022369 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.015 seconds
[0m18:04:37.026680 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.019 seconds
[0m18:04:37.044216 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:04:37.050645 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:04:37.049564 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:04:37.047625 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:04:37.051956 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_monthly)
[0m18:04:37.054345 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f7915dfe10>]}
[0m18:04:37.056205 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f790231090>]}
[0m18:04:37.057788 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:04:37.059722 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.28s]
[0m18:04:37.061343 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.28s]
[0m18:04:37.067081 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.076343 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:04:37.082458 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:04:37.097983 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:04:37.100848 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:04:37.104403 [info ] [Thread-2 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:04:37.107286 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:04:37.110288 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m18:04:37.117156 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_hourly)
[0m18:04:37.119090 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:04:37.120408 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:04:37.126113 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.126488 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:04:37.130445 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.138347 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.149149 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:04:37.150397 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:04:37.154990 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.161566 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.162006 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.165217 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:04:37.166638 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:37.171298 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.172662 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:04:37.175291 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.175741 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:04:37.177509 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:37.179002 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:04:37.182376 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.183971 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:04:37.185599 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:04:37.188222 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m18:04:37.191835 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.193258 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.004 seconds
[0m18:04:37.193589 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:04:37.195244 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:37.199977 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.201615 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.202556 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:04:37.203539 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:04:37.204134 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.003 seconds
[0m18:04:37.204990 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:37.208242 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.208664 [debug] [Thread-3 (]: SQL status: SELECT 704 in 0.004 seconds
[0m18:04:37.211764 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.212880 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:04:37.216312 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.217185 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:04:37.218617 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:37.218942 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:04:37.223287 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.223596 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m18:04:37.226044 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:04:37.226415 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:37.227985 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:37.229697 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:37.233325 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.234546 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.237546 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:37.238478 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:04:37.239433 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:37.240499 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.241865 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:37.243043 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:37.244868 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:37.245980 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m18:04:37.246543 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.249324 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:04:37.250496 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:37.251806 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:37.253266 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:04:37.257319 [debug] [Thread-2 (]: SQL status: COMMIT in 0.012 seconds
[0m18:04:37.260442 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:04:37.261779 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:37.262705 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:04:37.268897 [debug] [Thread-3 (]: SQL status: COMMIT in 0.016 seconds
[0m18:04:37.269244 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.015 seconds
[0m18:04:37.273288 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:04:37.275202 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:04:37.276302 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:37.277563 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f7902c6190>]}
[0m18:04:37.278467 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:04:37.279938 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.23s]
[0m18:04:37.280509 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.017 seconds
[0m18:04:37.282504 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:04:37.284628 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:04:37.285912 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:04:37.287188 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f790117090>]}
[0m18:04:37.288645 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:04:37.289835 [info ] [Thread-2 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.18s]
[0m18:04:37.296414 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f7e056-5cc2-492e-9047-4227633ea6b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f790117b90>]}
[0m18:04:37.301625 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:04:37.303103 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.18s]
[0m18:04:37.305150 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:04:37.308382 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:37.309571 [debug] [MainThread]: On master: BEGIN
[0m18:04:37.310799 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:04:37.321236 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m18:04:37.326536 [debug] [MainThread]: On master: COMMIT
[0m18:04:37.328500 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:37.330988 [debug] [MainThread]: On master: COMMIT
[0m18:04:37.332719 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:37.348076 [debug] [MainThread]: On master: Close
[0m18:04:37.351276 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:04:37.352794 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:04:37.354281 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:04:37.355511 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:04:37.357651 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:04:37.359098 [info ] [MainThread]: 
[0m18:04:37.361113 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.15 seconds (1.15s).
[0m18:04:37.364100 [debug] [MainThread]: Command end result
[0m18:04:37.439710 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:37.448360 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:37.494473 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:04:37.500046 [info ] [MainThread]: 
[0m18:04:37.508684 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:04:37.511539 [info ] [MainThread]: 
[0m18:04:37.514464 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:04:37.518449 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.4973617, "process_in_blocks": "0", "process_kernel_time": 0.892743, "process_mem_max_rss": "131428", "process_out_blocks": "0", "process_user_time": 2.398476}
[0m18:04:37.520952 [debug] [MainThread]: Command `dbt run` succeeded at 18:04:37.520747 after 4.50 seconds
[0m18:04:37.523950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f798f7f8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f798f9ab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f798f9a9d0>]}
[0m18:04:37.526251 [debug] [MainThread]: Flushing usage events
[0m18:04:38.228703 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:04:42.448096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6686dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6686fa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6686e350>]}


============================== 18:04:42.459081 | 544ca202-1690-42d5-a0fa-5fe062709a6d ==============================
[0m18:04:42.459081 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:04:42.471414 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'empty': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'printer_width': '80', 'write_json': 'True', 'invocation_command': 'dbt run', 'use_colors': 'True', 'fail_fast': 'False', 'quiet': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'partial_parse': 'True', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'static_parser': 'True', 'no_print': 'None', 'introspect': 'True', 'target_path': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'log_cache_events': 'False'}
[0m18:04:42.658511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac65566110>]}
[0m18:04:42.710819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac69598ad0>]}
[0m18:04:42.712967 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:04:42.824396 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:04:44.948519 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:04:44.950410 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:04:44.987320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac64d67d10>]}
[0m18:04:45.105748 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:45.113535 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:45.278863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac65911490>]}
[0m18:04:45.286730 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:04:45.292351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac645dcd90>]}
[0m18:04:45.301140 [info ] [MainThread]: 
[0m18:04:45.305600 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:45.310663 [info ] [MainThread]: 
[0m18:04:45.316386 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:04:45.329761 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:04:45.442345 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:04:45.444441 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:04:45.446817 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:45.461109 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.014 seconds
[0m18:04:45.466581 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:04:45.471836 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:04:45.478795 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:45.480161 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:04:45.481499 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:45.490923 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m18:04:45.492652 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:45.494144 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:04:45.502961 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.007 seconds
[0m18:04:45.506373 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:04:45.508107 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:04:45.514646 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:45.516460 [debug] [MainThread]: On master: BEGIN
[0m18:04:45.518609 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:04:45.529817 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m18:04:45.534009 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:45.536155 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:04:45.546280 [debug] [MainThread]: SQL status: SELECT 1 in 0.009 seconds
[0m18:04:45.549172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6684e650>]}
[0m18:04:45.550525 [debug] [MainThread]: On master: ROLLBACK
[0m18:04:45.554394 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:45.555652 [debug] [MainThread]: On master: BEGIN
[0m18:04:45.557462 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:04:45.558696 [debug] [MainThread]: On master: COMMIT
[0m18:04:45.559738 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:45.560993 [debug] [MainThread]: On master: COMMIT
[0m18:04:45.562223 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:45.563421 [debug] [MainThread]: On master: Close
[0m18:04:45.575094 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:04:45.578975 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:04:45.581299 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:04:45.585642 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:04:45.605609 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.630939 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:04:45.655008 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.668370 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.671027 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:04:45.672942 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:45.684831 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m18:04:45.687515 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.690501 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:04:45.699889 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m18:04:45.707879 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.709193 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:04:45.711650 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:45.716359 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.718009 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:04:45.721372 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:04:45.737785 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:45.739636 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.741019 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:45.755587 [debug] [Thread-1 (]: SQL status: COMMIT in 0.013 seconds
[0m18:04:45.763384 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:04:45.768766 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:45.770897 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:04:45.777001 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m18:04:45.780822 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:04:45.785211 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6553e850>]}
[0m18:04:45.787570 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.20s]
[0m18:04:45.789362 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:04:45.791837 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:04:45.792370 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:04:45.792671 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:04:45.793604 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:04:45.794788 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:04:45.795748 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:04:45.796741 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:04:45.797665 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:04:45.798735 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:04:45.799899 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:04:45.801055 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:04:45.801917 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:04:45.806295 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:04:45.810547 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:45.813451 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:45.821936 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:04:45.822473 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:04:45.828865 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:04:45.845578 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:45.852027 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:45.857334 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:04:45.871020 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:45.872391 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:45.873299 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:04:45.874075 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:45.874944 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:04:45.876207 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:04:45.877757 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:04:45.878775 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:04:45.880842 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:04:45.888487 [debug] [Thread-4 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:45.889750 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:45.890500 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:04:45.891658 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:04:45.892663 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:45.893353 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:04:46.220696 [debug] [Thread-2 (]: SQL status: BEGIN in 0.344 seconds
[0m18:04:46.224496 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:46.226245 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:04:46.527427 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.633 seconds
[0m18:04:46.534375 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.305 seconds
[0m18:04:46.534980 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.643 seconds
[0m18:04:46.545127 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:46.552382 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:46.558147 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:46.560409 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:04:46.562314 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:04:46.564024 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:04:46.565543 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:46.565840 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:46.567015 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:04:46.569428 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:46.572457 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:46.575172 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:46.576074 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:04:46.576870 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:04:46.577764 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:04:46.579682 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:46.580471 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:46.581101 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:04:46.582120 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:46.583510 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:46.584839 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:46.585605 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:46.586751 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:46.587879 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:46.588966 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:46.592636 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:46.593759 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:46.733982 [debug] [Thread-3 (]: SQL status: COMMIT in 0.139 seconds
[0m18:04:46.742283 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:04:46.743049 [debug] [Thread-4 (]: SQL status: COMMIT in 0.147 seconds
[0m18:04:46.743599 [debug] [Thread-2 (]: SQL status: COMMIT in 0.148 seconds
[0m18:04:46.748782 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:46.752662 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:04:46.758177 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:04:46.759905 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:04:46.762181 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:46.764144 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:46.770296 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:04:46.771607 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:04:46.840776 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.075 seconds
[0m18:04:46.844255 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.069 seconds
[0m18:04:46.844774 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.071 seconds
[0m18:04:46.860025 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:04:46.876465 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:04:46.884669 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:04:46.887010 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6553e850>]}
[0m18:04:46.888818 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac636f7a90>]}
[0m18:04:46.890785 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac66875d50>]}
[0m18:04:46.892842 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 1.09s]
[0m18:04:46.895028 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 1.09s]
[0m18:04:46.896633 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 1.09s]
[0m18:04:46.898451 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:04:46.900204 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:04:46.901998 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:04:46.903957 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:04:46.905443 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:04:46.906852 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:04:46.907963 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:04:46.909249 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:04:46.910638 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:04:46.911780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m18:04:46.912844 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:04:46.914009 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m18:04:46.915156 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:04:46.916145 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:04:46.917155 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:04:46.920412 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:46.925075 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:46.929665 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:46.936622 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:04:46.937108 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:04:46.942148 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:46.942772 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:04:46.954306 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:46.963121 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.071936 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.072704 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.074768 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:04:47.082251 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.085661 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:04:47.099872 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:47.104227 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:04:47.110814 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:04:47.125589 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:04:47.157013 [debug] [Thread-1 (]: SQL status: BEGIN in 0.057 seconds
[0m18:04:47.165782 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.169303 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:04:47.170528 [debug] [Thread-2 (]: SQL status: BEGIN in 0.060 seconds
[0m18:04:47.170967 [debug] [Thread-3 (]: SQL status: BEGIN in 0.045 seconds
[0m18:04:47.175442 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.177153 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.178820 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.006 seconds
[0m18:04:47.179216 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:04:47.188059 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:04:47.192627 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.197647 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:04:47.199691 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.223799 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.228398 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:04:47.238858 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.244509 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:47.247553 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.263147 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:47.350688 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.156 seconds
[0m18:04:47.352522 [debug] [Thread-2 (]: SQL status: SELECT 704 in 0.158 seconds
[0m18:04:47.359611 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.370237 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.374090 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:04:47.376685 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:04:47.379769 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.381093 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.385743 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.391208 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.392884 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:04:47.394339 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:04:47.396495 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.398194 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:47.400131 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:47.403410 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:47.405236 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.407040 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.408478 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:04:47.409866 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:04:47.450421 [debug] [Thread-1 (]: SQL status: COMMIT in 0.172 seconds
[0m18:04:47.457372 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:04:47.459867 [debug] [Thread-2 (]: SQL status: COMMIT in 0.048 seconds
[0m18:04:47.460529 [debug] [Thread-3 (]: SQL status: COMMIT in 0.049 seconds
[0m18:04:47.464860 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:47.473228 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:04:47.479494 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:04:47.483950 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:04:47.486964 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:47.488837 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:47.493638 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:04:47.498498 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:04:47.670160 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.179 seconds
[0m18:04:47.671733 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.165 seconds
[0m18:04:47.672260 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.170 seconds
[0m18:04:47.686876 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:04:47.690974 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:04:47.695938 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:04:47.698901 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac603c0b50>]}
[0m18:04:47.701136 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac603d6310>]}
[0m18:04:47.703719 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '544ca202-1690-42d5-a0fa-5fe062709a6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac603e0050>]}
[0m18:04:47.705773 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.79s]
[0m18:04:47.708015 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.79s]
[0m18:04:47.709836 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.79s]
[0m18:04:47.711259 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:04:47.712509 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:04:47.713542 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:04:47.718754 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:47.719814 [debug] [MainThread]: On master: BEGIN
[0m18:04:47.721008 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:04:47.729439 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m18:04:47.730642 [debug] [MainThread]: On master: COMMIT
[0m18:04:47.732009 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:47.733092 [debug] [MainThread]: On master: COMMIT
[0m18:04:47.734156 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:47.735813 [debug] [MainThread]: On master: Close
[0m18:04:47.737137 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:04:47.738178 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:04:47.739325 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:04:47.740748 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:04:47.741987 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:04:47.743186 [info ] [MainThread]: 
[0m18:04:47.744207 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 2.43 seconds (2.43s).
[0m18:04:47.746579 [debug] [MainThread]: Command end result
[0m18:04:47.817491 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:47.824747 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:47.836340 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:04:47.837245 [info ] [MainThread]: 
[0m18:04:47.838360 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:04:47.839238 [info ] [MainThread]: 
[0m18:04:47.840244 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:04:47.888347 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.5555024, "process_in_blocks": "0", "process_kernel_time": 0.945867, "process_mem_max_rss": "131428", "process_out_blocks": "0", "process_user_time": 2.847611}
[0m18:04:47.892695 [debug] [MainThread]: Command `dbt run` succeeded at 18:04:47.892283 after 5.56 seconds
[0m18:04:47.901687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6b127890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6b142950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ac6b143610>]}
[0m18:04:47.907714 [debug] [MainThread]: Flushing usage events
[0m18:04:48.785163 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:04:55.650777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bde05a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bde66450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bde205d0>]}


============================== 18:04:55.657562 | 48b1ac31-cb25-4f70-97f5-36f756604408 ==============================
[0m18:04:55.657562 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:04:55.659491 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'debug': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'use_colors': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'indirect_selection': 'eager', 'log_format': 'default', 'no_print': 'None', 'version_check': 'True', 'log_cache_events': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'static_parser': 'True', 'invocation_command': 'dbt run', 'quiet': 'False', 'empty': 'False', 'log_path': '/usr/app/dbt/dbt/logs'}
[0m18:04:55.830816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bcffe250>]}
[0m18:04:55.885596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9c0b76690>]}
[0m18:04:55.888478 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:04:56.085668 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:04:58.388794 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:04:58.396164 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:04:58.439051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bc38ae50>]}
[0m18:04:58.628274 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:04:58.638926 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:04:58.781983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bcb0d710>]}
[0m18:04:58.784229 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:04:58.785746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bdfa4090>]}
[0m18:04:58.791776 [info ] [MainThread]: 
[0m18:04:58.794234 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:58.796759 [info ] [MainThread]: 
[0m18:04:58.803890 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:04:58.812342 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:04:58.876549 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:04:58.879259 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:04:58.880782 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:58.898212 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m18:04:58.901963 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:04:58.907223 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:04:58.914504 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:58.915635 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:04:58.916958 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:04:58.926845 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m18:04:58.928214 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:04:58.929283 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:04:58.935859 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.005 seconds
[0m18:04:58.938860 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:04:58.941712 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:04:58.949410 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:58.950475 [debug] [MainThread]: On master: BEGIN
[0m18:04:58.951398 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:04:58.960642 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m18:04:58.962209 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:58.963672 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:04:58.974413 [debug] [MainThread]: SQL status: SELECT 1 in 0.009 seconds
[0m18:04:58.977428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9be4f2750>]}
[0m18:04:58.979079 [debug] [MainThread]: On master: ROLLBACK
[0m18:04:58.980668 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:58.981802 [debug] [MainThread]: On master: BEGIN
[0m18:04:58.983444 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m18:04:58.984763 [debug] [MainThread]: On master: COMMIT
[0m18:04:58.986313 [debug] [MainThread]: Using postgres connection "master"
[0m18:04:58.987897 [debug] [MainThread]: On master: COMMIT
[0m18:04:58.989446 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:04:58.990479 [debug] [MainThread]: On master: Close
[0m18:04:59.009519 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:04:59.011054 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:04:59.013089 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:04:59.014159 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:04:59.032469 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.044678 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:04:59.071401 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.082412 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.084591 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:04:59.085755 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:59.096300 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m18:04:59.097819 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.099269 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:04:59.108067 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m18:04:59.115161 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.116251 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:04:59.118492 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.122685 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.147039 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:04:59.152357 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.169655 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:59.175432 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.186167 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:04:59.195569 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m18:04:59.206490 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:04:59.215896 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:04:59.224730 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:04:59.238362 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.008 seconds
[0m18:04:59.250242 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:04:59.254903 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bde5b250>]}
[0m18:04:59.258505 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.24s]
[0m18:04:59.261348 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:04:59.264784 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:04:59.265432 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:04:59.266091 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:04:59.268229 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:04:59.270650 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:04:59.274443 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:04:59.276816 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:04:59.279053 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:04:59.281488 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:04:59.291467 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:04:59.298106 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:04:59.305803 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:04:59.317434 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:04:59.329968 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.347013 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.409490 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:04:59.413758 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:04:59.443215 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.443826 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:04:59.454421 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:04:59.477713 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.498240 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.499129 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.505210 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:04:59.507317 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.508378 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:04:59.524526 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:04:59.526554 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:04:59.528160 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:04:59.530617 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:04:59.537281 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m18:04:59.540271 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.542457 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:04:59.543365 [debug] [Thread-3 (]: SQL status: BEGIN in 0.015 seconds
[0m18:04:59.545726 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.547089 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:04:59.561322 [debug] [Thread-2 (]: SQL status: BEGIN in 0.030 seconds
[0m18:04:59.561900 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.013 seconds
[0m18:04:59.562189 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.018 seconds
[0m18:04:59.563507 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.570266 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.575981 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.590058 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:04:59.591615 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:04:59.593031 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:04:59.596180 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.597961 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.602588 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.608194 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.610366 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:04:59.614501 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:04:59.617299 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.618926 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.621966 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:59.622608 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.028 seconds
[0m18:04:59.627998 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:59.630265 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.636392 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.642740 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.645019 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:04:59.647231 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:04:59.649219 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:04:59.652735 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.658791 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.660742 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:04:59.662607 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.665086 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:59.666298 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.667637 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:04:59.668120 [debug] [Thread-3 (]: SQL status: COMMIT in 0.017 seconds
[0m18:04:59.669319 [debug] [Thread-4 (]: SQL status: COMMIT in 0.015 seconds
[0m18:04:59.672848 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:04:59.677219 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:04:59.682207 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:04:59.682594 [debug] [Thread-2 (]: SQL status: COMMIT in 0.013 seconds
[0m18:04:59.684382 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:04:59.686123 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:04:59.692148 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:04:59.693982 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:04:59.696990 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:04:59.698993 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:04:59.715343 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.020 seconds
[0m18:04:59.719353 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:04:59.721154 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9bcb0e150>]}
[0m18:04:59.723378 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.44s]
[0m18:04:59.725064 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:04:59.726993 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:04:59.729378 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.029 seconds
[0m18:04:59.728855 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:04:59.730076 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.032 seconds
[0m18:04:59.732710 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:04:59.740930 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m18:04:59.753245 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:04:59.765044 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9b82dfe10>]}
[0m18:04:59.773542 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:04:59.782079 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9b82e45d0>]}
[0m18:04:59.788972 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.48s]
[0m18:04:59.795807 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.797718 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.50s]
[0m18:04:59.799507 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:04:59.802105 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:04:59.803798 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:04:59.805190 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:04:59.806579 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:04:59.808262 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:04:59.813775 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:04:59.817952 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m18:04:59.821016 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:04:59.824949 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:04:59.826546 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:04:59.830723 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.833689 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:59.836461 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:59.849794 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:04:59.858790 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:04:59.859147 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:04:59.867126 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.874342 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:04:59.877137 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:04:59.891690 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:59.893420 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:04:59.902937 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:04:59.907685 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:04:59.916353 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m18:04:59.918730 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.921176 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m18:04:59.924144 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:59.924795 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:04:59.926200 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:04:59.927498 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:04:59.932299 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.003 seconds
[0m18:04:59.933581 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:04:59.934887 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:04:59.941096 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.946723 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:04:59.948460 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.951206 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.953147 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:04:59.954067 [debug] [Thread-2 (]: SQL status: BEGIN in 0.019 seconds
[0m18:04:59.955159 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:04:59.956251 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:04:59.958382 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:04:59.960407 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:04:59.959474 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:04:59.961771 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.020 seconds
[0m18:04:59.977139 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:05:00.009929 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:00.013862 [debug] [Thread-2 (]: SQL status: SELECT 704 in 0.012 seconds
[0m18:05:00.029767 [debug] [Thread-1 (]: SQL status: COMMIT in 0.011 seconds
[0m18:05:00.031585 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:05:00.040345 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:00.044302 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:05:00.047377 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:00.048686 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:05:00.051613 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:00.057075 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:00.060259 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:00.061412 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:05:00.063540 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:05:00.068321 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:00.072685 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:00.073292 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:05:00.074865 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:05:00.076445 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:00.078996 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:00.081332 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:05:00.083004 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:00.087270 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:00.092147 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9b82e5d90>]}
[0m18:05:00.095822 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:00.097905 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:00.100139 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.35s]
[0m18:05:00.110379 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m18:05:00.111797 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:00.113982 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:05:00.118940 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:05:00.140002 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:00.140734 [debug] [Thread-2 (]: SQL status: COMMIT in 0.012 seconds
[0m18:05:00.142825 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:05:00.162146 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:05:00.176349 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:05:00.189131 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:00.194139 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:05:00.198262 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:05:00.202909 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9b81c8fd0>]}
[0m18:05:00.207492 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.39s]
[0m18:05:00.210866 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:05:00.216553 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:05:00.219785 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:05:00.224668 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48b1ac31-cb25-4f70-97f5-36f756604408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9b81a5950>]}
[0m18:05:00.226807 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.41s]
[0m18:05:00.228925 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:05:00.233215 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:00.235112 [debug] [MainThread]: On master: BEGIN
[0m18:05:00.236568 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:05:00.249959 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m18:05:00.251730 [debug] [MainThread]: On master: COMMIT
[0m18:05:00.253337 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:00.255257 [debug] [MainThread]: On master: COMMIT
[0m18:05:00.262308 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:05:00.267816 [debug] [MainThread]: On master: Close
[0m18:05:00.272091 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:05:00.273831 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:05:00.275662 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:05:00.277564 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:05:00.279366 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:05:00.281348 [info ] [MainThread]: 
[0m18:05:00.283249 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 1.48 seconds (1.48s).
[0m18:05:00.286611 [debug] [MainThread]: Command end result
[0m18:05:00.430869 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:05:00.454139 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:05:00.482218 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:05:00.484685 [info ] [MainThread]: 
[0m18:05:00.488014 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:05:00.490575 [info ] [MainThread]: 
[0m18:05:00.492509 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:05:00.495754 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.8838515, "process_in_blocks": "0", "process_kernel_time": 0.751838, "process_mem_max_rss": "131472", "process_out_blocks": "0", "process_user_time": 2.46799}
[0m18:05:00.498194 [debug] [MainThread]: Command `dbt run` succeeded at 18:05:00.497983 after 4.89 seconds
[0m18:05:00.500339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9be160b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9c270f810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd9c272aa50>]}
[0m18:05:00.502577 [debug] [MainThread]: Flushing usage events
[0m18:05:01.378943 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:05:10.308677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e9223fc9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e9223e3f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e92243e610>]}


============================== 18:05:10.321013 | 981c36fe-6752-4cf2-8f9d-6440b8da91f7 ==============================
[0m18:05:10.321013 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:05:10.325651 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'use_colors': 'True', 'invocation_command': 'dbt run', 'log_cache_events': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'empty': 'False', 'introspect': 'True', 'printer_width': '80', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'target_path': 'None'}
[0m18:05:10.581779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e92175d690>]}
[0m18:05:10.632788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e925140750>]}
[0m18:05:10.637563 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:05:10.789764 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:05:13.475059 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:05:13.476706 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:05:13.519856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e920f640d0>]}
[0m18:05:13.651841 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:05:13.664702 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:05:13.777536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e921736890>]}
[0m18:05:13.780288 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:05:13.782851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e920368150>]}
[0m18:05:13.788557 [info ] [MainThread]: 
[0m18:05:13.791445 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:05:13.793567 [info ] [MainThread]: 
[0m18:05:13.796360 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:05:13.803668 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:05:13.884793 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:05:13.886585 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:05:13.887727 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:05:13.907216 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.019 seconds
[0m18:05:13.910909 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:05:13.916132 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:05:13.925691 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:05:13.927278 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:05:13.928748 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:05:13.939650 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m18:05:13.941668 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:05:13.943412 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:05:13.952774 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.007 seconds
[0m18:05:13.956850 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:05:13.958761 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:05:13.969402 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:13.971026 [debug] [MainThread]: On master: BEGIN
[0m18:05:13.972761 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:05:13.988223 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m18:05:13.990298 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:13.992351 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:05:14.001344 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m18:05:14.004718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e9229a9c10>]}
[0m18:05:14.006393 [debug] [MainThread]: On master: ROLLBACK
[0m18:05:14.008355 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:14.009860 [debug] [MainThread]: On master: BEGIN
[0m18:05:14.011672 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:05:14.013425 [debug] [MainThread]: On master: COMMIT
[0m18:05:14.014596 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:14.015907 [debug] [MainThread]: On master: COMMIT
[0m18:05:14.017365 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:05:14.018866 [debug] [MainThread]: On master: Close
[0m18:05:14.029327 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:05:14.031463 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:05:14.033377 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:05:14.034859 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:05:14.056376 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.073032 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:05:14.114683 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.130295 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.131659 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:05:14.133243 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:14.142500 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m18:05:14.144211 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.145671 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:05:14.153443 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m18:05:14.160527 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.162116 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:05:14.164632 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.168331 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.169520 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:05:14.171518 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.186999 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:05:14.188746 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.189747 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:05:14.201302 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m18:05:14.208479 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:05:14.213951 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:14.215870 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:05:14.220686 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m18:05:14.223431 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:05:14.227184 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e91f112590>]}
[0m18:05:14.228952 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.19s]
[0m18:05:14.230146 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:05:14.231982 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:05:14.232307 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:05:14.232587 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:05:14.233761 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:05:14.235023 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:05:14.236138 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:05:14.237358 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:05:14.238433 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:05:14.239817 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:05:14.241312 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:05:14.242570 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:05:14.243644 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:05:14.248898 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:05:14.253219 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.256805 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.266363 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:05:14.266915 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:05:14.273756 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:05:14.286903 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:05:14.290540 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.293808 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.302613 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.303111 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.304556 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:05:14.305599 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.305992 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:05:14.307465 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:05:14.308923 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:05:14.310645 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:05:14.313277 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:05:14.324245 [debug] [Thread-4 (]: SQL status: BEGIN in 0.011 seconds
[0m18:05:14.326013 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.327653 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:05:14.328472 [debug] [Thread-3 (]: SQL status: BEGIN in 0.018 seconds
[0m18:05:14.330460 [debug] [Thread-2 (]: SQL status: BEGIN in 0.023 seconds
[0m18:05:14.330986 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.332532 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.334033 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:05:14.335469 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:05:14.339705 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.010 seconds
[0m18:05:14.346530 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.348044 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:05:14.349754 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.353763 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.354923 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:05:14.355356 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.018 seconds
[0m18:05:14.356957 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.019 seconds
[0m18:05:14.357375 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.360530 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.364429 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.366467 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:05:14.367568 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:05:14.368533 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:05:14.369496 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.371151 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.371987 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.372246 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:05:14.375365 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.379091 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.381294 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:05:14.382495 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:05:14.385702 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.386955 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.388537 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:05:14.390858 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:05:14.392317 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.394049 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.395254 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:05:14.395763 [debug] [Thread-4 (]: SQL status: COMMIT in 0.015 seconds
[0m18:05:14.396615 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:05:14.401534 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:05:14.408353 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:14.409019 [debug] [Thread-3 (]: SQL status: COMMIT in 0.011 seconds
[0m18:05:14.410700 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:05:14.415379 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:05:14.417202 [debug] [Thread-2 (]: SQL status: COMMIT in 0.014 seconds
[0m18:05:14.419367 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:14.425663 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:05:14.427787 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:05:14.430031 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:14.432758 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:05:14.448131 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.030 seconds
[0m18:05:14.450106 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.016 seconds
[0m18:05:14.450680 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.019 seconds
[0m18:05:14.452983 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:05:14.456486 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:05:14.459274 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:05:14.461688 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e8ffe00b50>]}
[0m18:05:14.463316 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e8ffe22190>]}
[0m18:05:14.464641 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e9222ee010>]}
[0m18:05:14.465992 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.22s]
[0m18:05:14.467333 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.22s]
[0m18:05:14.469361 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.23s]
[0m18:05:14.470593 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:05:14.472148 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:05:14.473673 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:05:14.475657 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:05:14.476847 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:05:14.478466 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:05:14.479682 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:05:14.481025 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:05:14.482504 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:05:14.483541 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m18:05:14.484831 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_monthly)
[0m18:05:14.485691 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_daily)
[0m18:05:14.486538 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:05:14.488354 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:05:14.489483 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:05:14.492772 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.497394 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.500862 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.510718 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:05:14.511243 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:05:14.518036 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:05:14.520389 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.527522 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.532794 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.543270 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.544095 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.545654 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:05:14.546581 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.548124 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:05:14.549963 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:05:14.551919 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:05:14.553492 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:05:14.556562 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:14.566841 [debug] [Thread-4 (]: SQL status: BEGIN in 0.013 seconds
[0m18:05:14.567729 [debug] [Thread-2 (]: SQL status: BEGIN in 0.018 seconds
[0m18:05:14.568961 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.569789 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m18:05:14.570538 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.571699 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:05:14.573063 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.574376 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:05:14.577774 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:05:14.589883 [debug] [Thread-4 (]: SQL status: SELECT 44 in 0.014 seconds
[0m18:05:14.590687 [debug] [Thread-1 (]: SQL status: SELECT 704 in 0.010 seconds
[0m18:05:14.590996 [debug] [Thread-2 (]: SQL status: SELECT 132 in 0.011 seconds
[0m18:05:14.595399 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.599609 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.603534 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.604966 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:05:14.606356 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:05:14.607519 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:05:14.609555 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.620050 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.010 seconds
[0m18:05:14.621122 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.625205 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.630224 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.634216 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.635527 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:05:14.636957 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:05:14.638331 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:05:14.640216 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.641377 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:14.642665 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:05:14.644261 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:14.646014 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:14.647600 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:05:14.648576 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.649821 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.651175 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.652350 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:14.653630 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:14.654891 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:05:14.669193 [debug] [Thread-4 (]: SQL status: COMMIT in 0.013 seconds
[0m18:05:14.673582 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:05:14.675234 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:14.676161 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:05:14.679436 [debug] [Thread-2 (]: SQL status: COMMIT in 0.022 seconds
[0m18:05:14.679843 [debug] [Thread-1 (]: SQL status: COMMIT in 0.023 seconds
[0m18:05:14.682723 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:05:14.686937 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:05:14.688985 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:14.690764 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:14.691284 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.014 seconds
[0m18:05:14.692409 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:05:14.693556 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:05:14.696019 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:05:14.701052 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e8ffd01710>]}
[0m18:05:14.702794 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.22s]
[0m18:05:14.704099 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:05:14.709288 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.012 seconds
[0m18:05:14.712238 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:05:14.714560 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e8ffd02ed0>]}
[0m18:05:14.716771 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.23s]
[0m18:05:14.718314 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:05:14.720114 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.022 seconds
[0m18:05:14.722797 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:05:14.725001 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '981c36fe-6752-4cf2-8f9d-6440b8da91f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e8ffeed310>]}
[0m18:05:14.739404 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.24s]
[0m18:05:14.741037 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:05:14.744766 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:14.746284 [debug] [MainThread]: On master: BEGIN
[0m18:05:14.747510 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:05:14.757691 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m18:05:14.759043 [debug] [MainThread]: On master: COMMIT
[0m18:05:14.760540 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:14.761691 [debug] [MainThread]: On master: COMMIT
[0m18:05:14.762985 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:05:14.764195 [debug] [MainThread]: On master: Close
[0m18:05:14.765870 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:05:14.766972 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:05:14.767947 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_daily' was properly closed.
[0m18:05:14.769005 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:05:14.769983 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:05:14.771017 [info ] [MainThread]: 
[0m18:05:14.772066 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m18:05:14.774051 [debug] [MainThread]: Command end result
[0m18:05:14.891393 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:05:14.905367 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:05:14.932981 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:05:14.934773 [info ] [MainThread]: 
[0m18:05:14.936441 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:05:14.938048 [info ] [MainThread]: 
[0m18:05:14.939817 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:05:14.943481 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.745429, "process_in_blocks": "0", "process_kernel_time": 0.729069, "process_mem_max_rss": "131444", "process_out_blocks": "0", "process_user_time": 2.29491}
[0m18:05:14.947059 [debug] [MainThread]: Command `dbt run` succeeded at 18:05:14.946856 after 4.75 seconds
[0m18:05:14.949559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e926cc3890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e926cdeb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70e926cde9d0>]}
[0m18:05:14.951338 [debug] [MainThread]: Flushing usage events
[0m18:05:16.068214 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:05:31.361922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbda1a7750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd745a910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd7459fd0>]}


============================== 18:05:31.370418 | 83a18b06-aa6b-43ec-b6ac-f9428c4ed63d ==============================
[0m18:05:31.370418 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:05:31.375345 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'target_path': 'None', 'empty': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'warn_error': 'None', 'use_colors': 'True', 'introspect': 'True', 'printer_width': '80', 'invocation_command': 'dbt run', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'quiet': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'fail_fast': 'False'}
[0m18:05:31.576961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd65645d0>]}
[0m18:05:31.619022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbda1d28d0>]}
[0m18:05:31.621943 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:05:31.846608 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:05:34.280616 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:05:34.281771 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:05:34.319086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd5d08390>]}
[0m18:05:34.452763 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:05:34.477690 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:05:34.615338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd690cb50>]}
[0m18:05:34.617453 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:05:34.619596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd65c5590>]}
[0m18:05:34.624540 [info ] [MainThread]: 
[0m18:05:34.626449 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:05:34.628173 [info ] [MainThread]: 
[0m18:05:34.629851 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:05:34.637344 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:05:34.691865 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:05:34.695791 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:05:34.697686 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:05:34.714235 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m18:05:34.718070 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:05:34.723590 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:05:34.730378 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:05:34.733372 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:05:34.734814 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:05:34.745800 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m18:05:34.747309 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:05:34.748556 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:05:34.754124 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.004 seconds
[0m18:05:34.757189 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:05:34.758508 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:05:34.765072 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:34.766488 [debug] [MainThread]: On master: BEGIN
[0m18:05:34.768025 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:05:34.779532 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m18:05:34.780980 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:34.781867 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:05:34.788993 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m18:05:34.792053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd76c43d0>]}
[0m18:05:34.793809 [debug] [MainThread]: On master: ROLLBACK
[0m18:05:34.795829 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:34.798201 [debug] [MainThread]: On master: BEGIN
[0m18:05:34.801831 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:05:34.805751 [debug] [MainThread]: On master: COMMIT
[0m18:05:34.806824 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:34.807948 [debug] [MainThread]: On master: COMMIT
[0m18:05:34.809340 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:05:34.810446 [debug] [MainThread]: On master: Close
[0m18:05:34.819434 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:05:34.821549 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:05:34.824016 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:05:34.827260 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:05:34.844177 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.861949 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:05:34.885347 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.910594 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.912418 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:05:34.913985 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:34.924200 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m18:05:34.927219 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.929565 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:05:34.936498 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m18:05:34.944745 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.946482 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:05:34.949799 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:34.953524 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.954762 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:05:34.960238 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:34.976997 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:05:34.978814 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:34.979999 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:05:34.995995 [debug] [Thread-1 (]: SQL status: COMMIT in 0.014 seconds
[0m18:05:35.004780 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:05:35.012968 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:05:35.015401 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:05:35.026147 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.009 seconds
[0m18:05:35.031787 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:05:35.036179 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd4213350>]}
[0m18:05:35.038266 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.21s]
[0m18:05:35.041074 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:05:35.044299 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:05:35.044861 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:05:35.045537 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:05:35.047449 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:05:35.050012 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:05:35.051985 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:05:35.053842 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:05:35.056752 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:05:35.058328 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:05:35.059737 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:05:35.061481 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:05:35.065222 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:05:35.075323 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:05:35.082729 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.089705 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.113982 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:05:35.114901 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:05:35.124774 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:05:35.156716 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.157634 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:05:35.167842 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.179364 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.181185 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:05:35.181845 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.183184 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:05:35.183691 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.185460 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:05:35.189154 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:05:35.190894 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:05:35.192897 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:05:35.197737 [debug] [Thread-4 (]: SQL status: BEGIN in 0.014 seconds
[0m18:05:35.200245 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.202255 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:05:35.203294 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m18:05:35.203670 [debug] [Thread-3 (]: SQL status: BEGIN in 0.011 seconds
[0m18:05:35.205262 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.206722 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.207981 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:05:35.209168 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:05:35.214208 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.010 seconds
[0m18:05:35.222113 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.224143 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.013 seconds
[0m18:05:35.224568 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:05:35.229488 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.229858 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.017 seconds
[0m18:05:35.231565 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.232272 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:05:35.236648 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.240313 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.242551 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.242894 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:05:35.244394 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:05:35.248280 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.250777 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.252270 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.252984 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:05:35.257578 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.259927 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:05:35.262579 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:05:35.262970 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.264008 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.266025 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.267846 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:05:35.269437 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:05:35.271200 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:05:35.272219 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.274234 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.275928 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:05:35.278704 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:05:35.283614 [debug] [Thread-4 (]: SQL status: COMMIT in 0.010 seconds
[0m18:05:35.286855 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:05:35.287312 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m18:05:35.287666 [debug] [Thread-2 (]: SQL status: COMMIT in 0.008 seconds
[0m18:05:35.290663 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:05:35.293395 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:05:35.297018 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:05:35.298520 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:05:35.300146 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:05:35.301228 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:05:35.302968 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:05:35.303907 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:05:35.305358 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.003 seconds
[0m18:05:35.308200 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:05:35.309702 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd412ecd0>]}
[0m18:05:35.311580 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.25s]
[0m18:05:35.313255 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:05:35.314562 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:05:35.316045 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:05:35.317286 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.012 seconds
[0m18:05:35.317866 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_hourly)
[0m18:05:35.320771 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:05:35.321944 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:05:35.323069 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd438b990>]}
[0m18:05:35.326333 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.328640 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.27s]
[0m18:05:35.329352 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.023 seconds
[0m18:05:35.331783 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:05:35.334542 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:05:35.336245 [debug] [Thread-4 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:05:35.337458 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd412c990>]}
[0m18:05:35.338563 [info ] [Thread-4 (]: 6 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:05:35.340081 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.28s]
[0m18:05:35.341904 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_hourly, now model.data_project_1.mart_air_quality_daily)
[0m18:05:35.342610 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:05:35.344032 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:05:35.345301 [debug] [Thread-4 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:05:35.348716 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.350374 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:05:35.352925 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.355018 [info ] [Thread-3 (]: 7 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:05:35.357391 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:05:35.359013 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:05:35.363628 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.366198 [debug] [Thread-4 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:05:35.367016 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.370796 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.372482 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:05:35.373667 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:05:35.375473 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:05:35.379935 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.386725 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.388400 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:05:35.389470 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.390348 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:05:35.390976 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m18:05:35.392602 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:05:35.395029 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.396687 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:05:35.398464 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:05:35.405594 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m18:05:35.406974 [debug] [Thread-1 (]: SQL status: SELECT 704 in 0.006 seconds
[0m18:05:35.407268 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.411372 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.412289 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m18:05:35.413139 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:05:35.414211 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:05:35.415051 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.418169 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.418916 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:05:35.422390 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.422678 [debug] [Thread-4 (]: SQL status: SELECT 132 in 0.007 seconds
[0m18:05:35.425206 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:05:35.430690 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.432431 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.433256 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:05:35.435939 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:35.438654 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.440444 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.445797 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.446172 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.022 seconds
[0m18:05:35.447332 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:05:35.449027 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:05:35.453233 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.456037 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.458388 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:05:35.461107 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:05:35.463278 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.463829 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m18:05:35.464115 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.468268 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.471432 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:05:35.472848 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:05:35.474371 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:05:35.476543 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:05:35.480135 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:05:35.481181 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:05:35.481953 [debug] [Thread-4 (]: SQL status: COMMIT in 0.003 seconds
[0m18:05:35.487786 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:35.495320 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:05:35.496041 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:05:35.497671 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.500536 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:05:35.504422 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:05:35.506145 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:05:35.509226 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:05:35.511836 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd42b4910>]}
[0m18:05:35.515589 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m18:05:35.516500 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.19s]
[0m18:05:35.520620 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:05:35.525213 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:05:35.528186 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:05:35.528999 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.014 seconds
[0m18:05:35.533330 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:05:35.535705 [debug] [Thread-4 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:05:35.538350 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbccfb6210>]}
[0m18:05:35.540756 [info ] [Thread-4 (]: 6 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.20s]
[0m18:05:35.542661 [debug] [Thread-4 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:05:35.553390 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.016 seconds
[0m18:05:35.556936 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:05:35.559016 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83a18b06-aa6b-43ec-b6ac-f9428c4ed63d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbccfb4050>]}
[0m18:05:35.561255 [info ] [Thread-3 (]: 7 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.20s]
[0m18:05:35.562698 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:05:35.566757 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:35.568766 [debug] [MainThread]: On master: BEGIN
[0m18:05:35.569988 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:05:35.582691 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m18:05:35.585130 [debug] [MainThread]: On master: COMMIT
[0m18:05:35.586391 [debug] [MainThread]: Using postgres connection "master"
[0m18:05:35.587843 [debug] [MainThread]: On master: COMMIT
[0m18:05:35.589670 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:05:35.590934 [debug] [MainThread]: On master: Close
[0m18:05:35.592834 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:05:35.594334 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:05:35.595402 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:05:35.596013 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:05:35.596912 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_monthly' was properly closed.
[0m18:05:35.597953 [info ] [MainThread]: 
[0m18:05:35.599232 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m18:05:35.601179 [debug] [MainThread]: Command end result
[0m18:05:35.666926 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:05:35.675494 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:05:35.687649 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:05:35.689597 [info ] [MainThread]: 
[0m18:05:35.690784 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:05:35.691877 [info ] [MainThread]: 
[0m18:05:35.693119 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:05:35.696254 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.4176793, "process_in_blocks": "0", "process_kernel_time": 0.74897, "process_mem_max_rss": "131884", "process_out_blocks": "0", "process_user_time": 2.206206}
[0m18:05:35.697695 [debug] [MainThread]: Command `dbt run` succeeded at 18:05:35.697564 after 4.42 seconds
[0m18:05:35.698803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbdbd73810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd933cf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbdbd8e890>]}
[0m18:05:35.699743 [debug] [MainThread]: Flushing usage events
[0m18:05:36.449833 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:06:04.344426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feaee53350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feaee53850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feaeea7e50>]}


============================== 18:06:04.350374 | 996297d5-ad61-4bd4-b85e-9185febc3c1c ==============================
[0m18:06:04.350374 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:06:04.353477 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'use_colors': 'True', 'printer_width': '80', 'quiet': 'False', 'partial_parse': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'introspect': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'indirect_selection': 'eager', 'write_json': 'True', 'debug': 'False', 'log_cache_events': 'False', 'version_check': 'True'}
[0m18:06:04.500908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feae131990>]}
[0m18:06:04.552965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feb1bae910>]}
[0m18:06:04.556330 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:06:04.743214 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:06:06.614342 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:06:06.616505 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:06:06.661566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fead984a50>]}
[0m18:06:06.858178 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:06:06.869211 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:06:06.989105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feae157790>]}
[0m18:06:06.991197 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:06:06.992978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fead147a50>]}
[0m18:06:06.997704 [info ] [MainThread]: 
[0m18:06:06.999716 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:06:07.001373 [info ] [MainThread]: 
[0m18:06:07.003423 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:06:07.010164 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:06:07.063078 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:06:07.064604 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:06:07.066063 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:06:07.085713 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.020 seconds
[0m18:06:07.088734 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:06:07.092046 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:06:07.098494 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:06:07.100510 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:06:07.102576 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:06:07.113977 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m18:06:07.115722 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:06:07.117198 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:06:07.126985 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.008 seconds
[0m18:06:07.129810 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:06:07.131799 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:06:07.140435 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.141873 [debug] [MainThread]: On master: BEGIN
[0m18:06:07.143116 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:06:07.155757 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m18:06:07.157353 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.158795 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:06:07.171702 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m18:06:07.174755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feacd86410>]}
[0m18:06:07.176538 [debug] [MainThread]: On master: ROLLBACK
[0m18:06:07.178223 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.179705 [debug] [MainThread]: On master: BEGIN
[0m18:06:07.181490 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:06:07.183053 [debug] [MainThread]: On master: COMMIT
[0m18:06:07.184613 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.185914 [debug] [MainThread]: On master: COMMIT
[0m18:06:07.187440 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:06:07.188555 [debug] [MainThread]: On master: Close
[0m18:06:07.200012 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:06:07.202322 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:06:07.206617 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:06:07.211464 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:06:07.246313 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.266397 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:06:07.293862 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.306531 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.307868 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:06:07.308988 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:06:07.321389 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m18:06:07.323300 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.325449 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:06:07.337336 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m18:06:07.347842 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.349895 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:06:07.353257 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:06:07.358641 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.360635 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:06:07.364151 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.385844 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:06:07.387973 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.389538 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:06:07.395257 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m18:06:07.403625 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:06:07.411936 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:06:07.413821 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:06:07.422085 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m18:06:07.426568 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:06:07.430711 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feabb06110>]}
[0m18:06:07.433307 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.22s]
[0m18:06:07.435588 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:06:07.438320 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:06:07.438826 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:06:07.439398 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:06:07.440900 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:06:07.442838 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:06:07.445084 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:06:07.447034 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:06:07.448562 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:06:07.450458 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:06:07.452569 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:06:07.454265 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:06:07.455960 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:06:07.463368 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:06:07.467369 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.471309 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.480962 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:06:07.482776 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:06:07.495169 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:06:07.513240 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:06:07.515359 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.521705 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.531650 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.533521 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.534135 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:06:07.535621 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:06:07.536080 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.537212 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:06:07.538693 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:06:07.540131 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:06:07.544760 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:06:07.553754 [debug] [Thread-3 (]: SQL status: BEGIN in 0.016 seconds
[0m18:06:07.555322 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.555847 [debug] [Thread-2 (]: SQL status: BEGIN in 0.011 seconds
[0m18:06:07.556281 [debug] [Thread-4 (]: SQL status: BEGIN in 0.018 seconds
[0m18:06:07.556858 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:06:07.557809 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.558592 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.560133 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:06:07.561042 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:06:07.570776 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m18:06:07.576870 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.577306 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.015 seconds
[0m18:06:07.578583 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:06:07.583793 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.584063 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.021 seconds
[0m18:06:07.585582 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:06:07.586347 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:06:07.589418 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.592357 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.594025 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:06:07.594890 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:06:07.596183 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:06:07.599062 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.601069 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.602421 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:06:07.602692 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.606126 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.607859 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.608888 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:06:07.609855 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:06:07.611620 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:06:07.613138 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.615176 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.616698 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.618212 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:06:07.620234 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:06:07.621560 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:06:07.623878 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.626939 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:06:07.631309 [debug] [Thread-3 (]: SQL status: COMMIT in 0.008 seconds
[0m18:06:07.636178 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:06:07.636621 [debug] [Thread-2 (]: SQL status: COMMIT in 0.011 seconds
[0m18:06:07.637066 [debug] [Thread-4 (]: SQL status: COMMIT in 0.007 seconds
[0m18:06:07.641630 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:06:07.645489 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:06:07.652479 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:06:07.653896 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:06:07.655810 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:06:07.657485 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:06:07.660474 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:06:07.662184 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:06:07.664605 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:06:07.669496 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:06:07.669960 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:06:07.671889 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feaee9ec90>]}
[0m18:06:07.672443 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:06:07.675298 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:06:07.677170 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.22s]
[0m18:06:07.679338 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:06:07.681265 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feabb24d10>]}
[0m18:06:07.682593 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:06:07.684398 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feabca26d0>]}
[0m18:06:07.686208 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.23s]
[0m18:06:07.688827 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:06:07.690214 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.24s]
[0m18:06:07.692270 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:06:07.694145 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:06:07.696086 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:06:07.697914 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:06:07.701066 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m18:06:07.703379 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:06:07.704927 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:06:07.706684 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:06:07.708583 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:06:07.710059 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:06:07.715447 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.721340 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m18:06:07.724794 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:06:07.728235 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:06:07.734060 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.739001 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.743882 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:06:07.749443 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.749876 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:06:07.755111 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.755445 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:06:07.759647 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.763199 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.768314 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.769127 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:06:07.771164 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:06:07.773085 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.773465 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:06:07.775342 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:06:07.776791 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:06:07.782448 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:06:07.787762 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m18:06:07.789249 [debug] [Thread-3 (]: SQL status: BEGIN in 0.014 seconds
[0m18:06:07.791401 [debug] [Thread-2 (]: SQL status: BEGIN in 0.009 seconds
[0m18:06:07.792080 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.794275 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.796258 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.797834 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:06:07.801117 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:06:07.802876 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:06:07.809050 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.004 seconds
[0m18:06:07.815906 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.816367 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.010 seconds
[0m18:06:07.816687 [debug] [Thread-2 (]: SQL status: SELECT 704 in 0.009 seconds
[0m18:06:07.818577 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:06:07.824478 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.829540 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.832170 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.833264 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:06:07.836388 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:06:07.840533 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.843105 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.844450 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.845478 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:06:07.849517 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.853995 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.856868 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.858168 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:06:07.860062 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:06:07.862144 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:06:07.864151 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:06:07.864969 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:06:07.865866 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.868428 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:06:07.871226 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:06:07.872736 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:06:07.874085 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.875381 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.877887 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:06:07.879182 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:06:07.884256 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m18:06:07.888136 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:06:07.888619 [debug] [Thread-3 (]: SQL status: COMMIT in 0.008 seconds
[0m18:06:07.889168 [debug] [Thread-2 (]: SQL status: COMMIT in 0.008 seconds
[0m18:06:07.890590 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:06:07.893852 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:06:07.900060 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:06:07.901509 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:06:07.903285 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:06:07.904961 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:06:07.907427 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:06:07.909392 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:06:07.912450 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:06:07.914571 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:06:07.915383 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:06:07.916303 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fea8804710>]}
[0m18:06:07.916641 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:06:07.919046 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:06:07.920498 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.22s]
[0m18:06:07.922942 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:06:07.924834 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feae107110>]}
[0m18:06:07.926165 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:06:07.927546 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '996297d5-ad61-4bd4-b85e-9185febc3c1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fea881b390>]}
[0m18:06:07.928644 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.20s]
[0m18:06:07.931253 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.22s]
[0m18:06:07.933011 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:06:07.934142 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:06:07.937507 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.938680 [debug] [MainThread]: On master: BEGIN
[0m18:06:07.939918 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:06:07.948252 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m18:06:07.951546 [debug] [MainThread]: On master: COMMIT
[0m18:06:07.954365 [debug] [MainThread]: Using postgres connection "master"
[0m18:06:07.957218 [debug] [MainThread]: On master: COMMIT
[0m18:06:07.960201 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:06:07.962610 [debug] [MainThread]: On master: Close
[0m18:06:07.964316 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:06:07.966076 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:06:07.967696 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:06:07.971479 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:06:07.973389 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:06:07.974629 [info ] [MainThread]: 
[0m18:06:07.976040 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m18:06:07.977901 [debug] [MainThread]: Command end result
[0m18:06:08.043891 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:06:08.054176 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:06:08.069589 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:06:08.070796 [info ] [MainThread]: 
[0m18:06:08.072190 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:06:08.073546 [info ] [MainThread]: 
[0m18:06:08.074878 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:06:08.077067 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.7968097, "process_in_blocks": "0", "process_kernel_time": 0.641241, "process_mem_max_rss": "131236", "process_out_blocks": "0", "process_user_time": 2.207819}
[0m18:06:08.078448 [debug] [MainThread]: Command `dbt run` succeeded at 18:06:08.078304 after 3.80 seconds
[0m18:06:08.079780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feb368ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feb368ed10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76feb373b8d0>]}
[0m18:06:08.081049 [debug] [MainThread]: Flushing usage events
[0m18:06:08.817359 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:07:02.264470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db0a06850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db09a5150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db09a5f50>]}


============================== 18:07:02.273912 | 07284832-38ce-49bd-aebe-4e7629720ce8 ==============================
[0m18:07:02.273912 [info ] [MainThread]: Running with dbt=1.10.15
[0m18:07:02.276208 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error': 'None', 'indirect_selection': 'eager', 'quiet': 'False', 'partial_parse': 'True', 'no_print': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'write_json': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'debug': 'False', 'empty': 'False', 'static_parser': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'use_colors': 'True'}
[0m18:07:02.422236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db01864d0>]}
[0m18:07:02.485594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db3710350>]}
[0m18:07:02.487450 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m18:07:02.606733 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m18:07:04.452856 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:07:04.454639 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:07:04.492533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8daf5756d0>]}
[0m18:07:04.603514 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:07:04.613055 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:07:04.708812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8daf9cf850>]}
[0m18:07:04.711603 [info ] [MainThread]: Found 7 models, 2 data tests, 1 source, 738 macros
[0m18:07:04.712745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dae967490>]}
[0m18:07:04.716784 [info ] [MainThread]: 
[0m18:07:04.718379 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:07:04.719576 [info ] [MainThread]: 
[0m18:07:04.721096 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:07:04.727275 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m18:07:04.783844 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m18:07:04.785843 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m18:07:04.787335 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:07:04.804031 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m18:07:04.807967 [debug] [ThreadPool]: On list_data_project_1: Close
[0m18:07:04.813572 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m18:07:04.821242 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:07:04.822886 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m18:07:04.824128 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:07:04.833832 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m18:07:04.835707 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m18:07:04.837349 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m18:07:04.843304 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.005 seconds
[0m18:07:04.851045 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m18:07:04.852754 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m18:07:04.859203 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:04.860879 [debug] [MainThread]: On master: BEGIN
[0m18:07:04.862129 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:07:04.871111 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m18:07:04.872818 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:04.874327 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m18:07:04.888176 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m18:07:04.890825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dad8a1f50>]}
[0m18:07:04.892332 [debug] [MainThread]: On master: ROLLBACK
[0m18:07:04.895862 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:04.897905 [debug] [MainThread]: On master: BEGIN
[0m18:07:04.900155 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m18:07:04.909746 [debug] [MainThread]: On master: COMMIT
[0m18:07:04.913680 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:04.917545 [debug] [MainThread]: On master: COMMIT
[0m18:07:04.921031 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:07:04.922225 [debug] [MainThread]: On master: Close
[0m18:07:04.928212 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m18:07:04.930601 [info ] [Thread-1 (]: 1 of 7 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m18:07:04.934667 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m18:07:04.938414 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m18:07:04.952733 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m18:07:04.969506 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m18:07:04.994728 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.017133 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.018196 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m18:07:05.019056 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:05.028003 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m18:07:05.030513 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.032624 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma gen√©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_Inorg√°nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_Mon√≥xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m18:07:05.044660 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m18:07:05.052207 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.053556 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m18:07:05.055480 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.059093 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.060382 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m18:07:05.062898 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.075151 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:07:05.077377 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.080069 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m18:07:05.086381 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m18:07:05.092072 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m18:07:05.096986 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m18:07:05.097941 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m18:07:05.104848 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m18:07:05.107305 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m18:07:05.110034 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dad8cee10>]}
[0m18:07:05.111982 [info ] [Thread-1 (]: 1 of 7 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.17s]
[0m18:07:05.113146 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m18:07:05.114984 [debug] [Thread-3 (]: Began running node model.data_project_1.int_air_quality_daily
[0m18:07:05.115337 [debug] [Thread-4 (]: Began running node model.data_project_1.int_air_quality_hourly
[0m18:07:05.115631 [debug] [Thread-2 (]: Began running node model.data_project_1.int_air_quality_monthly
[0m18:07:05.116414 [info ] [Thread-3 (]: 2 of 7 START sql table model public.int_air_quality_daily ...................... [RUN]
[0m18:07:05.117688 [info ] [Thread-4 (]: 3 of 7 START sql table model public.int_air_quality_hourly ..................... [RUN]
[0m18:07:05.119723 [info ] [Thread-2 (]: 4 of 7 START sql table model public.int_air_quality_monthly .................... [RUN]
[0m18:07:05.120962 [debug] [Thread-3 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_daily'
[0m18:07:05.122029 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_hourly'
[0m18:07:05.123509 [debug] [Thread-2 (]: Acquiring new postgres connection 'model.data_project_1.int_air_quality_monthly'
[0m18:07:05.124794 [debug] [Thread-3 (]: Began compiling node model.data_project_1.int_air_quality_daily
[0m18:07:05.127570 [debug] [Thread-4 (]: Began compiling node model.data_project_1.int_air_quality_hourly
[0m18:07:05.129169 [debug] [Thread-2 (]: Began compiling node model.data_project_1.int_air_quality_monthly
[0m18:07:05.135530 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_daily"
[0m18:07:05.139144 [debug] [Thread-4 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.149455 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.182376 [debug] [Thread-2 (]: Began executing node model.data_project_1.int_air_quality_monthly
[0m18:07:05.183265 [debug] [Thread-3 (]: Began executing node model.data_project_1.int_air_quality_daily
[0m18:07:05.191528 [debug] [Thread-4 (]: Began executing node model.data_project_1.int_air_quality_hourly
[0m18:07:05.203657 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.208407 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_daily"
[0m18:07:05.213083 [debug] [Thread-4 (]: Writing runtime sql for node "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.226697 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.228503 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.230051 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: BEGIN
[0m18:07:05.231390 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.231841 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: BEGIN
[0m18:07:05.232869 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:07:05.233876 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: BEGIN
[0m18:07:05.235793 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:07:05.239442 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:07:05.246509 [debug] [Thread-3 (]: SQL status: BEGIN in 0.013 seconds
[0m18:07:05.248109 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.249817 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('day', measurement_timestamp) AS measurement_day,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

daily AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_day,
        AVG(concentration_ug_m3) AS avg_daily,
        MAX(concentration_ug_m3) AS max_daily,
        MIN(concentration_ug_m3) AS min_daily,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id, 
        station_name, 
        pollutant_type, 
        measurement_day
),

variation AS (
    SELECT
        *,
        avg_daily - LAG(avg_daily) OVER (
            PARTITION BY location_id, pollutant_type
            ORDER BY measurement_day
        ) AS variation_vs_prev_day
    FROM daily
)

SELECT *
FROM variation
  );
  
[0m18:07:05.251808 [debug] [Thread-2 (]: SQL status: BEGIN in 0.012 seconds
[0m18:07:05.253486 [debug] [Thread-4 (]: SQL status: BEGIN in 0.018 seconds
[0m18:07:05.255227 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.261211 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.261929 [debug] [Thread-3 (]: SQL status: SELECT 132 in 0.011 seconds
[0m18:07:05.266991 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('month', measurement_timestamp) AS measurement_month,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

monthly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_month,
        AVG(concentration_ug_m3) AS avg_monthly,
        MAX(concentration_ug_m3) AS max_monthly,
        MIN(concentration_ug_m3) AS min_monthly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_month
),

variation AS (
    SELECT
        monthly.*,
        avg_monthly 
            - LAG(avg_monthly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_month
            ) AS variation_vs_prev_month
    FROM monthly
)

SELECT *
FROM variation
  );
  
[0m18:07:05.270441 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

WITH base AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        DATE_TRUNC('hour', measurement_timestamp) AS measurement_hour,
        concentration_ug_m3
    FROM "data_project_1"."public"."stg_air_quality_valencia"
),

hourly AS (
    SELECT
        location_id,
        station_name,
        pollutant_type,
        measurement_hour,
        AVG(concentration_ug_m3) AS avg_hourly,
        MAX(concentration_ug_m3) AS max_hourly,
        MIN(concentration_ug_m3) AS min_hourly,
        COUNT(*) AS num_measurements
    FROM base
    GROUP BY 
        location_id,
        station_name,
        pollutant_type,
        measurement_hour
),

variation AS (
    SELECT
        hourly.*,
        avg_hourly 
            - LAG(avg_hourly) OVER (
                PARTITION BY location_id, pollutant_type
                ORDER BY measurement_hour
            ) AS variation_vs_prev_hour
    FROM hourly
)

SELECT *
FROM variation
  );
  
[0m18:07:05.277544 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.281208 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily" rename to "int_air_quality_daily__dbt_backup"
[0m18:07:05.283430 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.289721 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.291860 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
alter table "data_project_1"."public"."int_air_quality_daily__dbt_tmp" rename to "int_air_quality_daily"
[0m18:07:05.295439 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.295923 [debug] [Thread-2 (]: SQL status: SELECT 44 in 0.017 seconds
[0m18:07:05.297748 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:07:05.298311 [debug] [Thread-4 (]: SQL status: SELECT 704 in 0.018 seconds
[0m18:07:05.301446 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.303126 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.306295 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.308092 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly" rename to "int_air_quality_monthly__dbt_backup"
[0m18:07:05.309540 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: COMMIT
[0m18:07:05.310772 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly" rename to "int_air_quality_hourly__dbt_backup"
[0m18:07:05.312785 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.314990 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.318662 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.319376 [debug] [Thread-3 (]: SQL status: COMMIT in 0.006 seconds
[0m18:07:05.323632 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.324977 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
alter table "data_project_1"."public"."int_air_quality_monthly__dbt_tmp" rename to "int_air_quality_monthly"
[0m18:07:05.328853 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_daily__dbt_backup"
[0m18:07:05.330342 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
alter table "data_project_1"."public"."int_air_quality_hourly__dbt_tmp" rename to "int_air_quality_hourly"
[0m18:07:05.332187 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.335542 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.int_air_quality_daily"
[0m18:07:05.338938 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:07:05.339350 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m18:07:05.340263 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_daily"} */
drop table if exists "data_project_1"."public"."int_air_quality_daily__dbt_backup" cascade
[0m18:07:05.341338 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.342893 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:07:05.345391 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: COMMIT
[0m18:07:05.346989 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.348986 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: COMMIT
[0m18:07:05.350898 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:07:05.351482 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m18:07:05.353640 [debug] [Thread-3 (]: On model.data_project_1.int_air_quality_daily: Close
[0m18:07:05.353931 [debug] [Thread-4 (]: SQL status: COMMIT in 0.004 seconds
[0m18:07:05.357295 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_monthly__dbt_backup"
[0m18:07:05.358635 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac64b810>]}
[0m18:07:05.362482 [debug] [Thread-4 (]: Applying DROP to: "data_project_1"."public"."int_air_quality_hourly__dbt_backup"
[0m18:07:05.364032 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.int_air_quality_monthly"
[0m18:07:05.365566 [info ] [Thread-3 (]: 2 of 7 OK created sql table model public.int_air_quality_daily ................. [[32mSELECT 132[0m in 0.24s]
[0m18:07:05.367206 [debug] [Thread-4 (]: Using postgres connection "model.data_project_1.int_air_quality_hourly"
[0m18:07:05.368507 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."int_air_quality_monthly__dbt_backup" cascade
[0m18:07:05.370320 [debug] [Thread-3 (]: Finished running node model.data_project_1.int_air_quality_daily
[0m18:07:05.372517 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.int_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."int_air_quality_hourly__dbt_backup" cascade
[0m18:07:05.374728 [debug] [Thread-1 (]: Began running node model.data_project_1.mart_air_quality_daily
[0m18:07:05.376909 [info ] [Thread-1 (]: 5 of 7 START sql table model public.mart_air_quality_daily ..................... [RUN]
[0m18:07:05.378132 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.005 seconds
[0m18:07:05.378583 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.data_project_1.stg_air_quality_valencia, now model.data_project_1.mart_air_quality_daily)
[0m18:07:05.379260 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:07:05.380631 [debug] [Thread-2 (]: On model.data_project_1.int_air_quality_monthly: Close
[0m18:07:05.381520 [debug] [Thread-1 (]: Began compiling node model.data_project_1.mart_air_quality_daily
[0m18:07:05.383288 [debug] [Thread-4 (]: On model.data_project_1.int_air_quality_hourly: Close
[0m18:07:05.384672 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac503b50>]}
[0m18:07:05.387468 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.388759 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac6bee90>]}
[0m18:07:05.389799 [info ] [Thread-2 (]: 4 of 7 OK created sql table model public.int_air_quality_monthly ............... [[32mSELECT 44[0m in 0.26s]
[0m18:07:05.391825 [info ] [Thread-4 (]: 3 of 7 OK created sql table model public.int_air_quality_hourly ................ [[32mSELECT 704[0m in 0.27s]
[0m18:07:05.392871 [debug] [Thread-2 (]: Finished running node model.data_project_1.int_air_quality_monthly
[0m18:07:05.393824 [debug] [Thread-4 (]: Finished running node model.data_project_1.int_air_quality_hourly
[0m18:07:05.395163 [debug] [Thread-3 (]: Began running node model.data_project_1.mart_air_quality_monthly
[0m18:07:05.396156 [debug] [Thread-2 (]: Began running node model.data_project_1.mart_air_quality_hourly
[0m18:07:05.396774 [info ] [Thread-3 (]: 6 of 7 START sql table model public.mart_air_quality_monthly ................... [RUN]
[0m18:07:05.397664 [info ] [Thread-2 (]: 7 of 7 START sql table model public.mart_air_quality_hourly .................... [RUN]
[0m18:07:05.398851 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_daily, now model.data_project_1.mart_air_quality_monthly)
[0m18:07:05.399759 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.data_project_1.int_air_quality_monthly, now model.data_project_1.mart_air_quality_hourly)
[0m18:07:05.400352 [debug] [Thread-1 (]: Began executing node model.data_project_1.mart_air_quality_daily
[0m18:07:05.400889 [debug] [Thread-3 (]: Began compiling node model.data_project_1.mart_air_quality_monthly
[0m18:07:05.401821 [debug] [Thread-2 (]: Began compiling node model.data_project_1.mart_air_quality_hourly
[0m18:07:05.405348 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.408224 [debug] [Thread-3 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.411561 [debug] [Thread-2 (]: Writing injected SQL for node "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.420623 [debug] [Thread-3 (]: Began executing node model.data_project_1.mart_air_quality_monthly
[0m18:07:05.424461 [debug] [Thread-3 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.424850 [debug] [Thread-2 (]: Began executing node model.data_project_1.mart_air_quality_hourly
[0m18:07:05.425235 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.429503 [debug] [Thread-2 (]: Writing runtime sql for node "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.430770 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: BEGIN
[0m18:07:05.432878 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:05.435768 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.436778 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: BEGIN
[0m18:07:05.437184 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.438019 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:07:05.439137 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: BEGIN
[0m18:07:05.440818 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:07:05.441692 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m18:07:05.443303 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.444607 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_day,
    avg_daily,
    max_daily,
    min_daily,
    num_measurements,
    variation_vs_prev_day
FROM "data_project_1"."public"."int_air_quality_daily"
--Este mart proporciona un resumen diario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto al d√≠a anterior. Es √∫til para an√°lisis diarios y reportes de cumplimiento.
  );
  
[0m18:07:05.447038 [debug] [Thread-3 (]: SQL status: BEGIN in 0.009 seconds
[0m18:07:05.448382 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.449498 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_month,
    avg_monthly,
    max_monthly,
    min_monthly,
    num_measurements,
    variation_vs_prev_month
FROM "data_project_1"."public"."int_air_quality_monthly"
  );
  
[0m18:07:05.449824 [debug] [Thread-2 (]: SQL status: BEGIN in 0.009 seconds
[0m18:07:05.450066 [debug] [Thread-1 (]: SQL status: SELECT 132 in 0.004 seconds
[0m18:07:05.451683 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.456812 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.457133 [debug] [Thread-3 (]: SQL status: SELECT 44 in 0.006 seconds
[0m18:07:05.457981 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */

  
    

  create  table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    location_id,
    station_name,
    pollutant_type,
    measurement_hour,
    avg_hourly,
    max_hourly,
    min_hourly,
    num_measurements,
    variation_vs_prev_hour
FROM "data_project_1"."public"."int_air_quality_hourly"
--Este mart proporciona un resumen horario de las mediciones de calidad del aire, incluyendo promedios, m√°ximos, m√≠nimos y variaciones respecto a la hora anterior. Es √∫til para an√°lisis detallados y monitoreo en tiempo real.
  );
  
[0m18:07:05.459029 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily" rename to "mart_air_quality_daily__dbt_backup"
[0m18:07:05.463381 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.466237 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.466532 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly" rename to "mart_air_quality_monthly__dbt_backup"
[0m18:07:05.470430 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.470706 [debug] [Thread-2 (]: SQL status: SELECT 704 in 0.006 seconds
[0m18:07:05.472185 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
alter table "data_project_1"."public"."mart_air_quality_daily__dbt_tmp" rename to "mart_air_quality_daily"
[0m18:07:05.472627 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.475317 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.476600 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:07:05.478845 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.480027 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly" rename to "mart_air_quality_hourly__dbt_backup"
[0m18:07:05.481829 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:07:05.482775 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
alter table "data_project_1"."public"."mart_air_quality_monthly__dbt_tmp" rename to "mart_air_quality_monthly"
[0m18:07:05.484281 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.484509 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.485632 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m18:07:05.486375 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: COMMIT
[0m18:07:05.490053 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.491694 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:07:05.493741 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
alter table "data_project_1"."public"."mart_air_quality_hourly__dbt_tmp" rename to "mart_air_quality_hourly"
[0m18:07:05.494918 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.496478 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m18:07:05.496817 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: COMMIT
[0m18:07:05.498476 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:07:05.500361 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.501074 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m18:07:05.501932 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: COMMIT
[0m18:07:05.502446 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m18:07:05.505937 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_daily__dbt_backup"
[0m18:07:05.508836 [debug] [Thread-3 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_monthly__dbt_backup"
[0m18:07:05.509103 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m18:07:05.509976 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.mart_air_quality_daily"
[0m18:07:05.511519 [debug] [Thread-3 (]: Using postgres connection "model.data_project_1.mart_air_quality_monthly"
[0m18:07:05.515682 [debug] [Thread-2 (]: Applying DROP to: "data_project_1"."public"."mart_air_quality_hourly__dbt_backup"
[0m18:07:05.516864 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_daily"} */
drop table if exists "data_project_1"."public"."mart_air_quality_daily__dbt_backup" cascade
[0m18:07:05.517586 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_monthly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_monthly__dbt_backup" cascade
[0m18:07:05.518555 [debug] [Thread-2 (]: Using postgres connection "model.data_project_1.mart_air_quality_hourly"
[0m18:07:05.521475 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.mart_air_quality_hourly"} */
drop table if exists "data_project_1"."public"."mart_air_quality_hourly__dbt_backup" cascade
[0m18:07:05.523497 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:07:05.525863 [debug] [Thread-1 (]: On model.data_project_1.mart_air_quality_daily: Close
[0m18:07:05.526368 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.004 seconds
[0m18:07:05.527004 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.006 seconds
[0m18:07:05.527529 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac503d10>]}
[0m18:07:05.529473 [debug] [Thread-2 (]: On model.data_project_1.mart_air_quality_hourly: Close
[0m18:07:05.531664 [debug] [Thread-3 (]: On model.data_project_1.mart_air_quality_monthly: Close
[0m18:07:05.532976 [info ] [Thread-1 (]: 5 of 7 OK created sql table model public.mart_air_quality_daily ................ [[32mSELECT 132[0m in 0.15s]
[0m18:07:05.534227 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac5d1ed0>]}
[0m18:07:05.535853 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07284832-38ce-49bd-aebe-4e7629720ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8dac5d0c50>]}
[0m18:07:05.537126 [debug] [Thread-1 (]: Finished running node model.data_project_1.mart_air_quality_daily
[0m18:07:05.538572 [info ] [Thread-2 (]: 7 of 7 OK created sql table model public.mart_air_quality_hourly ............... [[32mSELECT 704[0m in 0.13s]
[0m18:07:05.540122 [info ] [Thread-3 (]: 6 of 7 OK created sql table model public.mart_air_quality_monthly .............. [[32mSELECT 44[0m in 0.14s]
[0m18:07:05.542767 [debug] [Thread-2 (]: Finished running node model.data_project_1.mart_air_quality_hourly
[0m18:07:05.543930 [debug] [Thread-3 (]: Finished running node model.data_project_1.mart_air_quality_monthly
[0m18:07:05.547610 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:05.548820 [debug] [MainThread]: On master: BEGIN
[0m18:07:05.549991 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:07:05.558419 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m18:07:05.560107 [debug] [MainThread]: On master: COMMIT
[0m18:07:05.561208 [debug] [MainThread]: Using postgres connection "master"
[0m18:07:05.562581 [debug] [MainThread]: On master: COMMIT
[0m18:07:05.563818 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m18:07:05.565165 [debug] [MainThread]: On master: Close
[0m18:07:05.566417 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:07:05.567822 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_daily' was properly closed.
[0m18:07:05.568874 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_monthly' was properly closed.
[0m18:07:05.570064 [debug] [MainThread]: Connection 'model.data_project_1.int_air_quality_hourly' was properly closed.
[0m18:07:05.571276 [debug] [MainThread]: Connection 'model.data_project_1.mart_air_quality_hourly' was properly closed.
[0m18:07:05.572546 [info ] [MainThread]: 
[0m18:07:05.573898 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m18:07:05.576538 [debug] [MainThread]: Command end result
[0m18:07:05.729533 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m18:07:05.744085 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m18:07:05.758320 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m18:07:05.759694 [info ] [MainThread]: 
[0m18:07:05.760742 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:07:05.762401 [info ] [MainThread]: 
[0m18:07:05.763764 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m18:07:05.765936 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5792952, "process_in_blocks": "0", "process_kernel_time": 0.621299, "process_mem_max_rss": "130988", "process_out_blocks": "0", "process_user_time": 2.122773}
[0m18:07:05.767554 [debug] [MainThread]: Command `dbt run` succeeded at 18:07:05.767355 after 3.58 seconds
[0m18:07:05.769424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db09c49d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db550b910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8db52c2b90>]}
[0m18:07:05.771144 [debug] [MainThread]: Flushing usage events
[0m18:07:06.589241 [debug] [MainThread]: An error was encountered while trying to flush usage events
