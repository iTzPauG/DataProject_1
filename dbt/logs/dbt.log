[0m15:32:36.454684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F293F0AC50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F296208AF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F296208910>]}


============================== 15:32:36.461207 | 879b74a6-ebbc-4308-8f2b-1a48fe0fc747 ==============================
[0m15:32:36.461207 [info ] [MainThread]: Running with dbt=1.10.15
[0m15:32:36.462204 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'log_format': 'default', 'printer_width': '80', 'no_print': 'None', 'invocation_command': 'dbt debug', 'warn_error': 'None', 'log_path': 'logs', 'partial_parse': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'version_check': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'introspect': 'True', 'empty': 'None', 'log_cache_events': 'False', 'debug': 'False', 'profiles_dir': 'C:\\Users\\gbala\\OneDrive\\Escritorio\\MÃ¡ster Big Data\\apis\\DataProject_1', 'use_colors': 'True', 'cache_selected_only': 'False', 'write_json': 'True'}
[0m15:32:36.501905 [info ] [MainThread]: dbt version: 1.10.15
[0m15:32:36.502906 [info ] [MainThread]: python version: 3.10.11
[0m15:32:36.503911 [info ] [MainThread]: python path: C:\Users\gbala\AppData\Local\Programs\Python\Python310\python.exe
[0m15:32:36.504904 [info ] [MainThread]: os info: Windows-10-10.0.26200-SP0
[0m15:32:36.504904 [error] [MainThread]: Encountered an error:
[Errno 13] Permission denied: 'C:\\Users\\gbala\\OneDrive\\Escritorio\\MÃ¡ster Big Data\\apis\\DataProject_1\\profiles.yml'
[0m15:32:36.506905 [error] [MainThread]: Traceback (most recent call last):
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\cli\requires.py", line 178, in wrapper
    result, success = func(*args, **kwargs)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\cli\requires.py", line 128, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\cli\main.py", line 420, in debug
    results = task.run()
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\task\debug.py", line 114, in run
    load_profile_status: SubtaskStatus = self._load_profile()
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\task\debug.py", line 195, in _load_profile
    dbt_common.clients.system.load_file_contents(self.profile_path)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt_common\record.py", line 538, in record_replay_wrapper
    return func_to_record(*call_args, **kwargs)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt_common\clients\system.py", line 182, in load_file_contents
    with open(path, "rb") as handle:
PermissionError: [Errno 13] Permission denied: 'C:\\Users\\gbala\\OneDrive\\Escritorio\\MÃ¡ster Big Data\\apis\\DataProject_1\\profiles.yml'

[0m15:32:36.509425 [debug] [MainThread]: Command `dbt debug` failed at 15:32:36.509425 after 0.25 seconds
[0m15:32:36.510428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F293F0AC50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F296208820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F296207A00>]}
[0m15:32:36.510428 [debug] [MainThread]: Flushing usage events
[0m15:32:37.297013 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:33:42.306894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C08AF0AC80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C08D208B20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C08D208940>]}


============================== 15:33:42.311894 | d131ef89-fac4-4c60-93c1-f5a39b6f270a ==============================
[0m15:33:42.311894 [info ] [MainThread]: Running with dbt=1.10.15
[0m15:33:42.314400 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'use_colors': 'True', 'printer_width': '80', 'no_print': 'None', 'target_path': 'None', 'warn_error': 'None', 'static_parser': 'True', 'partial_parse': 'True', 'log_path': 'logs', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'version_check': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'introspect': 'True', 'empty': 'None', 'log_cache_events': 'False', 'debug': 'False', 'profiles_dir': 'C:\\Users\\gbala\\OneDrive\\Escritorio\\MÃ¡ster Big Data\\apis\\DataProject_1', 'invocation_command': 'dbt debug', 'cache_selected_only': 'False', 'write_json': 'True'}
[0m15:33:42.331833 [info ] [MainThread]: dbt version: 1.10.15
[0m15:33:42.332832 [info ] [MainThread]: python version: 3.10.11
[0m15:33:42.333832 [info ] [MainThread]: python path: C:\Users\gbala\AppData\Local\Programs\Python\Python310\python.exe
[0m15:33:42.335334 [info ] [MainThread]: os info: Windows-10-10.0.26200-SP0
[0m15:33:42.335334 [error] [MainThread]: Encountered an error:
[Errno 13] Permission denied: 'C:\\Users\\gbala\\OneDrive\\Escritorio\\MÃ¡ster Big Data\\apis\\DataProject_1\\profiles.yml'
[0m15:33:42.339338 [error] [MainThread]: Traceback (most recent call last):
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\cli\requires.py", line 178, in wrapper
    result, success = func(*args, **kwargs)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\cli\requires.py", line 128, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\cli\main.py", line 420, in debug
    results = task.run()
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\task\debug.py", line 114, in run
    load_profile_status: SubtaskStatus = self._load_profile()
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\task\debug.py", line 195, in _load_profile
    dbt_common.clients.system.load_file_contents(self.profile_path)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt_common\record.py", line 538, in record_replay_wrapper
    return func_to_record(*call_args, **kwargs)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt_common\clients\system.py", line 182, in load_file_contents
    with open(path, "rb") as handle:
PermissionError: [Errno 13] Permission denied: 'C:\\Users\\gbala\\OneDrive\\Escritorio\\MÃ¡ster Big Data\\apis\\DataProject_1\\profiles.yml'

[0m15:33:42.340337 [debug] [MainThread]: Command `dbt debug` failed at 15:33:42.340337 after 0.22 seconds
[0m15:33:42.341338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C08AF0AC80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C08D208850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C08D207A00>]}
[0m15:33:42.341338 [debug] [MainThread]: Flushing usage events
[0m15:33:43.140781 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:34:32.782202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022C4335AC20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022C45656F80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022C45656DA0>]}


============================== 15:34:32.791866 | dfe32839-0c13-44a2-8f3f-cf49ec2cbc53 ==============================
[0m15:34:32.791866 [info ] [MainThread]: Running with dbt=1.10.15
[0m15:34:32.792866 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'log_format': 'default', 'printer_width': '80', 'profiles_dir': 'C:\\Users\\gbala\\OneDrive\\Escritorio\\MÃ¡ster Big Data\\apis\\DataProject_1', 'invocation_command': 'dbt run', 'warn_error': 'None', 'static_parser': 'True', 'partial_parse': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'log_path': 'logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'introspect': 'True', 'quiet': 'False', 'empty': 'False', 'log_cache_events': 'False', 'debug': 'False', 'no_print': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'target_path': 'None'}
[0m15:34:32.794871 [error] [MainThread]: Encountered an error:
Runtime Error
  No dbt_project.yml found at expected path C:\Users\gbala\OneDrive\Escritorio\MÃ¡ster Big Data\apis\DataProject_1\dbt\dbt_project.yml
  Verify that each entry within packages.yml (and their transitive dependencies) contains a file named dbt_project.yml
  
[0m15:34:32.795915 [debug] [MainThread]: Command `dbt run` failed at 15:34:32.795915 after 0.21 seconds
[0m15:34:32.796913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022C4335AC20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022C45656DA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022C45657040>]}
[0m15:34:32.797908 [debug] [MainThread]: Flushing usage events
[0m15:34:33.719172 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:36:00.746296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029C8E9AABF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029C90C9CA90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029C90C9C8B0>]}


============================== 15:36:00.754838 | 900cef32-bdab-4ed8-a097-a0f7076d47b6 ==============================
[0m15:36:00.754838 [info ] [MainThread]: Running with dbt=1.10.15
[0m15:36:00.756835 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'no_print': 'None', 'use_colors': 'True', 'printer_width': '80', 'write_json': 'True', 'warn_error': 'None', 'static_parser': 'True', 'partial_parse': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'log_path': 'logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'quiet': 'False', 'introspect': 'True', 'empty': 'None', 'log_cache_events': 'False', 'debug': 'False', 'profiles_dir': 'C:\\Users\\gbala\\OneDrive\\Escritorio\\MÃ¡ster Big Data\\apis\\DataProject_1', 'invocation_command': 'dbt debug', 'cache_selected_only': 'False', 'target_path': 'None'}
[0m15:36:00.788665 [info ] [MainThread]: dbt version: 1.10.15
[0m15:36:00.790424 [info ] [MainThread]: python version: 3.10.11
[0m15:36:00.791697 [info ] [MainThread]: python path: C:\Users\gbala\AppData\Local\Programs\Python\Python310\python.exe
[0m15:36:00.793498 [info ] [MainThread]: os info: Windows-10-10.0.26200-SP0
[0m15:36:00.796161 [error] [MainThread]: Encountered an error:
[Errno 13] Permission denied: 'C:\\Users\\gbala\\OneDrive\\Escritorio\\MÃ¡ster Big Data\\apis\\DataProject_1\\profiles.yml'
[0m15:36:00.800495 [error] [MainThread]: Traceback (most recent call last):
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\cli\requires.py", line 178, in wrapper
    result, success = func(*args, **kwargs)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\cli\requires.py", line 128, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\cli\main.py", line 420, in debug
    results = task.run()
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\task\debug.py", line 114, in run
    load_profile_status: SubtaskStatus = self._load_profile()
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt\task\debug.py", line 195, in _load_profile
    dbt_common.clients.system.load_file_contents(self.profile_path)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt_common\record.py", line 538, in record_replay_wrapper
    return func_to_record(*call_args, **kwargs)
  File "C:\Users\gbala\AppData\Local\Programs\Python\Python310\lib\site-packages\dbt_common\clients\system.py", line 182, in load_file_contents
    with open(path, "rb") as handle:
PermissionError: [Errno 13] Permission denied: 'C:\\Users\\gbala\\OneDrive\\Escritorio\\MÃ¡ster Big Data\\apis\\DataProject_1\\profiles.yml'

[0m15:36:00.803501 [debug] [MainThread]: Command `dbt debug` failed at 15:36:00.802496 after 0.26 seconds
[0m15:36:00.803501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029C8E9AABF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029C90C9C7C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029C90CA3A00>]}
[0m15:36:00.805882 [debug] [MainThread]: Flushing usage events
[0m15:36:01.481056 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:02:31.562387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70184def2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7018506df790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70184defe7d0>]}


============================== 22:02:31.569161 | 1d3776c5-a37f-4205-a4f2-14067f24bf8b ==============================
[0m22:02:31.569161 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:02:31.571739 [debug] [MainThread]: running dbt with arguments {'log_path': '/usr/app/dbt/dbt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'indirect_selection': 'eager', 'log_format': 'default', 'invocation_command': 'dbt run', 'debug': 'False', 'introspect': 'True', 'write_json': 'True', 'no_print': 'None', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False'}
[0m22:02:31.600516 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /usr/app/dbt/dbt/profiles.yml
  
[0m22:02:31.605048 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.10927596, "process_in_blocks": "0", "process_kernel_time": 0.519203, "process_mem_max_rss": "104224", "process_out_blocks": "0", "process_user_time": 1.194168}
[0m22:02:31.606970 [debug] [MainThread]: Command `dbt run` failed at 22:02:31.606829 after 0.11 seconds
[0m22:02:31.608395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7018526f6e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70184def0bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70184e013790>]}
[0m22:02:31.609769 [debug] [MainThread]: Flushing usage events
[0m22:02:32.265318 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:02:34.750041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4554e4810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4554e4790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4554e4a50>]}


============================== 22:02:34.756485 | d6640e8f-1d2a-4194-92c6-e37f9db280b3 ==============================
[0m22:02:34.756485 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:02:34.758401 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'partial_parse': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'quiet': 'False', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'debug': 'False', 'introspect': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'warn_error': 'None', 'log_format': 'default', 'printer_width': '80', 'indirect_selection': 'eager', 'version_check': 'True', 'target_path': 'None', 'write_json': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:02:34.771281 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /usr/app/dbt/dbt/profiles.yml
  
[0m22:02:34.773356 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.10074192, "process_in_blocks": "0", "process_kernel_time": 0.393414, "process_mem_max_rss": "104052", "process_out_blocks": "0", "process_user_time": 1.334187}
[0m22:02:34.775204 [debug] [MainThread]: Command `dbt run` failed at 22:02:34.775015 after 0.10 seconds
[0m22:02:34.776603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af455151310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af455152610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4551abf10>]}
[0m22:02:34.777707 [debug] [MainThread]: Flushing usage events
[0m22:02:35.636031 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:02:37.752182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e33e2a1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e33ee3b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e33e35cd0>]}


============================== 22:02:37.759529 | 017c86e6-5e3e-4418-b17f-427a7cb13e64 ==============================
[0m22:02:37.759529 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:02:37.761861 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'warn_error': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'debug': 'False', 'introspect': 'True', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'version_check': 'True', 'empty': 'False', 'quiet': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'no_print': 'None'}
[0m22:02:37.773321 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /usr/app/dbt/dbt/profiles.yml
  
[0m22:02:37.775461 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.10659985, "process_in_blocks": "0", "process_kernel_time": 0.292774, "process_mem_max_rss": "103932", "process_out_blocks": "0", "process_user_time": 1.078853}
[0m22:02:37.777233 [debug] [MainThread]: Command `dbt run` failed at 22:02:37.777015 after 0.11 seconds
[0m22:02:37.778647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e33e35cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e33dd4890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e33e28e90>]}
[0m22:02:37.779903 [debug] [MainThread]: Flushing usage events
[0m22:02:38.499198 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:02:40.772979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x706ad16ce250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x706ad1ae3450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x706ad1ae0990>]}


============================== 22:02:40.778634 | cb61047c-b745-4c5b-8cc7-a082c8b14198 ==============================
[0m22:02:40.778634 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:02:40.779692 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'write_json': 'True', 'partial_parse': 'True', 'log_format': 'default', 'no_print': 'None', 'fail_fast': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'printer_width': '80', 'quiet': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'use_colors': 'True', 'static_parser': 'True', 'version_check': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'profiles_dir': '/usr/app/dbt/dbt'}
[0m22:02:40.787378 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /usr/app/dbt/dbt/profiles.yml
  
[0m22:02:40.789206 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.078284286, "process_in_blocks": "0", "process_kernel_time": 0.339181, "process_mem_max_rss": "104184", "process_out_blocks": "0", "process_user_time": 0.973651}
[0m22:02:40.790145 [debug] [MainThread]: Command `dbt run` failed at 22:02:40.790055 after 0.08 seconds
[0m22:02:40.790956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x706ad5ed2d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x706ad16ccb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x706ad16cfe50>]}
[0m22:02:40.791716 [debug] [MainThread]: Flushing usage events
[0m22:02:41.584249 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:02:44.274610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5d223aa3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5d226b47d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5d226b4710>]}


============================== 22:02:44.284477 | edf0d116-2e21-4803-a1fc-6a021ecd2719 ==============================
[0m22:02:44.284477 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:02:44.288407 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'use_experimental_parser': 'False', 'static_parser': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'printer_width': '80', 'no_print': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'fail_fast': 'False', 'target_path': 'None', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'introspect': 'True', 'log_format': 'default', 'version_check': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False'}
[0m22:02:44.308129 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /usr/app/dbt/dbt/profiles.yml
  
[0m22:02:44.314224 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.13790442, "process_in_blocks": "0", "process_kernel_time": 0.329933, "process_mem_max_rss": "104192", "process_out_blocks": "0", "process_user_time": 0.942099}
[0m22:02:44.316722 [debug] [MainThread]: Command `dbt run` failed at 22:02:44.316593 after 0.14 seconds
[0m22:02:44.318129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5d226b4710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5d226b4490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5d223a3fd0>]}
[0m22:02:44.320145 [debug] [MainThread]: Flushing usage events
[0m22:02:45.047304 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:02:48.614274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a052db7cbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a052db48f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a052db496d0>]}


============================== 22:02:48.622981 | 570e3782-600f-4622-9cd2-56c78fb791aa ==============================
[0m22:02:48.622981 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:02:48.626589 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'write_json': 'True', 'warn_error': 'None', 'empty': 'False', 'static_parser': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'debug': 'False', 'introspect': 'True', 'cache_selected_only': 'False'}
[0m22:02:48.637684 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /usr/app/dbt/dbt/profiles.yml
  
[0m22:02:48.639154 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.09573463, "process_in_blocks": "0", "process_kernel_time": 0.325589, "process_mem_max_rss": "104192", "process_out_blocks": "0", "process_user_time": 1.0652}
[0m22:02:48.640982 [debug] [MainThread]: Command `dbt run` failed at 22:02:48.640761 after 0.10 seconds
[0m22:02:48.642959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a052db8a950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a052db7de10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a052deb8d90>]}
[0m22:02:48.644026 [debug] [MainThread]: Flushing usage events
[0m22:02:49.455610 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:02:54.645763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768a295ca750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768a295955d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768a29594490>]}


============================== 22:02:54.654471 | 183ab491-0576-4042-a127-e2e1c9f24ae4 ==============================
[0m22:02:54.654471 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:02:54.656520 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'log_cache_events': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'version_check': 'True', 'quiet': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'no_print': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'static_parser': 'True', 'printer_width': '80', 'invocation_command': 'dbt run', 'target_path': 'None', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'write_json': 'True', 'introspect': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True'}
[0m22:02:54.669556 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /usr/app/dbt/dbt/profiles.yml
  
[0m22:02:54.671917 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.13827485, "process_in_blocks": "0", "process_kernel_time": 0.278324, "process_mem_max_rss": "103908", "process_out_blocks": "0", "process_user_time": 1.057633}
[0m22:02:54.673501 [debug] [MainThread]: Command `dbt run` failed at 22:02:54.673302 after 0.14 seconds
[0m22:02:54.674632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768a299d0410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768a295ca4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768a295cbf50>]}
[0m22:02:54.675896 [debug] [MainThread]: Flushing usage events
[0m22:02:55.399825 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:03:03.849650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b387db4d790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3880887810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b387db9e810>]}


============================== 22:03:03.855383 | 3b25f55d-eae3-474c-92bc-f5a1622c1aa8 ==============================
[0m22:03:03.855383 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:03:03.858184 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'introspect': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'version_check': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'log_format': 'default', 'static_parser': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'printer_width': '80', 'empty': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'debug': 'False', 'quiet': 'False'}
[0m22:03:03.867870 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /usr/app/dbt/dbt/profiles.yml
  
[0m22:03:03.870039 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.095092185, "process_in_blocks": "0", "process_kernel_time": 0.402365, "process_mem_max_rss": "104428", "process_out_blocks": "0", "process_user_time": 1.119452}
[0m22:03:03.872017 [debug] [MainThread]: Command `dbt run` failed at 22:03:03.871906 after 0.10 seconds
[0m22:03:03.873142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b388238ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b387dd978d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b387e150a50>]}
[0m22:03:03.876045 [debug] [MainThread]: Flushing usage events
[0m22:03:04.514238 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:03:19.256673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ffdadbdad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ffdad88550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ffdad89250>]}


============================== 22:03:19.263966 | 469f5da1-441e-4d8a-8ce4-2ecd45592223 ==============================
[0m22:03:19.263966 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:03:19.266267 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'invocation_command': 'dbt run', 'log_cache_events': 'False', 'fail_fast': 'False', 'no_print': 'None', 'printer_width': '80', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'empty': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'debug': 'False', 'introspect': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'target_path': 'None', 'partial_parse': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True'}
[0m22:03:19.283123 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /usr/app/dbt/dbt/profiles.yml
  
[0m22:03:19.285883 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.101348504, "process_in_blocks": "0", "process_kernel_time": 0.329696, "process_mem_max_rss": "103924", "process_out_blocks": "0", "process_user_time": 1.088397}
[0m22:03:19.290251 [debug] [MainThread]: Command `dbt run` failed at 22:03:19.289983 after 0.11 seconds
[0m22:03:19.292076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ffdf5d2e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ffdadbe3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ffdad89210>]}
[0m22:03:19.293755 [debug] [MainThread]: Flushing usage events
[0m22:03:19.964253 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:03:47.831345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c36714ea210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3672359b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c36714e2410>]}


============================== 22:03:47.842672 | 18565f1c-d574-462a-a9b7-dc259aefeaf2 ==============================
[0m22:03:47.842672 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:03:47.845121 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'empty': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'target_path': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'introspect': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'printer_width': '80', 'profiles_dir': '/usr/app/dbt/dbt', 'write_json': 'True'}
[0m22:03:47.858920 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /usr/app/dbt/dbt/profiles.yml
  
[0m22:03:47.862726 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.101612315, "process_in_blocks": "0", "process_kernel_time": 0.397136, "process_mem_max_rss": "103556", "process_out_blocks": "0", "process_user_time": 1.159638}
[0m22:03:47.865581 [debug] [MainThread]: Command `dbt run` failed at 22:03:47.865443 after 0.10 seconds
[0m22:03:47.866544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3675ceec50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3671492250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3675db2b90>]}
[0m22:03:47.867611 [debug] [MainThread]: Flushing usage events
[0m22:03:48.744994 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:04:42.102625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742bd34c70d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742bd0761ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742bd0762ad0>]}


============================== 22:04:42.115716 | a729b193-19e3-41b5-aca1-2b2305ad51f1 ==============================
[0m22:04:42.115716 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:04:42.119543 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'fail_fast': 'False', 'target_path': 'None', 'cache_selected_only': 'False', 'static_parser': 'True', 'quiet': 'False', 'warn_error': 'None', 'introspect': 'True', 'printer_width': '80', 'profiles_dir': '/usr/app/dbt/dbt', 'no_print': 'None', 'version_check': 'True', 'use_experimental_parser': 'False', 'use_colors': 'True', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'debug': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'write_json': 'True'}
[0m22:04:42.293151 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:04:42.295628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a729b193-19e3-41b5-aca1-2b2305ad51f1', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742bd0780fd0>]}
[0m22:04:42.397334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a729b193-19e3-41b5-aca1-2b2305ad51f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742bcff18f50>]}
[0m22:04:42.450611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a729b193-19e3-41b5-aca1-2b2305ad51f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742bd34de6d0>]}
[0m22:04:42.453298 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:04:42.778613 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:04:42.825387 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:04:42.830250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a729b193-19e3-41b5-aca1-2b2305ad51f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742bcfb9e3d0>]}
[0m22:04:46.130124 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:04:46.133069 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:04:46.136305 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.1923976, "process_in_blocks": "1472", "process_kernel_time": 0.596056, "process_mem_max_rss": "118196", "process_out_blocks": "0", "process_user_time": 2.3882}
[0m22:04:46.138482 [debug] [MainThread]: Command `dbt run` failed at 22:04:46.138374 after 4.19 seconds
[0m22:04:46.141613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742bd4fcae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742bd4fcae90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742bcfbc1190>]}
[0m22:04:46.144064 [debug] [MainThread]: Flushing usage events
[0m22:04:46.820961 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:05:21.785469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790fc47fa110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790fc47f9c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790fc47abe50>]}


============================== 22:05:21.794015 | 9e83294b-fcf4-48b5-948d-a3838293ed42 ==============================
[0m22:05:21.794015 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:05:21.795576 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'log_cache_events': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'static_parser': 'True', 'quiet': 'False', 'fail_fast': 'False', 'log_format': 'default', 'indirect_selection': 'eager', 'no_print': 'None', 'use_colors': 'True', 'write_json': 'True', 'debug': 'False', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'target_path': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'introspect': 'True', 'printer_width': '80'}
[0m22:05:21.860203 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:05:21.861890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9e83294b-fcf4-48b5-948d-a3838293ed42', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790fc47a5610>]}
[0m22:05:21.942787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9e83294b-fcf4-48b5-948d-a3838293ed42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790fc3b5c750>]}
[0m22:05:21.985941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9e83294b-fcf4-48b5-948d-a3838293ed42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790fc750a910>]}
[0m22:05:21.988831 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:05:22.137366 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:05:22.161171 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:05:22.162872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9e83294b-fcf4-48b5-948d-a3838293ed42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790fc37d86d0>]}
[0m22:05:25.262452 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:05:25.265084 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:05:25.268715 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.5570295, "process_in_blocks": "0", "process_kernel_time": 0.617405, "process_mem_max_rss": "117528", "process_out_blocks": "0", "process_user_time": 2.325293}
[0m22:05:25.271526 [debug] [MainThread]: Command `dbt run` failed at 22:05:25.271301 after 3.56 seconds
[0m22:05:25.273231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790fc4805f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790fc4806110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790fc49fb050>]}
[0m22:05:25.274891 [debug] [MainThread]: Flushing usage events
[0m22:05:26.018153 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:05:28.201642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cfb0001bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cfb111b0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cfb00a7c50>]}


============================== 22:05:28.209111 | 5069d877-4360-4532-8964-c705edb1515e ==============================
[0m22:05:28.209111 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:05:28.211384 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/usr/app/dbt/dbt', 'log_format': 'default', 'printer_width': '80', 'log_cache_events': 'False', 'debug': 'False', 'write_json': 'True', 'empty': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'introspect': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'fail_fast': 'False', 'version_check': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'warn_error': 'None', 'target_path': 'None'}
[0m22:05:28.271944 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:05:28.273658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '5069d877-4360-4532-8964-c705edb1515e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cfb0003bd0>]}
[0m22:05:28.348314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5069d877-4360-4532-8964-c705edb1515e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cfaf312850>]}
[0m22:05:28.404327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5069d877-4360-4532-8964-c705edb1515e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cfb2d14850>]}
[0m22:05:28.409962 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:05:28.562639 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:05:28.579080 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:05:28.580339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5069d877-4360-4532-8964-c705edb1515e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cfaff9c850>]}
[0m22:05:30.967511 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:05:30.969589 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:05:30.971134 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.8367815, "process_in_blocks": "0", "process_kernel_time": 0.546657, "process_mem_max_rss": "117664", "process_out_blocks": "0", "process_user_time": 2.272301}
[0m22:05:30.972218 [debug] [MainThread]: Command `dbt run` failed at 22:05:30.972138 after 2.84 seconds
[0m22:05:30.973324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cfb4806e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cfb0408290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cfaf368f90>]}
[0m22:05:30.974240 [debug] [MainThread]: Flushing usage events
[0m22:05:31.768386 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:05:33.940586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcf7436350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcf829e050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcf7788a90>]}


============================== 22:05:33.946888 | fff85a4c-5170-4143-8adc-499e520ef92e ==============================
[0m22:05:33.946888 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:05:33.948865 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'partial_parse': 'True', 'target_path': 'None', 'printer_width': '80', 'introspect': 'True', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'write_json': 'True', 'quiet': 'False', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'warn_error': 'None', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'use_colors': 'True', 'fail_fast': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'empty': 'False'}
[0m22:05:34.006447 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:05:34.008112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'fff85a4c-5170-4143-8adc-499e520ef92e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcf73e7ed0>]}
[0m22:05:34.079999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fff85a4c-5170-4143-8adc-499e520ef92e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcf65462d0>]}
[0m22:05:34.123215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fff85a4c-5170-4143-8adc-499e520ef92e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcfa144690>]}
[0m22:05:34.126234 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:05:34.343464 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:05:34.431837 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:05:34.433368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fff85a4c-5170-4143-8adc-499e520ef92e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcf65ab2d0>]}
[0m22:05:37.004150 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:05:37.006098 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:05:37.008559 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.1499603, "process_in_blocks": "0", "process_kernel_time": 0.572933, "process_mem_max_rss": "117640", "process_out_blocks": "0", "process_user_time": 2.167533}
[0m22:05:37.010015 [debug] [MainThread]: Command `dbt run` failed at 22:05:37.009803 after 3.15 seconds
[0m22:05:37.011324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcf73e1250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcf51e9850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcf75e0b10>]}
[0m22:05:37.012894 [debug] [MainThread]: Flushing usage events
[0m22:05:37.905384 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:05:40.272383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72b7b874ae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72b7b8880110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72b7b874a690>]}


============================== 22:05:40.285001 | 6bd2f5bc-6434-49a6-90ee-cc303ca17b51 ==============================
[0m22:05:40.285001 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:05:40.287379 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'debug': 'False', 'quiet': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'partial_parse': 'True', 'use_colors': 'True', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'no_print': 'None', 'write_json': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'fail_fast': 'False', 'printer_width': '80', 'cache_selected_only': 'False'}
[0m22:05:40.353261 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:05:40.355225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6bd2f5bc-6434-49a6-90ee-cc303ca17b51', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72b7b87a1950>]}
[0m22:05:40.424371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6bd2f5bc-6434-49a6-90ee-cc303ca17b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72b7b7bca890>]}
[0m22:05:40.490012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6bd2f5bc-6434-49a6-90ee-cc303ca17b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72b7bb44ab90>]}
[0m22:05:40.492626 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:05:40.646290 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:05:40.679001 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:05:40.679900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6bd2f5bc-6434-49a6-90ee-cc303ca17b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72b7b8a707d0>]}
[0m22:05:42.837553 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:05:42.840371 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:05:42.846442 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.634635, "process_in_blocks": "0", "process_kernel_time": 0.458701, "process_mem_max_rss": "117800", "process_out_blocks": "0", "process_user_time": 2.277268}
[0m22:05:42.848401 [debug] [MainThread]: Command `dbt run` failed at 22:05:42.848200 after 2.64 seconds
[0m22:05:42.849839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72b7bcf42d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72b7b8708c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72b7b675e050>]}
[0m22:05:42.851570 [debug] [MainThread]: Flushing usage events
[0m22:05:43.673085 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:05:46.451258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c6f60261d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c6f60324d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c6f6026150>]}


============================== 22:05:46.460125 | 313ee6ba-1c1d-4916-baa9-e23d9ad4ae33 ==============================
[0m22:05:46.460125 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:05:46.462380 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'fail_fast': 'False', 'log_format': 'default', 'version_check': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'quiet': 'False', 'write_json': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'empty': 'False', 'printer_width': '80', 'cache_selected_only': 'False', 'static_parser': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'debug': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m22:05:46.538594 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:05:46.540089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '313ee6ba-1c1d-4916-baa9-e23d9ad4ae33', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c6f5fd3b50>]}
[0m22:05:46.609950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '313ee6ba-1c1d-4916-baa9-e23d9ad4ae33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c6f53577d0>]}
[0m22:05:46.674610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '313ee6ba-1c1d-4916-baa9-e23d9ad4ae33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c6f8d344d0>]}
[0m22:05:46.679067 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:05:46.983708 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:05:47.012817 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:05:47.015390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '313ee6ba-1c1d-4916-baa9-e23d9ad4ae33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c6f57080d0>]}
[0m22:05:49.731028 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:05:49.734202 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:05:49.737329 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.4094687, "process_in_blocks": "0", "process_kernel_time": 0.623924, "process_mem_max_rss": "117788", "process_out_blocks": "0", "process_user_time": 2.198007}
[0m22:05:49.739711 [debug] [MainThread]: Command `dbt run` failed at 22:05:49.739521 after 3.41 seconds
[0m22:05:49.742200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c6f614f5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c6f47d3b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c6fa8e6a50>]}
[0m22:05:49.744001 [debug] [MainThread]: Flushing usage events
[0m22:05:50.694838 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:05:54.302807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x727003a8a6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x727005a104d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x727003a8a890>]}


============================== 22:05:54.313518 | 5aec6715-2743-4876-90da-5c44a13e3b0c ==============================
[0m22:05:54.313518 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:05:54.319457 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'printer_width': '80', 'warn_error': 'None', 'debug': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'target_path': 'None', 'partial_parse': 'True', 'no_print': 'None', 'cache_selected_only': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'write_json': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'fail_fast': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'use_colors': 'True', 'quiet': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'invocation_command': 'dbt run'}
[0m22:05:54.383171 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:05:54.391677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '5aec6715-2743-4876-90da-5c44a13e3b0c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x727003dbce50>]}
[0m22:05:54.488361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5aec6715-2743-4876-90da-5c44a13e3b0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x727002b6a610>]}
[0m22:05:54.534894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5aec6715-2743-4876-90da-5c44a13e3b0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x727006798910>]}
[0m22:05:54.536783 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:05:54.743214 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:05:54.783443 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:05:54.794432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5aec6715-2743-4876-90da-5c44a13e3b0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x727002b4ff10>]}
[0m22:05:57.114052 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:05:57.116430 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:05:57.118432 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.8976145, "process_in_blocks": "0", "process_kernel_time": 0.464031, "process_mem_max_rss": "118008", "process_out_blocks": "0", "process_user_time": 2.185309}
[0m22:05:57.120225 [debug] [MainThread]: Command `dbt run` failed at 22:05:57.120120 after 2.90 seconds
[0m22:05:57.122323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72700828ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x727003b57b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x727001f1e110>]}
[0m22:05:57.124346 [debug] [MainThread]: Flushing usage events
[0m22:05:57.968171 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:06:03.042695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa37593cbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa375946ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa375946550>]}


============================== 22:06:03.048844 | 77d7ded9-f9df-4de9-a043-376367ce15db ==============================
[0m22:06:03.048844 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:06:03.050185 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'warn_error': 'None', 'empty': 'False', 'partial_parse': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'version_check': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'use_colors': 'True', 'no_print': 'None', 'debug': 'False', 'introspect': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'log_format': 'default', 'fail_fast': 'False', 'target_path': 'None', 'indirect_selection': 'eager', 'write_json': 'True'}
[0m22:06:03.102428 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:06:03.104059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '77d7ded9-f9df-4de9-a043-376367ce15db', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa3758e9ad0>]}
[0m22:06:03.191799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '77d7ded9-f9df-4de9-a043-376367ce15db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa374dddb90>]}
[0m22:06:03.244641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '77d7ded9-f9df-4de9-a043-376367ce15db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa378666c50>]}
[0m22:06:03.246598 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:06:03.349373 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:06:03.357830 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:06:03.358722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '77d7ded9-f9df-4de9-a043-376367ce15db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa374dd4350>]}
[0m22:06:05.849595 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:06:05.852096 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:06:05.854925 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.892235, "process_in_blocks": "0", "process_kernel_time": 0.430029, "process_mem_max_rss": "117704", "process_out_blocks": "0", "process_user_time": 2.210998}
[0m22:06:05.856648 [debug] [MainThread]: Command `dbt run` failed at 22:06:05.856445 after 2.89 seconds
[0m22:06:05.858380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa3758e8150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa3758eaa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa373dd9f90>]}
[0m22:06:05.859620 [debug] [MainThread]: Flushing usage events
[0m22:06:06.738050 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:06:15.223221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73013a814d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73013a4b8190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73013a4b8890>]}


============================== 22:06:15.229661 | d24ac611-5830-4ae6-87f6-9ac295b824b3 ==============================
[0m22:06:15.229661 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:06:15.230994 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'quiet': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'use_colors': 'True', 'debug': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'warn_error': 'None', 'static_parser': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'empty': 'False', 'target_path': 'None', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'invocation_command': 'dbt run', 'partial_parse': 'True'}
[0m22:06:15.277836 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:06:15.279079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd24ac611-5830-4ae6-87f6-9ac295b824b3', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73013a523090>]}
[0m22:06:15.346261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd24ac611-5830-4ae6-87f6-9ac295b824b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7301395760d0>]}
[0m22:06:15.398800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd24ac611-5830-4ae6-87f6-9ac295b824b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73013d214c10>]}
[0m22:06:15.403978 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:06:15.518284 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:06:15.531649 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:06:15.533042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd24ac611-5830-4ae6-87f6-9ac295b824b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x730139582b90>]}
[0m22:06:17.759886 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:06:17.761846 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:06:17.764330 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.6385384, "process_in_blocks": "0", "process_kernel_time": 0.335923, "process_mem_max_rss": "117052", "process_out_blocks": "0", "process_user_time": 2.38424}
[0m22:06:17.766115 [debug] [MainThread]: Command `dbt run` failed at 22:06:17.765769 after 2.64 seconds
[0m22:06:17.767745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73013a4a3d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73013895c210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x730138d05f90>]}
[0m22:06:17.769239 [debug] [MainThread]: Flushing usage events
[0m22:06:18.445110 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:06:33.276502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7645b1e26810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7645b2e1d5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7645b1e32ad0>]}


============================== 22:06:33.283568 | 4c8031c2-494a-4e2b-868c-09d5fcf55a0c ==============================
[0m22:06:33.283568 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:06:33.285462 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'empty': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'cache_selected_only': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'use_colors': 'True', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'quiet': 'False', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'printer_width': '80', 'debug': 'False', 'no_print': 'None', 'partial_parse': 'True', 'target_path': 'None', 'static_parser': 'True'}
[0m22:06:33.351173 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:06:33.352888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '4c8031c2-494a-4e2b-868c-09d5fcf55a0c', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7645b1e6f090>]}
[0m22:06:33.434319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4c8031c2-494a-4e2b-868c-09d5fcf55a0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7645b1d0e890>]}
[0m22:06:33.483064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4c8031c2-494a-4e2b-868c-09d5fcf55a0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7645b11f9f10>]}
[0m22:06:33.485073 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:06:33.647798 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:06:33.668811 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:06:33.673044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4c8031c2-494a-4e2b-868c-09d5fcf55a0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7645b1e269d0>]}
[0m22:06:36.750832 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:06:36.753443 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:06:36.757665 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.5591166, "process_in_blocks": "0", "process_kernel_time": 0.438284, "process_mem_max_rss": "117920", "process_out_blocks": "0", "process_user_time": 2.317225}
[0m22:06:36.759080 [debug] [MainThread]: Command `dbt run` failed at 22:06:36.758970 after 3.56 seconds
[0m22:06:36.760140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7645b1e32950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7645b019e850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7645b01f6050>]}
[0m22:06:36.761004 [debug] [MainThread]: Flushing usage events
[0m22:06:37.518961 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:07:05.187930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5c901ea5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5c901ea550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5c901ea790>]}


============================== 22:07:05.194217 | 2a7fe359-465c-45d6-9922-c4e283871bb4 ==============================
[0m22:07:05.194217 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:07:05.196085 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'no_print': 'None', 'introspect': 'True', 'use_colors': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'empty': 'False', 'debug': 'False', 'log_cache_events': 'False', 'write_json': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'version_check': 'True'}
[0m22:07:05.268516 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:07:05.271680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '2a7fe359-465c-45d6-9922-c4e283871bb4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5c900d2910>]}
[0m22:07:05.371382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2a7fe359-465c-45d6-9922-c4e283871bb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5c8f5a1290>]}
[0m22:07:05.414038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2a7fe359-465c-45d6-9922-c4e283871bb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5c92ef2850>]}
[0m22:07:05.417286 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:07:05.579454 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:07:05.601210 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:07:05.603344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '2a7fe359-465c-45d6-9922-c4e283871bb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5c8f5edd10>]}
[0m22:07:08.581550 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:07:08.583408 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:07:08.586076 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.4606073, "process_in_blocks": "0", "process_kernel_time": 0.404572, "process_mem_max_rss": "117828", "process_out_blocks": "0", "process_user_time": 2.37484}
[0m22:07:08.587529 [debug] [MainThread]: Command `dbt run` failed at 22:07:08.587379 after 3.46 seconds
[0m22:07:08.588672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5c949d2d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5c901f6950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5c8e5264d0>]}
[0m22:07:08.589907 [debug] [MainThread]: Flushing usage events
[0m22:07:09.342386 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:07:46.325842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af98aed1910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af98aed7cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af98aed13d0>]}


============================== 22:07:46.332051 | df2eb243-d140-4b02-a195-2f471f0588b4 ==============================
[0m22:07:46.332051 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:07:46.333572 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'debug': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'target_path': 'None', 'use_colors': 'True', 'introspect': 'True', 'printer_width': '80', 'fail_fast': 'False', 'version_check': 'True', 'log_format': 'default', 'quiet': 'False', 'invocation_command': 'dbt run', 'static_parser': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'empty': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True'}
[0m22:07:46.392839 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:07:46.394434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'df2eb243-d140-4b02-a195-2f471f0588b4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af98a369910>]}
[0m22:07:46.484747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df2eb243-d140-4b02-a195-2f471f0588b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af98a3f1390>]}
[0m22:07:46.536830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df2eb243-d140-4b02-a195-2f471f0588b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af98af26510>]}
[0m22:07:46.539180 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:07:46.698087 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:07:46.730801 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:07:46.732655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'df2eb243-d140-4b02-a195-2f471f0588b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af98b2581d0>]}
[0m22:07:49.624994 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:07:49.627475 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:07:49.630211 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.3725836, "process_in_blocks": "0", "process_kernel_time": 0.476681, "process_mem_max_rss": "117068", "process_out_blocks": "0", "process_user_time": 2.336133}
[0m22:07:49.632319 [debug] [MainThread]: Command `dbt run` failed at 22:07:49.632241 after 3.37 seconds
[0m22:07:49.633664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af98f7eea50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af98af31fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af98a3d1850>]}
[0m22:07:49.634690 [debug] [MainThread]: Flushing usage events
[0m22:07:50.502018 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:07:52.662762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725d66646b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725d66651e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725d66652290>]}


============================== 22:07:52.672857 | 535c5180-d62a-416d-887d-d80425e42ecb ==============================
[0m22:07:52.672857 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:07:52.675784 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'use_colors': 'True', 'version_check': 'True', 'no_print': 'None', 'warn_error': 'None', 'debug': 'False', 'log_format': 'default', 'static_parser': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'empty': 'False', 'partial_parse': 'True', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'log_path': '/usr/app/dbt/dbt/logs', 'introspect': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'target_path': 'None', 'cache_selected_only': 'False'}
[0m22:07:52.751623 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:07:52.754157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '535c5180-d62a-416d-887d-d80425e42ecb', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725d666ae110>]}
[0m22:07:52.841808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '535c5180-d62a-416d-887d-d80425e42ecb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725d65373810>]}
[0m22:07:52.888686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '535c5180-d62a-416d-887d-d80425e42ecb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725d69360710>]}
[0m22:07:52.892269 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:07:53.081837 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:07:53.095774 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:07:53.096791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '535c5180-d62a-416d-887d-d80425e42ecb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725d64b1f2d0>]}
[0m22:07:55.718781 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:07:55.720728 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:07:55.723093 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.1381123, "process_in_blocks": "0", "process_kernel_time": 0.389928, "process_mem_max_rss": "117096", "process_out_blocks": "0", "process_user_time": 2.198876}
[0m22:07:55.724419 [debug] [MainThread]: Command `dbt run` failed at 22:07:55.724323 after 3.14 seconds
[0m22:07:55.727310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725d6ae4ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725d64b07b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725d665e0490>]}
[0m22:07:55.728036 [debug] [MainThread]: Flushing usage events
[0m22:07:56.559502 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:07:58.635259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e6da91910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e6ddf8990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e6da91f10>]}


============================== 22:07:58.640980 | 370493bb-edda-44a6-bfc5-7d192dd0e9a1 ==============================
[0m22:07:58.640980 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:07:58.643055 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'printer_width': '80', 'log_path': '/usr/app/dbt/dbt/logs', 'invocation_command': 'dbt run', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'empty': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'version_check': 'True', 'quiet': 'False', 'log_cache_events': 'False'}
[0m22:07:58.700163 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:07:58.701902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '370493bb-edda-44a6-bfc5-7d192dd0e9a1', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e6da93450>]}
[0m22:07:58.780149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '370493bb-edda-44a6-bfc5-7d192dd0e9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e6dae6d10>]}
[0m22:07:58.828737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '370493bb-edda-44a6-bfc5-7d192dd0e9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e707f4690>]}
[0m22:07:58.830987 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:07:58.979207 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:07:58.998401 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:07:58.999989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '370493bb-edda-44a6-bfc5-7d192dd0e9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e6cbc0950>]}
[0m22:08:01.597466 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:08:01.600424 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:08:01.602835 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.04219, "process_in_blocks": "0", "process_kernel_time": 0.421374, "process_mem_max_rss": "117976", "process_out_blocks": "0", "process_user_time": 2.175095}
[0m22:08:01.604480 [debug] [MainThread]: Command `dbt run` failed at 22:08:01.604311 after 3.04 seconds
[0m22:08:01.605901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e722e2d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e6cf2a7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e6bbcaf90>]}
[0m22:08:01.606885 [debug] [MainThread]: Flushing usage events
[0m22:08:02.388176 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:08:05.064385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc0eef90610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc0ec275450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc0ec2b5f90>]}


============================== 22:08:05.071805 | 086bac93-43ee-45ed-a087-1d7bf76ddc92 ==============================
[0m22:08:05.071805 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:08:05.074196 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'warn_error': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'fail_fast': 'False', 'write_json': 'True', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'printer_width': '80', 'static_parser': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'introspect': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'quiet': 'False', 'empty': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'target_path': 'None'}
[0m22:08:05.129815 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:08:05.131428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '086bac93-43ee-45ed-a087-1d7bf76ddc92', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc0ed11db90>]}
[0m22:08:05.207441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '086bac93-43ee-45ed-a087-1d7bf76ddc92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc0ed27c910>]}
[0m22:08:05.253783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '086bac93-43ee-45ed-a087-1d7bf76ddc92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc0eefb8b90>]}
[0m22:08:05.256152 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:08:05.467381 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:08:05.502635 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:08:05.504337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '086bac93-43ee-45ed-a087-1d7bf76ddc92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc0ea714b10>]}
[0m22:08:09.137603 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:08:09.139311 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:08:09.141722 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.2057467, "process_in_blocks": "0", "process_kernel_time": 0.418153, "process_mem_max_rss": "117680", "process_out_blocks": "0", "process_user_time": 2.479937}
[0m22:08:09.143198 [debug] [MainThread]: Command `dbt run` failed at 22:08:09.143096 after 4.21 seconds
[0m22:08:09.144126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc0f0ab2c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc0eb3cbb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc0eafd8b10>]}
[0m22:08:09.144994 [debug] [MainThread]: Flushing usage events
[0m22:08:09.766127 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:08:12.915038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75918b5d9750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75918b5da490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75918b5d8290>]}


============================== 22:08:12.924087 | ab0f950e-d8d9-4f28-9c92-e12e2161ba17 ==============================
[0m22:08:12.924087 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:08:12.927377 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'write_json': 'True', 'introspect': 'True', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'empty': 'False', 'no_print': 'None', 'target_path': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'version_check': 'True', 'printer_width': '80', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'warn_error': 'None'}
[0m22:08:13.016344 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:08:13.018849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ab0f950e-d8d9-4f28-9c92-e12e2161ba17', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75918b657350>]}
[0m22:08:13.109504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ab0f950e-d8d9-4f28-9c92-e12e2161ba17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75918a7b3150>]}
[0m22:08:13.173715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ab0f950e-d8d9-4f28-9c92-e12e2161ba17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75918e3607d0>]}
[0m22:08:13.180480 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:08:13.546532 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:08:13.613386 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:08:13.615646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ab0f950e-d8d9-4f28-9c92-e12e2161ba17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75918b5d8350>]}
[0m22:08:16.654832 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:08:16.657531 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:08:16.660489 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.8702667, "process_in_blocks": "0", "process_kernel_time": 0.477466, "process_mem_max_rss": "117000", "process_out_blocks": "0", "process_user_time": 2.563238}
[0m22:08:16.662434 [debug] [MainThread]: Command `dbt run` failed at 22:08:16.662244 after 3.87 seconds
[0m22:08:16.669043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7591897ead90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75918932bf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75918b62ed90>]}
[0m22:08:16.671313 [debug] [MainThread]: Flushing usage events
[0m22:08:17.331908 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:08:21.431234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b05a9f6b550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b05a9f16990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b05a9f6b450>]}


============================== 22:08:21.441965 | 151c517f-72ba-40cb-84ac-e0159fbf207d ==============================
[0m22:08:21.441965 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:08:21.445238 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'debug': 'False', 'empty': 'False', 'partial_parse': 'True', 'target_path': 'None', 'introspect': 'True', 'quiet': 'False', 'write_json': 'True', 'printer_width': '80', 'fail_fast': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'version_check': 'True', 'no_print': 'None'}
[0m22:08:21.531588 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:08:21.534008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '151c517f-72ba-40cb-84ac-e0159fbf207d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b05a9f15d50>]}
[0m22:08:21.623897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '151c517f-72ba-40cb-84ac-e0159fbf207d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b05a9f34d50>]}
[0m22:08:21.672300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '151c517f-72ba-40cb-84ac-e0159fbf207d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b05a9f06390>]}
[0m22:08:21.679448 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:08:21.807136 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:08:21.823346 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:08:21.825105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '151c517f-72ba-40cb-84ac-e0159fbf207d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b05a8bfdcd0>]}
[0m22:08:24.866195 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:08:24.870991 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:08:24.874107 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.5701041, "process_in_blocks": "0", "process_kernel_time": 0.46824, "process_mem_max_rss": "117556", "process_out_blocks": "0", "process_user_time": 2.484625}
[0m22:08:24.875992 [debug] [MainThread]: Command `dbt run` failed at 22:08:24.875892 after 3.57 seconds
[0m22:08:24.877722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b05ae77ef10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b05a9f72710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b05a7f08f90>]}
[0m22:08:24.880040 [debug] [MainThread]: Flushing usage events
[0m22:08:25.766965 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:08:31.382026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2c2f3029d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2c2f2c9350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2c2f2c85d0>]}


============================== 22:08:31.389593 | cee3ff52-1292-4386-be5f-7aa33a859765 ==============================
[0m22:08:31.389593 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:08:31.391914 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'use_colors': 'True', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'version_check': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'target_path': 'None', 'partial_parse': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'debug': 'False', 'printer_width': '80', 'static_parser': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'profiles_dir': '/usr/app/dbt/dbt'}
[0m22:08:31.466124 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:08:31.468087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'cee3ff52-1292-4386-be5f-7aa33a859765', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2c2e79edd0>]}
[0m22:08:31.563383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cee3ff52-1292-4386-be5f-7aa33a859765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2c2e79cdd0>]}
[0m22:08:31.607400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cee3ff52-1292-4386-be5f-7aa33a859765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2c32012750>]}
[0m22:08:31.610474 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:08:31.803604 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:08:31.830423 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:08:31.831965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'cee3ff52-1292-4386-be5f-7aa33a859765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2c2dfed490>]}
[0m22:08:34.793589 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:08:34.795444 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:08:34.797244 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.5047119, "process_in_blocks": "0", "process_kernel_time": 0.49366, "process_mem_max_rss": "117668", "process_out_blocks": "0", "process_user_time": 2.586444}
[0m22:08:34.798865 [debug] [MainThread]: Command `dbt run` failed at 22:08:34.798715 after 3.51 seconds
[0m22:08:34.800150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2c2f2c9350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2c2f30e350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2c2f30e190>]}
[0m22:08:34.801393 [debug] [MainThread]: Flushing usage events
[0m22:08:35.574220 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:08:44.094345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726724cc1090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726724cc2f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7267251235d0>]}


============================== 22:08:44.101398 | 3b612aa2-666d-4ecf-9745-6e7561581d93 ==============================
[0m22:08:44.101398 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:08:44.102918 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'quiet': 'False', 'log_cache_events': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'fail_fast': 'False', 'log_format': 'default', 'empty': 'False', 'no_print': 'None', 'printer_width': '80', 'debug': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'version_check': 'True', 'use_colors': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:08:44.168261 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:08:44.173232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3b612aa2-666d-4ecf-9745-6e7561581d93', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726724d3e0d0>]}
[0m22:08:44.250358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3b612aa2-666d-4ecf-9745-6e7561581d93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726723d227d0>]}
[0m22:08:44.297100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3b612aa2-666d-4ecf-9745-6e7561581d93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726727a4c810>]}
[0m22:08:44.301174 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:08:44.486581 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:08:44.563777 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:08:44.566416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3b612aa2-666d-4ecf-9745-6e7561581d93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7267239e1110>]}
[0m22:08:47.617956 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:08:47.620902 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ConfigSourcePathDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:08:47.624160 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.596013, "process_in_blocks": "0", "process_kernel_time": 0.455309, "process_mem_max_rss": "117744", "process_out_blocks": "0", "process_user_time": 2.341589}
[0m22:08:47.626101 [debug] [MainThread]: Command `dbt run` failed at 22:08:47.625869 after 3.60 seconds
[0m22:08:47.627919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726724cc2d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726724cc1090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7267241b3f90>]}
[0m22:08:47.629513 [debug] [MainThread]: Flushing usage events
[0m22:08:48.388145 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:09:03.258747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ca173323d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ca1733e050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ca17333b10>]}


============================== 22:09:03.265830 | ebcc3727-ebcf-4856-8bd1-a29d4c7b9f91 ==============================
[0m22:09:03.265830 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:09:03.267750 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'log_format': 'default', 'log_path': '/usr/app/dbt/dbt/logs', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'printer_width': '80', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False', 'introspect': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'version_check': 'True', 'use_colors': 'True', 'quiet': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'static_parser': 'True', 'target_path': 'None', 'debug': 'False', 'no_print': 'None', 'profiles_dir': '/usr/app/dbt/dbt'}
[0m22:09:03.334214 [error] [MainThread]: Encountered an error:
Runtime Error
  Required "name" field not present in project

Error encountered in /usr/app/dbt/dbt/dbt_project.yml
[0m22:09:03.337251 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.17175733, "process_in_blocks": "0", "process_kernel_time": 0.292533, "process_mem_max_rss": "108660", "process_out_blocks": "0", "process_user_time": 1.150369}
[0m22:09:03.338677 [debug] [MainThread]: Command `dbt run` failed at 22:09:03.338537 after 0.17 seconds
[0m22:09:03.339760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ca181a1950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ca1bbfaa50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ca172dda90>]}
[0m22:09:03.340855 [debug] [MainThread]: Flushing usage events
[0m22:09:04.066060 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:09:31.609610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5fac9ee8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5fac9ee650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5fac9ee610>]}


============================== 22:09:31.621622 | f58e8f66-1932-44f0-916e-139117b9653f ==============================
[0m22:09:31.621622 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:09:31.638731 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'introspect': 'True', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'log_format': 'default', 'target_path': 'None', 'quiet': 'False', 'no_print': 'None', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'partial_parse': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'log_cache_events': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'invocation_command': 'dbt run', 'static_parser': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager'}
[0m22:09:31.732377 [error] [MainThread]: Encountered an error:
Runtime Error
  Required "name" field not present in project

Error encountered in /usr/app/dbt/dbt/dbt_project.yml
[0m22:09:31.734749 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.22383465, "process_in_blocks": "0", "process_kernel_time": 0.25194, "process_mem_max_rss": "108984", "process_out_blocks": "0", "process_user_time": 1.109351}
[0m22:09:31.736742 [debug] [MainThread]: Command `dbt run` failed at 22:09:31.736495 after 0.23 seconds
[0m22:09:31.738287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5fb11f2d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5fac0e2850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5fb11f2dd0>]}
[0m22:09:31.739397 [debug] [MainThread]: Flushing usage events
[0m22:09:32.450588 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:10:25.651366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c621bfa8d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c621bfa8f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c621bfe67d0>]}


============================== 22:10:25.658067 | d49ac864-fa76-4749-b4e3-993f5dfd728b ==============================
[0m22:10:25.658067 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:10:25.660366 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'partial_parse': 'True', 'write_json': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'introspect': 'True', 'static_parser': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'invocation_command': 'dbt run', 'log_path': '/usr/app/dbt/dbt/logs', 'log_format': 'default', 'printer_width': '80', 'warn_error': 'None', 'version_check': 'True', 'quiet': 'False', 'empty': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False'}
[0m22:10:25.823703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd49ac864-fa76-4749-b4e3-993f5dfd728b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c621c300cd0>]}
[0m22:10:25.868917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd49ac864-fa76-4749-b4e3-993f5dfd728b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c621b3c6990>]}
[0m22:10:25.871100 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:10:26.028377 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:10:26.049368 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:10:26.051212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd49ac864-fa76-4749-b4e3-993f5dfd728b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c621c032810>]}
[0m22:10:28.895927 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:10:28.898126 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.323643, "process_in_blocks": "0", "process_kernel_time": 0.441879, "process_mem_max_rss": "117600", "process_out_blocks": "0", "process_user_time": 2.246223}
[0m22:10:28.899756 [debug] [MainThread]: Command `dbt run` failed at 22:10:28.899545 after 3.33 seconds
[0m22:10:28.900908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6219f1cd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c621a3ca850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c621b38b290>]}
[0m22:10:28.901892 [debug] [MainThread]: Flushing usage events
[0m22:10:29.732077 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:10:44.254565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7586e8f9af10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7586e65dca50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7586e62aa550>]}


============================== 22:10:44.261044 | a05e0592-3835-4947-9e0f-99219a66bad4 ==============================
[0m22:10:44.261044 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:10:44.262962 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'write_json': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'debug': 'False', 'log_cache_events': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'printer_width': '80', 'no_print': 'None', 'quiet': 'False', 'warn_error': 'None', 'use_colors': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'version_check': 'True', 'partial_parse': 'True', 'introspect': 'True', 'empty': 'False', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m22:10:44.393125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a05e0592-3835-4947-9e0f-99219a66bad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7586e558fa50>]}
[0m22:10:44.441839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a05e0592-3835-4947-9e0f-99219a66bad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7586e8fb25d0>]}
[0m22:10:44.445565 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:10:44.589920 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:10:44.611124 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:10:44.612518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a05e0592-3835-4947-9e0f-99219a66bad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7586e6189850>]}
[0m22:10:47.466222 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:10:47.469477 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.2818594, "process_in_blocks": "0", "process_kernel_time": 0.387441, "process_mem_max_rss": "116996", "process_out_blocks": "0", "process_user_time": 2.299917}
[0m22:10:47.471932 [debug] [MainThread]: Command `dbt run` failed at 22:10:47.471824 after 3.28 seconds
[0m22:10:47.473725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7586eaa8ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7586e6249810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7586e49cdf90>]}
[0m22:10:47.475464 [debug] [MainThread]: Flushing usage events
[0m22:10:48.471396 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:10:50.659517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d132af7b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d132af2bfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d132af2be50>]}


============================== 22:10:50.667173 | 53e3b29f-42eb-4186-b38d-8a7f1e1426d2 ==============================
[0m22:10:50.667173 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:10:50.669025 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'static_parser': 'True', 'empty': 'False', 'warn_error': 'None', 'invocation_command': 'dbt run', 'log_path': '/usr/app/dbt/dbt/logs', 'use_colors': 'True', 'fail_fast': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'use_experimental_parser': 'False', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'version_check': 'True', 'partial_parse': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'log_cache_events': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'log_format': 'default'}
[0m22:10:50.797562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53e3b29f-42eb-4186-b38d-8a7f1e1426d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d132af78710>]}
[0m22:10:50.842282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53e3b29f-42eb-4186-b38d-8a7f1e1426d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d132dc84bd0>]}
[0m22:10:50.844566 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:10:51.007060 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:10:51.034198 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:10:51.036188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '53e3b29f-42eb-4186-b38d-8a7f1e1426d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1329fbfc10>]}
[0m22:10:53.832262 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:10:53.834416 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.2574008, "process_in_blocks": "0", "process_kernel_time": 0.399608, "process_mem_max_rss": "117524", "process_out_blocks": "0", "process_user_time": 2.228745}
[0m22:10:53.835490 [debug] [MainThread]: Command `dbt run` failed at 22:10:53.835390 after 3.26 seconds
[0m22:10:53.836481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d132f77ec50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d132a3d6010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d132b2ac450>]}
[0m22:10:53.837313 [debug] [MainThread]: Flushing usage events
[0m22:10:54.717073 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:10:56.898688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71110faffe90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71110ff1b410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71110fb06550>]}


============================== 22:10:56.908111 | 272ad709-5496-4fb3-a3e1-733750a2b4d4 ==============================
[0m22:10:56.908111 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:10:56.910651 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'log_format': 'default', 'cache_selected_only': 'False', 'write_json': 'True', 'partial_parse': 'True', 'introspect': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'quiet': 'False', 'static_parser': 'True', 'use_colors': 'True', 'debug': 'False', 'log_cache_events': 'False', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'fail_fast': 'False', 'target_path': 'None', 'printer_width': '80', 'indirect_selection': 'eager'}
[0m22:10:57.068663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '272ad709-5496-4fb3-a3e1-733750a2b4d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71110fac93d0>]}
[0m22:10:57.125336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '272ad709-5496-4fb3-a3e1-733750a2b4d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71110f9b9f10>]}
[0m22:10:57.128382 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:10:57.292555 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:10:57.333731 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:10:57.335875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '272ad709-5496-4fb3-a3e1-733750a2b4d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71110faa6750>]}
[0m22:11:00.335433 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:11:00.338766 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.5041642, "process_in_blocks": "0", "process_kernel_time": 0.374993, "process_mem_max_rss": "117508", "process_out_blocks": "0", "process_user_time": 2.337726}
[0m22:11:00.340392 [debug] [MainThread]: Command `dbt run` failed at 22:11:00.340301 after 3.51 seconds
[0m22:11:00.341724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71110fb06010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71110fb05f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7111143ae9d0>]}
[0m22:11:00.344261 [debug] [MainThread]: Flushing usage events
[0m22:11:00.996537 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:11:03.578769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3aba46dcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3aba47a810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3aba41a0d0>]}


============================== 22:11:03.584150 | 3fde5118-c0c9-4c1b-9b56-08760677e780 ==============================
[0m22:11:03.584150 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:11:03.586015 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'empty': 'False', 'log_format': 'default', 'printer_width': '80', 'log_path': '/usr/app/dbt/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'debug': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'use_colors': 'True', 'target_path': 'None', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt run'}
[0m22:11:03.747893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3fde5118-c0c9-4c1b-9b56-08760677e780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3aba58f790>]}
[0m22:11:03.800992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3fde5118-c0c9-4c1b-9b56-08760677e780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3abd186710>]}
[0m22:11:03.804524 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:11:03.915202 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:11:03.928141 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:11:03.929399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3fde5118-c0c9-4c1b-9b56-08760677e780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3ab95228d0>]}
[0m22:11:07.275016 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:11:07.277090 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.7646687, "process_in_blocks": "0", "process_kernel_time": 0.38983, "process_mem_max_rss": "117428", "process_out_blocks": "0", "process_user_time": 2.477049}
[0m22:11:07.280332 [debug] [MainThread]: Command `dbt run` failed at 22:11:07.280046 after 3.77 seconds
[0m22:11:07.282240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3aba41a3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3ab85bbf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3ab85c6c10>]}
[0m22:11:07.297567 [debug] [MainThread]: Flushing usage events
[0m22:11:07.927035 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:11:10.859899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7be7cbbd0090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7be7c8ef5ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7be7c8eb08d0>]}


============================== 22:11:10.866016 | 5fca89db-c1be-4197-8679-31ac3462825f ==============================
[0m22:11:10.866016 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:11:10.868253 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'static_parser': 'True', 'use_colors': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'debug': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'target_path': 'None', 'quiet': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'indirect_selection': 'eager', 'warn_error': 'None', 'invocation_command': 'dbt run', 'empty': 'False', 'version_check': 'True'}
[0m22:11:11.009808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5fca89db-c1be-4197-8679-31ac3462825f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7be7c83e0dd0>]}
[0m22:11:11.065250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5fca89db-c1be-4197-8679-31ac3462825f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7be7cbc04650>]}
[0m22:11:11.067800 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:11:11.238147 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:11:11.252649 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:11:11.253910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5fca89db-c1be-4197-8679-31ac3462825f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7be7c7bb7450>]}
[0m22:11:14.089584 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:11:14.092089 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.3033948, "process_in_blocks": "0", "process_kernel_time": 0.388034, "process_mem_max_rss": "117816", "process_out_blocks": "0", "process_user_time": 2.431156}
[0m22:11:14.094742 [debug] [MainThread]: Command `dbt run` failed at 22:11:14.094501 after 3.31 seconds
[0m22:11:14.096946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7be7c8e96550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7be7c8e950d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7be7c957cf90>]}
[0m22:11:14.099213 [debug] [MainThread]: Flushing usage events
[0m22:11:15.106713 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:11:18.666025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebaa6877010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebaa3b9e510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebaa3b3d2d0>]}


============================== 22:11:18.672944 | 56aff213-607f-49b9-88c2-c7be67e40a37 ==============================
[0m22:11:18.672944 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:11:18.674440 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'target_path': 'None', 'fail_fast': 'False', 'quiet': 'False', 'partial_parse': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'version_check': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'empty': 'False', 'warn_error': 'None', 'log_format': 'default', 'use_experimental_parser': 'False', 'debug': 'False', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:11:18.853113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '56aff213-607f-49b9-88c2-c7be67e40a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebaa3b9e250>]}
[0m22:11:18.904743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '56aff213-607f-49b9-88c2-c7be67e40a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebaa2bcdfd0>]}
[0m22:11:18.906448 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:11:19.073989 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:11:19.095250 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:11:19.096793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '56aff213-607f-49b9-88c2-c7be67e40a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebaa27cfb90>]}
[0m22:11:21.619198 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:11:21.621879 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.026399, "process_in_blocks": "0", "process_kernel_time": 0.39884, "process_mem_max_rss": "117468", "process_out_blocks": "0", "process_user_time": 2.268154}
[0m22:11:21.623707 [debug] [MainThread]: Command `dbt run` failed at 22:11:21.623452 after 3.03 seconds
[0m22:11:21.625136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebaa8396c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebaa4a01950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebaa1f9eb10>]}
[0m22:11:21.626267 [debug] [MainThread]: Flushing usage events
[0m22:11:22.264057 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:11:27.575689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f82059ead0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f820918410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f8209189d0>]}


============================== 22:11:27.584326 | ad243fea-2444-4298-8859-138c5523268d ==============================
[0m22:11:27.584326 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:11:27.585795 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'fail_fast': 'False', 'no_print': 'None', 'cache_selected_only': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'introspect': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'invocation_command': 'dbt run', 'empty': 'False', 'printer_width': '80', 'profiles_dir': '/usr/app/dbt/dbt', 'use_colors': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'quiet': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'version_check': 'True'}
[0m22:11:27.722642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad243fea-2444-4298-8859-138c5523268d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f81fd52590>]}
[0m22:11:27.770175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad243fea-2444-4298-8859-138c5523268d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f81fcbdf10>]}
[0m22:11:27.772949 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:11:27.936501 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:11:27.956532 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:11:27.958012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ad243fea-2444-4298-8859-138c5523268d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f81f9868d0>]}
[0m22:11:30.642754 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:11:30.645790 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.1406796, "process_in_blocks": "0", "process_kernel_time": 0.49625, "process_mem_max_rss": "117412", "process_out_blocks": "0", "process_user_time": 2.33601}
[0m22:11:30.648753 [debug] [MainThread]: Command `dbt run` failed at 22:11:30.648647 after 3.14 seconds
[0m22:11:30.650556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f81eda2ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f81eddaad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f824dfadd0>]}
[0m22:11:30.652353 [debug] [MainThread]: Flushing usage events
[0m22:11:31.786968 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:11:40.474176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c4442bf0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c444288cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c4442cab90>]}


============================== 22:11:40.484882 | 497f02c7-9ba1-442b-b9ab-e5718694cf75 ==============================
[0m22:11:40.484882 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:11:40.487125 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'static_parser': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'fail_fast': 'False', 'cache_selected_only': 'False', 'use_colors': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'debug': 'False', 'quiet': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'write_json': 'True', 'warn_error': 'None', 'printer_width': '80', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'log_cache_events': 'False', 'version_check': 'True', 'introspect': 'True', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:11:40.742473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '497f02c7-9ba1-442b-b9ab-e5718694cf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c44430a250>]}
[0m22:11:40.793053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '497f02c7-9ba1-442b-b9ab-e5718694cf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c446ff4690>]}
[0m22:11:40.795542 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:11:40.966297 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:11:40.984025 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:11:40.985572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '497f02c7-9ba1-442b-b9ab-e5718694cf75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c4433628d0>]}
[0m22:11:44.052870 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:11:44.055630 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.6603937, "process_in_blocks": "0", "process_kernel_time": 0.486897, "process_mem_max_rss": "117468", "process_out_blocks": "0", "process_user_time": 2.575978}
[0m22:11:44.057746 [debug] [MainThread]: Command `dbt run` failed at 22:11:44.057550 after 3.66 seconds
[0m22:11:44.060787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c4427f3090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c44278ff90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c4445e4490>]}
[0m22:11:44.062225 [debug] [MainThread]: Flushing usage events
[0m22:11:45.118891 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:11:59.907806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78859172fd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78858ea01a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78858ea025d0>]}


============================== 22:11:59.914994 | 537af27c-d918-443c-9ced-bc6815d9ae54 ==============================
[0m22:11:59.914994 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:11:59.916301 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'target_path': 'None', 'no_print': 'None', 'printer_width': '80', 'warn_error': 'None', 'static_parser': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'log_format': 'default', 'invocation_command': 'dbt run', 'use_colors': 'True', 'version_check': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'empty': 'False'}
[0m22:12:00.069067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '537af27c-d918-443c-9ced-bc6815d9ae54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78858e9f29d0>]}
[0m22:12:00.112268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '537af27c-d918-443c-9ced-bc6815d9ae54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78859176c310>]}
[0m22:12:00.114705 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:12:00.293034 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:12:00.317599 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:12:00.319781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '537af27c-d918-443c-9ced-bc6815d9ae54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78858d7ceb50>]}
[0m22:12:03.157814 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:12:03.160564 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.36368, "process_in_blocks": "0", "process_kernel_time": 0.389171, "process_mem_max_rss": "117580", "process_out_blocks": "0", "process_user_time": 2.262062}
[0m22:12:03.162785 [debug] [MainThread]: Command `dbt run` failed at 22:12:03.162622 after 3.37 seconds
[0m22:12:03.164436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78859325ac50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78858c311850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78858f8c5950>]}
[0m22:12:03.166596 [debug] [MainThread]: Flushing usage events
[0m22:12:03.893066 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:12:31.524464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7212e3e60d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7212e3e47dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7212e3ea2550>]}


============================== 22:12:31.535584 | 35c026d5-4b30-4cec-bf23-bb4968e1930a ==============================
[0m22:12:31.535584 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:12:31.537975 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'debug': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'version_check': 'True', 'no_print': 'None', 'target_path': 'None', 'introspect': 'True', 'write_json': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'quiet': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'partial_parse': 'True', 'log_path': '/usr/app/dbt/dbt/logs'}
[0m22:12:31.726302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '35c026d5-4b30-4cec-bf23-bb4968e1930a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7212e2fb8e10>]}
[0m22:12:31.776755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '35c026d5-4b30-4cec-bf23-bb4968e1930a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7212e6bb8d10>]}
[0m22:12:31.779744 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:12:31.935619 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:12:31.952594 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:12:31.954031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '35c026d5-4b30-4cec-bf23-bb4968e1930a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7212e3eea610>]}
[0m22:12:34.353145 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:12:34.356808 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.9156141, "process_in_blocks": "0", "process_kernel_time": 0.440046, "process_mem_max_rss": "117444", "process_out_blocks": "0", "process_user_time": 2.365757}
[0m22:12:34.358428 [debug] [MainThread]: Command `dbt run` failed at 22:12:34.358341 after 2.92 seconds
[0m22:12:34.360287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7212e3e32650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7212e1ff0250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7212e3e60d10>]}
[0m22:12:34.361742 [debug] [MainThread]: Flushing usage events
[0m22:12:34.970270 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:13:28.208741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70276dde9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70276dddd110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70276ddde8d0>]}


============================== 22:13:28.215691 | f09a342c-009e-4e35-b650-65a0f9a9a8f5 ==============================
[0m22:13:28.215691 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:13:28.217411 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'quiet': 'False', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'printer_width': '80', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'debug': 'False', 'use_colors': 'True', 'warn_error': 'None', 'log_cache_events': 'False'}
[0m22:13:28.358730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f09a342c-009e-4e35-b650-65a0f9a9a8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70276deff790>]}
[0m22:13:28.406621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f09a342c-009e-4e35-b650-65a0f9a9a8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70276d4ba410>]}
[0m22:13:28.409331 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:13:28.584346 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:13:28.612847 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:13:28.615459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f09a342c-009e-4e35-b650-65a0f9a9a8f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70276d1663d0>]}
[0m22:13:31.523280 [error] [MainThread]: Encountered an error:
Compilation Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The data_project_1.stg_air_quality_valencia model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
[0m22:13:31.528661 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.3934755, "process_in_blocks": "0", "process_kernel_time": 0.432747, "process_mem_max_rss": "117304", "process_out_blocks": "0", "process_user_time": 2.322955}
[0m22:13:31.531702 [debug] [MainThread]: Command `dbt run` failed at 22:13:31.531604 after 3.40 seconds
[0m22:13:31.536431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7027725e2f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70276dd8a610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70276c5c2c10>]}
[0m22:13:31.538514 [debug] [MainThread]: Flushing usage events
[0m22:13:32.314567 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:10.574313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932c68099d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932c6f67850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932c680b290>]}


============================== 22:14:10.582742 | 1bad3012-477f-468c-8167-f96f2a28e4a6 ==============================
[0m22:14:10.582742 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:14:10.583917 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'introspect': 'True', 'invocation_command': 'dbt run', 'use_colors': 'True', 'partial_parse': 'True', 'printer_width': '80', 'write_json': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'log_cache_events': 'False', 'warn_error': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'quiet': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'use_experimental_parser': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'static_parser': 'True', 'version_check': 'True'}
[0m22:14:10.727447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1bad3012-477f-468c-8167-f96f2a28e4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932c551e2d0>]}
[0m22:14:10.775873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1bad3012-477f-468c-8167-f96f2a28e4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932c9586650>]}
[0m22:14:10.779455 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:14:10.923557 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:14:10.943013 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:14:10.944629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1bad3012-477f-468c-8167-f96f2a28e4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932c55ae3d0>]}
[0m22:14:13.789978 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.data_project_1.int_evolucion_temporal' (models/intermediate/int_evolucion_temporal.sql) depends on a node named 'staging_valenbisi' which was not found
[0m22:14:13.793279 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.2949317, "process_in_blocks": "0", "process_kernel_time": 0.488495, "process_mem_max_rss": "122016", "process_out_blocks": "0", "process_user_time": 2.446448}
[0m22:14:13.795577 [debug] [MainThread]: Command `dbt run` failed at 22:14:13.795499 after 3.30 seconds
[0m22:14:13.797372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932c6b70990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932cb072e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932cb072dd0>]}
[0m22:14:13.798957 [debug] [MainThread]: Flushing usage events
[0m22:14:14.603887 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:16.767234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747bbf3cc5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747bc1d86fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747bbf09ec10>]}


============================== 22:14:16.776228 | a5b87a60-50a6-4945-9001-045d5ac76c74 ==============================
[0m22:14:16.776228 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:14:16.777983 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/usr/app/dbt/dbt', 'use_colors': 'True', 'invocation_command': 'dbt run', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'quiet': 'False', 'warn_error': 'None', 'target_path': 'None', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'write_json': 'True', 'debug': 'False', 'no_print': 'None', 'use_experimental_parser': 'False', 'printer_width': '80', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'log_cache_events': 'False'}
[0m22:14:16.947779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a5b87a60-50a6-4945-9001-045d5ac76c74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747bbefd8dd0>]}
[0m22:14:16.994835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a5b87a60-50a6-4945-9001-045d5ac76c74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747bc1d9a790>]}
[0m22:14:16.997568 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:14:17.150238 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:14:17.171709 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:14:17.174764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a5b87a60-50a6-4945-9001-045d5ac76c74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747bbf04d590>]}
[0m22:14:19.936285 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.data_project_1.int_evolucion_temporal' (models/intermediate/int_evolucion_temporal.sql) depends on a node named 'staging_valenbisi' which was not found
[0m22:14:19.939338 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.245116, "process_in_blocks": "0", "process_kernel_time": 0.498118, "process_mem_max_rss": "121644", "process_out_blocks": "0", "process_user_time": 2.383852}
[0m22:14:19.942083 [debug] [MainThread]: Command `dbt run` failed at 22:14:19.941996 after 3.25 seconds
[0m22:14:19.945502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747bc387ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747bbf02edd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747bbcf32050>]}
[0m22:14:19.947476 [debug] [MainThread]: Flushing usage events
[0m22:14:20.595034 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:22.865507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770834b32d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770834b33d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770834b32f10>]}


============================== 22:14:22.871101 | bbf8c519-07dc-4206-8612-acec79e1f3a5 ==============================
[0m22:14:22.871101 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:14:22.875637 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_cache_events': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'fail_fast': 'False', 'partial_parse': 'True', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'use_colors': 'True', 'write_json': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'introspect': 'True', 'static_parser': 'True', 'printer_width': '80', 'no_print': 'None'}
[0m22:14:23.018275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bbf8c519-07dc-4206-8612-acec79e1f3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770834adcd50>]}
[0m22:14:23.073796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bbf8c519-07dc-4206-8612-acec79e1f3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770837856850>]}
[0m22:14:23.085483 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:14:23.207474 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:14:23.218157 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:14:23.219682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'bbf8c519-07dc-4206-8612-acec79e1f3a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770833fc16d0>]}
[0m22:14:26.405185 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.data_project_1.int_evolucion_temporal' (models/intermediate/int_evolucion_temporal.sql) depends on a node named 'staging_valenbisi' which was not found
[0m22:14:26.408410 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.6042283, "process_in_blocks": "0", "process_kernel_time": 0.430393, "process_mem_max_rss": "121528", "process_out_blocks": "0", "process_user_time": 2.658786}
[0m22:14:26.410103 [debug] [MainThread]: Command `dbt run` failed at 22:14:26.409901 after 3.61 seconds
[0m22:14:26.411137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7708396115d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770834f50450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770839336dd0>]}
[0m22:14:26.412282 [debug] [MainThread]: Flushing usage events
[0m22:14:27.203394 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:29.679744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704f642eb6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704f615de9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704f642d7c50>]}


============================== 22:14:29.690013 | b574f11c-e0a4-4ed2-b48a-ca60d0842b1a ==============================
[0m22:14:29.690013 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:14:29.691782 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'write_json': 'True', 'static_parser': 'True', 'debug': 'False', 'printer_width': '80', 'target_path': 'None', 'no_print': 'None', 'indirect_selection': 'eager', 'profiles_dir': '/usr/app/dbt/dbt', 'use_experimental_parser': 'False', 'quiet': 'False', 'empty': 'False', 'partial_parse': 'True', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'log_format': 'default', 'fail_fast': 'False', 'use_colors': 'True', 'warn_error': 'None'}
[0m22:14:29.832870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b574f11c-e0a4-4ed2-b48a-ca60d0842b1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704f609799d0>]}
[0m22:14:29.885685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b574f11c-e0a4-4ed2-b48a-ca60d0842b1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704f60d3afd0>]}
[0m22:14:29.888431 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:14:30.043976 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:14:30.057840 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:14:30.058832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b574f11c-e0a4-4ed2-b48a-ca60d0842b1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704f60ca1d10>]}
[0m22:14:32.840812 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.data_project_1.int_evolucion_temporal' (models/intermediate/int_evolucion_temporal.sql) depends on a node named 'staging_valenbisi' which was not found
[0m22:14:32.846030 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.2308276, "process_in_blocks": "0", "process_kernel_time": 0.393404, "process_mem_max_rss": "122084", "process_out_blocks": "0", "process_user_time": 2.595657}
[0m22:14:32.848312 [debug] [MainThread]: Command `dbt run` failed at 22:14:32.848180 after 3.23 seconds
[0m22:14:32.849763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704f65dded90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704f61582950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704f5f533090>]}
[0m22:14:32.851660 [debug] [MainThread]: Flushing usage events
[0m22:14:33.598152 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:36.475716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cd2ae3ee10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cd2ae467d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cd2b24b5d0>]}


============================== 22:14:36.481943 | 9b39a65b-5733-4067-b9b4-e9ee3bce36b2 ==============================
[0m22:14:36.481943 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:14:36.483440 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'empty': 'False', 'printer_width': '80', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'invocation_command': 'dbt run', 'debug': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'static_parser': 'True', 'write_json': 'True', 'use_colors': 'True', 'quiet': 'False', 'log_format': 'default', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m22:14:36.608850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9b39a65b-5733-4067-b9b4-e9ee3bce36b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cd2be62c10>]}
[0m22:14:36.652682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9b39a65b-5733-4067-b9b4-e9ee3bce36b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cd2db74690>]}
[0m22:14:36.654438 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:14:36.790434 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:14:36.816668 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:14:36.818742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9b39a65b-5733-4067-b9b4-e9ee3bce36b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cd29f4abd0>]}
[0m22:14:39.687362 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.data_project_1.int_evolucion_temporal' (models/intermediate/int_evolucion_temporal.sql) depends on a node named 'staging_valenbisi' which was not found
[0m22:14:39.690922 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.2787578, "process_in_blocks": "0", "process_kernel_time": 0.353864, "process_mem_max_rss": "121396", "process_out_blocks": "0", "process_user_time": 2.619412}
[0m22:14:39.692630 [debug] [MainThread]: Command `dbt run` failed at 22:14:39.692508 after 3.28 seconds
[0m22:14:39.693915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cd29ba0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cd28708a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cd2f64add0>]}
[0m22:14:39.695188 [debug] [MainThread]: Flushing usage events
[0m22:14:40.311095 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:43.978359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ec2d3b27d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ec2d35d350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ec2d35e5d0>]}


============================== 22:14:43.985950 | 189c4d7e-3f15-4de7-9468-79a429fd06d2 ==============================
[0m22:14:43.985950 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:14:43.988244 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'debug': 'False', 'quiet': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'log_format': 'default', 'no_print': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'write_json': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'static_parser': 'True', 'use_colors': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'printer_width': '80'}
[0m22:14:44.147108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '189c4d7e-3f15-4de7-9468-79a429fd06d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ec2c74e790>]}
[0m22:14:44.194374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '189c4d7e-3f15-4de7-9468-79a429fd06d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ec300bcb10>]}
[0m22:14:44.196803 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:14:44.319296 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:14:44.329090 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:14:44.330097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '189c4d7e-3f15-4de7-9468-79a429fd06d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ec2bb0ec10>]}
[0m22:14:47.308365 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.data_project_1.int_evolucion_temporal' (models/intermediate/int_evolucion_temporal.sql) depends on a node named 'staging_valenbisi' which was not found
[0m22:14:47.315969 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.4114053, "process_in_blocks": "0", "process_kernel_time": 0.386492, "process_mem_max_rss": "121808", "process_out_blocks": "0", "process_user_time": 2.550056}
[0m22:14:47.318785 [debug] [MainThread]: Command `dbt run` failed at 22:14:47.318490 after 3.41 seconds
[0m22:14:47.321224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ec31c7acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ec2af64d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ec23da24d0>]}
[0m22:14:47.323390 [debug] [MainThread]: Flushing usage events
[0m22:14:47.987308 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:53.349583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bbe09e7090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bbe0997e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bbe0992b90>]}


============================== 22:14:53.355087 | bbf1767c-8427-4785-919b-61f2cc389355 ==============================
[0m22:14:53.355087 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:14:53.357129 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'quiet': 'False', 'cache_selected_only': 'False', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'profiles_dir': '/usr/app/dbt/dbt', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt run', 'no_print': 'None', 'log_cache_events': 'False', 'partial_parse': 'True', 'log_format': 'default', 'log_path': '/usr/app/dbt/dbt/logs', 'warn_error': 'None', 'printer_width': '80', 'write_json': 'True', 'static_parser': 'True', 'version_check': 'True', 'empty': 'False', 'debug': 'False'}
[0m22:14:53.514904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bbf1767c-8427-4785-919b-61f2cc389355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bbdfd6dad0>]}
[0m22:14:53.569975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bbf1767c-8427-4785-919b-61f2cc389355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bbe371e710>]}
[0m22:14:53.572386 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:14:53.691324 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:14:53.739200 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:14:53.744305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'bbf1767c-8427-4785-919b-61f2cc389355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bbdf9ae690>]}
[0m22:14:57.073925 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.data_project_1.int_evolucion_temporal' (models/intermediate/int_evolucion_temporal.sql) depends on a node named 'staging_valenbisi' which was not found
[0m22:14:57.077517 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.805238, "process_in_blocks": "0", "process_kernel_time": 0.422334, "process_mem_max_rss": "121764", "process_out_blocks": "0", "process_user_time": 2.641582}
[0m22:14:57.079374 [debug] [MainThread]: Command `dbt run` failed at 22:14:57.079138 after 3.81 seconds
[0m22:14:57.080898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bbe0980790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bbde5b0850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70bbe0982b10>]}
[0m22:14:57.082180 [debug] [MainThread]: Flushing usage events
[0m22:14:57.590925 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:15:06.245977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c7b65a9a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c7b655be10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c7b6555f50>]}


============================== 22:15:06.257071 | 80b94d24-0a64-427b-8357-f517c7499f6b ==============================
[0m22:15:06.257071 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:15:06.259596 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'write_json': 'True', 'introspect': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'no_print': 'None', 'printer_width': '80', 'partial_parse': 'True', 'log_cache_events': 'False', 'empty': 'False', 'target_path': 'None', 'version_check': 'True', 'cache_selected_only': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'log_format': 'default', 'debug': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error': 'None'}
[0m22:15:06.422234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '80b94d24-0a64-427b-8357-f517c7499f6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c7b6c86990>]}
[0m22:15:06.465866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '80b94d24-0a64-427b-8357-f517c7499f6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c7b55ddfd0>]}
[0m22:15:06.468027 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:15:06.586175 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:15:06.627779 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:15:06.634558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '80b94d24-0a64-427b-8357-f517c7499f6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c7b5596ad0>]}
[0m22:15:09.986336 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.data_project_1.int_evolucion_temporal' (models/intermediate/int_evolucion_temporal.sql) depends on a node named 'staging_valenbisi' which was not found
[0m22:15:09.989730 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.8611434, "process_in_blocks": "0", "process_kernel_time": 0.408973, "process_mem_max_rss": "121776", "process_out_blocks": "0", "process_user_time": 2.77778}
[0m22:15:09.992622 [debug] [MainThread]: Command `dbt run` failed at 22:15:09.992474 after 3.86 seconds
[0m22:15:09.994716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c7b6546790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c7b4555d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c7b494cd10>]}
[0m22:15:09.996622 [debug] [MainThread]: Flushing usage events
[0m22:15:10.532695 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:15:25.517873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765ecaa1ea10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765eca9e8e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765ecaa1e490>]}


============================== 22:15:25.524862 | a239a69b-1a60-4126-a8cb-a09e5b0bc2a8 ==============================
[0m22:15:25.524862 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:15:25.526550 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'log_format': 'default', 'empty': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'partial_parse': 'True', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'no_print': 'None', 'target_path': 'None', 'introspect': 'True', 'write_json': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'printer_width': '80', 'warn_error': 'None'}
[0m22:15:25.675181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a239a69b-1a60-4126-a8cb-a09e5b0bc2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765eca189e50>]}
[0m22:15:25.730203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a239a69b-1a60-4126-a8cb-a09e5b0bc2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765ecd730890>]}
[0m22:15:25.732182 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:15:25.868822 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:15:25.895721 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:15:25.898042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a239a69b-1a60-4126-a8cb-a09e5b0bc2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765ec9d96b90>]}
[0m22:15:28.442750 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.data_project_1.int_evolucion_temporal' (models/intermediate/int_evolucion_temporal.sql) depends on a node named 'staging_valenbisi' which was not found
[0m22:15:28.445777 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.0031567, "process_in_blocks": "0", "process_kernel_time": 0.403534, "process_mem_max_rss": "122276", "process_out_blocks": "0", "process_user_time": 2.558408}
[0m22:15:28.448181 [debug] [MainThread]: Command `dbt run` failed at 22:15:28.447965 after 3.01 seconds
[0m22:15:28.450057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765ecb88d950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765ec89416d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765ecf222c50>]}
[0m22:15:28.452029 [debug] [MainThread]: Flushing usage events
[0m22:15:29.151115 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:15:56.788030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7002b3083d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7002b302c990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7002b308e810>]}


============================== 22:15:56.798002 | ba593906-9071-4aaf-9361-389e8f19c224 ==============================
[0m22:15:56.798002 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:15:56.801652 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'write_json': 'True', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'printer_width': '80', 'fail_fast': 'False', 'static_parser': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'use_colors': 'True', 'target_path': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'partial_parse': 'True', 'warn_error': 'None', 'version_check': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:15:56.990825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ba593906-9071-4aaf-9361-389e8f19c224', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7002b301eb50>]}
[0m22:15:57.041941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ba593906-9071-4aaf-9361-389e8f19c224', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7002b5da2910>]}
[0m22:15:57.046026 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:15:57.201591 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:15:57.268922 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:15:57.271661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ba593906-9071-4aaf-9361-389e8f19c224', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7002b21c3250>]}
[0m22:16:00.342722 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.data_project_1.int_evolucion_temporal' (models/intermediate/int_evolucion_temporal.sql) depends on a node named 'staging_valenbisi' which was not found
[0m22:16:00.362943 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.6444218, "process_in_blocks": "0", "process_kernel_time": 0.448797, "process_mem_max_rss": "122036", "process_out_blocks": "0", "process_user_time": 2.567445}
[0m22:16:00.368113 [debug] [MainThread]: Command `dbt run` failed at 22:16:00.367551 after 3.65 seconds
[0m22:16:00.372856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7002b3394810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7002b41d9550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7002b7896dd0>]}
[0m22:16:00.377012 [debug] [MainThread]: Flushing usage events
[0m22:16:01.307278 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:16:54.630807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd1e85b6b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd1e85b6c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd1e85b6410>]}


============================== 22:16:54.638469 | cf505cb2-f918-4761-ad0c-3401ab64c898 ==============================
[0m22:16:54.638469 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:16:54.643602 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'static_parser': 'True', 'write_json': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'target_path': 'None', 'debug': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'indirect_selection': 'eager', 'quiet': 'False', 'invocation_command': 'dbt run', 'printer_width': '80', 'no_print': 'None', 'log_format': 'default', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'empty': 'False', 'log_cache_events': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True'}
[0m22:16:54.800915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cf505cb2-f918-4761-ad0c-3401ab64c898', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd1e95de550>]}
[0m22:16:54.859508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cf505cb2-f918-4761-ad0c-3401ab64c898', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd1eb2c47d0>]}
[0m22:16:54.862157 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:16:54.992006 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:16:55.010964 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:16:55.012524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'cf505cb2-f918-4761-ad0c-3401ab64c898', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd1e85fe650>]}
[0m22:17:02.119990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d6f45e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d72447d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d6f46950>]}


============================== 22:17:02.130364 | 99feae6d-ab51-40bf-9c9c-cf57456eb992 ==============================
[0m22:17:02.130364 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:17:02.132132 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'use_colors': 'True', 'debug': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'partial_parse': 'True', 'no_print': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'empty': 'False', 'log_format': 'default', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'printer_width': '80', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'introspect': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'static_parser': 'True', 'warn_error': 'None'}
[0m22:17:02.268812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '99feae6d-ab51-40bf-9c9c-cf57456eb992', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d6f76650>]}
[0m22:17:02.313556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '99feae6d-ab51-40bf-9c9c-cf57456eb992', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d9c4a8d0>]}
[0m22:17:02.315756 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:17:02.472161 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:17:02.499922 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:17:02.501861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '99feae6d-ab51-40bf-9c9c-cf57456eb992', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d6ef5f50>]}
[0m22:17:05.635712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '99feae6d-ab51-40bf-9c9c-cf57456eb992', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d46ab050>]}
[0m22:17:05.846449 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:05.859504 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:05.929950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '99feae6d-ab51-40bf-9c9c-cf57456eb992', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d4b40390>]}
[0m22:17:05.931626 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:17:05.933165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99feae6d-ab51-40bf-9c9c-cf57456eb992', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d45b9090>]}
[0m22:17:05.937062 [info ] [MainThread]: 
[0m22:17:05.938253 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:17:05.939378 [info ] [MainThread]: 
[0m22:17:05.941364 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:17:05.943304 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:17:06.030125 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:17:06.031950 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:17:06.033567 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:17:06.135972 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.102 seconds
[0m22:17:06.141148 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:17:06.145282 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:17:06.156948 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:06.159659 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:17:06.162005 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:17:06.177126 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m22:17:06.179075 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:06.180692 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:17:06.231551 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.049 seconds
[0m22:17:06.235000 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:17:06.236754 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:17:06.244797 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:06.245962 [debug] [MainThread]: On master: BEGIN
[0m22:17:06.247424 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:17:06.257806 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:17:06.259479 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:06.260904 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:17:06.292311 [debug] [MainThread]: SQL status: SELECT 5 in 0.030 seconds
[0m22:17:06.296833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99feae6d-ab51-40bf-9c9c-cf57456eb992', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d4b41a10>]}
[0m22:17:06.298237 [debug] [MainThread]: On master: ROLLBACK
[0m22:17:06.299952 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:06.301105 [debug] [MainThread]: On master: BEGIN
[0m22:17:06.302467 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:17:06.303806 [debug] [MainThread]: On master: COMMIT
[0m22:17:06.305162 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:06.306476 [debug] [MainThread]: On master: COMMIT
[0m22:17:06.307855 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:06.309584 [debug] [MainThread]: On master: Close
[0m22:17:06.317343 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:17:06.318856 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:17:06.320396 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:17:06.321947 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:17:06.329496 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:06.365633 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:17:06.399028 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:06.426735 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:06.428313 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:17:06.429624 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:17:06.440158 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m22:17:06.441918 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:06.443780 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0;
  );
[0m22:17:06.448874 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 139: WHERE concentration_ug_m3 >= 0;
                                        ^

[0m22:17:06.450070 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: ROLLBACK
[0m22:17:06.451431 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:17:06.461195 [debug] [Thread-1 (]: Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:06.464795 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99feae6d-ab51-40bf-9c9c-cf57456eb992', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d3b3c790>]}
[0m22:17:06.466702 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model public.stg_air_quality_valencia ........... [[31mERROR[0m in 0.14s]
[0m22:17:06.468599 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:17:06.470243 [debug] [Thread-7 (]: Marking all children of 'model.data_project_1.stg_air_quality_valencia' to be skipped because of status 'error'.  Reason: Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql.
[0m22:17:06.474144 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:06.475350 [debug] [MainThread]: On master: BEGIN
[0m22:17:06.476480 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:17:06.488391 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m22:17:06.490485 [debug] [MainThread]: On master: COMMIT
[0m22:17:06.491736 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:06.493093 [debug] [MainThread]: On master: COMMIT
[0m22:17:06.494606 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:06.495836 [debug] [MainThread]: On master: Close
[0m22:17:06.497348 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:17:06.498819 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:17:06.500007 [info ] [MainThread]: 
[0m22:17:06.501662 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m22:17:06.504043 [debug] [MainThread]: Command end result
[0m22:17:06.564542 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:06.576509 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:06.590172 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:17:06.591865 [info ] [MainThread]: 
[0m22:17:06.593693 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:17:06.595305 [info ] [MainThread]: 
[0m22:17:06.597078 [error] [MainThread]: [31mFailure in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)[0m
[0m22:17:06.598878 [error] [MainThread]:   Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:06.600663 [info ] [MainThread]: 
[0m22:17:06.602158 [info ] [MainThread]:   compiled code at target/compiled/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:06.603533 [info ] [MainThread]: 
[0m22:17:06.605055 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m22:17:06.608000 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.575983, "process_in_blocks": "160", "process_kernel_time": 0.515646, "process_mem_max_rss": "132168", "process_out_blocks": "0", "process_user_time": 3.06568}
[0m22:17:06.609741 [debug] [MainThread]: Command `dbt run` failed at 22:17:06.609552 after 4.58 seconds
[0m22:17:06.611303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9db73ee90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9db73edd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9d6f38f90>]}
[0m22:17:06.612380 [debug] [MainThread]: Flushing usage events
[0m22:17:07.451014 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:17:09.661458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3009bf30d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3009b9cb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3009b9ef50>]}


============================== 22:17:09.667430 | 5fa9dd4d-cb95-45ef-b645-c490f7e73c47 ==============================
[0m22:17:09.667430 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:17:09.669587 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'indirect_selection': 'eager', 'warn_error': 'None', 'introspect': 'True', 'partial_parse': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'log_cache_events': 'False', 'quiet': 'False', 'static_parser': 'True', 'empty': 'False', 'printer_width': '80', 'write_json': 'True', 'no_print': 'None', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'target_path': 'None'}
[0m22:17:09.795602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5fa9dd4d-cb95-45ef-b645-c490f7e73c47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3009b9e850>]}
[0m22:17:09.838636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5fa9dd4d-cb95-45ef-b645-c490f7e73c47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f300c924850>]}
[0m22:17:09.841299 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:17:09.975251 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:17:11.286722 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:17:11.287602 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:17:11.319682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5fa9dd4d-cb95-45ef-b645-c490f7e73c47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3008391590>]}
[0m22:17:11.438413 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:11.446644 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:11.510553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5fa9dd4d-cb95-45ef-b645-c490f7e73c47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30083c5190>]}
[0m22:17:11.512239 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:17:11.514338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5fa9dd4d-cb95-45ef-b645-c490f7e73c47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3007b2c0d0>]}
[0m22:17:11.518317 [info ] [MainThread]: 
[0m22:17:11.521334 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:17:11.524118 [info ] [MainThread]: 
[0m22:17:11.526835 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:17:11.530041 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:17:11.658584 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:17:11.666685 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:17:11.672846 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:17:11.707088 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.034 seconds
[0m22:17:11.710715 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:17:11.715040 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:17:11.723647 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:11.725665 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:17:11.727509 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:17:11.743367 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m22:17:11.746097 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:11.748030 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:17:11.759437 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m22:17:11.764812 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:17:11.767150 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:17:11.778251 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:11.780403 [debug] [MainThread]: On master: BEGIN
[0m22:17:11.782243 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:17:11.794859 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m22:17:11.796925 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:11.799024 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:17:11.809730 [debug] [MainThread]: SQL status: SELECT 5 in 0.009 seconds
[0m22:17:11.813639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5fa9dd4d-cb95-45ef-b645-c490f7e73c47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30083e0210>]}
[0m22:17:11.815513 [debug] [MainThread]: On master: ROLLBACK
[0m22:17:11.817046 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:11.818882 [debug] [MainThread]: On master: BEGIN
[0m22:17:11.820808 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:17:11.822386 [debug] [MainThread]: On master: COMMIT
[0m22:17:11.824173 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:11.825426 [debug] [MainThread]: On master: COMMIT
[0m22:17:11.826740 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:11.827909 [debug] [MainThread]: On master: Close
[0m22:17:11.836212 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:17:11.837554 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:17:11.839740 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:17:11.841028 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:17:11.860849 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:11.898838 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:17:11.934994 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:11.949367 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:11.951024 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:17:11.952026 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:17:11.963558 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m22:17:11.965148 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:11.967270 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0;
  );
[0m22:17:11.973332 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 139: WHERE concentration_ug_m3 >= 0;
                                        ^

[0m22:17:11.985371 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: ROLLBACK
[0m22:17:11.988335 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:17:11.996242 [debug] [Thread-1 (]: Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:11.999596 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5fa9dd4d-cb95-45ef-b645-c490f7e73c47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3006a61cd0>]}
[0m22:17:12.002542 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model public.stg_air_quality_valencia ........... [[31mERROR[0m in 0.16s]
[0m22:17:12.005094 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:17:12.007292 [debug] [Thread-7 (]: Marking all children of 'model.data_project_1.stg_air_quality_valencia' to be skipped because of status 'error'.  Reason: Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql.
[0m22:17:12.012045 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:12.013734 [debug] [MainThread]: On master: BEGIN
[0m22:17:12.015738 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:17:12.029024 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m22:17:12.030989 [debug] [MainThread]: On master: COMMIT
[0m22:17:12.032494 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:12.033790 [debug] [MainThread]: On master: COMMIT
[0m22:17:12.038690 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:12.040452 [debug] [MainThread]: On master: Close
[0m22:17:12.042109 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:17:12.043571 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:17:12.045018 [info ] [MainThread]: 
[0m22:17:12.046882 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m22:17:12.049269 [debug] [MainThread]: Command end result
[0m22:17:12.113039 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:12.120876 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:12.130477 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:17:12.131607 [info ] [MainThread]: 
[0m22:17:12.132837 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:17:12.135319 [info ] [MainThread]: 
[0m22:17:12.136834 [error] [MainThread]: [31mFailure in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)[0m
[0m22:17:12.138493 [error] [MainThread]:   Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:12.139916 [info ] [MainThread]: 
[0m22:17:12.141378 [info ] [MainThread]:   compiled code at target/compiled/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:12.142734 [info ] [MainThread]: 
[0m22:17:12.144409 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m22:17:12.146870 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.5652514, "process_in_blocks": "0", "process_kernel_time": 0.356089, "process_mem_max_rss": "126672", "process_out_blocks": "0", "process_user_time": 1.907055}
[0m22:17:12.148184 [debug] [MainThread]: Command `dbt run` failed at 22:17:12.148053 after 2.57 seconds
[0m22:17:12.149753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3009b8e8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f300e4c6b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f30041c5a10>]}
[0m22:17:12.151155 [debug] [MainThread]: Flushing usage events
[0m22:17:13.189461 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:17:15.358429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef6c9e2610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef6ca42450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef6c9e2a10>]}


============================== 22:17:15.368287 | 158775b6-6e36-41c9-bb00-be8766c0a502 ==============================
[0m22:17:15.368287 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:17:15.371059 [debug] [MainThread]: running dbt with arguments {'log_path': '/usr/app/dbt/dbt/logs', 'indirect_selection': 'eager', 'printer_width': '80', 'profiles_dir': '/usr/app/dbt/dbt', 'static_parser': 'True', 'no_print': 'None', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'debug': 'False', 'fail_fast': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'empty': 'False', 'cache_selected_only': 'False', 'use_colors': 'True', 'write_json': 'True', 'warn_error': 'None', 'introspect': 'True', 'version_check': 'True', 'log_cache_events': 'False'}
[0m22:17:15.526729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '158775b6-6e36-41c9-bb00-be8766c0a502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef6bbc7190>]}
[0m22:17:15.568391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '158775b6-6e36-41c9-bb00-be8766c0a502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef6f74a750>]}
[0m22:17:15.570570 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:17:15.727676 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:17:17.483371 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:17:17.484557 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:17:17.516211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '158775b6-6e36-41c9-bb00-be8766c0a502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef6b7665d0>]}
[0m22:17:17.666248 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:17.675908 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:17.710687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '158775b6-6e36-41c9-bb00-be8766c0a502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef6aba8e50>]}
[0m22:17:17.712648 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:17:17.714887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '158775b6-6e36-41c9-bb00-be8766c0a502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef6a316890>]}
[0m22:17:17.718460 [info ] [MainThread]: 
[0m22:17:17.720967 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:17:17.723257 [info ] [MainThread]: 
[0m22:17:17.725610 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:17:17.728474 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:17:17.854512 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:17:17.856461 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:17:17.858047 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:17:17.875356 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m22:17:17.878962 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:17:17.883107 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:17:17.890142 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:17.892100 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:17:17.893745 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:17:17.903731 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m22:17:17.905479 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:17.906755 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:17:17.915737 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.007 seconds
[0m22:17:17.919283 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:17:17.921417 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:17:17.929114 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:17.931126 [debug] [MainThread]: On master: BEGIN
[0m22:17:17.932807 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:17:17.943299 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:17:17.945327 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:17.947980 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:17:17.956684 [debug] [MainThread]: SQL status: SELECT 5 in 0.007 seconds
[0m22:17:17.961029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '158775b6-6e36-41c9-bb00-be8766c0a502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef6bbbd810>]}
[0m22:17:17.962759 [debug] [MainThread]: On master: ROLLBACK
[0m22:17:17.964792 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:17.966244 [debug] [MainThread]: On master: BEGIN
[0m22:17:17.968159 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:17:17.969607 [debug] [MainThread]: On master: COMMIT
[0m22:17:17.971133 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:17.972469 [debug] [MainThread]: On master: COMMIT
[0m22:17:17.974233 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:17.975807 [debug] [MainThread]: On master: Close
[0m22:17:17.985347 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:17:17.987259 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:17:17.988974 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:17:17.990349 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:17:18.006004 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:18.019864 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:17:18.044930 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:18.059474 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:18.060636 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:17:18.062319 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:17:18.074049 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m22:17:18.075532 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:18.076827 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0;
  );
[0m22:17:18.081786 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 139: WHERE concentration_ug_m3 >= 0;
                                        ^

[0m22:17:18.083419 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: ROLLBACK
[0m22:17:18.085404 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:17:18.091879 [debug] [Thread-1 (]: Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:18.095194 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '158775b6-6e36-41c9-bb00-be8766c0a502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef69845690>]}
[0m22:17:18.097761 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model public.stg_air_quality_valencia ........... [[31mERROR[0m in 0.11s]
[0m22:17:18.099721 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:17:18.101751 [debug] [Thread-7 (]: Marking all children of 'model.data_project_1.stg_air_quality_valencia' to be skipped because of status 'error'.  Reason: Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql.
[0m22:17:18.105949 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:18.107539 [debug] [MainThread]: On master: BEGIN
[0m22:17:18.108908 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:17:18.122830 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m22:17:18.124814 [debug] [MainThread]: On master: COMMIT
[0m22:17:18.126856 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:18.128173 [debug] [MainThread]: On master: COMMIT
[0m22:17:18.130216 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:18.131876 [debug] [MainThread]: On master: Close
[0m22:17:18.133379 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:17:18.134699 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:17:18.136358 [info ] [MainThread]: 
[0m22:17:18.138080 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.41 seconds (0.41s).
[0m22:17:18.140085 [debug] [MainThread]: Command end result
[0m22:17:18.218119 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:18.227818 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:18.243065 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:17:18.244280 [info ] [MainThread]: 
[0m22:17:18.245714 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:17:18.247324 [info ] [MainThread]: 
[0m22:17:18.249100 [error] [MainThread]: [31mFailure in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)[0m
[0m22:17:18.251176 [error] [MainThread]:   Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:18.252768 [info ] [MainThread]: 
[0m22:17:18.254255 [info ] [MainThread]:   compiled code at target/compiled/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:18.255733 [info ] [MainThread]: 
[0m22:17:18.257063 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m22:17:18.259159 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.9578576, "process_in_blocks": "0", "process_kernel_time": 0.395972, "process_mem_max_rss": "127168", "process_out_blocks": "0", "process_user_time": 1.893243}
[0m22:17:18.260568 [debug] [MainThread]: Command `dbt run` failed at 22:17:18.260407 after 2.96 seconds
[0m22:17:18.261960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef7123ae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef7123ae90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ef6d9e0a50>]}
[0m22:17:18.264628 [debug] [MainThread]: Flushing usage events
[0m22:17:19.039952 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:17:21.503185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb9999bd990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb9999680d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb99996a6d0>]}


============================== 22:17:21.508425 | fd9bb17f-2898-446b-992b-dad3749829a8 ==============================
[0m22:17:21.508425 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:17:21.509811 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'invocation_command': 'dbt run', 'empty': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'introspect': 'True', 'write_json': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'fail_fast': 'False', 'partial_parse': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'log_path': '/usr/app/dbt/dbt/logs', 'profiles_dir': '/usr/app/dbt/dbt', 'no_print': 'None'}
[0m22:17:21.703928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd9bb17f-2898-446b-992b-dad3749829a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb99995a050>]}
[0m22:17:21.749660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd9bb17f-2898-446b-992b-dad3749829a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb99c6ca790>]}
[0m22:17:21.752924 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:17:21.900851 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:17:25.213301 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:17:25.215087 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:17:25.248496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd9bb17f-2898-446b-992b-dad3749829a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb9989e8510>]}
[0m22:17:25.437793 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:25.450695 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:25.497155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd9bb17f-2898-446b-992b-dad3749829a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb997de0c90>]}
[0m22:17:25.499858 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:17:25.501749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd9bb17f-2898-446b-992b-dad3749829a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb9975641d0>]}
[0m22:17:25.505500 [info ] [MainThread]: 
[0m22:17:25.507807 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:17:25.509256 [info ] [MainThread]: 
[0m22:17:25.511510 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:17:25.514521 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:17:25.623726 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:17:25.625792 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:17:25.627244 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:17:25.647274 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.020 seconds
[0m22:17:25.650482 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:17:25.653572 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:17:25.663727 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:25.665637 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:17:25.667856 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:17:25.678565 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m22:17:25.680305 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:25.681763 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:17:25.688023 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.005 seconds
[0m22:17:25.690593 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:17:25.693068 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:17:25.701077 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:25.702920 [debug] [MainThread]: On master: BEGIN
[0m22:17:25.704573 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:17:25.714680 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:17:25.717620 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:25.719481 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:17:25.726666 [debug] [MainThread]: SQL status: SELECT 5 in 0.006 seconds
[0m22:17:25.730189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd9bb17f-2898-446b-992b-dad3749829a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb99c33d290>]}
[0m22:17:25.731591 [debug] [MainThread]: On master: ROLLBACK
[0m22:17:25.734994 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:25.736662 [debug] [MainThread]: On master: BEGIN
[0m22:17:25.738215 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:17:25.739736 [debug] [MainThread]: On master: COMMIT
[0m22:17:25.742503 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:25.744614 [debug] [MainThread]: On master: COMMIT
[0m22:17:25.747381 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m22:17:25.750947 [debug] [MainThread]: On master: Close
[0m22:17:25.763251 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:17:25.769053 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:17:25.772035 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:17:25.775945 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:17:25.801065 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:25.836436 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:17:25.864228 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:25.918043 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:25.920456 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:17:25.923878 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:17:25.937504 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m22:17:25.942582 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:25.952804 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0;
  );
[0m22:17:25.960852 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 139: WHERE concentration_ug_m3 >= 0;
                                        ^

[0m22:17:25.963305 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: ROLLBACK
[0m22:17:25.966599 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:17:25.972001 [debug] [Thread-1 (]: Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:25.976477 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd9bb17f-2898-446b-992b-dad3749829a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb996735310>]}
[0m22:17:25.979246 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model public.stg_air_quality_valencia ........... [[31mERROR[0m in 0.20s]
[0m22:17:25.983901 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:17:25.987541 [debug] [Thread-7 (]: Marking all children of 'model.data_project_1.stg_air_quality_valencia' to be skipped because of status 'error'.  Reason: Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql.
[0m22:17:25.994966 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:26.001803 [debug] [MainThread]: On master: BEGIN
[0m22:17:26.003898 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:17:26.017302 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m22:17:26.020188 [debug] [MainThread]: On master: COMMIT
[0m22:17:26.021759 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:26.023156 [debug] [MainThread]: On master: COMMIT
[0m22:17:26.024327 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:26.025426 [debug] [MainThread]: On master: Close
[0m22:17:26.027005 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:17:26.030242 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:17:26.031751 [info ] [MainThread]: 
[0m22:17:26.033265 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m22:17:26.035808 [debug] [MainThread]: Command end result
[0m22:17:26.107453 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:26.115920 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:26.129154 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:17:26.130295 [info ] [MainThread]: 
[0m22:17:26.131615 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:17:26.133019 [info ] [MainThread]: 
[0m22:17:26.134224 [error] [MainThread]: [31mFailure in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)[0m
[0m22:17:26.136358 [error] [MainThread]:   Database Error in model stg_air_quality_valencia (models/staging/stg_air_quality_valencia.sql)
  syntax error at or near ";"
  LINE 139: WHERE concentration_ug_m3 >= 0;
                                          ^
  compiled code at target/run/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:26.138037 [info ] [MainThread]: 
[0m22:17:26.139703 [info ] [MainThread]:   compiled code at target/compiled/data_project_1/models/staging/stg_air_quality_valencia.sql
[0m22:17:26.141312 [info ] [MainThread]: 
[0m22:17:26.142863 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m22:17:26.145702 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.713255, "process_in_blocks": "0", "process_kernel_time": 0.435694, "process_mem_max_rss": "127488", "process_out_blocks": "0", "process_user_time": 1.942637}
[0m22:17:26.149077 [debug] [MainThread]: Command `dbt run` failed at 22:17:26.148814 after 4.72 seconds
[0m22:17:26.150659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb999988c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb999ddb450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb99b948810>]}
[0m22:17:26.152240 [debug] [MainThread]: Flushing usage events
[0m22:17:26.908267 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:17:29.828702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c500d997d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c500d99fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c500d9ac10>]}


============================== 22:17:29.837295 | 43eb7c5d-b5f4-47c7-a8d3-fa1b07c48460 ==============================
[0m22:17:29.837295 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:17:29.839325 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'partial_parse': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'empty': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'profiles_dir': '/usr/app/dbt/dbt', 'version_check': 'True', 'use_colors': 'True', 'fail_fast': 'False', 'debug': 'False', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'write_json': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'use_experimental_parser': 'False', 'no_print': 'None'}
[0m22:17:30.020916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '43eb7c5d-b5f4-47c7-a8d3-fa1b07c48460', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c50057e2d0>]}
[0m22:17:30.065764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '43eb7c5d-b5f4-47c7-a8d3-fa1b07c48460', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c503b08810>]}
[0m22:17:30.069767 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:17:30.354140 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:17:32.681103 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:17:32.682853 [debug] [MainThread]: Partial parsing: updated file: data_project_1://models/staging/stg_air_quality_valencia.sql
[0m22:17:33.070947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '43eb7c5d-b5f4-47c7-a8d3-fa1b07c48460', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c4ff50c090>]}
[0m22:17:33.217654 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:33.228494 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:33.271289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '43eb7c5d-b5f4-47c7-a8d3-fa1b07c48460', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c4ff594510>]}
[0m22:17:33.272792 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:17:33.274449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43eb7c5d-b5f4-47c7-a8d3-fa1b07c48460', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c500131150>]}
[0m22:17:33.279391 [info ] [MainThread]: 
[0m22:17:33.280635 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:17:33.281808 [info ] [MainThread]: 
[0m22:17:33.283169 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:17:33.285348 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:17:33.332324 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:17:33.334600 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:17:33.335919 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:17:33.377557 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.041 seconds
[0m22:17:33.381799 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:17:33.389817 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:17:33.403538 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:33.405623 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:17:33.407714 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:17:33.421246 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m22:17:33.423872 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:33.425046 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:17:33.432747 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.006 seconds
[0m22:17:33.434965 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:17:33.436334 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:17:33.443586 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:33.444790 [debug] [MainThread]: On master: BEGIN
[0m22:17:33.445655 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:17:33.456294 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:17:33.457655 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:33.459393 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:17:33.465576 [debug] [MainThread]: SQL status: SELECT 5 in 0.005 seconds
[0m22:17:33.467665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43eb7c5d-b5f4-47c7-a8d3-fa1b07c48460', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c4fe91e710>]}
[0m22:17:33.468916 [debug] [MainThread]: On master: ROLLBACK
[0m22:17:33.470084 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:33.470808 [debug] [MainThread]: On master: BEGIN
[0m22:17:33.471872 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:17:33.473151 [debug] [MainThread]: On master: COMMIT
[0m22:17:33.473923 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:33.474637 [debug] [MainThread]: On master: COMMIT
[0m22:17:33.475667 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:33.476348 [debug] [MainThread]: On master: Close
[0m22:17:33.480913 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:17:33.481944 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:17:33.483158 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:17:33.484144 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:17:33.490442 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:33.499077 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:17:33.526544 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:33.535155 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:33.536010 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:17:33.536942 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:17:33.546950 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m22:17:33.548257 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:33.549253 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:17:33.596530 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.046 seconds
[0m22:17:33.624073 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:33.627796 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:17:33.645981 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.008 seconds
[0m22:17:33.653105 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:33.684798 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:17:33.688403 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:17:33.709108 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:17:33.710671 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:33.712204 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:17:33.715655 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:17:33.724553 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:17:33.731623 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:33.733923 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:17:33.764261 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.029 seconds
[0m22:17:33.767677 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:17:33.770054 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '43eb7c5d-b5f4-47c7-a8d3-fa1b07c48460', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c4fdaa3690>]}
[0m22:17:33.771644 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.29s]
[0m22:17:33.773061 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:17:33.776297 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:33.777353 [debug] [MainThread]: On master: BEGIN
[0m22:17:33.778322 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:17:33.787866 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m22:17:33.789006 [debug] [MainThread]: On master: COMMIT
[0m22:17:33.789971 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:33.791201 [debug] [MainThread]: On master: COMMIT
[0m22:17:33.792636 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:33.793525 [debug] [MainThread]: On master: Close
[0m22:17:33.794595 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:17:33.795772 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:17:33.796791 [info ] [MainThread]: 
[0m22:17:33.798088 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.51 seconds (0.51s).
[0m22:17:33.799575 [debug] [MainThread]: Command end result
[0m22:17:33.851001 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:33.860225 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:33.868089 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:17:33.868912 [info ] [MainThread]: 
[0m22:17:33.874169 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:17:33.878286 [info ] [MainThread]: 
[0m22:17:33.882538 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:17:33.887785 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.1217484, "process_in_blocks": "0", "process_kernel_time": 0.494044, "process_mem_max_rss": "130680", "process_out_blocks": "0", "process_user_time": 2.15008}
[0m22:17:33.893919 [debug] [MainThread]: Command `dbt run` succeeded at 22:17:33.893785 after 4.13 seconds
[0m22:17:33.899825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c505903910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c5056ba9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c5056bb690>]}
[0m22:17:33.905425 [debug] [MainThread]: Flushing usage events
[0m22:17:34.690841 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:17:38.164881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669d6b5e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669d6b6650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669d6b6750>]}


============================== 22:17:38.174377 | 157dfb5f-e605-4097-aeaf-b050ec19019d ==============================
[0m22:17:38.174377 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:17:38.177161 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'printer_width': '80', 'write_json': 'True', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'warn_error': 'None', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'version_check': 'True', 'log_format': 'default', 'introspect': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt/dbt'}
[0m22:17:38.309058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '157dfb5f-e605-4097-aeaf-b050ec19019d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669c365950>]}
[0m22:17:38.365065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '157dfb5f-e605-4097-aeaf-b050ec19019d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7066a03d27d0>]}
[0m22:17:38.367267 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:17:38.562477 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:17:40.719774 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:17:40.721099 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:17:40.757334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '157dfb5f-e605-4097-aeaf-b050ec19019d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669b7959d0>]}
[0m22:17:40.894174 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:40.928768 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:40.994459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '157dfb5f-e605-4097-aeaf-b050ec19019d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669b7c7e90>]}
[0m22:17:40.995895 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:17:40.997141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '157dfb5f-e605-4097-aeaf-b050ec19019d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669af38250>]}
[0m22:17:41.000095 [info ] [MainThread]: 
[0m22:17:41.001576 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:17:41.002950 [info ] [MainThread]: 
[0m22:17:41.004082 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:17:41.005876 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:17:41.105505 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:17:41.113032 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:17:41.121903 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:17:41.150141 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.028 seconds
[0m22:17:41.156661 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:17:41.160869 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:17:41.174674 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:41.176182 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:17:41.177196 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:17:41.185825 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m22:17:41.187224 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:41.188295 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:17:41.193999 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.004 seconds
[0m22:17:41.196614 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:17:41.198274 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:17:41.203364 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:41.204636 [debug] [MainThread]: On master: BEGIN
[0m22:17:41.206098 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:17:41.215953 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:17:41.218546 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:41.221508 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:17:41.227837 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m22:17:41.230026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '157dfb5f-e605-4097-aeaf-b050ec19019d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669b7783d0>]}
[0m22:17:41.231178 [debug] [MainThread]: On master: ROLLBACK
[0m22:17:41.232564 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:41.234158 [debug] [MainThread]: On master: BEGIN
[0m22:17:41.235650 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:17:41.236738 [debug] [MainThread]: On master: COMMIT
[0m22:17:41.238034 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:41.239104 [debug] [MainThread]: On master: COMMIT
[0m22:17:41.240289 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:41.241366 [debug] [MainThread]: On master: Close
[0m22:17:41.250149 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:17:41.251733 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:17:41.253432 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:17:41.254707 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:17:41.271738 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:41.283036 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:17:41.307422 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:41.332528 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:41.341514 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:17:41.349365 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:17:41.363355 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m22:17:41.370983 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:41.378016 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:17:41.392841 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.013 seconds
[0m22:17:41.404002 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:41.405584 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:17:41.407877 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:17:41.413421 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:41.414748 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:17:41.416808 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:17:41.431249 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:17:41.435532 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:41.438435 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:17:41.445483 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:17:41.455345 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:17:41.461785 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:41.463484 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:17:41.469288 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m22:17:41.481116 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:17:41.484617 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '157dfb5f-e605-4097-aeaf-b050ec19019d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669bff4850>]}
[0m22:17:41.486988 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.23s]
[0m22:17:41.488842 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:17:41.492344 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:41.494000 [debug] [MainThread]: On master: BEGIN
[0m22:17:41.495283 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:17:41.506675 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:17:41.509149 [debug] [MainThread]: On master: COMMIT
[0m22:17:41.515364 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:41.518078 [debug] [MainThread]: On master: COMMIT
[0m22:17:41.520071 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:41.521796 [debug] [MainThread]: On master: Close
[0m22:17:41.523504 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:17:41.524857 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:17:41.526325 [info ] [MainThread]: 
[0m22:17:41.531467 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m22:17:41.535156 [debug] [MainThread]: Command end result
[0m22:17:41.636611 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:41.644946 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:41.658644 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:17:41.659643 [info ] [MainThread]: 
[0m22:17:41.661171 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:17:41.662300 [info ] [MainThread]: 
[0m22:17:41.663937 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:17:41.666423 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5819883, "process_in_blocks": "0", "process_kernel_time": 0.356289, "process_mem_max_rss": "127268", "process_out_blocks": "0", "process_user_time": 1.809471}
[0m22:17:41.671227 [debug] [MainThread]: Command `dbt run` succeeded at 22:17:41.671133 after 3.59 seconds
[0m22:17:41.680391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669d656e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70669d6566d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7066a1f5f8d0>]}
[0m22:17:41.684864 [debug] [MainThread]: Flushing usage events
[0m22:17:42.476877 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:17:48.473636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7effef5dc910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7effef5de750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7effef5deb90>]}


============================== 22:17:48.486607 | 51ca4ebe-3230-443e-87a6-13eec62fb1a5 ==============================
[0m22:17:48.486607 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:17:48.496565 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'invocation_command': 'dbt run', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'log_path': '/usr/app/dbt/dbt/logs', 'profiles_dir': '/usr/app/dbt/dbt', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'write_json': 'True', 'version_check': 'True', 'target_path': 'None', 'use_colors': 'True', 'indirect_selection': 'eager', 'warn_error': 'None', 'fail_fast': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'quiet': 'False', 'static_parser': 'True', 'cache_selected_only': 'False'}
[0m22:17:48.666194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '51ca4ebe-3230-443e-87a6-13eec62fb1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7effefa68310>]}
[0m22:17:48.714540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '51ca4ebe-3230-443e-87a6-13eec62fb1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efff23388d0>]}
[0m22:17:48.716790 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:17:48.859432 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:17:50.917801 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:17:50.919400 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:17:50.960838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '51ca4ebe-3230-443e-87a6-13eec62fb1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7effef4a39d0>]}
[0m22:17:56.529848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2be8215650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2be8217250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2be8271ed0>]}


============================== 22:17:56.540026 | f3a2ce68-ee7f-4f1f-b3fb-92dbfe9edc8e ==============================
[0m22:17:56.540026 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:17:56.541557 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run', 'target_path': 'None', 'partial_parse': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'warn_error': 'None', 'version_check': 'True', 'introspect': 'True', 'log_format': 'default', 'log_path': '/usr/app/dbt/dbt/logs', 'write_json': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'no_print': 'None', 'empty': 'False', 'indirect_selection': 'eager', 'debug': 'False', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True'}
[0m22:17:56.679550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f3a2ce68-ee7f-4f1f-b3fb-92dbfe9edc8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2be6f68d10>]}
[0m22:17:56.730313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f3a2ce68-ee7f-4f1f-b3fb-92dbfe9edc8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2beaf8a8d0>]}
[0m22:17:56.733532 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:17:56.893094 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:17:58.656185 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:17:58.657860 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:17:58.692323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f3a2ce68-ee7f-4f1f-b3fb-92dbfe9edc8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2be63f0650>]}
[0m22:17:58.819150 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:58.828531 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:58.856341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f3a2ce68-ee7f-4f1f-b3fb-92dbfe9edc8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2be63ae4d0>]}
[0m22:17:58.857690 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:17:58.859376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f3a2ce68-ee7f-4f1f-b3fb-92dbfe9edc8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2be5b28690>]}
[0m22:17:58.863899 [info ] [MainThread]: 
[0m22:17:58.865165 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:17:58.866466 [info ] [MainThread]: 
[0m22:17:58.867672 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:17:58.870370 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:17:58.977737 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:17:58.979086 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:17:58.980709 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:17:58.996784 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m22:17:58.999760 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:17:59.003518 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:17:59.011745 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:59.013127 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:17:59.014075 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:17:59.025361 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m22:17:59.026876 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:17:59.028690 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:17:59.039182 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.009 seconds
[0m22:17:59.041976 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:17:59.043596 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:17:59.051506 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:59.052868 [debug] [MainThread]: On master: BEGIN
[0m22:17:59.054024 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:17:59.066534 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m22:17:59.068464 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:59.069986 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:17:59.081399 [debug] [MainThread]: SQL status: SELECT 1 in 0.010 seconds
[0m22:17:59.084698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f3a2ce68-ee7f-4f1f-b3fb-92dbfe9edc8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2be6f17490>]}
[0m22:17:59.086429 [debug] [MainThread]: On master: ROLLBACK
[0m22:17:59.088353 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:59.089474 [debug] [MainThread]: On master: BEGIN
[0m22:17:59.091576 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:17:59.092805 [debug] [MainThread]: On master: COMMIT
[0m22:17:59.094695 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:59.096410 [debug] [MainThread]: On master: COMMIT
[0m22:17:59.097819 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:59.099742 [debug] [MainThread]: On master: Close
[0m22:17:59.108506 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:17:59.111520 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:17:59.113706 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:17:59.114847 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:17:59.132084 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:59.147290 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:17:59.178179 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:17:59.192650 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:59.198438 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:17:59.202132 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:17:59.211603 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m22:17:59.213061 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:59.214303 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:17:59.222920 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m22:17:59.229459 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:59.230693 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:17:59.233540 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:17:59.236717 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:59.237884 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:17:59.239982 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:17:59.252033 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:17:59.253245 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:59.254237 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:17:59.256753 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:17:59.261986 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:17:59.266204 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:17:59.267462 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:17:59.272931 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m22:17:59.275675 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:17:59.277841 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f3a2ce68-ee7f-4f1f-b3fb-92dbfe9edc8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2be6bab850>]}
[0m22:17:59.279609 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.16s]
[0m22:17:59.281698 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:17:59.285856 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:59.287776 [debug] [MainThread]: On master: BEGIN
[0m22:17:59.289281 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:17:59.300195 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:17:59.302154 [debug] [MainThread]: On master: COMMIT
[0m22:17:59.303720 [debug] [MainThread]: Using postgres connection "master"
[0m22:17:59.305037 [debug] [MainThread]: On master: COMMIT
[0m22:17:59.306467 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:17:59.307789 [debug] [MainThread]: On master: Close
[0m22:17:59.309266 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:17:59.310511 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:17:59.312320 [info ] [MainThread]: 
[0m22:17:59.314133 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.44 seconds (0.44s).
[0m22:17:59.315897 [debug] [MainThread]: Command end result
[0m22:17:59.376230 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:17:59.385113 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:17:59.397336 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:17:59.398412 [info ] [MainThread]: 
[0m22:17:59.399555 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:17:59.400586 [info ] [MainThread]: 
[0m22:17:59.401889 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:17:59.403872 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.9361203, "process_in_blocks": "0", "process_kernel_time": 0.432866, "process_mem_max_rss": "127028", "process_out_blocks": "0", "process_user_time": 1.839681}
[0m22:17:59.405368 [debug] [MainThread]: Command `dbt run` succeeded at 22:17:59.405236 after 2.94 seconds
[0m22:17:59.407148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2be8578b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2becb2f810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2beca7edd0>]}
[0m22:17:59.408536 [debug] [MainThread]: Flushing usage events
[0m22:18:00.046369 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:18:02.252854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759049b26250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759049e32bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759049b32450>]}


============================== 22:18:02.260599 | 072d5a9d-4427-45f7-b964-5b4d244ed2e5 ==============================
[0m22:18:02.260599 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:18:02.262394 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'empty': 'False', 'warn_error': 'None', 'use_colors': 'True', 'write_json': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'version_check': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'log_cache_events': 'False', 'log_format': 'default', 'introspect': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'fail_fast': 'False'}
[0m22:18:02.418831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '072d5a9d-4427-45f7-b964-5b4d244ed2e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759049b47790>]}
[0m22:18:02.463728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '072d5a9d-4427-45f7-b964-5b4d244ed2e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759048bbdd50>]}
[0m22:18:02.466300 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:18:02.625260 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:18:04.375527 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:18:04.377200 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:18:04.413432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '072d5a9d-4427-45f7-b964-5b4d244ed2e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759047f82810>]}
[0m22:18:04.521460 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:04.530821 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:04.564607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '072d5a9d-4427-45f7-b964-5b4d244ed2e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759047fcc4d0>]}
[0m22:18:04.565936 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:18:04.567380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '072d5a9d-4427-45f7-b964-5b4d244ed2e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759049ad1590>]}
[0m22:18:04.571014 [info ] [MainThread]: 
[0m22:18:04.572617 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:18:04.574314 [info ] [MainThread]: 
[0m22:18:04.575925 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:18:04.578469 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:18:04.686077 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:18:04.689475 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:18:04.691810 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:18:04.705936 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.014 seconds
[0m22:18:04.709493 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:18:04.712298 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:18:04.718281 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:04.719847 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:18:04.720679 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:18:04.728845 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m22:18:04.729727 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:04.731133 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:18:04.737897 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m22:18:04.741356 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:18:04.743039 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:18:04.750002 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:04.751482 [debug] [MainThread]: On master: BEGIN
[0m22:18:04.753881 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:18:04.763944 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:18:04.765861 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:04.767949 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:18:04.775048 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m22:18:04.777766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '072d5a9d-4427-45f7-b964-5b4d244ed2e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759048fc7710>]}
[0m22:18:04.779201 [debug] [MainThread]: On master: ROLLBACK
[0m22:18:04.781591 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:04.784582 [debug] [MainThread]: On master: BEGIN
[0m22:18:04.786432 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:18:04.787725 [debug] [MainThread]: On master: COMMIT
[0m22:18:04.788986 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:04.789995 [debug] [MainThread]: On master: COMMIT
[0m22:18:04.791669 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:04.793119 [debug] [MainThread]: On master: Close
[0m22:18:04.801459 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:18:04.803465 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:18:04.805310 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:18:04.807305 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:18:04.829417 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:04.841053 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:18:04.873330 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:04.886660 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:04.888166 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:18:04.889666 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:18:04.901720 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m22:18:04.903532 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:04.905139 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:18:04.919816 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.013 seconds
[0m22:18:04.928146 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:04.930099 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:18:04.933756 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:18:04.937818 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:04.939049 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:18:04.941784 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:18:04.953763 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:04.955371 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:04.956437 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:04.959846 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:18:04.966154 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:18:04.971058 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:04.972128 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:18:04.977253 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m22:18:04.980224 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:18:04.982724 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '072d5a9d-4427-45f7-b964-5b4d244ed2e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75904b97e190>]}
[0m22:18:04.984021 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.18s]
[0m22:18:04.985602 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:18:04.988367 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:04.989628 [debug] [MainThread]: On master: BEGIN
[0m22:18:04.990977 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:18:05.001687 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:18:05.003248 [debug] [MainThread]: On master: COMMIT
[0m22:18:05.004405 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:05.005817 [debug] [MainThread]: On master: COMMIT
[0m22:18:05.007034 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:05.008112 [debug] [MainThread]: On master: Close
[0m22:18:05.009349 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:18:05.010099 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:18:05.011218 [info ] [MainThread]: 
[0m22:18:05.012468 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.44 seconds (0.44s).
[0m22:18:05.014524 [debug] [MainThread]: Command end result
[0m22:18:05.078886 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:05.087781 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:05.098907 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:18:05.100425 [info ] [MainThread]: 
[0m22:18:05.102123 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:18:05.103554 [info ] [MainThread]: 
[0m22:18:05.105369 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:18:05.107383 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.925155, "process_in_blocks": "0", "process_kernel_time": 0.39157, "process_mem_max_rss": "126728", "process_out_blocks": "0", "process_user_time": 1.925559}
[0m22:18:05.108543 [debug] [MainThread]: Command `dbt run` succeeded at 22:18:05.108443 after 2.93 seconds
[0m22:18:05.109749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75904e3eb810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75904e406a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75904e406910>]}
[0m22:18:05.111103 [debug] [MainThread]: Flushing usage events
[0m22:18:05.751316 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:18:07.952295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7889652c3150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7889652e0d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788967ffb9d0>]}


============================== 22:18:07.957815 | bcd5da31-808c-4480-847a-04a6db6d7753 ==============================
[0m22:18:07.957815 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:18:07.959466 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'debug': 'False', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'no_print': 'None', 'use_colors': 'True', 'static_parser': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'target_path': 'None', 'write_json': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'printer_width': '80', 'fail_fast': 'False', 'introspect': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'log_format': 'default', 'quiet': 'False', 'version_check': 'True', 'partial_parse': 'True'}
[0m22:18:08.094852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bcd5da31-808c-4480-847a-04a6db6d7753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788965433790>]}
[0m22:18:08.143405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bcd5da31-808c-4480-847a-04a6db6d7753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788968022910>]}
[0m22:18:08.145935 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:18:08.269915 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:18:09.736488 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:18:09.738234 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:18:09.774725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bcd5da31-808c-4480-847a-04a6db6d7753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78896374c150>]}
[0m22:18:09.879003 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:09.887083 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:09.915157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bcd5da31-808c-4480-847a-04a6db6d7753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78896374cf90>]}
[0m22:18:09.916794 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:18:09.918353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bcd5da31-808c-4480-847a-04a6db6d7753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788962f1a650>]}
[0m22:18:09.920641 [info ] [MainThread]: 
[0m22:18:09.921883 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:18:09.925111 [info ] [MainThread]: 
[0m22:18:09.927022 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:18:09.929930 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:18:10.052007 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:18:10.053733 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:18:10.057151 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:18:10.074005 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m22:18:10.076569 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:18:10.079038 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:18:10.084258 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:10.086788 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:18:10.091296 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:18:10.100575 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m22:18:10.102895 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:10.103809 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:18:10.110709 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m22:18:10.113041 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:18:10.114435 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:18:10.121141 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:10.125711 [debug] [MainThread]: On master: BEGIN
[0m22:18:10.127212 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:18:10.135055 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m22:18:10.136118 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:10.136924 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:18:10.144344 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m22:18:10.146237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bcd5da31-808c-4480-847a-04a6db6d7753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788962146250>]}
[0m22:18:10.147116 [debug] [MainThread]: On master: ROLLBACK
[0m22:18:10.148188 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:10.148812 [debug] [MainThread]: On master: BEGIN
[0m22:18:10.149719 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:18:10.150461 [debug] [MainThread]: On master: COMMIT
[0m22:18:10.151199 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:10.151919 [debug] [MainThread]: On master: COMMIT
[0m22:18:10.152787 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:10.153602 [debug] [MainThread]: On master: Close
[0m22:18:10.162123 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:18:10.177818 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:18:10.180703 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:18:10.183287 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:18:10.199196 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:10.241423 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:18:10.278423 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:10.300222 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:10.302467 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:18:10.303767 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:18:10.315492 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m22:18:10.317355 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:10.318800 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:18:10.330035 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m22:18:10.337228 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:10.338412 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:18:10.341540 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:18:10.344896 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:10.346021 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:18:10.348259 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:18:10.362869 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:10.364182 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:10.365363 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:10.369037 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:18:10.377406 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:18:10.387333 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:10.394619 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:18:10.402611 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m22:18:10.409868 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:18:10.412883 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcd5da31-808c-4480-847a-04a6db6d7753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788963fddf90>]}
[0m22:18:10.414728 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.23s]
[0m22:18:10.416368 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:18:10.419919 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:10.423213 [debug] [MainThread]: On master: BEGIN
[0m22:18:10.425162 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:18:10.440367 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m22:18:10.442150 [debug] [MainThread]: On master: COMMIT
[0m22:18:10.443550 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:10.447999 [debug] [MainThread]: On master: COMMIT
[0m22:18:10.449391 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:10.450915 [debug] [MainThread]: On master: Close
[0m22:18:10.452325 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:18:10.454227 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:18:10.457275 [info ] [MainThread]: 
[0m22:18:10.459433 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.53 seconds (0.53s).
[0m22:18:10.461955 [debug] [MainThread]: Command end result
[0m22:18:10.539846 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:10.549688 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:10.566259 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:18:10.567910 [info ] [MainThread]: 
[0m22:18:10.569504 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:18:10.570975 [info ] [MainThread]: 
[0m22:18:10.572833 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:18:10.575023 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.6959617, "process_in_blocks": "0", "process_kernel_time": 0.366381, "process_mem_max_rss": "127172", "process_out_blocks": "0", "process_user_time": 1.880219}
[0m22:18:10.576811 [debug] [MainThread]: Command `dbt run` succeeded at 22:18:10.576643 after 2.70 seconds
[0m22:18:10.578162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7889652b3c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78896561ca90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788969b16dd0>]}
[0m22:18:10.579623 [debug] [MainThread]: Flushing usage events
[0m22:18:11.518038 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:18:13.984234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72310ebae950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72310a720490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72310a7225d0>]}


============================== 22:18:13.991208 | b505e766-b4ce-4241-b32a-0cf1fec46b63 ==============================
[0m22:18:13.991208 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:18:13.992323 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'target_path': 'None', 'printer_width': '80', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'quiet': 'False', 'write_json': 'True', 'fail_fast': 'False', 'no_print': 'None', 'static_parser': 'True', 'introspect': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'log_format': 'default', 'debug': 'False', 'version_check': 'True', 'log_cache_events': 'False'}
[0m22:18:14.139394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b505e766-b4ce-4241-b32a-0cf1fec46b63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72310aaa8e10>]}
[0m22:18:14.190095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b505e766-b4ce-4241-b32a-0cf1fec46b63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72310d48e190>]}
[0m22:18:14.191617 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:18:14.404502 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:18:16.713890 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:18:16.715226 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:18:16.755222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b505e766-b4ce-4241-b32a-0cf1fec46b63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723108b87190>]}
[0m22:18:16.881946 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:16.892367 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:16.923042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b505e766-b4ce-4241-b32a-0cf1fec46b63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723108ba6010>]}
[0m22:18:16.924206 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:18:16.925612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b505e766-b4ce-4241-b32a-0cf1fec46b63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72310834a110>]}
[0m22:18:16.928695 [info ] [MainThread]: 
[0m22:18:16.930058 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:18:16.932265 [info ] [MainThread]: 
[0m22:18:16.934371 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:18:16.936285 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:18:17.033944 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:18:17.035935 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:18:17.037827 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:18:17.055360 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m22:18:17.058960 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:18:17.063480 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:18:17.069810 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:17.070914 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:18:17.071792 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:18:17.084826 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m22:18:17.086103 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:17.087192 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:18:17.093459 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m22:18:17.096794 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:18:17.098912 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:18:17.105672 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:17.106817 [debug] [MainThread]: On master: BEGIN
[0m22:18:17.107881 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:18:17.117212 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m22:18:17.118251 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:17.119441 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:18:17.126358 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m22:18:17.129060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b505e766-b4ce-4241-b32a-0cf1fec46b63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723109bca490>]}
[0m22:18:17.131976 [debug] [MainThread]: On master: ROLLBACK
[0m22:18:17.145458 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:17.147844 [debug] [MainThread]: On master: BEGIN
[0m22:18:17.157664 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:18:17.161823 [debug] [MainThread]: On master: COMMIT
[0m22:18:17.162715 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:17.164006 [debug] [MainThread]: On master: COMMIT
[0m22:18:17.165139 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:17.165940 [debug] [MainThread]: On master: Close
[0m22:18:17.174918 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:18:17.176653 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:18:17.178207 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:18:17.179883 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:18:17.195919 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:17.208240 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:18:17.236866 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:17.255049 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:17.256132 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:18:17.257341 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:18:17.267647 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m22:18:17.269824 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:17.271962 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:18:17.285819 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m22:18:17.293815 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:17.295406 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:18:17.298728 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:18:17.303869 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:17.310468 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:18:17.315598 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:18:17.332691 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:17.336003 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:17.338771 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:17.343470 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:18:17.349168 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:18:17.356642 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:17.358423 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:18:17.366555 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m22:18:17.373336 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:18:17.376857 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b505e766-b4ce-4241-b32a-0cf1fec46b63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72310b879790>]}
[0m22:18:17.379424 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.20s]
[0m22:18:17.382007 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:18:17.388673 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:17.390839 [debug] [MainThread]: On master: BEGIN
[0m22:18:17.392603 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:18:17.405805 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m22:18:17.408092 [debug] [MainThread]: On master: COMMIT
[0m22:18:17.410025 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:17.411774 [debug] [MainThread]: On master: COMMIT
[0m22:18:17.413790 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:17.415832 [debug] [MainThread]: On master: Close
[0m22:18:17.419810 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:18:17.421527 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:18:17.422855 [info ] [MainThread]: 
[0m22:18:17.424625 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.49 seconds (0.49s).
[0m22:18:17.426488 [debug] [MainThread]: Command end result
[0m22:18:17.495830 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:17.512795 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:17.529174 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:18:17.530478 [info ] [MainThread]: 
[0m22:18:17.531881 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:18:17.536345 [info ] [MainThread]: 
[0m22:18:17.540277 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:18:17.542690 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.624657, "process_in_blocks": "0", "process_kernel_time": 0.448237, "process_mem_max_rss": "126780", "process_out_blocks": "0", "process_user_time": 1.890748}
[0m22:18:17.544240 [debug] [MainThread]: Command `dbt run` succeeded at 22:18:17.544063 after 3.63 seconds
[0m22:18:17.545479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72310a781dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72310b5e5950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72310f287910>]}
[0m22:18:17.546703 [debug] [MainThread]: Flushing usage events
[0m22:18:18.436868 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:18:21.249332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe325526890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe325525990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3258a0490>]}


============================== 22:18:21.255732 | 4805495d-ed86-4d48-8fcc-714975e47289 ==============================
[0m22:18:21.255732 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:18:21.256811 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'target_path': 'None', 'use_colors': 'True', 'invocation_command': 'dbt run', 'write_json': 'True', 'no_print': 'None', 'partial_parse': 'True', 'empty': 'False', 'introspect': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'version_check': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'fail_fast': 'False', 'log_cache_events': 'False', 'quiet': 'False'}
[0m22:18:21.380936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4805495d-ed86-4d48-8fcc-714975e47289', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe325524c50>]}
[0m22:18:21.427546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4805495d-ed86-4d48-8fcc-714975e47289', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3282a66d0>]}
[0m22:18:21.429132 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:18:21.671904 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:18:23.001634 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:18:23.002733 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:18:23.035351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4805495d-ed86-4d48-8fcc-714975e47289', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe323505090>]}
[0m22:18:23.125396 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:23.130822 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:23.154830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4805495d-ed86-4d48-8fcc-714975e47289', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3239c8490>]}
[0m22:18:23.155960 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:18:23.157153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4805495d-ed86-4d48-8fcc-714975e47289', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe32313c650>]}
[0m22:18:23.159007 [info ] [MainThread]: 
[0m22:18:23.159978 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:18:23.160829 [info ] [MainThread]: 
[0m22:18:23.161986 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:18:23.163402 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:18:23.254942 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:18:23.257043 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:18:23.259082 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:18:23.274948 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m22:18:23.278466 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:18:23.282243 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:18:23.290533 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:23.292278 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:18:23.293513 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:18:23.303711 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m22:18:23.304996 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:23.306034 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:18:23.312270 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m22:18:23.314994 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:18:23.316376 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:18:23.322952 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:23.323973 [debug] [MainThread]: On master: BEGIN
[0m22:18:23.325055 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:18:23.335117 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:18:23.336970 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:23.338609 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:18:23.346857 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m22:18:23.349772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4805495d-ed86-4d48-8fcc-714975e47289', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe32231e350>]}
[0m22:18:23.351644 [debug] [MainThread]: On master: ROLLBACK
[0m22:18:23.353097 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:23.354358 [debug] [MainThread]: On master: BEGIN
[0m22:18:23.355744 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:18:23.356945 [debug] [MainThread]: On master: COMMIT
[0m22:18:23.357907 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:23.358905 [debug] [MainThread]: On master: COMMIT
[0m22:18:23.360709 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:23.361715 [debug] [MainThread]: On master: Close
[0m22:18:23.368734 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:18:23.370224 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:18:23.371764 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:18:23.372991 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:18:23.393561 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:23.403659 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:18:23.429524 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:23.439970 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:23.441042 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:18:23.442182 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:18:23.452440 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m22:18:23.454400 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:23.455751 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:18:23.467523 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m22:18:23.474707 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:23.476022 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:18:23.478524 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:18:23.481977 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:23.483064 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:18:23.486470 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:18:23.502469 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:23.503716 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:23.504715 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:23.508020 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:18:23.513052 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:18:23.519850 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:23.520963 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:18:23.526900 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m22:18:23.530200 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:18:23.532559 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4805495d-ed86-4d48-8fcc-714975e47289', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3239c8710>]}
[0m22:18:23.535479 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.16s]
[0m22:18:23.536716 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:18:23.539054 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:23.539854 [debug] [MainThread]: On master: BEGIN
[0m22:18:23.540593 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:18:23.547664 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m22:18:23.549167 [debug] [MainThread]: On master: COMMIT
[0m22:18:23.549969 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:23.551536 [debug] [MainThread]: On master: COMMIT
[0m22:18:23.552425 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:23.553197 [debug] [MainThread]: On master: Close
[0m22:18:23.554033 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:18:23.555075 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:18:23.555732 [info ] [MainThread]: 
[0m22:18:23.556538 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.39 seconds (0.39s).
[0m22:18:23.557572 [debug] [MainThread]: Command end result
[0m22:18:23.606925 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:23.612898 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:23.621283 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:18:23.622252 [info ] [MainThread]: 
[0m22:18:23.623269 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:18:23.624176 [info ] [MainThread]: 
[0m22:18:23.625054 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:18:23.626380 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.4349785, "process_in_blocks": "0", "process_kernel_time": 0.355445, "process_mem_max_rss": "127056", "process_out_blocks": "0", "process_user_time": 1.813577}
[0m22:18:23.628573 [debug] [MainThread]: Command `dbt run` succeeded at 22:18:23.628482 after 2.44 seconds
[0m22:18:23.630043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe329d82d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe329d82dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe329e2f8d0>]}
[0m22:18:23.630914 [debug] [MainThread]: Flushing usage events
[0m22:18:24.354984 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:18:27.773132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a339016b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a338fe0990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a338fc2ad0>]}


============================== 22:18:27.779220 | b78f214e-1f13-487d-8970-8b0c8b11c148 ==============================
[0m22:18:27.779220 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:18:27.780781 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'warn_error': 'None', 'use_colors': 'True', 'introspect': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'fail_fast': 'False', 'version_check': 'True', 'empty': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'debug': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'write_json': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'printer_width': '80'}
[0m22:18:27.919807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b78f214e-1f13-487d-8970-8b0c8b11c148', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a338fb0390>]}
[0m22:18:27.961360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b78f214e-1f13-487d-8970-8b0c8b11c148', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a33bd2e510>]}
[0m22:18:27.967503 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:18:28.132965 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:18:30.244866 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:18:30.246484 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:18:30.293588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b78f214e-1f13-487d-8970-8b0c8b11c148', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3377d0cd0>]}
[0m22:18:30.410843 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:30.419362 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:30.445779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b78f214e-1f13-487d-8970-8b0c8b11c148', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3377c4c50>]}
[0m22:18:30.447876 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:18:30.449354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b78f214e-1f13-487d-8970-8b0c8b11c148', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a336f149d0>]}
[0m22:18:30.452397 [info ] [MainThread]: 
[0m22:18:30.453734 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:18:30.454912 [info ] [MainThread]: 
[0m22:18:30.456203 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:18:30.458190 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:18:30.558063 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:18:30.559535 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:18:30.562248 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:18:30.580534 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.018 seconds
[0m22:18:30.583344 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:18:30.585865 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:18:30.594882 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:30.596190 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:18:30.597078 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:18:30.609550 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m22:18:30.611159 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:30.612256 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:18:30.627903 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.015 seconds
[0m22:18:30.630329 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:18:30.631760 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:18:30.638342 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:30.639340 [debug] [MainThread]: On master: BEGIN
[0m22:18:30.640261 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:18:30.649206 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m22:18:30.650227 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:30.651218 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:18:30.660666 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m22:18:30.662962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b78f214e-1f13-487d-8970-8b0c8b11c148', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3383a3fd0>]}
[0m22:18:30.664976 [debug] [MainThread]: On master: ROLLBACK
[0m22:18:30.666643 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:30.668221 [debug] [MainThread]: On master: BEGIN
[0m22:18:30.669776 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:18:30.671274 [debug] [MainThread]: On master: COMMIT
[0m22:18:30.672643 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:30.673745 [debug] [MainThread]: On master: COMMIT
[0m22:18:30.674940 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:30.675933 [debug] [MainThread]: On master: Close
[0m22:18:30.681999 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:18:30.683188 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:18:30.684371 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:18:30.685454 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:18:30.698722 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:30.709838 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:18:30.741661 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:30.753740 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:30.755215 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:18:30.756400 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:18:30.766975 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m22:18:30.769075 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:30.770737 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:18:30.783861 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m22:18:30.789892 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:30.791163 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:18:30.793760 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:18:30.797717 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:30.798823 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:18:30.801464 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:18:30.815062 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:30.816342 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:30.817216 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:30.819523 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m22:18:30.824337 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:18:30.831071 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:30.832557 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:18:30.837713 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m22:18:30.840797 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:18:30.843403 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b78f214e-1f13-487d-8970-8b0c8b11c148', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a337fdf850>]}
[0m22:18:30.845086 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.16s]
[0m22:18:30.847171 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:18:30.849972 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:30.851284 [debug] [MainThread]: On master: BEGIN
[0m22:18:30.852321 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:18:30.860349 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m22:18:30.861494 [debug] [MainThread]: On master: COMMIT
[0m22:18:30.863204 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:30.864051 [debug] [MainThread]: On master: COMMIT
[0m22:18:30.865075 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:30.866546 [debug] [MainThread]: On master: Close
[0m22:18:30.867915 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:18:30.868914 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:18:30.870423 [info ] [MainThread]: 
[0m22:18:30.871776 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.41 seconds (0.41s).
[0m22:18:30.873869 [debug] [MainThread]: Command end result
[0m22:18:30.928858 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:30.936821 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:30.946949 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:18:30.948341 [info ] [MainThread]: 
[0m22:18:30.949912 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:18:30.951151 [info ] [MainThread]: 
[0m22:18:30.953793 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:18:30.955590 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.2588336, "process_in_blocks": "0", "process_kernel_time": 0.349012, "process_mem_max_rss": "127388", "process_out_blocks": "0", "process_user_time": 1.822171}
[0m22:18:30.956709 [debug] [MainThread]: Command `dbt run` succeeded at 22:18:30.956570 after 3.26 seconds
[0m22:18:30.957662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a339022090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a33d81ae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a33d8cb810>]}
[0m22:18:30.958804 [debug] [MainThread]: Flushing usage events
[0m22:18:31.861189 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:18:37.057158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe6e88e190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe6e8ee890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe6e88df50>]}


============================== 22:18:37.071008 | ab6793a8-207b-4314-a960-a97a4978df4c ==============================
[0m22:18:37.071008 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:18:37.074856 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'introspect': 'True', 'printer_width': '80', 'static_parser': 'True', 'version_check': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'use_colors': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'debug': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'log_cache_events': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'target_path': 'None', 'cache_selected_only': 'False', 'write_json': 'True', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error': 'None'}
[0m22:18:37.243476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ab6793a8-207b-4314-a960-a97a4978df4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe6e88cd10>]}
[0m22:18:37.301234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ab6793a8-207b-4314-a960-a97a4978df4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe715eea10>]}
[0m22:18:37.310441 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:18:37.498455 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:18:39.901465 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:18:39.907000 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:18:39.958972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ab6793a8-207b-4314-a960-a97a4978df4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe6cd6ba10>]}
[0m22:18:40.090279 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:40.112931 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:40.149988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ab6793a8-207b-4314-a960-a97a4978df4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe6cdce110>]}
[0m22:18:40.151362 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:18:40.153229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab6793a8-207b-4314-a960-a97a4978df4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe6c5445d0>]}
[0m22:18:40.161684 [info ] [MainThread]: 
[0m22:18:40.163135 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:18:40.164441 [info ] [MainThread]: 
[0m22:18:40.169444 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:18:40.172140 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:18:40.295937 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:18:40.298866 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:18:40.310653 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:18:40.334872 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.024 seconds
[0m22:18:40.341915 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:18:40.347773 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:18:40.361839 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:40.365162 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:18:40.368180 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:18:40.382831 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m22:18:40.386349 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:40.391784 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:18:40.404145 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.010 seconds
[0m22:18:40.408863 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:18:40.411215 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:18:40.418974 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:40.420630 [debug] [MainThread]: On master: BEGIN
[0m22:18:40.422377 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:18:40.433604 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:18:40.435675 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:40.438676 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:18:40.448638 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m22:18:40.451770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab6793a8-207b-4314-a960-a97a4978df4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe6e87df50>]}
[0m22:18:40.454670 [debug] [MainThread]: On master: ROLLBACK
[0m22:18:40.456806 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:40.458311 [debug] [MainThread]: On master: BEGIN
[0m22:18:40.460099 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:18:40.461499 [debug] [MainThread]: On master: COMMIT
[0m22:18:40.462857 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:40.464063 [debug] [MainThread]: On master: COMMIT
[0m22:18:40.465659 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:40.466999 [debug] [MainThread]: On master: Close
[0m22:18:40.478194 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:18:40.480160 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:18:40.482258 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:18:40.483458 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:18:40.508129 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:40.522469 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:18:40.550653 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:40.567658 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:40.569543 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:18:40.570696 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:18:40.583042 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m22:18:40.584607 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:40.586503 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:18:40.600068 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m22:18:40.637751 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:40.640267 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:18:40.644349 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:18:40.650035 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:40.651375 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:18:40.655350 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:18:40.669271 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:40.670539 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:40.671512 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:40.677118 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m22:18:40.682352 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:18:40.686886 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:40.688849 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:18:40.696328 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m22:18:40.698866 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:18:40.700761 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab6793a8-207b-4314-a960-a97a4978df4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe6b772850>]}
[0m22:18:40.701768 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.22s]
[0m22:18:40.709566 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:18:40.712357 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:40.713477 [debug] [MainThread]: On master: BEGIN
[0m22:18:40.714322 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:18:40.722654 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m22:18:40.723655 [debug] [MainThread]: On master: COMMIT
[0m22:18:40.724451 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:40.725234 [debug] [MainThread]: On master: COMMIT
[0m22:18:40.726019 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:40.726704 [debug] [MainThread]: On master: Close
[0m22:18:40.727597 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:18:40.728290 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:18:40.729143 [info ] [MainThread]: 
[0m22:18:40.730085 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m22:18:40.731101 [debug] [MainThread]: Command end result
[0m22:18:40.830480 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:40.841374 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:40.856069 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:18:40.857210 [info ] [MainThread]: 
[0m22:18:40.858611 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:18:40.859819 [info ] [MainThread]: 
[0m22:18:40.861193 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:18:40.863453 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.881072, "process_in_blocks": "0", "process_kernel_time": 0.384005, "process_mem_max_rss": "127148", "process_out_blocks": "0", "process_user_time": 1.895775}
[0m22:18:40.864684 [debug] [MainThread]: Command `dbt run` succeeded at 22:18:40.864530 after 3.88 seconds
[0m22:18:40.865720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe733f3910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe731aab90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfe731aaa50>]}
[0m22:18:40.866723 [debug] [MainThread]: Flushing usage events
[0m22:18:41.573482 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:18:50.018088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d68decd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d68e6610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d68a90d0>]}


============================== 22:18:50.023714 | b974ba05-b0e3-4328-9dfa-ac8ba84f639c ==============================
[0m22:18:50.023714 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:18:50.024889 [debug] [MainThread]: running dbt with arguments {'log_path': '/usr/app/dbt/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'write_json': 'True', 'debug': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'empty': 'False', 'static_parser': 'True', 'invocation_command': 'dbt run', 'no_print': 'None', 'indirect_selection': 'eager', 'use_colors': 'True', 'target_path': 'None', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_format': 'default', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False'}
[0m22:18:50.147185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b974ba05-b0e3-4328-9dfa-ac8ba84f639c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d6bf0bd0>]}
[0m22:18:50.188336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b974ba05-b0e3-4328-9dfa-ac8ba84f639c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d9606690>]}
[0m22:18:50.198788 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:18:50.365389 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:18:51.555597 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:18:51.558030 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:18:51.591053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b974ba05-b0e3-4328-9dfa-ac8ba84f639c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d4d88150>]}
[0m22:18:51.695266 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:51.704858 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:51.735006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b974ba05-b0e3-4328-9dfa-ac8ba84f639c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d4d88750>]}
[0m22:18:51.736335 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:18:51.737857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b974ba05-b0e3-4328-9dfa-ac8ba84f639c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d45242d0>]}
[0m22:18:51.741045 [info ] [MainThread]: 
[0m22:18:51.742510 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:18:51.743904 [info ] [MainThread]: 
[0m22:18:51.745616 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:18:51.748190 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:18:51.878694 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:18:51.880631 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:18:51.882233 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:18:51.898318 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m22:18:51.901064 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:18:51.904140 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:18:51.911807 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:51.913500 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:18:51.914764 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:18:51.925727 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m22:18:51.927228 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:18:51.928589 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:18:51.936642 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m22:18:51.938978 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:18:51.940448 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:18:51.946347 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:51.947757 [debug] [MainThread]: On master: BEGIN
[0m22:18:51.949347 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:18:51.960026 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:18:51.961331 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:51.962471 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:18:51.970282 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m22:18:51.972192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b974ba05-b0e3-4328-9dfa-ac8ba84f639c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d5197350>]}
[0m22:18:51.973428 [debug] [MainThread]: On master: ROLLBACK
[0m22:18:51.974530 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:51.975384 [debug] [MainThread]: On master: BEGIN
[0m22:18:51.977872 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:18:51.978692 [debug] [MainThread]: On master: COMMIT
[0m22:18:51.979805 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:51.980658 [debug] [MainThread]: On master: COMMIT
[0m22:18:51.982016 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:51.982899 [debug] [MainThread]: On master: Close
[0m22:18:51.992270 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:18:51.993594 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:18:51.994780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:18:51.995707 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:18:52.012304 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:52.031378 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:18:52.062995 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:18:52.073450 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:52.074402 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:18:52.076153 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:18:52.084270 [debug] [Thread-1 (]: SQL status: BEGIN in 0.008 seconds
[0m22:18:52.085519 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:52.086707 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:18:52.100602 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m22:18:52.106995 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:52.122305 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:18:52.126707 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:18:52.131349 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:52.132846 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:18:52.135490 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:18:52.152628 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:52.157182 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:52.159423 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:18:52.163520 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:18:52.172930 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:18:52.179428 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:18:52.180981 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:18:52.188402 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m22:18:52.195217 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:18:52.203649 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b974ba05-b0e3-4328-9dfa-ac8ba84f639c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d51a9e50>]}
[0m22:18:52.222101 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.20s]
[0m22:18:52.224659 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:18:52.229690 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:52.231238 [debug] [MainThread]: On master: BEGIN
[0m22:18:52.232518 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:18:52.246641 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m22:18:52.248203 [debug] [MainThread]: On master: COMMIT
[0m22:18:52.249998 [debug] [MainThread]: Using postgres connection "master"
[0m22:18:52.251382 [debug] [MainThread]: On master: COMMIT
[0m22:18:52.252968 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:18:52.254331 [debug] [MainThread]: On master: Close
[0m22:18:52.255607 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:18:52.258508 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:18:52.260755 [info ] [MainThread]: 
[0m22:18:52.262072 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m22:18:52.263711 [debug] [MainThread]: Command end result
[0m22:18:52.320536 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:18:52.327514 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:18:52.340368 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:18:52.341472 [info ] [MainThread]: 
[0m22:18:52.343490 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:18:52.345536 [info ] [MainThread]: 
[0m22:18:52.347037 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:18:52.349546 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.409421, "process_in_blocks": "0", "process_kernel_time": 0.397413, "process_mem_max_rss": "126428", "process_out_blocks": "0", "process_user_time": 1.826497}
[0m22:18:52.350770 [debug] [MainThread]: Command `dbt run` succeeded at 22:18:52.350590 after 2.41 seconds
[0m22:18:52.351980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619d6885210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619db1a3810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7619db1bea50>]}
[0m22:18:52.353103 [debug] [MainThread]: Flushing usage events
[0m22:18:53.162407 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:19:07.814124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b8631aa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b86319ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b8631a250>]}


============================== 22:19:07.819458 | e7480395-a8dd-45bb-96f2-957d2d49c012 ==============================
[0m22:19:07.819458 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:19:07.821226 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'log_cache_events': 'False', 'quiet': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'no_print': 'None', 'log_format': 'default', 'profiles_dir': '/usr/app/dbt/dbt', 'introspect': 'True', 'static_parser': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'printer_width': '80', 'indirect_selection': 'eager', 'target_path': 'None', 'debug': 'False', 'cache_selected_only': 'False', 'write_json': 'True', 'fail_fast': 'False'}
[0m22:19:07.942524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7480395-a8dd-45bb-96f2-957d2d49c012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b857e0b10>]}
[0m22:19:07.986425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e7480395-a8dd-45bb-96f2-957d2d49c012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b8907ea50>]}
[0m22:19:07.989344 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:19:08.132800 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:19:09.817902 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:19:09.819992 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:19:09.857864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e7480395-a8dd-45bb-96f2-957d2d49c012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b84780150>]}
[0m22:19:10.083608 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:19:10.101270 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:19:10.142340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e7480395-a8dd-45bb-96f2-957d2d49c012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b847a8bd0>]}
[0m22:19:10.143975 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:19:10.145597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7480395-a8dd-45bb-96f2-957d2d49c012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b83f149d0>]}
[0m22:19:10.149899 [info ] [MainThread]: 
[0m22:19:10.151309 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:19:10.152593 [info ] [MainThread]: 
[0m22:19:10.154084 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:19:10.156244 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:19:10.264897 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:19:10.266632 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:19:10.267814 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:19:10.281174 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.013 seconds
[0m22:19:10.283329 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:19:10.286086 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:19:10.292259 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:19:10.293685 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:19:10.295086 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:19:10.305301 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m22:19:10.306615 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:19:10.308268 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:19:10.313720 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.004 seconds
[0m22:19:10.316406 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:19:10.317763 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:19:10.327210 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:10.343017 [debug] [MainThread]: On master: BEGIN
[0m22:19:10.345560 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:19:10.364395 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m22:19:10.366266 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:10.368003 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:19:10.377259 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m22:19:10.379652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7480395-a8dd-45bb-96f2-957d2d49c012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b88273d10>]}
[0m22:19:10.381031 [debug] [MainThread]: On master: ROLLBACK
[0m22:19:10.382741 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:10.383907 [debug] [MainThread]: On master: BEGIN
[0m22:19:10.385708 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:19:10.386868 [debug] [MainThread]: On master: COMMIT
[0m22:19:10.387965 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:10.388821 [debug] [MainThread]: On master: COMMIT
[0m22:19:10.389806 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:19:10.391512 [debug] [MainThread]: On master: Close
[0m22:19:10.401084 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:19:10.402676 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:19:10.403970 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:19:10.404917 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:19:10.422579 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:19:10.439056 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:19:10.464217 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:19:10.476174 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:10.477857 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:19:10.479222 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:19:10.489743 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m22:19:10.491376 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:10.492548 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:19:10.505111 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m22:19:10.511655 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:10.512937 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:19:10.516875 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:19:10.520757 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:10.521829 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:19:10.524951 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:19:10.536911 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:19:10.538073 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:10.539099 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:19:10.543923 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:19:10.551998 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:19:10.558260 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:10.559587 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:19:10.565777 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m22:19:10.568948 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:19:10.571252 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7480395-a8dd-45bb-96f2-957d2d49c012', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b8530dd10>]}
[0m22:19:10.574015 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.17s]
[0m22:19:10.575796 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:19:10.578390 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:10.579321 [debug] [MainThread]: On master: BEGIN
[0m22:19:10.580184 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:19:10.589153 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m22:19:10.629815 [debug] [MainThread]: On master: COMMIT
[0m22:19:10.632605 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:10.636641 [debug] [MainThread]: On master: COMMIT
[0m22:19:10.640264 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:19:10.643213 [debug] [MainThread]: On master: Close
[0m22:19:10.645793 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:19:10.647597 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:19:10.649320 [info ] [MainThread]: 
[0m22:19:10.652013 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.50 seconds (0.50s).
[0m22:19:10.653976 [debug] [MainThread]: Command end result
[0m22:19:10.724730 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:19:10.733630 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:19:10.744350 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:19:10.745597 [info ] [MainThread]: 
[0m22:19:10.746845 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:19:10.747980 [info ] [MainThread]: 
[0m22:19:10.749282 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:19:10.750820 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.014014, "process_in_blocks": "0", "process_kernel_time": 0.307143, "process_mem_max_rss": "127296", "process_out_blocks": "0", "process_user_time": 1.777338}
[0m22:19:10.751689 [debug] [MainThread]: Command `dbt run` succeeded at 22:19:10.751608 after 3.01 seconds
[0m22:19:10.752548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b8ac23810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b8ac3e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763b8ac3f550>]}
[0m22:19:10.753326 [debug] [MainThread]: Flushing usage events
[0m22:19:11.352553 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:19:38.930026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74543b545210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74543b8cce90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74543b5a61d0>]}


============================== 22:19:38.936795 | 12dc2c8a-dedb-4f7c-b039-9bc7662ed693 ==============================
[0m22:19:38.936795 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:19:38.938109 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'quiet': 'False', 'version_check': 'True', 'introspect': 'True', 'warn_error': 'None', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'log_format': 'default', 'log_path': '/usr/app/dbt/dbt/logs', 'empty': 'False', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'static_parser': 'True', 'no_print': 'None', 'debug': 'False', 'use_colors': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'target_path': 'None', 'log_cache_events': 'False', 'fail_fast': 'False'}
[0m22:19:39.071361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12dc2c8a-dedb-4f7c-b039-9bc7662ed693', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74543a9c95d0>]}
[0m22:19:39.112790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '12dc2c8a-dedb-4f7c-b039-9bc7662ed693', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74543e2a69d0>]}
[0m22:19:39.115335 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:19:39.332402 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:19:41.764914 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:19:41.772660 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:19:41.832235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '12dc2c8a-dedb-4f7c-b039-9bc7662ed693', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74543950cb10>]}
[0m22:19:42.037009 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:19:42.051222 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:19:42.085543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '12dc2c8a-dedb-4f7c-b039-9bc7662ed693', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7454399c8290>]}
[0m22:19:42.087335 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:19:42.088646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12dc2c8a-dedb-4f7c-b039-9bc7662ed693', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745439148290>]}
[0m22:19:42.091389 [info ] [MainThread]: 
[0m22:19:42.092562 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:19:42.093604 [info ] [MainThread]: 
[0m22:19:42.095508 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:19:42.097806 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:19:42.210578 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:19:42.215955 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:19:42.222007 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:19:42.251810 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.030 seconds
[0m22:19:42.260554 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:19:42.267956 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:19:42.278754 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:19:42.280889 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:19:42.282593 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:19:42.296462 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m22:19:42.298432 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:19:42.299808 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:19:42.309956 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.008 seconds
[0m22:19:42.313968 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:19:42.315765 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:19:42.322854 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:42.324889 [debug] [MainThread]: On master: BEGIN
[0m22:19:42.326864 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:19:42.338836 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m22:19:42.342674 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:42.344068 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:19:42.352554 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m22:19:42.355230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12dc2c8a-dedb-4f7c-b039-9bc7662ed693', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74543a517190>]}
[0m22:19:42.356864 [debug] [MainThread]: On master: ROLLBACK
[0m22:19:42.358289 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:42.359543 [debug] [MainThread]: On master: BEGIN
[0m22:19:42.361230 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:19:42.362463 [debug] [MainThread]: On master: COMMIT
[0m22:19:42.363393 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:42.364218 [debug] [MainThread]: On master: COMMIT
[0m22:19:42.365414 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:19:42.366435 [debug] [MainThread]: On master: Close
[0m22:19:42.373742 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:19:42.375150 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:19:42.376559 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:19:42.381213 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:19:42.400909 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:19:42.414343 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:19:42.456828 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:19:42.511188 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:42.513473 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:19:42.515700 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:19:42.530377 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m22:19:42.532636 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:42.534491 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:19:42.547126 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m22:19:42.557404 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:42.559127 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:19:42.562674 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:19:42.569448 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:42.571302 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:19:42.574370 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:19:42.589316 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:19:42.594895 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:42.599725 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:19:42.604474 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:19:42.613007 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:19:42.621505 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:19:42.626629 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:19:42.637422 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.007 seconds
[0m22:19:42.643962 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:19:42.652661 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12dc2c8a-dedb-4f7c-b039-9bc7662ed693', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74543a9f3d90>]}
[0m22:19:42.657503 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.27s]
[0m22:19:42.661560 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:19:42.667982 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:42.672700 [debug] [MainThread]: On master: BEGIN
[0m22:19:42.677975 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:19:42.697956 [debug] [MainThread]: SQL status: BEGIN in 0.020 seconds
[0m22:19:42.702050 [debug] [MainThread]: On master: COMMIT
[0m22:19:42.705052 [debug] [MainThread]: Using postgres connection "master"
[0m22:19:42.709064 [debug] [MainThread]: On master: COMMIT
[0m22:19:42.712394 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:19:42.714974 [debug] [MainThread]: On master: Close
[0m22:19:42.721217 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:19:42.726472 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:19:42.733932 [info ] [MainThread]: 
[0m22:19:42.737284 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.64 seconds (0.64s).
[0m22:19:42.743506 [debug] [MainThread]: Command end result
[0m22:19:42.890045 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:19:42.900876 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:19:42.916958 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:19:42.918454 [info ] [MainThread]: 
[0m22:19:42.920008 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:19:42.921258 [info ] [MainThread]: 
[0m22:19:42.922367 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:19:42.924563 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.0999255, "process_in_blocks": "0", "process_kernel_time": 0.395444, "process_mem_max_rss": "126764", "process_out_blocks": "0", "process_user_time": 1.815089}
[0m22:19:42.926235 [debug] [MainThread]: Command `dbt run` succeeded at 22:19:42.926109 after 4.10 seconds
[0m22:19:42.928178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74543b536590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74543b534410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7454400ab910>]}
[0m22:19:42.929479 [debug] [MainThread]: Flushing usage events
[0m22:19:44.101944 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:20:37.340783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e205123f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e2050cf110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e205853ad0>]}


============================== 22:20:37.346625 | a5ea53d1-7a30-46ae-ada6-9424590ec503 ==============================
[0m22:20:37.346625 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:20:37.348272 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'write_json': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'log_path': '/usr/app/dbt/dbt/logs', 'static_parser': 'True', 'fail_fast': 'False', 'debug': 'False', 'printer_width': '80', 'partial_parse': 'True', 'log_format': 'default', 'use_colors': 'True', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'empty': 'False', 'target_path': 'None', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'version_check': 'True'}
[0m22:20:37.476716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a5ea53d1-7a30-46ae-ada6-9424590ec503', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e2060f8850>]}
[0m22:20:37.528995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a5ea53d1-7a30-46ae-ada6-9424590ec503', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e204794790>]}
[0m22:20:37.531478 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:20:37.690764 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:20:39.586694 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:20:39.588238 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:20:39.627938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a5ea53d1-7a30-46ae-ada6-9424590ec503', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e205458590>]}
[0m22:20:39.733917 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:20:39.742144 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:20:39.772164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a5ea53d1-7a30-46ae-ada6-9424590ec503', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e203baa590>]}
[0m22:20:39.773447 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:20:39.774568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a5ea53d1-7a30-46ae-ada6-9424590ec503', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e20336c5d0>]}
[0m22:20:39.777601 [info ] [MainThread]: 
[0m22:20:39.778766 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:20:39.779804 [info ] [MainThread]: 
[0m22:20:39.781034 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:20:39.782663 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:20:39.883220 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:20:39.885549 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:20:39.887588 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:20:39.904874 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m22:20:39.910104 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:20:39.914491 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:20:39.924239 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:20:39.928118 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:20:39.930256 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:20:39.943010 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m22:20:39.945865 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:20:39.947222 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:20:39.957566 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.009 seconds
[0m22:20:39.975886 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:20:39.981786 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:20:39.991316 [debug] [MainThread]: Using postgres connection "master"
[0m22:20:39.993637 [debug] [MainThread]: On master: BEGIN
[0m22:20:39.995233 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:20:40.015338 [debug] [MainThread]: SQL status: BEGIN in 0.020 seconds
[0m22:20:40.017690 [debug] [MainThread]: Using postgres connection "master"
[0m22:20:40.019379 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:20:40.029030 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m22:20:40.031944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a5ea53d1-7a30-46ae-ada6-9424590ec503', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e205073550>]}
[0m22:20:40.033795 [debug] [MainThread]: On master: ROLLBACK
[0m22:20:40.034884 [debug] [MainThread]: Using postgres connection "master"
[0m22:20:40.036250 [debug] [MainThread]: On master: BEGIN
[0m22:20:40.037958 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:20:40.039055 [debug] [MainThread]: On master: COMMIT
[0m22:20:40.039952 [debug] [MainThread]: Using postgres connection "master"
[0m22:20:40.040912 [debug] [MainThread]: On master: COMMIT
[0m22:20:40.041997 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:20:40.043038 [debug] [MainThread]: On master: Close
[0m22:20:40.051770 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:20:40.053263 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:20:40.054771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:20:40.055647 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:20:40.071350 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:20:40.079041 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:20:40.105402 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:20:40.114787 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:20:40.115773 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:20:40.116632 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:20:40.127023 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m22:20:40.127993 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:20:40.129199 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:20:40.136362 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m22:20:40.141622 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:20:40.142817 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:20:40.144756 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:20:40.147484 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:20:40.148307 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:20:40.150104 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:20:40.160936 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:20:40.163637 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:20:40.164958 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:20:40.167612 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m22:20:40.172343 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:20:40.177563 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:20:40.178574 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:20:40.184379 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m22:20:40.186575 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:20:40.189936 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a5ea53d1-7a30-46ae-ada6-9424590ec503', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e20475c090>]}
[0m22:20:40.194576 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.13s]
[0m22:20:40.195746 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:20:40.198119 [debug] [MainThread]: Using postgres connection "master"
[0m22:20:40.199058 [debug] [MainThread]: On master: BEGIN
[0m22:20:40.199863 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:20:40.210130 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:20:40.227243 [debug] [MainThread]: On master: COMMIT
[0m22:20:40.232861 [debug] [MainThread]: Using postgres connection "master"
[0m22:20:40.234292 [debug] [MainThread]: On master: COMMIT
[0m22:20:40.235957 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:20:40.237245 [debug] [MainThread]: On master: Close
[0m22:20:40.238580 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:20:40.244980 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:20:40.247124 [info ] [MainThread]: 
[0m22:20:40.249257 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m22:20:40.251542 [debug] [MainThread]: Command end result
[0m22:20:40.330375 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:20:40.340522 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:20:40.349948 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:20:40.350953 [info ] [MainThread]: 
[0m22:20:40.351952 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:20:40.352831 [info ] [MainThread]: 
[0m22:20:40.353887 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:20:40.355444 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.06922, "process_in_blocks": "0", "process_kernel_time": 0.414465, "process_mem_max_rss": "127020", "process_out_blocks": "0", "process_user_time": 1.828524}
[0m22:20:40.356328 [debug] [MainThread]: Command `dbt run` succeeded at 22:20:40.356208 after 3.07 seconds
[0m22:20:40.357184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e20512e5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e2099b3890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79e2099ce950>]}
[0m22:20:40.357945 [debug] [MainThread]: Flushing usage events
[0m22:20:41.204719 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:21:43.350309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a875786a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a87578df50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8757863d0>]}


============================== 22:21:43.356427 | 2a7ec32e-1aad-473a-b517-e7f87951472c ==============================
[0m22:21:43.356427 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:21:43.357940 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'invocation_command': 'dbt run', 'debug': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'static_parser': 'True', 'indirect_selection': 'eager', 'printer_width': '80', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'partial_parse': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'quiet': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'version_check': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'empty': 'False'}
[0m22:21:43.497686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2a7ec32e-1aad-473a-b517-e7f87951472c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a875ba0450>]}
[0m22:21:43.549920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2a7ec32e-1aad-473a-b517-e7f87951472c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8784ac910>]}
[0m22:21:43.552190 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:21:43.711164 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:21:45.549232 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:21:45.551098 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:21:45.584829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2a7ec32e-1aad-473a-b517-e7f87951472c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a873bf52d0>]}
[0m22:21:45.714351 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:21:45.722849 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:21:45.747750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2a7ec32e-1aad-473a-b517-e7f87951472c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a873bc92d0>]}
[0m22:21:45.749023 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:21:45.750241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a7ec32e-1aad-473a-b517-e7f87951472c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a87333c550>]}
[0m22:21:45.752563 [info ] [MainThread]: 
[0m22:21:45.753483 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:21:45.754315 [info ] [MainThread]: 
[0m22:21:45.755353 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:21:45.757243 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:21:45.860438 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:21:45.862342 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:21:45.863749 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:21:45.879245 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.015 seconds
[0m22:21:45.881957 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:21:45.884465 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:21:45.891512 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:21:45.892982 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:21:45.894808 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:21:45.908519 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m22:21:45.911480 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:21:45.913693 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:21:45.922403 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.007 seconds
[0m22:21:45.926506 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:21:45.927933 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:21:45.934096 [debug] [MainThread]: Using postgres connection "master"
[0m22:21:45.935507 [debug] [MainThread]: On master: BEGIN
[0m22:21:45.936848 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:21:45.946537 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:21:45.948220 [debug] [MainThread]: Using postgres connection "master"
[0m22:21:45.949650 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:21:45.958625 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m22:21:45.961661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a7ec32e-1aad-473a-b517-e7f87951472c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a87573eb50>]}
[0m22:21:45.963228 [debug] [MainThread]: On master: ROLLBACK
[0m22:21:45.964977 [debug] [MainThread]: Using postgres connection "master"
[0m22:21:45.966328 [debug] [MainThread]: On master: BEGIN
[0m22:21:45.968026 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:21:45.969420 [debug] [MainThread]: On master: COMMIT
[0m22:21:45.970832 [debug] [MainThread]: Using postgres connection "master"
[0m22:21:45.972218 [debug] [MainThread]: On master: COMMIT
[0m22:21:45.974484 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:21:45.976028 [debug] [MainThread]: On master: Close
[0m22:21:45.986288 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:21:45.988259 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:21:45.990019 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:21:45.991803 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:21:46.013499 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:21:46.039389 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:21:46.077370 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:21:46.093994 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:21:46.095498 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:21:46.096894 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:21:46.109863 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m22:21:46.111858 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:21:46.114207 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:21:46.132413 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.016 seconds
[0m22:21:46.142027 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:21:46.144458 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:21:46.148757 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:21:46.153735 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:21:46.155745 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:21:46.158955 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:21:46.172757 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:21:46.174385 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:21:46.176156 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:21:46.180810 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:21:46.187133 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:21:46.195341 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:21:46.197220 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:21:46.203028 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m22:21:46.207450 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:21:46.211429 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a7ec32e-1aad-473a-b517-e7f87951472c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a87766ded0>]}
[0m22:21:46.213617 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.22s]
[0m22:21:46.215787 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:21:46.219174 [debug] [MainThread]: Using postgres connection "master"
[0m22:21:46.221096 [debug] [MainThread]: On master: BEGIN
[0m22:21:46.223553 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:21:46.231942 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m22:21:46.234524 [debug] [MainThread]: On master: COMMIT
[0m22:21:46.236023 [debug] [MainThread]: Using postgres connection "master"
[0m22:21:46.237673 [debug] [MainThread]: On master: COMMIT
[0m22:21:46.239221 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:21:46.240694 [debug] [MainThread]: On master: Close
[0m22:21:46.242510 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:21:46.243943 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:21:46.245768 [info ] [MainThread]: 
[0m22:21:46.247379 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.49 seconds (0.49s).
[0m22:21:46.249378 [debug] [MainThread]: Command end result
[0m22:21:46.318797 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:21:46.327973 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:21:46.343512 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:21:46.345018 [info ] [MainThread]: 
[0m22:21:46.346582 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:21:46.347943 [info ] [MainThread]: 
[0m22:21:46.349323 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:21:46.351677 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.0784204, "process_in_blocks": "0", "process_kernel_time": 0.460082, "process_mem_max_rss": "126528", "process_out_blocks": "0", "process_user_time": 1.884722}
[0m22:21:46.353162 [debug] [MainThread]: Command `dbt run` succeeded at 22:21:46.352982 after 3.08 seconds
[0m22:21:46.354585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a879f8ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a875720990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a8773cc810>]}
[0m22:21:46.356815 [debug] [MainThread]: Flushing usage events
[0m22:21:47.211143 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:22:49.343227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7deccd19c650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7decca46cc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7deccd19fad0>]}


============================== 22:22:49.348602 | 52f73a23-12e1-47c7-add7-8b6be477beff ==============================
[0m22:22:49.348602 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:22:49.349767 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'write_json': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'version_check': 'True', 'static_parser': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'profiles_dir': '/usr/app/dbt/dbt', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'warn_error': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'use_colors': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'empty': 'False', 'introspect': 'True', 'fail_fast': 'False', 'debug': 'False', 'target_path': 'None'}
[0m22:22:49.483509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '52f73a23-12e1-47c7-add7-8b6be477beff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7decc95b9d90>]}
[0m22:22:49.530020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '52f73a23-12e1-47c7-add7-8b6be477beff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7deccd1c6a50>]}
[0m22:22:49.559965 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:22:49.685741 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:22:50.962629 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:22:50.963731 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:22:50.997378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '52f73a23-12e1-47c7-add7-8b6be477beff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7decc8596150>]}
[0m22:22:51.112277 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:22:51.118098 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:22:51.137754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '52f73a23-12e1-47c7-add7-8b6be477beff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7decc85dd090>]}
[0m22:22:51.138572 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:22:51.139376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '52f73a23-12e1-47c7-add7-8b6be477beff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7decc7d30f50>]}
[0m22:22:51.141001 [info ] [MainThread]: 
[0m22:22:51.141870 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:22:51.142593 [info ] [MainThread]: 
[0m22:22:51.143632 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:22:51.144875 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:22:51.237272 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:22:51.239106 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:22:51.240724 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:22:51.255992 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.015 seconds
[0m22:22:51.259166 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:22:51.262470 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:22:51.268158 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:22:51.269408 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:22:51.270472 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:22:51.280265 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m22:22:51.282564 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:22:51.284078 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:22:51.294774 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.009 seconds
[0m22:22:51.297661 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:22:51.299350 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:22:51.305332 [debug] [MainThread]: Using postgres connection "master"
[0m22:22:51.306657 [debug] [MainThread]: On master: BEGIN
[0m22:22:51.307789 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:22:51.318585 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m22:22:51.321106 [debug] [MainThread]: Using postgres connection "master"
[0m22:22:51.322783 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:22:51.331577 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m22:22:51.334509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '52f73a23-12e1-47c7-add7-8b6be477beff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7decc8dfe650>]}
[0m22:22:51.338360 [debug] [MainThread]: On master: ROLLBACK
[0m22:22:51.340885 [debug] [MainThread]: Using postgres connection "master"
[0m22:22:51.342167 [debug] [MainThread]: On master: BEGIN
[0m22:22:51.345243 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:22:51.346716 [debug] [MainThread]: On master: COMMIT
[0m22:22:51.348025 [debug] [MainThread]: Using postgres connection "master"
[0m22:22:51.348997 [debug] [MainThread]: On master: COMMIT
[0m22:22:51.350278 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:22:51.351403 [debug] [MainThread]: On master: Close
[0m22:22:51.365062 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:22:51.379862 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:22:51.382984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:22:51.391797 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:22:51.411631 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:22:51.427917 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:22:51.456421 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:22:51.469857 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:22:51.471794 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:22:51.473114 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:22:51.490317 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m22:22:51.492153 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:22:51.494134 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:22:51.510357 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.015 seconds
[0m22:22:51.518666 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:22:51.519927 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:22:51.522585 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:22:51.528520 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:22:51.529864 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:22:51.532438 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:22:51.544867 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:22:51.546398 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:22:51.547924 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:22:51.552281 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:22:51.557642 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:22:51.563094 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:22:51.564542 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:22:51.570935 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m22:22:51.574360 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:22:51.576848 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '52f73a23-12e1-47c7-add7-8b6be477beff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7decc917a010>]}
[0m22:22:51.578617 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.19s]
[0m22:22:51.580463 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:22:51.584893 [debug] [MainThread]: Using postgres connection "master"
[0m22:22:51.586179 [debug] [MainThread]: On master: BEGIN
[0m22:22:51.591686 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:22:51.605094 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m22:22:51.606520 [debug] [MainThread]: On master: COMMIT
[0m22:22:51.607523 [debug] [MainThread]: Using postgres connection "master"
[0m22:22:51.608521 [debug] [MainThread]: On master: COMMIT
[0m22:22:51.610758 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:22:51.611856 [debug] [MainThread]: On master: Close
[0m22:22:51.613393 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:22:51.614587 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:22:51.615620 [info ] [MainThread]: 
[0m22:22:51.616622 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m22:22:51.618265 [debug] [MainThread]: Command end result
[0m22:22:51.679347 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:22:51.687910 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:22:51.703245 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:22:51.704736 [info ] [MainThread]: 
[0m22:22:51.706307 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:22:51.707737 [info ] [MainThread]: 
[0m22:22:51.710133 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:22:51.712254 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.4829433, "process_in_blocks": "0", "process_kernel_time": 0.383618, "process_mem_max_rss": "127036", "process_out_blocks": "0", "process_user_time": 1.821179}
[0m22:22:51.713321 [debug] [MainThread]: Command `dbt run` succeeded at 22:22:51.713165 after 2.48 seconds
[0m22:22:51.714553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7decceca6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7decceca6d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7decced538d0>]}
[0m22:22:51.715788 [debug] [MainThread]: Flushing usage events
[0m22:22:52.448554 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:23:54.766423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60464aab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6048ea3110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60461520d0>]}


============================== 22:23:54.774323 | 3573b48e-d66e-4dec-81f9-fcae2029f46e ==============================
[0m22:23:54.774323 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:23:54.775967 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'quiet': 'False', 'introspect': 'True', 'version_check': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error': 'None', 'invocation_command': 'dbt run', 'no_print': 'None', 'empty': 'False', 'printer_width': '80', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'log_cache_events': 'False', 'write_json': 'True', 'debug': 'False'}
[0m22:23:54.914356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3573b48e-d66e-4dec-81f9-fcae2029f46e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e604515b7d0>]}
[0m22:23:54.967647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3573b48e-d66e-4dec-81f9-fcae2029f46e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6048eb6950>]}
[0m22:23:54.970618 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m22:23:55.119674 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:23:57.310375 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:23:57.312270 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:23:57.355264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3573b48e-d66e-4dec-81f9-fcae2029f46e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6044550150>]}
[0m22:23:57.472345 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:23:57.481618 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:23:57.515726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3573b48e-d66e-4dec-81f9-fcae2029f46e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60445c9950>]}
[0m22:23:57.517442 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m22:23:57.518819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3573b48e-d66e-4dec-81f9-fcae2029f46e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6043d14cd0>]}
[0m22:23:57.522669 [info ] [MainThread]: 
[0m22:23:57.525178 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:23:57.527326 [info ] [MainThread]: 
[0m22:23:57.529242 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:23:57.532401 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m22:23:57.649736 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m22:23:57.653968 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m22:23:57.656949 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:23:57.673680 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m22:23:57.676582 [debug] [ThreadPool]: On list_data_project_1: Close
[0m22:23:57.692798 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m22:23:57.703279 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:23:57.707034 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m22:23:57.708522 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:23:57.718440 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m22:23:57.726703 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m22:23:57.728924 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:23:57.738993 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m22:23:57.743429 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m22:23:57.745421 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m22:23:57.752228 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:57.755129 [debug] [MainThread]: On master: BEGIN
[0m22:23:57.758219 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:23:57.770958 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m22:23:57.773202 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:57.775237 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m22:23:57.784724 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m22:23:57.788433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3573b48e-d66e-4dec-81f9-fcae2029f46e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e60480abc50>]}
[0m22:23:57.790360 [debug] [MainThread]: On master: ROLLBACK
[0m22:23:57.792189 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:57.793820 [debug] [MainThread]: On master: BEGIN
[0m22:23:57.796009 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m22:23:57.797442 [debug] [MainThread]: On master: COMMIT
[0m22:23:57.798517 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:57.799662 [debug] [MainThread]: On master: COMMIT
[0m22:23:57.801155 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:23:57.802357 [debug] [MainThread]: On master: Close
[0m22:23:57.810182 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m22:23:57.811761 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m22:23:57.813132 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m22:23:57.814171 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m22:23:57.830398 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m22:23:57.842282 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m22:23:57.872673 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m22:23:57.886121 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:23:57.888103 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m22:23:57.889671 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:23:57.903625 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m22:23:57.905325 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:23:57.907261 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m22:23:57.916623 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m22:23:57.924275 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:23:57.925750 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m22:23:57.928137 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:23:57.931954 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:23:57.932993 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m22:23:57.935112 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:23:57.951784 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:23:57.953428 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:23:57.954792 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m22:23:57.959030 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:23:57.966282 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m22:23:57.971947 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m22:23:57.973413 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m22:23:57.979624 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m22:23:57.983495 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m22:23:57.986497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3573b48e-d66e-4dec-81f9-fcae2029f46e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6042f19f50>]}
[0m22:23:57.988497 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.17s]
[0m22:23:57.991078 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m22:23:57.994288 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:57.995324 [debug] [MainThread]: On master: BEGIN
[0m22:23:57.996281 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:23:58.006864 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m22:23:58.008355 [debug] [MainThread]: On master: COMMIT
[0m22:23:58.009636 [debug] [MainThread]: Using postgres connection "master"
[0m22:23:58.010985 [debug] [MainThread]: On master: COMMIT
[0m22:23:58.012913 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:23:58.014291 [debug] [MainThread]: On master: Close
[0m22:23:58.015711 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:23:58.017297 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m22:23:58.019117 [info ] [MainThread]: 
[0m22:23:58.020477 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.49 seconds (0.49s).
[0m22:23:58.022952 [debug] [MainThread]: Command end result
[0m22:23:58.089888 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m22:23:58.099163 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m22:23:58.110513 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m22:23:58.111719 [info ] [MainThread]: 
[0m22:23:58.113011 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:23:58.114028 [info ] [MainThread]: 
[0m22:23:58.115614 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:23:58.117857 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.4557703, "process_in_blocks": "0", "process_kernel_time": 0.493024, "process_mem_max_rss": "126932", "process_out_blocks": "0", "process_user_time": 2.067523}
[0m22:23:58.119835 [debug] [MainThread]: Command `dbt run` succeeded at 22:23:58.119428 after 3.46 seconds
[0m22:23:58.122240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6046151610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6046151fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e604a9aadd0>]}
[0m22:23:58.123697 [debug] [MainThread]: Flushing usage events
[0m22:23:58.667235 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:09:59.829211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae8c08aa7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae8c08aa390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae8c0849190>]}


============================== 23:09:59.835268 | 9f4959a4-01b3-4069-ae6b-a999b098efef ==============================
[0m23:09:59.835268 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:09:59.837842 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'quiet': 'False', 'no_print': 'None', 'partial_parse': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'log_cache_events': 'False', 'fail_fast': 'False', 'write_json': 'True', 'empty': 'False', 'static_parser': 'True', 'version_check': 'True', 'introspect': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'target_path': 'None'}
[0m23:10:00.018994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9f4959a4-01b3-4069-ae6b-a999b098efef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae8c1864790>]}
[0m23:10:00.069935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9f4959a4-01b3-4069-ae6b-a999b098efef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae8c35a4850>]}
[0m23:10:00.074206 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:10:00.236367 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:10:00.580557 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading data_project_1: staging/sources.yml - Runtime Error
    Syntax error near line 11
    ------------------------------
    8  | tables:
    9  | - name: estaciones
    10 | description: "InformaciÃ³n de las estaciones de mediciÃ³n"
    11 | - name: air_quality
    12 | description: "Mediciones de calidad del aire por estaciÃ³n y contaminante"
    
    Raw Error:
    ------------------------------
    while parsing a block mapping
      in "<unicode string>", line 1, column 1
    did not find expected key
      in "<unicode string>", line 11, column 1
[0m23:10:00.584358 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.8839717, "process_in_blocks": "0", "process_kernel_time": 0.383822, "process_mem_max_rss": "115272", "process_out_blocks": "0", "process_user_time": 1.618386}
[0m23:10:00.588102 [debug] [MainThread]: Command `dbt run` failed at 23:10:00.587737 after 0.89 seconds
[0m23:10:00.590708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae8c0bac450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae8bed8d990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae8bed8de90>]}
[0m23:10:00.592353 [debug] [MainThread]: Flushing usage events
[0m23:10:01.186063 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:11:03.767147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a948b2adad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a948b30eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a948b30e450>]}


============================== 23:11:03.775452 | 3cd15883-03c9-4b0f-b4ed-006f7b86a8da ==============================
[0m23:11:03.775452 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:11:03.777238 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'printer_width': '80', 'warn_error': 'None', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'empty': 'False', 'target_path': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'log_format': 'default', 'no_print': 'None', 'static_parser': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'debug': 'False', 'invocation_command': 'dbt run', 'fail_fast': 'False'}
[0m23:11:03.933741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3cd15883-03c9-4b0f-b4ed-006f7b86a8da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a948b30e810>]}
[0m23:11:03.993526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3cd15883-03c9-4b0f-b4ed-006f7b86a8da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a948e012810>]}
[0m23:11:03.996344 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:11:04.147032 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:11:04.420285 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading data_project_1: staging/sources.yml - Runtime Error
    Syntax error near line 11
    ------------------------------
    8  | tables:
    9  | - name: estaciones
    10 | description: "InformaciÃ³n de las estaciones de mediciÃ³n"
    11 | - name: air_quality
    12 | description: "Mediciones de calidad del aire por estaciÃ³n y contaminante"
    
    Raw Error:
    ------------------------------
    while parsing a block mapping
      in "<unicode string>", line 1, column 1
    did not find expected key
      in "<unicode string>", line 11, column 1
[0m23:11:04.424426 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.7370256, "process_in_blocks": "0", "process_kernel_time": 0.592097, "process_mem_max_rss": "116084", "process_out_blocks": "0", "process_user_time": 1.580259}
[0m23:11:04.427025 [debug] [MainThread]: Command `dbt run` failed at 23:11:04.426736 after 0.74 seconds
[0m23:11:04.428435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a948b29c610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a948fb06e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a948fb06e90>]}
[0m23:11:04.429890 [debug] [MainThread]: Flushing usage events
[0m23:11:05.012300 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:12:07.346203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec3d603bf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec3d603a8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec3d603a550>]}


============================== 23:12:07.354663 | fb63c58e-e41c-4229-9948-89a4deba3135 ==============================
[0m23:12:07.354663 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:12:07.356031 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'invocation_command': 'dbt run', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'write_json': 'True', 'no_print': 'None', 'introspect': 'True', 'warn_error': 'None', 'empty': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'partial_parse': 'True', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager'}
[0m23:12:07.504834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb63c58e-e41c-4229-9948-89a4deba3135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec3d5fe5650>]}
[0m23:12:07.552895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb63c58e-e41c-4229-9948-89a4deba3135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec3d8d628d0>]}
[0m23:12:07.579317 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:12:07.765328 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:12:10.578620 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:12:10.580292 [debug] [MainThread]: Partial parsing: added file: data_project_1://models/staging/sources.yml
[0m23:12:10.680354 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two sources with the name "raw_data_estaciones".
  
  Since these resources have the same name, dbt will be unable to find the correct resource
  when looking for source("raw_data", "estaciones").
  
  To fix this, change the name of one of these resources:
  - source.data_project_1.raw_data.estaciones (models/staging/sources.yml)
  - source.data_project_1.raw_data.estaciones (models/sources.yml)
[0m23:12:10.683580 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.4024155, "process_in_blocks": "0", "process_kernel_time": 0.748105, "process_mem_max_rss": "117808", "process_out_blocks": "0", "process_user_time": 1.580223}
[0m23:12:10.685919 [debug] [MainThread]: Command `dbt run` failed at 23:12:10.685579 after 3.40 seconds
[0m23:12:10.687246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec3d60422d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec3d6042190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec3d6360f90>]}
[0m23:12:10.688404 [debug] [MainThread]: Flushing usage events
[0m23:12:11.427100 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:13:13.611797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c58a9918350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c58a95bb610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c58a95ba650>]}


============================== 23:13:13.617937 | 5090d238-b79b-4064-9637-297f02269a6a ==============================
[0m23:13:13.617937 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:13:13.619798 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'no_print': 'None', 'static_parser': 'True', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'profiles_dir': '/usr/app/dbt/dbt', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'write_json': 'True', 'partial_parse': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'introspect': 'True', 'fail_fast': 'False', 'debug': 'False', 'version_check': 'True'}
[0m23:13:13.759798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5090d238-b79b-4064-9637-297f02269a6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c58a8d68250>]}
[0m23:13:13.808442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5090d238-b79b-4064-9637-297f02269a6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c58ac3287d0>]}
[0m23:13:13.810671 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:13:13.943141 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:13:16.517001 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:13:16.518810 [debug] [MainThread]: Partial parsing: added file: data_project_1://models/staging/sources.yml
[0m23:13:16.594509 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two sources with the name "raw_data_estaciones".
  
  Since these resources have the same name, dbt will be unable to find the correct resource
  when looking for source("raw_data", "estaciones").
  
  To fix this, change the name of one of these resources:
  - source.data_project_1.raw_data.estaciones (models/staging/sources.yml)
  - source.data_project_1.raw_data.estaciones (models/sources.yml)
[0m23:13:16.597545 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.0525296, "process_in_blocks": "0", "process_kernel_time": 0.554162, "process_mem_max_rss": "117340", "process_out_blocks": "0", "process_user_time": 1.560301}
[0m23:13:16.599114 [debug] [MainThread]: Command `dbt run` failed at 23:13:16.598919 after 3.05 seconds
[0m23:13:16.600240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c58ade12e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c58a75e7850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c58ade12e90>]}
[0m23:13:16.601264 [debug] [MainThread]: Flushing usage events
[0m23:13:17.497593 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:14:12.214720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76e7bd56cad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76e7bd591210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76e7bd56c2d0>]}


============================== 23:14:12.222984 | dde7178e-867a-478d-a427-adcb1fdcc086 ==============================
[0m23:14:12.222984 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:14:12.224898 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'quiet': 'False', 'partial_parse': 'True', 'debug': 'False', 'static_parser': 'True', 'log_format': 'default', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'empty': 'False', 'no_print': 'None', 'warn_error': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'use_colors': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'invocation_command': 'dbt run'}
[0m23:14:12.381705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dde7178e-867a-478d-a427-adcb1fdcc086', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76e7bd609650>]}
[0m23:14:12.429362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dde7178e-867a-478d-a427-adcb1fdcc086', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76e7bc101d50>]}
[0m23:14:12.432218 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:14:12.578864 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:14:14.599551 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:14:14.601584 [debug] [MainThread]: Partial parsing: added file: data_project_1://models/staging/sources.yml
[0m23:14:14.680596 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two sources with the name "raw_data_estaciones".
  
  Since these resources have the same name, dbt will be unable to find the correct resource
  when looking for source("raw_data", "estaciones").
  
  To fix this, change the name of one of these resources:
  - source.data_project_1.raw_data.estaciones (models/staging/sources.yml)
  - source.data_project_1.raw_data.estaciones (models/sources.yml)
[0m23:14:14.685082 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.541882, "process_in_blocks": "0", "process_kernel_time": 0.564802, "process_mem_max_rss": "117312", "process_out_blocks": "0", "process_user_time": 1.601619}
[0m23:14:14.687502 [debug] [MainThread]: Command `dbt run` failed at 23:14:14.687211 after 2.54 seconds
[0m23:14:14.689532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76e7bd55e9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76e7c1da6e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76e7c1da6dd0>]}
[0m23:14:14.690726 [debug] [MainThread]: Flushing usage events
[0m23:14:15.558691 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:14:17.929368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4832c7b0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a482ff134d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a483036cad0>]}


============================== 23:14:17.940895 | 6f9526a8-2bd3-4cb6-a42a-57b6d06432b5 ==============================
[0m23:14:17.940895 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:14:17.945162 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'use_colors': 'True', 'indirect_selection': 'eager', 'quiet': 'False', 'introspect': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'target_path': 'None', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'write_json': 'True', 'log_format': 'default', 'static_parser': 'True'}
[0m23:14:18.094612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f9526a8-2bd3-4cb6-a42a-57b6d06432b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4830f448d0>]}
[0m23:14:18.142560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f9526a8-2bd3-4cb6-a42a-57b6d06432b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4832c92710>]}
[0m23:14:18.145810 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:14:18.310881 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:14:20.442783 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:14:20.444737 [debug] [MainThread]: Partial parsing: added file: data_project_1://models/staging/sources.yml
[0m23:14:20.518023 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two sources with the name "raw_data_estaciones".
  
  Since these resources have the same name, dbt will be unable to find the correct resource
  when looking for source("raw_data", "estaciones").
  
  To fix this, change the name of one of these resources:
  - source.data_project_1.raw_data.estaciones (models/staging/sources.yml)
  - source.data_project_1.raw_data.estaciones (models/sources.yml)
[0m23:14:20.521000 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.6663733, "process_in_blocks": "0", "process_kernel_time": 0.566085, "process_mem_max_rss": "117644", "process_out_blocks": "0", "process_user_time": 1.570687}
[0m23:14:20.522846 [debug] [MainThread]: Command `dbt run` failed at 23:14:20.522630 after 2.67 seconds
[0m23:14:20.524141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a482ff02310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a482d702990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a483476ed10>]}
[0m23:14:20.525261 [debug] [MainThread]: Flushing usage events
[0m23:14:21.215177 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:14:23.674053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c92051b1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c91d7d4e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c91d8124d0>]}


============================== 23:14:23.683705 | 01877fa8-eaee-43d2-ab0a-35721602f87d ==============================
[0m23:14:23.683705 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:14:23.685744 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'profiles_dir': '/usr/app/dbt/dbt', 'write_json': 'True', 'partial_parse': 'True', 'use_colors': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'printer_width': '80', 'fail_fast': 'False', 'no_print': 'None', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'log_path': '/usr/app/dbt/dbt/logs', 'introspect': 'True', 'use_experimental_parser': 'False', 'debug': 'False', 'version_check': 'True', 'quiet': 'False'}
[0m23:14:23.836774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01877fa8-eaee-43d2-ab0a-35721602f87d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c91d80af50>]}
[0m23:14:23.892300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01877fa8-eaee-43d2-ab0a-35721602f87d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c91cb1a990>]}
[0m23:14:23.894842 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:14:24.043148 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:14:26.219793 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:14:26.221804 [debug] [MainThread]: Partial parsing: added file: data_project_1://models/staging/sources.yml
[0m23:14:26.311154 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two sources with the name "raw_data_estaciones".
  
  Since these resources have the same name, dbt will be unable to find the correct resource
  when looking for source("raw_data", "estaciones").
  
  To fix this, change the name of one of these resources:
  - source.data_project_1.raw_data.estaciones (models/staging/sources.yml)
  - source.data_project_1.raw_data.estaciones (models/sources.yml)
[0m23:14:26.313577 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.7125905, "process_in_blocks": "0", "process_kernel_time": 0.394292, "process_mem_max_rss": "117356", "process_out_blocks": "0", "process_user_time": 1.798958}
[0m23:14:26.315263 [debug] [MainThread]: Command `dbt run` failed at 23:14:26.315151 after 2.71 seconds
[0m23:14:26.316734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c91b3061d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c9220d69d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c9220d6990>]}
[0m23:14:26.318047 [debug] [MainThread]: Flushing usage events
[0m23:14:27.008270 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:14:29.627160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7023ac4a3b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7023ac4adf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7023ac4a02d0>]}


============================== 23:14:29.631944 | da20a032-9297-4575-a54a-b5e0b332a408 ==============================
[0m23:14:29.631944 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:14:29.635755 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/usr/app/dbt/dbt', 'quiet': 'False', 'debug': 'False', 'static_parser': 'True', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'partial_parse': 'True', 'warn_error': 'None', 'version_check': 'True', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'fail_fast': 'False', 'indirect_selection': 'eager', 'no_print': 'None', 'use_colors': 'True', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False'}
[0m23:14:29.778254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da20a032-9297-4575-a54a-b5e0b332a408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7023ab169950>]}
[0m23:14:29.832695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da20a032-9297-4575-a54a-b5e0b332a408', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7023ab1bdd50>]}
[0m23:14:29.835601 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:14:29.964058 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:14:31.932340 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:14:31.933671 [debug] [MainThread]: Partial parsing: added file: data_project_1://models/staging/sources.yml
[0m23:14:31.998869 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two sources with the name "raw_data_estaciones".
  
  Since these resources have the same name, dbt will be unable to find the correct resource
  when looking for source("raw_data", "estaciones").
  
  To fix this, change the name of one of these resources:
  - source.data_project_1.raw_data.estaciones (models/staging/sources.yml)
  - source.data_project_1.raw_data.estaciones (models/sources.yml)
[0m23:14:32.001462 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.4504461, "process_in_blocks": "0", "process_kernel_time": 0.45873, "process_mem_max_rss": "116868", "process_out_blocks": "0", "process_user_time": 1.627495}
[0m23:14:32.003035 [debug] [MainThread]: Command `dbt run` failed at 23:14:32.002821 after 2.45 seconds
[0m23:14:32.004322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7023b0d729d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7023b0d72950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7023ab176a10>]}
[0m23:14:32.005463 [debug] [MainThread]: Flushing usage events
[0m23:14:32.980339 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:14:35.852677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7771ba5acc90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7771ba27e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7771ba27e950>]}


============================== 23:14:35.860091 | c41ee8f8-3e36-4125-9b92-806957dbed14 ==============================
[0m23:14:35.860091 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:14:35.862394 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'warn_error': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'use_colors': 'True', 'no_print': 'None', 'introspect': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_cache_events': 'False'}
[0m23:14:36.018257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c41ee8f8-3e36-4125-9b92-806957dbed14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7771ba1b9b50>]}
[0m23:14:36.070320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c41ee8f8-3e36-4125-9b92-806957dbed14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7771bcf7a7d0>]}
[0m23:14:36.072349 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:14:36.246147 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:14:37.749720 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:14:37.750782 [debug] [MainThread]: Partial parsing: added file: data_project_1://models/staging/sources.yml
[0m23:14:37.814428 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two sources with the name "raw_data_estaciones".
  
  Since these resources have the same name, dbt will be unable to find the correct resource
  when looking for source("raw_data", "estaciones").
  
  To fix this, change the name of one of these resources:
  - source.data_project_1.raw_data.estaciones (models/staging/sources.yml)
  - source.data_project_1.raw_data.estaciones (models/sources.yml)
[0m23:14:37.831074 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.0637143, "process_in_blocks": "0", "process_kernel_time": 0.453463, "process_mem_max_rss": "117520", "process_out_blocks": "0", "process_user_time": 1.569065}
[0m23:14:37.832872 [debug] [MainThread]: Command `dbt run` failed at 23:14:37.832717 after 2.07 seconds
[0m23:14:37.834002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7771ba20e5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7771b8d41290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7771bea5ad10>]}
[0m23:14:37.835157 [debug] [MainThread]: Flushing usage events
[0m23:14:38.717197 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:14:42.318231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d786fe54d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d786fb0910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d7872f8290>]}


============================== 23:14:42.338143 | 887517be-0b91-4b44-a95a-5c29381c5a50 ==============================
[0m23:14:42.338143 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:14:42.343155 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'introspect': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt run', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'use_experimental_parser': 'False', 'quiet': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'empty': 'False', 'static_parser': 'True', 'warn_error': 'None', 'printer_width': '80', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'use_colors': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'log_format': 'default', 'write_json': 'True'}
[0m23:14:42.514213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '887517be-0b91-4b44-a95a-5c29381c5a50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d786f91310>]}
[0m23:14:42.560959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '887517be-0b91-4b44-a95a-5c29381c5a50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d789cf6410>]}
[0m23:14:42.564351 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:14:42.727061 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:14:44.500127 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m23:14:44.501221 [debug] [MainThread]: Partial parsing: added file: data_project_1://models/staging/sources.yml
[0m23:14:44.987448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '887517be-0b91-4b44-a95a-5c29381c5a50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d78677dc90>]}
[0m23:14:45.142779 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:14:45.151321 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:14:45.200771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '887517be-0b91-4b44-a95a-5c29381c5a50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d78479b7d0>]}
[0m23:14:45.202445 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:14:45.203673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '887517be-0b91-4b44-a95a-5c29381c5a50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d785b82250>]}
[0m23:14:45.206532 [info ] [MainThread]: 
[0m23:14:45.207769 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:14:45.208902 [info ] [MainThread]: 
[0m23:14:45.210452 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:14:45.212509 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:14:45.284869 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:14:45.286485 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:14:45.287639 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:14:45.312797 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.025 seconds
[0m23:14:45.315575 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:14:45.318365 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:14:45.326677 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:14:45.328047 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:14:45.329221 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:14:45.341074 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m23:14:45.343052 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:14:45.344545 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:14:45.366370 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.021 seconds
[0m23:14:45.370618 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:14:45.374638 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:14:45.383655 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:45.387202 [debug] [MainThread]: On master: BEGIN
[0m23:14:45.389047 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:14:45.404000 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m23:14:45.406484 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:45.408464 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:14:45.424181 [debug] [MainThread]: SQL status: SELECT 1 in 0.014 seconds
[0m23:14:45.429008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '887517be-0b91-4b44-a95a-5c29381c5a50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d783b5a710>]}
[0m23:14:45.431704 [debug] [MainThread]: On master: ROLLBACK
[0m23:14:45.434459 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:45.436726 [debug] [MainThread]: On master: BEGIN
[0m23:14:45.440056 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:14:45.441907 [debug] [MainThread]: On master: COMMIT
[0m23:14:45.443698 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:45.445114 [debug] [MainThread]: On master: COMMIT
[0m23:14:45.447060 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:14:45.448390 [debug] [MainThread]: On master: Close
[0m23:14:45.459865 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:14:45.461977 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:14:45.463942 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:14:45.465689 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:14:45.479634 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:14:45.494922 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:14:45.525445 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:14:45.541763 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:45.543561 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:14:45.545227 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:14:45.558000 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:14:45.560217 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:45.561825 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:14:45.590177 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.027 seconds
[0m23:14:45.597388 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:45.599731 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:14:45.604371 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m23:14:45.609762 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:45.610933 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:14:45.613717 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:14:45.626210 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:14:45.628061 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:45.629367 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:14:45.635091 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:14:45.643170 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:14:45.649986 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:45.651497 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:14:45.663370 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.010 seconds
[0m23:14:45.667263 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:14:45.671976 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '887517be-0b91-4b44-a95a-5c29381c5a50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d784f1db50>]}
[0m23:14:45.675215 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.21s]
[0m23:14:45.677778 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:14:45.682798 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:45.684289 [debug] [MainThread]: On master: BEGIN
[0m23:14:45.685820 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:14:45.698457 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:14:45.699896 [debug] [MainThread]: On master: COMMIT
[0m23:14:45.701210 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:45.702504 [debug] [MainThread]: On master: COMMIT
[0m23:14:45.704318 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:14:45.705816 [debug] [MainThread]: On master: Close
[0m23:14:45.707447 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:14:45.708820 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:14:45.710207 [info ] [MainThread]: 
[0m23:14:45.711388 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.50 seconds (0.50s).
[0m23:14:45.713017 [debug] [MainThread]: Command end result
[0m23:14:45.778100 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:14:45.789357 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:14:45.807488 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:14:45.809343 [info ] [MainThread]: 
[0m23:14:45.810934 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:14:45.812795 [info ] [MainThread]: 
[0m23:14:45.813949 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:14:45.816661 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.578174, "process_in_blocks": "0", "process_kernel_time": 0.444467, "process_mem_max_rss": "132648", "process_out_blocks": "0", "process_user_time": 2.295735}
[0m23:14:45.818571 [debug] [MainThread]: Command `dbt run` succeeded at 23:14:45.818443 after 3.58 seconds
[0m23:14:45.820045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d786f82350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d786f825d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d78baef910>]}
[0m23:14:45.821408 [debug] [MainThread]: Flushing usage events
[0m23:14:46.397397 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:14:51.742064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73590c262410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73590c261ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73590c262090>]}


============================== 23:14:51.752534 | cba78809-ab86-4b91-a8e7-6775144b552d ==============================
[0m23:14:51.752534 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:14:51.754747 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'write_json': 'True', 'quiet': 'False', 'use_colors': 'True', 'version_check': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'static_parser': 'True', 'introspect': 'True', 'no_print': 'None', 'debug': 'False', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'empty': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'printer_width': '80', 'fail_fast': 'False', 'use_experimental_parser': 'False'}
[0m23:14:51.937290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cba78809-ab86-4b91-a8e7-6775144b552d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73590c20fed0>]}
[0m23:14:51.985092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cba78809-ab86-4b91-a8e7-6775144b552d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73590afa1d50>]}
[0m23:14:51.997359 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:14:52.145865 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:14:54.104049 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:14:54.104902 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:14:54.137850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cba78809-ab86-4b91-a8e7-6775144b552d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73590b3bed90>]}
[0m23:14:54.225512 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:14:54.231364 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:14:54.254210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cba78809-ab86-4b91-a8e7-6775144b552d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735909b03cd0>]}
[0m23:14:54.255278 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:14:54.256363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cba78809-ab86-4b91-a8e7-6775144b552d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735909b76850>]}
[0m23:14:54.258237 [info ] [MainThread]: 
[0m23:14:54.259291 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:14:54.261359 [info ] [MainThread]: 
[0m23:14:54.265248 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:14:54.271999 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:14:54.386153 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:14:54.387814 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:14:54.389123 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:14:54.405064 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m23:14:54.408323 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:14:54.411371 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:14:54.422496 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:14:54.424185 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:14:54.425397 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:14:54.437917 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m23:14:54.439683 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:14:54.441270 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:14:54.448655 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:14:54.451340 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:14:54.452963 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:14:54.460625 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:54.463262 [debug] [MainThread]: On master: BEGIN
[0m23:14:54.465180 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:14:54.475911 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m23:14:54.477474 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:54.479837 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:14:54.488424 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m23:14:54.490630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cba78809-ab86-4b91-a8e7-6775144b552d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735909b79310>]}
[0m23:14:54.491854 [debug] [MainThread]: On master: ROLLBACK
[0m23:14:54.493148 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:54.494047 [debug] [MainThread]: On master: BEGIN
[0m23:14:54.495477 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:14:54.498738 [debug] [MainThread]: On master: COMMIT
[0m23:14:54.499821 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:54.500826 [debug] [MainThread]: On master: COMMIT
[0m23:14:54.502056 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:14:54.502995 [debug] [MainThread]: On master: Close
[0m23:14:54.508474 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:14:54.509619 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:14:54.510771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:14:54.512837 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:14:54.532234 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:14:54.600818 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:14:54.644059 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:14:54.687275 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:54.689924 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:14:54.697434 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:14:54.726794 [debug] [Thread-1 (]: SQL status: BEGIN in 0.029 seconds
[0m23:14:54.732348 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:54.734247 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:14:54.749044 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.013 seconds
[0m23:14:54.757524 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:54.759392 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:14:54.764591 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m23:14:54.769933 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:54.771816 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:14:54.775659 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:14:54.791614 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:14:54.793839 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:54.796295 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:14:54.800721 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:14:54.806339 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:14:54.810671 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:14:54.813464 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:14:54.819232 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m23:14:54.821882 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:14:54.824152 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cba78809-ab86-4b91-a8e7-6775144b552d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735908f7e810>]}
[0m23:14:54.825924 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.31s]
[0m23:14:54.829941 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:14:54.833034 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:54.834082 [debug] [MainThread]: On master: BEGIN
[0m23:14:54.835058 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:14:54.857304 [debug] [MainThread]: SQL status: BEGIN in 0.022 seconds
[0m23:14:54.865714 [debug] [MainThread]: On master: COMMIT
[0m23:14:54.870066 [debug] [MainThread]: Using postgres connection "master"
[0m23:14:54.873501 [debug] [MainThread]: On master: COMMIT
[0m23:14:54.877443 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m23:14:54.881589 [debug] [MainThread]: On master: Close
[0m23:14:54.884930 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:14:54.887613 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:14:54.890611 [info ] [MainThread]: 
[0m23:14:54.892737 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.63 seconds (0.63s).
[0m23:14:54.894543 [debug] [MainThread]: Command end result
[0m23:14:54.971117 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:14:54.979370 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:14:54.991573 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:14:54.992870 [info ] [MainThread]: 
[0m23:14:54.995600 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:14:54.996925 [info ] [MainThread]: 
[0m23:14:54.998571 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:14:55.000925 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.3222008, "process_in_blocks": "0", "process_kernel_time": 0.454843, "process_mem_max_rss": "127644", "process_out_blocks": "0", "process_user_time": 1.896532}
[0m23:14:55.002074 [debug] [MainThread]: Command `dbt run` succeeded at 23:14:55.001947 after 3.32 seconds
[0m23:14:55.003036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73590c568b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735910b17810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735910b328d0>]}
[0m23:14:55.004011 [debug] [MainThread]: Flushing usage events
[0m23:14:55.621148 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:15:04.064263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe38ddf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe393e510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe38df5d0>]}


============================== 23:15:04.071964 | d4911c70-64db-4b51-931d-082fdfa56162 ==============================
[0m23:15:04.071964 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:15:04.074314 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'quiet': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'empty': 'False', 'warn_error': 'None', 'log_format': 'default', 'use_colors': 'True', 'printer_width': '80', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'profiles_dir': '/usr/app/dbt/dbt', 'use_experimental_parser': 'False', 'no_print': 'None', 'cache_selected_only': 'False'}
[0m23:15:04.217240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd4911c70-64db-4b51-931d-082fdfa56162', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe38cdf90>]}
[0m23:15:04.265346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd4911c70-64db-4b51-931d-082fdfa56162', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe6668710>]}
[0m23:15:04.267385 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:15:04.433838 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:15:06.314984 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:15:06.316654 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:15:06.356002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd4911c70-64db-4b51-931d-082fdfa56162', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe21555d0>]}
[0m23:15:06.475039 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:15:06.485237 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:15:06.514650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd4911c70-64db-4b51-931d-082fdfa56162', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe15983d0>]}
[0m23:15:06.516131 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:15:06.517568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4911c70-64db-4b51-931d-082fdfa56162', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe1582210>]}
[0m23:15:06.520388 [info ] [MainThread]: 
[0m23:15:06.522633 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:15:06.524585 [info ] [MainThread]: 
[0m23:15:06.526668 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:15:06.528982 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:15:06.653045 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:15:06.655067 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:15:06.658106 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:15:06.682450 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.024 seconds
[0m23:15:06.686420 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:15:06.691350 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:15:06.701598 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:15:06.703407 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:15:06.705535 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:15:06.718482 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m23:15:06.720546 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:15:06.722562 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:15:06.731682 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m23:15:06.734384 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:15:06.736022 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:15:06.743389 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:06.745019 [debug] [MainThread]: On master: BEGIN
[0m23:15:06.746671 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:15:06.758683 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m23:15:06.761421 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:06.763257 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:15:06.771762 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m23:15:06.775434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4911c70-64db-4b51-931d-082fdfa56162', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe296a3d0>]}
[0m23:15:06.777803 [debug] [MainThread]: On master: ROLLBACK
[0m23:15:06.779667 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:06.781440 [debug] [MainThread]: On master: BEGIN
[0m23:15:06.783673 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:15:06.785690 [debug] [MainThread]: On master: COMMIT
[0m23:15:06.787567 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:06.789054 [debug] [MainThread]: On master: COMMIT
[0m23:15:06.790576 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:15:06.792999 [debug] [MainThread]: On master: Close
[0m23:15:06.801951 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:15:06.803877 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:15:06.805919 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:15:06.808545 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:15:06.831396 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:15:06.849238 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:15:06.875467 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:15:06.888124 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:06.889397 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:15:06.891349 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:15:06.904070 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:15:06.906793 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:06.908622 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:15:06.924380 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.014 seconds
[0m23:15:06.934955 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:06.936352 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:15:06.939660 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:15:06.948995 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:06.951194 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:15:06.955082 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:15:06.973368 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:15:06.976021 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:06.977576 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:15:06.981537 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:15:06.991305 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:15:06.997950 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:06.999209 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:15:07.007641 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.007 seconds
[0m23:15:07.011801 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:15:07.014662 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4911c70-64db-4b51-931d-082fdfa56162', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe08a08d0>]}
[0m23:15:07.017100 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.21s]
[0m23:15:07.019033 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:15:07.023032 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:07.024626 [debug] [MainThread]: On master: BEGIN
[0m23:15:07.026110 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:15:07.037470 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m23:15:07.039687 [debug] [MainThread]: On master: COMMIT
[0m23:15:07.041760 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:07.043455 [debug] [MainThread]: On master: COMMIT
[0m23:15:07.045545 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:15:07.047414 [debug] [MainThread]: On master: Close
[0m23:15:07.049212 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:15:07.050628 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:15:07.052023 [info ] [MainThread]: 
[0m23:15:07.053344 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.53 seconds (0.53s).
[0m23:15:07.055920 [debug] [MainThread]: Command end result
[0m23:15:07.128881 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:15:07.136692 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:15:07.150607 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:15:07.151882 [info ] [MainThread]: 
[0m23:15:07.153369 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:15:07.155037 [info ] [MainThread]: 
[0m23:15:07.156684 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:15:07.159067 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.1596315, "process_in_blocks": "0", "process_kernel_time": 0.395479, "process_mem_max_rss": "127492", "process_out_blocks": "0", "process_user_time": 1.924934}
[0m23:15:07.160649 [debug] [MainThread]: Command `dbt run` succeeded at 23:15:07.160444 after 3.16 seconds
[0m23:15:07.162058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe393dcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe813ee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fe81eb890>]}
[0m23:15:07.163371 [debug] [MainThread]: Flushing usage events
[0m23:15:07.787502 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:15:22.558264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27b6ee1910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27b6ee7fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27b6ee0cd0>]}


============================== 23:15:22.564726 | 5d223acb-b865-4376-8c9e-4fdc1f178a48 ==============================
[0m23:15:22.564726 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:15:22.565998 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'log_format': 'default', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'partial_parse': 'True', 'no_print': 'None', 'warn_error': 'None', 'use_colors': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'log_cache_events': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'quiet': 'False', 'introspect': 'True', 'printer_width': '80', 'debug': 'False', 'static_parser': 'True', 'fail_fast': 'False'}
[0m23:15:22.719969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d223acb-b865-4376-8c9e-4fdc1f178a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27b63cabd0>]}
[0m23:15:22.765661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d223acb-b865-4376-8c9e-4fdc1f178a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27b634f990>]}
[0m23:15:22.769482 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:15:23.170113 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:15:25.280082 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:15:25.281949 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:15:25.317417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d223acb-b865-4376-8c9e-4fdc1f178a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27b5718750>]}
[0m23:15:25.438632 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:15:25.450552 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:15:25.492090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d223acb-b865-4376-8c9e-4fdc1f178a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27b4b31e50>]}
[0m23:15:25.493811 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:15:25.495399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d223acb-b865-4376-8c9e-4fdc1f178a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27b4ba05d0>]}
[0m23:15:25.499806 [info ] [MainThread]: 
[0m23:15:25.501737 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:15:25.503446 [info ] [MainThread]: 
[0m23:15:25.505594 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:15:25.508384 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:15:25.645740 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:15:25.647162 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:15:25.648351 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:15:25.665220 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m23:15:25.669340 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:15:25.673340 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:15:25.679550 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:15:25.681086 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:15:25.682289 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:15:25.693163 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m23:15:25.695141 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:15:25.696320 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:15:25.704667 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.007 seconds
[0m23:15:25.707396 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:15:25.708465 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:15:25.713825 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:25.715379 [debug] [MainThread]: On master: BEGIN
[0m23:15:25.716900 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:15:25.726868 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m23:15:25.729844 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:25.732583 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:15:25.739916 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m23:15:25.742526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d223acb-b865-4376-8c9e-4fdc1f178a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27b572ca50>]}
[0m23:15:25.744146 [debug] [MainThread]: On master: ROLLBACK
[0m23:15:25.745450 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:25.746592 [debug] [MainThread]: On master: BEGIN
[0m23:15:25.747779 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:15:25.748984 [debug] [MainThread]: On master: COMMIT
[0m23:15:25.750036 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:25.751389 [debug] [MainThread]: On master: COMMIT
[0m23:15:25.753042 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:15:25.754268 [debug] [MainThread]: On master: Close
[0m23:15:25.762579 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:15:25.764424 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:15:25.766049 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:15:25.767464 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:15:25.790321 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:15:25.803241 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:15:25.837887 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:15:25.852398 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:25.853811 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:15:25.855165 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:15:25.870202 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m23:15:25.872414 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:25.876724 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:15:25.895180 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.014 seconds
[0m23:15:25.903971 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:25.906085 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:15:25.908811 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:15:25.916109 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:25.918076 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:15:25.921773 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:15:25.937649 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:15:25.939765 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:25.941025 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:15:25.945488 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:15:25.955488 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:15:25.963377 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:25.965696 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:15:25.972977 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:15:25.976971 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:15:25.980215 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d223acb-b865-4376-8c9e-4fdc1f178a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27b3de7f90>]}
[0m23:15:25.982245 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.21s]
[0m23:15:25.984353 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:15:25.988256 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:25.989755 [debug] [MainThread]: On master: BEGIN
[0m23:15:25.990917 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:15:26.003052 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m23:15:26.005238 [debug] [MainThread]: On master: COMMIT
[0m23:15:26.007113 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:26.008383 [debug] [MainThread]: On master: COMMIT
[0m23:15:26.009931 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:15:26.011085 [debug] [MainThread]: On master: Close
[0m23:15:26.012401 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:15:26.013793 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:15:26.015755 [info ] [MainThread]: 
[0m23:15:26.017491 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.51 seconds (0.51s).
[0m23:15:26.019718 [debug] [MainThread]: Command end result
[0m23:15:26.114164 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:15:26.126008 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:15:26.146329 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:15:26.148318 [info ] [MainThread]: 
[0m23:15:26.150966 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:15:26.153097 [info ] [MainThread]: 
[0m23:15:26.155503 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:15:26.158700 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.6673439, "process_in_blocks": "0", "process_kernel_time": 0.489712, "process_mem_max_rss": "127400", "process_out_blocks": "0", "process_user_time": 1.860907}
[0m23:15:26.160708 [debug] [MainThread]: Command `dbt run` succeeded at 23:15:26.160507 after 3.67 seconds
[0m23:15:26.162606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27bba47910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27bb7feb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b27bb7fe990>]}
[0m23:15:26.164498 [debug] [MainThread]: Flushing usage events
[0m23:15:26.925571 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:15:54.522407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfffec63290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfffc13b750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bffffe91110>]}


============================== 23:15:54.531944 | 123f66e0-a451-4926-b169-68fd47d1823c ==============================
[0m23:15:54.531944 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:15:54.533785 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'static_parser': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'invocation_command': 'dbt run', 'log_format': 'default', 'version_check': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'log_cache_events': 'False', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'quiet': 'False', 'target_path': 'None', 'use_colors': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m23:15:54.677537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '123f66e0-a451-4926-b169-68fd47d1823c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfffc084290>]}
[0m23:15:54.732310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '123f66e0-a451-4926-b169-68fd47d1823c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfffec767d0>]}
[0m23:15:54.735996 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:15:54.881848 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:15:56.799289 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:15:56.800262 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:15:56.835033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '123f66e0-a451-4926-b169-68fd47d1823c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfffa70d190>]}
[0m23:15:56.921825 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:15:56.927104 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:15:56.955974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '123f66e0-a451-4926-b169-68fd47d1823c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfff9b9af50>]}
[0m23:15:56.956980 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:15:56.958211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '123f66e0-a451-4926-b169-68fd47d1823c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfffabf8f50>]}
[0m23:15:56.960125 [info ] [MainThread]: 
[0m23:15:56.961326 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:15:56.962378 [info ] [MainThread]: 
[0m23:15:56.963686 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:15:56.964958 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:15:57.068930 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:15:57.071699 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:15:57.073358 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:15:57.091574 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.018 seconds
[0m23:15:57.093857 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:15:57.096524 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:15:57.102271 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:15:57.104260 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:15:57.105423 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:15:57.113247 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m23:15:57.114822 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:15:57.117347 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:15:57.123642 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:15:57.125435 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:15:57.126543 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:15:57.130936 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:57.134208 [debug] [MainThread]: On master: BEGIN
[0m23:15:57.155150 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:15:57.172837 [debug] [MainThread]: SQL status: BEGIN in 0.018 seconds
[0m23:15:57.175186 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:57.177090 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:15:57.185037 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m23:15:57.190783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '123f66e0-a451-4926-b169-68fd47d1823c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfff8ee2850>]}
[0m23:15:57.192450 [debug] [MainThread]: On master: ROLLBACK
[0m23:15:57.194757 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:57.195978 [debug] [MainThread]: On master: BEGIN
[0m23:15:57.197798 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:15:57.199404 [debug] [MainThread]: On master: COMMIT
[0m23:15:57.200624 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:57.201798 [debug] [MainThread]: On master: COMMIT
[0m23:15:57.203243 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:15:57.205561 [debug] [MainThread]: On master: Close
[0m23:15:57.217518 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:15:57.219116 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:15:57.226105 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:15:57.227927 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:15:57.248527 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:15:57.260453 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:15:57.284859 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:15:57.295830 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:57.296791 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:15:57.297564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:15:57.307251 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m23:15:57.308545 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:57.309654 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:15:57.326436 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.015 seconds
[0m23:15:57.332487 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:57.333510 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:15:57.336390 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:15:57.348803 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:57.350089 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:15:57.352754 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:15:57.365810 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:15:57.367150 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:57.368586 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:15:57.372998 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:15:57.380657 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:15:57.387967 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:15:57.389499 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:15:57.396425 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m23:15:57.399608 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:15:57.402621 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '123f66e0-a451-4926-b169-68fd47d1823c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfff9ba8b90>]}
[0m23:15:57.405607 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.18s]
[0m23:15:57.407092 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:15:57.409907 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:57.410799 [debug] [MainThread]: On master: BEGIN
[0m23:15:57.411793 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:15:57.420618 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m23:15:57.422618 [debug] [MainThread]: On master: COMMIT
[0m23:15:57.423500 [debug] [MainThread]: Using postgres connection "master"
[0m23:15:57.424754 [debug] [MainThread]: On master: COMMIT
[0m23:15:57.426613 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m23:15:57.427598 [debug] [MainThread]: On master: Close
[0m23:15:57.428639 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:15:57.429495 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:15:57.430548 [info ] [MainThread]: 
[0m23:15:57.431495 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m23:15:57.432675 [debug] [MainThread]: Command end result
[0m23:15:57.485265 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:15:57.494128 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:15:57.504630 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:15:57.505520 [info ] [MainThread]: 
[0m23:15:57.506825 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:15:57.509085 [info ] [MainThread]: 
[0m23:15:57.510420 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:15:57.511950 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.0714788, "process_in_blocks": "0", "process_kernel_time": 0.405132, "process_mem_max_rss": "128112", "process_out_blocks": "0", "process_user_time": 1.816957}
[0m23:15:57.513078 [debug] [MainThread]: Command `dbt run` succeeded at 23:15:57.512949 after 3.07 seconds
[0m23:15:57.513964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfffbeeac90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfffbef9e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0000752d10>]}
[0m23:15:57.514816 [debug] [MainThread]: Flushing usage events
[0m23:15:58.364225 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:18:09.764741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca4167e9750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca41684a1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca41684aa10>]}


============================== 23:18:09.783094 | 0d1bcfbb-270c-4cf3-aff3-cc6ab5e26b5c ==============================
[0m23:18:09.783094 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:18:09.786880 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'empty': 'False', 'fail_fast': 'False', 'write_json': 'True', 'log_cache_events': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'debug': 'False', 'quiet': 'False', 'introspect': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'indirect_selection': 'eager', 'static_parser': 'True', 'warn_error': 'None', 'target_path': 'None', 'use_experimental_parser': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m23:18:10.083600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0d1bcfbb-270c-4cf3-aff3-cc6ab5e26b5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca415569450>]}
[0m23:18:10.185455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0d1bcfbb-270c-4cf3-aff3-cc6ab5e26b5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca4155cd890>]}
[0m23:18:10.189887 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:18:10.491457 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:18:12.540546 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:18:12.542544 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:18:12.601664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0d1bcfbb-270c-4cf3-aff3-cc6ab5e26b5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca416881e10>]}
[0m23:18:12.750951 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:18:12.763203 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:18:12.815642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0d1bcfbb-270c-4cf3-aff3-cc6ab5e26b5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca41410c850>]}
[0m23:18:12.817374 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:18:12.818575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d1bcfbb-270c-4cf3-aff3-cc6ab5e26b5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca418d7f290>]}
[0m23:18:12.821750 [info ] [MainThread]: 
[0m23:18:12.824235 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:18:12.825853 [info ] [MainThread]: 
[0m23:18:12.827862 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:18:12.830116 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:18:12.959279 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:18:12.961237 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:18:12.962875 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:18:12.981170 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.018 seconds
[0m23:18:12.985699 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:18:12.988387 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:18:12.997326 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:18:12.999924 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:18:13.001158 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:18:13.011194 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m23:18:13.012641 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:18:13.013799 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:18:13.027478 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.012 seconds
[0m23:18:13.029974 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:18:13.031487 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:18:13.036430 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:13.038352 [debug] [MainThread]: On master: BEGIN
[0m23:18:13.039928 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:18:13.049366 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m23:18:13.051049 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:13.052695 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:18:13.064617 [debug] [MainThread]: SQL status: SELECT 1 in 0.010 seconds
[0m23:18:13.066924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d1bcfbb-270c-4cf3-aff3-cc6ab5e26b5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca4149e2c50>]}
[0m23:18:13.068075 [debug] [MainThread]: On master: ROLLBACK
[0m23:18:13.069029 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:13.069758 [debug] [MainThread]: On master: BEGIN
[0m23:18:13.070713 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:18:13.071946 [debug] [MainThread]: On master: COMMIT
[0m23:18:13.073379 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:13.074562 [debug] [MainThread]: On master: COMMIT
[0m23:18:13.076192 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:18:13.077406 [debug] [MainThread]: On master: Close
[0m23:18:13.083798 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:18:13.085326 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:18:13.086452 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:18:13.087418 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:18:13.103080 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:18:13.115500 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:18:13.152092 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:18:13.163997 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:13.165092 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:18:13.166210 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:18:13.174254 [debug] [Thread-1 (]: SQL status: BEGIN in 0.008 seconds
[0m23:18:13.175834 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:13.176968 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:18:13.188849 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m23:18:13.195026 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:13.196514 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:18:13.198597 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:18:13.204226 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:13.205860 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:18:13.208308 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:18:13.219499 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:18:13.221047 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:13.222435 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:18:13.226712 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:18:13.232688 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:18:13.237913 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:13.239460 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:18:13.246367 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m23:18:13.249500 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:18:13.252096 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d1bcfbb-270c-4cf3-aff3-cc6ab5e26b5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca413683a10>]}
[0m23:18:13.253972 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.16s]
[0m23:18:13.255933 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:18:13.259025 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:13.260475 [debug] [MainThread]: On master: BEGIN
[0m23:18:13.261684 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:18:13.270541 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m23:18:13.272160 [debug] [MainThread]: On master: COMMIT
[0m23:18:13.273676 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:13.275309 [debug] [MainThread]: On master: COMMIT
[0m23:18:13.276789 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:18:13.279241 [debug] [MainThread]: On master: Close
[0m23:18:13.280628 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:18:13.281678 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:18:13.282732 [info ] [MainThread]: 
[0m23:18:13.283812 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.46 seconds (0.46s).
[0m23:18:13.285279 [debug] [MainThread]: Command end result
[0m23:18:13.340119 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:18:13.347247 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:18:13.359844 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:18:13.361356 [info ] [MainThread]: 
[0m23:18:13.363145 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:18:13.364668 [info ] [MainThread]: 
[0m23:18:13.365958 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:18:13.368027 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.7112052, "process_in_blocks": "0", "process_kernel_time": 0.989917, "process_mem_max_rss": "127256", "process_out_blocks": "0", "process_user_time": 2.796717}
[0m23:18:13.369266 [debug] [MainThread]: Command `dbt run` succeeded at 23:18:13.369161 after 3.71 seconds
[0m23:18:13.370430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca41b03acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca41b03ac50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca41b347910>]}
[0m23:18:13.371733 [debug] [MainThread]: Flushing usage events
[0m23:18:14.143387 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:18:16.447163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb81ece950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb81ed5ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb81ecea10>]}


============================== 23:18:16.453247 | 3ec824f9-9319-43ac-abfd-0186520f4c03 ==============================
[0m23:18:16.453247 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:18:16.455892 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'empty': 'False', 'use_experimental_parser': 'False', 'target_path': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'indirect_selection': 'eager', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'log_format': 'default', 'printer_width': '80', 'partial_parse': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'quiet': 'False', 'log_cache_events': 'False', 'write_json': 'True', 'log_path': '/usr/app/dbt/dbt/logs'}
[0m23:18:16.602373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3ec824f9-9319-43ac-abfd-0186520f4c03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb80f15250>]}
[0m23:18:16.650280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3ec824f9-9319-43ac-abfd-0186520f4c03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb81322190>]}
[0m23:18:16.655113 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:18:16.799917 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:18:18.670164 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:18:18.671404 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:18:18.706940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3ec824f9-9319-43ac-abfd-0186520f4c03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb80ba2550>]}
[0m23:18:18.839512 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:18:18.860081 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:18:18.902230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3ec824f9-9319-43ac-abfd-0186520f4c03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb7fb01a90>]}
[0m23:18:18.904410 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:18:18.906723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ec824f9-9319-43ac-abfd-0186520f4c03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb7fb76210>]}
[0m23:18:18.910553 [info ] [MainThread]: 
[0m23:18:18.912124 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:18:18.914101 [info ] [MainThread]: 
[0m23:18:18.917077 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:18:18.921195 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:18:19.038799 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:18:19.040159 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:18:19.041246 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:18:19.056738 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.015 seconds
[0m23:18:19.059555 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:18:19.062889 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:18:19.070094 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:18:19.071199 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:18:19.072357 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:18:19.081888 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m23:18:19.083917 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:18:19.084876 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:18:19.090732 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:18:19.092557 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:18:19.093696 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:18:19.099506 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:19.101768 [debug] [MainThread]: On master: BEGIN
[0m23:18:19.103421 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:18:19.113332 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m23:18:19.118094 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:19.120296 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:18:19.127479 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m23:18:19.129875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ec824f9-9319-43ac-abfd-0186520f4c03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb7fbca210>]}
[0m23:18:19.131612 [debug] [MainThread]: On master: ROLLBACK
[0m23:18:19.135867 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:19.136926 [debug] [MainThread]: On master: BEGIN
[0m23:18:19.138309 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:18:19.139538 [debug] [MainThread]: On master: COMMIT
[0m23:18:19.140468 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:19.141408 [debug] [MainThread]: On master: COMMIT
[0m23:18:19.142779 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:18:19.144072 [debug] [MainThread]: On master: Close
[0m23:18:19.152500 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:18:19.154338 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:18:19.155875 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:18:19.157310 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:18:19.171201 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:18:19.189637 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:18:19.215887 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:18:19.231602 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:19.234847 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:18:19.236657 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:18:19.249578 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:18:19.251798 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:19.253925 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:18:19.261980 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m23:18:19.270753 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:19.272203 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:18:19.274445 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:18:19.279290 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:19.280737 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:18:19.284724 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:18:19.296774 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:18:19.298934 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:19.302344 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:18:19.308424 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:18:19.314430 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:18:19.322704 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:19.324780 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:18:19.329453 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m23:18:19.333316 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:18:19.338573 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ec824f9-9319-43ac-abfd-0186520f4c03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb80fa4450>]}
[0m23:18:19.340970 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.18s]
[0m23:18:19.342612 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:18:19.345826 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:19.347431 [debug] [MainThread]: On master: BEGIN
[0m23:18:19.348648 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:18:19.359776 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m23:18:19.362073 [debug] [MainThread]: On master: COMMIT
[0m23:18:19.363529 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:19.364931 [debug] [MainThread]: On master: COMMIT
[0m23:18:19.368260 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m23:18:19.369996 [debug] [MainThread]: On master: Close
[0m23:18:19.372048 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:18:19.373599 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:18:19.374908 [info ] [MainThread]: 
[0m23:18:19.376100 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.46 seconds (0.46s).
[0m23:18:19.378245 [debug] [MainThread]: Command end result
[0m23:18:19.455843 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:18:19.464649 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:18:19.478364 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:18:19.480449 [info ] [MainThread]: 
[0m23:18:19.484566 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:18:19.485668 [info ] [MainThread]: 
[0m23:18:19.487284 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:18:19.489618 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.1212366, "process_in_blocks": "0", "process_kernel_time": 0.471218, "process_mem_max_rss": "126732", "process_out_blocks": "0", "process_user_time": 2.029863}
[0m23:18:19.491000 [debug] [MainThread]: Command `dbt run` succeeded at 23:18:19.490821 after 3.12 seconds
[0m23:18:19.492196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb81ed6050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb86783810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cbb8679e8d0>]}
[0m23:18:19.493410 [debug] [MainThread]: Flushing usage events
[0m23:18:20.284212 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:18:22.449383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d356e87da50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d356f6cddd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d356e87e890>]}


============================== 23:18:22.456727 | 91a90fb1-4f4e-4fa2-88e3-ec509b67a134 ==============================
[0m23:18:22.456727 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:18:22.458769 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'warn_error': 'None', 'static_parser': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'indirect_selection': 'eager', 'fail_fast': 'False', 'quiet': 'False', 'log_cache_events': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'use_experimental_parser': 'False', 'introspect': 'True', 'empty': 'False', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'log_path': '/usr/app/dbt/dbt/logs'}
[0m23:18:22.602525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '91a90fb1-4f4e-4fa2-88e3-ec509b67a134', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d356d9ae310>]}
[0m23:18:22.663825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '91a90fb1-4f4e-4fa2-88e3-ec509b67a134', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d35715a27d0>]}
[0m23:18:22.665925 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:18:22.793006 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:18:24.858317 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:18:24.859751 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:18:24.892394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '91a90fb1-4f4e-4fa2-88e3-ec509b67a134', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d356cd28150>]}
[0m23:18:25.022128 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:18:25.033479 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:18:25.081802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '91a90fb1-4f4e-4fa2-88e3-ec509b67a134', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d356c10d510>]}
[0m23:18:25.083483 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:18:25.085130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '91a90fb1-4f4e-4fa2-88e3-ec509b67a134', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d356d9f0ed0>]}
[0m23:18:25.088691 [info ] [MainThread]: 
[0m23:18:25.090114 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:18:25.091831 [info ] [MainThread]: 
[0m23:18:25.093664 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:18:25.096226 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:18:25.210235 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:18:25.214790 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:18:25.217198 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:18:25.239692 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.022 seconds
[0m23:18:25.243005 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:18:25.249876 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:18:25.259722 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:18:25.263172 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:18:25.268283 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:18:25.282442 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m23:18:25.284971 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:18:25.287029 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:18:25.302578 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.010 seconds
[0m23:18:25.306664 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:18:25.310000 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:18:25.318712 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:25.321414 [debug] [MainThread]: On master: BEGIN
[0m23:18:25.324561 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:18:25.337350 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:18:25.339672 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:25.341302 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:18:25.350220 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m23:18:25.353159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '91a90fb1-4f4e-4fa2-88e3-ec509b67a134', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d356e89f190>]}
[0m23:18:25.354609 [debug] [MainThread]: On master: ROLLBACK
[0m23:18:25.356130 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:25.357289 [debug] [MainThread]: On master: BEGIN
[0m23:18:25.358571 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:18:25.359961 [debug] [MainThread]: On master: COMMIT
[0m23:18:25.361921 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:25.363793 [debug] [MainThread]: On master: COMMIT
[0m23:18:25.365549 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:18:25.367199 [debug] [MainThread]: On master: Close
[0m23:18:25.375171 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:18:25.376912 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:18:25.378968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:18:25.380760 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:18:25.398361 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:18:25.411009 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:18:25.439268 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:18:25.454125 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:25.455247 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:18:25.456397 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:18:25.468146 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:18:25.470287 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:25.471903 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:18:25.483186 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m23:18:25.490721 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:25.493005 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:18:25.498166 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:18:25.503683 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:25.511943 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:18:25.515750 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:18:25.536222 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:18:25.537901 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:25.539148 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:18:25.543679 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:18:25.552105 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:18:25.557008 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:25.558199 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:18:25.565030 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m23:18:25.568249 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:18:25.571737 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91a90fb1-4f4e-4fa2-88e3-ec509b67a134', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d356f961750>]}
[0m23:18:25.573964 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.19s]
[0m23:18:25.576392 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:18:25.581317 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:25.584045 [debug] [MainThread]: On master: BEGIN
[0m23:18:25.585930 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:18:25.599875 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:18:25.601916 [debug] [MainThread]: On master: COMMIT
[0m23:18:25.603934 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:25.605569 [debug] [MainThread]: On master: COMMIT
[0m23:18:25.607162 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:18:25.608814 [debug] [MainThread]: On master: Close
[0m23:18:25.611326 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:18:25.613040 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:18:25.614198 [info ] [MainThread]: 
[0m23:18:25.615891 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m23:18:25.618704 [debug] [MainThread]: Command end result
[0m23:18:25.700016 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:18:25.709881 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:18:25.729169 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:18:25.731099 [info ] [MainThread]: 
[0m23:18:25.733411 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:18:25.735291 [info ] [MainThread]: 
[0m23:18:25.737539 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:18:25.747195 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.3622887, "process_in_blocks": "0", "process_kernel_time": 0.502233, "process_mem_max_rss": "127932", "process_out_blocks": "0", "process_user_time": 1.903627}
[0m23:18:25.749860 [debug] [MainThread]: Command `dbt run` succeeded at 23:18:25.749555 after 3.36 seconds
[0m23:18:25.752123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3573143810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3573092e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3573092e90>]}
[0m23:18:25.754163 [debug] [MainThread]: Flushing usage events
[0m23:18:26.346496 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:18:28.825422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b26f48ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b26faa010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b272d8ad0>]}


============================== 23:18:28.830268 | 7f2d1b60-292a-4899-a1ef-8cb94b7669c6 ==============================
[0m23:18:28.830268 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:18:28.831727 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/usr/app/dbt/dbt/logs', 'indirect_selection': 'eager', 'log_format': 'default', 'static_parser': 'True', 'use_experimental_parser': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'partial_parse': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'empty': 'False', 'no_print': 'None', 'target_path': 'None', 'quiet': 'False', 'warn_error': 'None', 'introspect': 'True', 'use_colors': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt run'}
[0m23:18:28.964252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f2d1b60-292a-4899-a1ef-8cb94b7669c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b2990b9d0>]}
[0m23:18:29.031264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f2d1b60-292a-4899-a1ef-8cb94b7669c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b29cae110>]}
[0m23:18:29.033803 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:18:29.166689 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:18:31.188215 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:18:31.191780 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:18:31.226656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f2d1b60-292a-4899-a1ef-8cb94b7669c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b25739390>]}
[0m23:18:31.357721 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:18:31.371142 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:18:31.411468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f2d1b60-292a-4899-a1ef-8cb94b7669c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b24bc7d10>]}
[0m23:18:31.413120 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:18:31.414452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f2d1b60-292a-4899-a1ef-8cb94b7669c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b24bc2790>]}
[0m23:18:31.417615 [info ] [MainThread]: 
[0m23:18:31.418982 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:18:31.420270 [info ] [MainThread]: 
[0m23:18:31.421944 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:18:31.428787 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:18:31.563043 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:18:31.564570 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:18:31.565607 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:18:31.580468 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.015 seconds
[0m23:18:31.582663 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:18:31.585125 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:18:31.593883 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:18:31.594996 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:18:31.595916 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:18:31.604940 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m23:18:31.607903 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:18:31.609405 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:18:31.616876 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m23:18:31.618793 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:18:31.619917 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:18:31.626647 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:31.628102 [debug] [MainThread]: On master: BEGIN
[0m23:18:31.629214 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:18:31.637596 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m23:18:31.640291 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:31.641597 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:18:31.648714 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m23:18:31.650516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f2d1b60-292a-4899-a1ef-8cb94b7669c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b26f4a950>]}
[0m23:18:31.651602 [debug] [MainThread]: On master: ROLLBACK
[0m23:18:31.652595 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:31.653560 [debug] [MainThread]: On master: BEGIN
[0m23:18:31.654575 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:18:31.658043 [debug] [MainThread]: On master: COMMIT
[0m23:18:31.670676 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:31.675428 [debug] [MainThread]: On master: COMMIT
[0m23:18:31.677973 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:18:31.679364 [debug] [MainThread]: On master: Close
[0m23:18:31.685631 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:18:31.686864 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:18:31.699935 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:18:31.702272 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:18:31.719944 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:18:31.743951 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:18:31.770797 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:18:31.785226 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:31.786240 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:18:31.787083 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:18:31.798254 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:18:31.809534 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:31.812138 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:18:31.827705 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.013 seconds
[0m23:18:31.834773 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:31.835910 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:18:31.839111 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:18:31.846578 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:31.848220 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:18:31.851134 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:18:31.866326 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:18:31.867830 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:31.869137 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:18:31.874618 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:18:31.882525 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:18:31.887403 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:18:31.889018 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:18:31.895228 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:18:31.898302 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:18:31.901012 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f2d1b60-292a-4899-a1ef-8cb94b7669c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b23da4b90>]}
[0m23:18:31.903022 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.20s]
[0m23:18:31.906900 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:18:31.910179 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:31.911192 [debug] [MainThread]: On master: BEGIN
[0m23:18:31.912576 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:18:31.921457 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m23:18:31.924170 [debug] [MainThread]: On master: COMMIT
[0m23:18:31.928748 [debug] [MainThread]: Using postgres connection "master"
[0m23:18:31.929703 [debug] [MainThread]: On master: COMMIT
[0m23:18:31.931007 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:18:31.932018 [debug] [MainThread]: On master: Close
[0m23:18:31.933299 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:18:31.934717 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:18:31.935838 [info ] [MainThread]: 
[0m23:18:31.936993 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.51 seconds (0.51s).
[0m23:18:31.939543 [debug] [MainThread]: Command end result
[0m23:18:32.027394 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:18:32.036852 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:18:32.052547 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:18:32.053884 [info ] [MainThread]: 
[0m23:18:32.056909 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:18:32.059246 [info ] [MainThread]: 
[0m23:18:32.061300 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:18:32.064487 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.3009844, "process_in_blocks": "0", "process_kernel_time": 0.452778, "process_mem_max_rss": "127988", "process_out_blocks": "0", "process_user_time": 1.887926}
[0m23:18:32.066213 [debug] [MainThread]: Command `dbt run` succeeded at 23:18:32.066062 after 3.30 seconds
[0m23:18:32.067436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b2b82f890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b2b84a950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4b2b84b610>]}
[0m23:18:32.068563 [debug] [MainThread]: Flushing usage events
[0m23:18:32.855662 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:18:35.698896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59d4db7710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59d52175d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59d4db42d0>]}


============================== 23:18:35.707236 | efd2f5df-dd62-41e5-9341-aaf0fe49dbe7 ==============================
[0m23:18:35.707236 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:18:35.708930 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'indirect_selection': 'eager', 'profiles_dir': '/usr/app/dbt/dbt', 'printer_width': '80', 'debug': 'False', 'partial_parse': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'log_cache_events': 'False', 'version_check': 'True', 'fail_fast': 'False', 'target_path': 'None', 'use_colors': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'empty': 'False', 'write_json': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:18:35.860296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'efd2f5df-dd62-41e5-9341-aaf0fe49dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59d7c425d0>]}
[0m23:18:35.913102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'efd2f5df-dd62-41e5-9341-aaf0fe49dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59d41c6610>]}
[0m23:18:35.915670 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:18:36.069749 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:18:37.798517 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:18:37.799796 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:18:37.844283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'efd2f5df-dd62-41e5-9341-aaf0fe49dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59d3900610>]}
[0m23:18:37.940556 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:18:37.948258 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:18:38.002918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'efd2f5df-dd62-41e5-9341-aaf0fe49dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59d2d17d90>]}
[0m23:18:38.004619 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:18:38.006025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'efd2f5df-dd62-41e5-9341-aaf0fe49dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59d35f9190>]}
[0m23:18:38.008253 [info ] [MainThread]: 
[0m23:18:38.009303 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:18:38.010811 [info ] [MainThread]: 
[0m23:18:38.013360 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:18:38.015869 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:18:38.128494 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:18:38.130649 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:18:38.131791 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:21:09.621865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f85c13d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f8928e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f85c25d0>]}


============================== 23:21:09.628631 | 61c1cc83-3843-4971-bc86-d713947dced0 ==============================
[0m23:21:09.628631 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:21:09.629888 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'target_path': 'None', 'log_cache_events': 'False', 'static_parser': 'True', 'quiet': 'False', 'log_format': 'default', 'no_print': 'None', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error': 'None', 'use_experimental_parser': 'False', 'printer_width': '80', 'write_json': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'partial_parse': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True'}
[0m23:21:09.795820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '61c1cc83-3843-4971-bc86-d713947dced0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f962edd0>]}
[0m23:21:09.859590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '61c1cc83-3843-4971-bc86-d713947dced0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f7d67b90>]}
[0m23:21:09.862880 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:21:10.065775 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:21:11.974777 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:21:11.976864 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:21:12.019478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '61c1cc83-3843-4971-bc86-d713947dced0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f715b3d0>]}
[0m23:21:12.324788 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:12.357200 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:12.449830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '61c1cc83-3843-4971-bc86-d713947dced0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f658b290>]}
[0m23:21:12.452160 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:21:12.454441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '61c1cc83-3843-4971-bc86-d713947dced0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f6586850>]}
[0m23:21:12.459698 [info ] [MainThread]: 
[0m23:21:12.462430 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:21:12.470886 [info ] [MainThread]: 
[0m23:21:12.474954 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:21:12.484142 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:21:12.596269 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:21:12.598081 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:21:12.603728 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:21:12.618228 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.014 seconds
[0m23:21:12.622148 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:21:12.630552 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:21:12.644548 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:12.648006 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:21:12.652589 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:12.671400 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m23:21:12.674812 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:12.683399 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:21:12.692711 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.007 seconds
[0m23:21:12.696783 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:21:12.698667 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:21:12.707098 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:12.709246 [debug] [MainThread]: On master: BEGIN
[0m23:21:12.711545 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:21:12.723224 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m23:21:12.727169 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:12.728613 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:21:12.742804 [debug] [MainThread]: SQL status: SELECT 1 in 0.010 seconds
[0m23:21:12.746930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '61c1cc83-3843-4971-bc86-d713947dced0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f659ad10>]}
[0m23:21:12.750262 [debug] [MainThread]: On master: ROLLBACK
[0m23:21:12.756619 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:12.757794 [debug] [MainThread]: On master: BEGIN
[0m23:21:12.762719 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:21:12.764173 [debug] [MainThread]: On master: COMMIT
[0m23:21:12.765677 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:12.770160 [debug] [MainThread]: On master: COMMIT
[0m23:21:12.772863 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:12.776113 [debug] [MainThread]: On master: Close
[0m23:21:12.785924 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:21:12.790731 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:21:12.792146 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:21:12.793225 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:21:12.808780 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:12.821051 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:21:12.848240 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:12.864126 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:12.865320 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:21:12.866485 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:12.876782 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m23:21:12.879112 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:12.880638 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:21:12.892457 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m23:21:12.898826 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:12.900192 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:21:12.903379 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:21:12.911436 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:12.913592 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:21:12.916147 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:21:12.933187 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:12.934919 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:12.936604 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:12.940192 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:21:12.946277 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:21:12.956789 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:12.958853 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:21:12.963965 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m23:21:12.966974 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:21:12.969555 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '61c1cc83-3843-4971-bc86-d713947dced0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f53ae0d0>]}
[0m23:21:12.971039 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.18s]
[0m23:21:12.972498 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:21:12.974925 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:12.975966 [debug] [MainThread]: On master: BEGIN
[0m23:21:12.977090 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:21:12.984635 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m23:21:12.985920 [debug] [MainThread]: On master: COMMIT
[0m23:21:12.987167 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:12.987957 [debug] [MainThread]: On master: COMMIT
[0m23:21:12.989019 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:12.990449 [debug] [MainThread]: On master: Close
[0m23:21:12.991785 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:21:12.992911 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:21:12.994246 [info ] [MainThread]: 
[0m23:21:12.995609 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m23:21:12.996892 [debug] [MainThread]: Command end result
[0m23:21:13.061819 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:13.072582 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:13.086780 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:21:13.089458 [info ] [MainThread]: 
[0m23:21:13.091096 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:21:13.092413 [info ] [MainThread]: 
[0m23:21:13.093496 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:21:13.094969 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5350964, "process_in_blocks": "0", "process_kernel_time": 0.965089, "process_mem_max_rss": "127500", "process_out_blocks": "0", "process_user_time": 2.752602}
[0m23:21:13.097317 [debug] [MainThread]: Command `dbt run` succeeded at 23:21:13.097216 after 3.54 seconds
[0m23:21:13.098268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854fd11f910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854fced6b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854fced6a50>]}
[0m23:21:13.099133 [debug] [MainThread]: Flushing usage events
[0m23:21:13.883248 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:21:16.074598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f6b30ac90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f6b2bbfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f6b3161d0>]}


============================== 23:21:16.080742 | 8b3a969e-471b-41db-9db3-761df5633e7a ==============================
[0m23:21:16.080742 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:21:16.082600 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'debug': 'False', 'target_path': 'None', 'warn_error': 'None', 'printer_width': '80', 'indirect_selection': 'eager', 'no_print': 'None', 'version_check': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'cache_selected_only': 'False', 'partial_parse': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'introspect': 'True', 'use_experimental_parser': 'False', 'use_colors': 'True', 'quiet': 'False', 'empty': 'False', 'log_cache_events': 'False', 'fail_fast': 'False', 'invocation_command': 'dbt run'}
[0m23:21:16.228770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8b3a969e-471b-41db-9db3-761df5633e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f6b34a610>]}
[0m23:21:16.275281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8b3a969e-471b-41db-9db3-761df5633e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f6e020790>]}
[0m23:21:16.277683 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:21:16.421825 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:21:18.761436 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:21:18.763077 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:21:18.802342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8b3a969e-471b-41db-9db3-761df5633e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f6a7f1210>]}
[0m23:21:18.917748 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:18.927286 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:18.961576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8b3a969e-471b-41db-9db3-761df5633e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f69b2f590>]}
[0m23:21:18.964743 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:21:18.966926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8b3a969e-471b-41db-9db3-761df5633e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f68fa2250>]}
[0m23:21:18.970607 [info ] [MainThread]: 
[0m23:21:18.972008 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:21:18.973735 [info ] [MainThread]: 
[0m23:21:18.975688 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:21:18.979908 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:21:19.093535 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:21:19.095902 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:21:19.097754 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:21:19.114073 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m23:21:19.118260 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:21:19.122168 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:21:19.129766 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:19.131489 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:21:19.133146 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:19.146370 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m23:21:19.148457 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:19.150043 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:21:19.158397 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.007 seconds
[0m23:21:19.162126 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:21:19.164152 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:21:19.171381 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:19.172992 [debug] [MainThread]: On master: BEGIN
[0m23:21:19.174374 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:21:19.187454 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:21:19.189433 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:19.191533 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:21:19.200985 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m23:21:19.204382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8b3a969e-471b-41db-9db3-761df5633e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f68b4a750>]}
[0m23:21:19.206428 [debug] [MainThread]: On master: ROLLBACK
[0m23:21:19.208502 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:19.209895 [debug] [MainThread]: On master: BEGIN
[0m23:21:19.211832 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:21:19.213908 [debug] [MainThread]: On master: COMMIT
[0m23:21:19.215338 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:19.216559 [debug] [MainThread]: On master: COMMIT
[0m23:21:19.217856 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:19.219028 [debug] [MainThread]: On master: Close
[0m23:21:19.227841 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:21:19.230516 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:21:19.232491 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:21:19.234355 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:21:19.255235 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:19.271637 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:21:19.303590 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:19.317673 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:19.319173 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:21:19.320737 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:19.334474 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m23:21:19.336252 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:19.337950 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:21:19.346779 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m23:21:19.354533 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:19.355870 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:21:19.358449 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:21:19.366232 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:19.367931 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:21:19.370573 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:21:19.384156 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:19.385621 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:19.386841 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:19.390798 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:21:19.398187 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:21:19.404951 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:19.406550 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:21:19.412822 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:21:19.417563 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:21:19.421183 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b3a969e-471b-41db-9db3-761df5633e7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f63fc9bd0>]}
[0m23:21:19.423039 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.19s]
[0m23:21:19.425235 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:21:19.428687 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:19.430579 [debug] [MainThread]: On master: BEGIN
[0m23:21:19.431826 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:21:19.442955 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m23:21:19.444819 [debug] [MainThread]: On master: COMMIT
[0m23:21:19.446261 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:19.448089 [debug] [MainThread]: On master: COMMIT
[0m23:21:19.450057 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:19.451424 [debug] [MainThread]: On master: Close
[0m23:21:19.452936 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:21:19.454290 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:21:19.455884 [info ] [MainThread]: 
[0m23:21:19.459047 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.48 seconds (0.48s).
[0m23:21:19.464423 [debug] [MainThread]: Command end result
[0m23:21:19.541403 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:19.551617 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:19.568549 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:21:19.570017 [info ] [MainThread]: 
[0m23:21:19.572403 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:21:19.574304 [info ] [MainThread]: 
[0m23:21:19.576845 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:21:19.580045 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5837197, "process_in_blocks": "0", "process_kernel_time": 0.416054, "process_mem_max_rss": "127896", "process_out_blocks": "0", "process_user_time": 1.978298}
[0m23:21:19.582384 [debug] [MainThread]: Command `dbt run` succeeded at 23:21:19.582205 after 3.59 seconds
[0m23:21:19.584049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f6b63cd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f6c179950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c8f6fe1b910>]}
[0m23:21:19.585752 [debug] [MainThread]: Flushing usage events
[0m23:21:20.405515 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:21:22.652152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502d105ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502d4e47d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502d1061d0>]}


============================== 23:21:22.659635 | c9bc1669-5e82-46e9-a484-9039dbee3f99 ==============================
[0m23:21:22.659635 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:21:22.661411 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'use_experimental_parser': 'False', 'quiet': 'False', 'partial_parse': 'True', 'log_format': 'default', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'static_parser': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None', 'write_json': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'target_path': 'None', 'invocation_command': 'dbt run'}
[0m23:21:22.810842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c9bc1669-5e82-46e9-a484-9039dbee3f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502d21b790>]}
[0m23:21:22.864541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c9bc1669-5e82-46e9-a484-9039dbee3f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502fe0ac50>]}
[0m23:21:22.867751 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:21:22.995141 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:21:24.871015 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:21:24.873001 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:21:24.907608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c9bc1669-5e82-46e9-a484-9039dbee3f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502b5d5950>]}
[0m23:21:25.015690 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:25.023084 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:25.057698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c9bc1669-5e82-46e9-a484-9039dbee3f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502bde93d0>]}
[0m23:21:25.059484 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:21:25.061473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c9bc1669-5e82-46e9-a484-9039dbee3f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502ad764d0>]}
[0m23:21:25.065343 [info ] [MainThread]: 
[0m23:21:25.066877 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:21:25.068325 [info ] [MainThread]: 
[0m23:21:25.069956 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:21:25.073089 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:21:25.196005 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:21:25.198062 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:21:25.199158 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:21:25.215723 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.016 seconds
[0m23:21:25.218092 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:21:25.220842 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:21:25.229247 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:25.237468 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:21:25.244057 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:25.259220 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:21:25.261849 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:25.263553 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:21:25.275187 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.010 seconds
[0m23:21:25.278445 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:21:25.280199 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:21:25.287605 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:25.288887 [debug] [MainThread]: On master: BEGIN
[0m23:21:25.290059 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:21:25.302619 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:21:25.304267 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:25.305847 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:21:25.316008 [debug] [MainThread]: SQL status: SELECT 1 in 0.009 seconds
[0m23:21:25.319216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c9bc1669-5e82-46e9-a484-9039dbee3f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502bdedbd0>]}
[0m23:21:25.320895 [debug] [MainThread]: On master: ROLLBACK
[0m23:21:25.322604 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:25.324064 [debug] [MainThread]: On master: BEGIN
[0m23:21:25.326931 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:21:25.328333 [debug] [MainThread]: On master: COMMIT
[0m23:21:25.329433 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:25.330508 [debug] [MainThread]: On master: COMMIT
[0m23:21:25.332009 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:25.333071 [debug] [MainThread]: On master: Close
[0m23:21:25.341017 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:21:25.342990 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:21:25.344508 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:21:25.345707 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:21:25.361817 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:25.374271 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:21:25.401259 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:25.413528 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:25.414765 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:21:25.415746 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:25.427321 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:21:25.429378 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:25.432610 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:21:25.442005 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m23:21:25.450022 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:25.451076 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:21:25.452915 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:21:25.457861 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:25.459321 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:21:25.461494 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:21:25.471932 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:25.474327 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:25.476064 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:25.480937 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:21:25.485957 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:21:25.490316 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:25.497066 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:21:25.506829 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m23:21:25.513295 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:21:25.517076 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c9bc1669-5e82-46e9-a484-9039dbee3f99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502d400950>]}
[0m23:21:25.519530 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.17s]
[0m23:21:25.522392 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:21:25.527895 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:25.530472 [debug] [MainThread]: On master: BEGIN
[0m23:21:25.532848 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:21:25.548886 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m23:21:25.551554 [debug] [MainThread]: On master: COMMIT
[0m23:21:25.553646 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:25.555611 [debug] [MainThread]: On master: COMMIT
[0m23:21:25.557946 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:25.561061 [debug] [MainThread]: On master: Close
[0m23:21:25.565167 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:21:25.567391 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:21:25.569636 [info ] [MainThread]: 
[0m23:21:25.572288 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.50 seconds (0.50s).
[0m23:21:25.574770 [debug] [MainThread]: Command end result
[0m23:21:25.660112 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:25.669376 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:25.683994 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:21:25.685265 [info ] [MainThread]: 
[0m23:21:25.687288 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:21:25.689104 [info ] [MainThread]: 
[0m23:21:25.690930 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:21:25.693279 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.123558, "process_in_blocks": "0", "process_kernel_time": 0.487546, "process_mem_max_rss": "127812", "process_out_blocks": "0", "process_user_time": 1.783608}
[0m23:21:25.695408 [debug] [MainThread]: Command `dbt run` succeeded at 23:21:25.695112 after 3.13 seconds
[0m23:21:25.696923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502d094390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b502d096610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b50319af810>]}
[0m23:21:25.698266 [debug] [MainThread]: Flushing usage events
[0m23:21:26.437636 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:21:28.873947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e6c7f25d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e6c7f2810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e6c7f1e50>]}


============================== 23:21:28.884745 | 23b7b3ff-2735-4842-9b7c-b6d4a81a9a00 ==============================
[0m23:21:28.884745 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:21:28.886573 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'log_format': 'default', 'printer_width': '80', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'profiles_dir': '/usr/app/dbt/dbt', 'fail_fast': 'False', 'log_cache_events': 'False', 'write_json': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'empty': 'False'}
[0m23:21:29.033146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '23b7b3ff-2735-4842-9b7c-b6d4a81a9a00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e6c969910>]}
[0m23:21:29.082402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '23b7b3ff-2735-4842-9b7c-b6d4a81a9a00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e6f508310>]}
[0m23:21:29.084697 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:21:29.192250 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:21:30.679897 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:21:30.680807 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:21:30.712230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '23b7b3ff-2735-4842-9b7c-b6d4a81a9a00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e6b307950>]}
[0m23:21:30.803311 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:30.810177 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:30.852675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '23b7b3ff-2735-4842-9b7c-b6d4a81a9a00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e6bb75410>]}
[0m23:21:30.855405 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:21:30.856840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23b7b3ff-2735-4842-9b7c-b6d4a81a9a00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e6a7a6590>]}
[0m23:21:30.859152 [info ] [MainThread]: 
[0m23:21:30.860155 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:21:30.861228 [info ] [MainThread]: 
[0m23:21:30.862360 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:21:30.864093 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:21:30.961711 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:21:30.969620 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:21:30.972239 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:21:31.002940 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.030 seconds
[0m23:21:31.008327 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:21:31.012935 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:21:31.023002 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:31.025118 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:21:31.027185 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:31.041926 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:21:31.045005 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:31.046576 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:21:31.056034 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.008 seconds
[0m23:21:31.060009 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:21:31.061903 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:21:31.071170 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:31.073273 [debug] [MainThread]: On master: BEGIN
[0m23:21:31.075730 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:21:31.087889 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m23:21:31.089805 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:31.091748 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:21:31.099716 [debug] [MainThread]: SQL status: SELECT 1 in 0.006 seconds
[0m23:21:31.102765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23b7b3ff-2735-4842-9b7c-b6d4a81a9a00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e6bb46310>]}
[0m23:21:31.104581 [debug] [MainThread]: On master: ROLLBACK
[0m23:21:31.106463 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:31.108365 [debug] [MainThread]: On master: BEGIN
[0m23:21:31.109928 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:21:31.111086 [debug] [MainThread]: On master: COMMIT
[0m23:21:31.112149 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:31.113305 [debug] [MainThread]: On master: COMMIT
[0m23:21:31.114824 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:31.116059 [debug] [MainThread]: On master: Close
[0m23:21:31.139406 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:21:31.156535 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:21:31.172211 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:21:31.174616 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:21:31.203605 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:31.230508 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:21:31.271664 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:31.294934 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:31.297392 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:21:31.298736 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:31.311765 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:21:31.313585 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:31.315129 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:21:31.328226 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m23:21:31.336709 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:31.338695 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:21:31.341400 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:21:31.348971 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:31.350366 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:21:31.353012 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:21:31.372206 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:31.373891 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:31.377715 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:31.396845 [debug] [Thread-1 (]: SQL status: COMMIT in 0.016 seconds
[0m23:21:31.404027 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:21:31.413412 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:31.418001 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:21:31.436893 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.015 seconds
[0m23:21:31.442278 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:21:31.445790 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23b7b3ff-2735-4842-9b7c-b6d4a81a9a00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e6950cb10>]}
[0m23:21:31.447868 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.27s]
[0m23:21:31.449912 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:21:31.453706 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:31.454944 [debug] [MainThread]: On master: BEGIN
[0m23:21:31.455968 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:21:31.466230 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m23:21:31.492315 [debug] [MainThread]: On master: COMMIT
[0m23:21:31.494971 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:31.496561 [debug] [MainThread]: On master: COMMIT
[0m23:21:31.498824 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:31.500484 [debug] [MainThread]: On master: Close
[0m23:21:31.502525 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:21:31.506355 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:21:31.507891 [info ] [MainThread]: 
[0m23:21:31.509543 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.65 seconds (0.65s).
[0m23:21:31.511521 [debug] [MainThread]: Command end result
[0m23:21:31.574488 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:31.581842 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:31.592014 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:21:31.593254 [info ] [MainThread]: 
[0m23:21:31.594581 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:21:31.595806 [info ] [MainThread]: 
[0m23:21:31.596918 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:21:31.598567 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.7895212, "process_in_blocks": "0", "process_kernel_time": 0.427992, "process_mem_max_rss": "127204", "process_out_blocks": "0", "process_user_time": 1.860121}
[0m23:21:31.599599 [debug] [MainThread]: Command `dbt run` succeeded at 23:21:31.599491 after 2.79 seconds
[0m23:21:31.600539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e71303910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e710bacd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788e710bab90>]}
[0m23:21:31.601575 [debug] [MainThread]: Flushing usage events
[0m23:21:32.185311 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:21:35.286081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d8e47310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d8e2f790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d8e46f90>]}


============================== 23:21:35.298150 | 21a582a0-7583-49d8-8d33-3b33bc65ce45 ==============================
[0m23:21:35.298150 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:21:35.300381 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'use_colors': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'write_json': 'True', 'debug': 'False', 'log_format': 'default', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'empty': 'False', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'quiet': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'printer_width': '80', 'cache_selected_only': 'False', 'use_experimental_parser': 'False'}
[0m23:21:35.508370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '21a582a0-7583-49d8-8d33-3b33bc65ce45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d6162250>]}
[0m23:21:35.565040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '21a582a0-7583-49d8-8d33-3b33bc65ce45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d8e568d0>]}
[0m23:21:35.569009 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:21:35.743762 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:21:37.544838 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:21:37.546029 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:21:37.580458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '21a582a0-7583-49d8-8d33-3b33bc65ce45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d552f950>]}
[0m23:21:37.692365 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:37.699751 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:37.732389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '21a582a0-7583-49d8-8d33-3b33bc65ce45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d3d22790>]}
[0m23:21:37.733569 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:21:37.735226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '21a582a0-7583-49d8-8d33-3b33bc65ce45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d55d8d50>]}
[0m23:21:37.737768 [info ] [MainThread]: 
[0m23:21:37.738802 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:21:37.739699 [info ] [MainThread]: 
[0m23:21:37.740832 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:21:37.742473 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:21:37.869711 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:21:37.872081 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:21:37.874435 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:21:37.893673 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.019 seconds
[0m23:21:37.915365 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:21:37.924380 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:21:37.938460 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:37.941146 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:21:37.944010 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:37.959682 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m23:21:37.963180 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:37.965751 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:21:37.978728 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.010 seconds
[0m23:21:37.983365 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:21:37.985618 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:21:37.994392 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:37.997012 [debug] [MainThread]: On master: BEGIN
[0m23:21:37.999409 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:21:38.013032 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:21:38.014684 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:38.016271 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:21:38.026534 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m23:21:38.030077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '21a582a0-7583-49d8-8d33-3b33bc65ce45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d3db6650>]}
[0m23:21:38.031863 [debug] [MainThread]: On master: ROLLBACK
[0m23:21:38.033591 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:38.034893 [debug] [MainThread]: On master: BEGIN
[0m23:21:38.036830 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:21:38.038362 [debug] [MainThread]: On master: COMMIT
[0m23:21:38.039443 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:38.040486 [debug] [MainThread]: On master: COMMIT
[0m23:21:38.041762 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:38.042809 [debug] [MainThread]: On master: Close
[0m23:21:38.051037 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:21:38.052610 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:21:38.054433 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:21:38.055466 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:21:38.077030 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:38.109611 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:21:38.162079 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:38.183805 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:38.185140 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:21:38.186391 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:38.199217 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:21:38.200712 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:38.202164 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:21:38.215267 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m23:21:38.225079 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:38.226456 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:21:38.231254 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:21:38.237050 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:38.238514 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:21:38.241717 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:21:38.262451 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:38.264666 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:38.266118 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:38.279620 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m23:21:38.288096 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:21:38.297098 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:38.298662 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:21:38.307062 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.007 seconds
[0m23:21:38.320223 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:21:38.323202 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21a582a0-7583-49d8-8d33-3b33bc65ce45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d552f910>]}
[0m23:21:38.325285 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.27s]
[0m23:21:38.327527 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:21:38.333654 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:38.334766 [debug] [MainThread]: On master: BEGIN
[0m23:21:38.335788 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:21:38.349672 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:21:38.355935 [debug] [MainThread]: On master: COMMIT
[0m23:21:38.360033 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:38.365280 [debug] [MainThread]: On master: COMMIT
[0m23:21:38.371087 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:38.372735 [debug] [MainThread]: On master: Close
[0m23:21:38.374642 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:21:38.376035 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:21:38.377341 [info ] [MainThread]: 
[0m23:21:38.379139 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.64 seconds (0.64s).
[0m23:21:38.381266 [debug] [MainThread]: Command end result
[0m23:21:38.515857 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:38.523857 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:38.535293 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:21:38.536206 [info ] [MainThread]: 
[0m23:21:38.537487 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:21:38.538545 [info ] [MainThread]: 
[0m23:21:38.539596 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:21:38.541173 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.3495486, "process_in_blocks": "0", "process_kernel_time": 0.527825, "process_mem_max_rss": "127564", "process_out_blocks": "0", "process_user_time": 2.053116}
[0m23:21:38.542257 [debug] [MainThread]: Command `dbt run` succeeded at 23:21:38.542072 after 3.35 seconds
[0m23:21:38.543288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82d6454c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82da936d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c82da9e38d0>]}
[0m23:21:38.545006 [debug] [MainThread]: Flushing usage events
[0m23:21:39.584887 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:21:43.545700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d797cd50090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d797d0789d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d797ccffb10>]}


============================== 23:21:43.552315 | 93659782-90cc-439b-833a-32d647c8196e ==============================
[0m23:21:43.552315 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:21:43.553683 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/usr/app/dbt/dbt', 'warn_error': 'None', 'cache_selected_only': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'partial_parse': 'True', 'log_format': 'default', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'quiet': 'False', 'printer_width': '80', 'target_path': 'None'}
[0m23:21:43.706194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '93659782-90cc-439b-833a-32d647c8196e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d797cd861d0>]}
[0m23:21:43.760881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '93659782-90cc-439b-833a-32d647c8196e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d797fa7a8d0>]}
[0m23:21:43.765314 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:21:43.921308 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:21:46.280615 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:21:46.282246 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:21:46.320237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '93659782-90cc-439b-833a-32d647c8196e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d797c15a990>]}
[0m23:21:46.413113 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:46.422344 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:46.469587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '93659782-90cc-439b-833a-32d647c8196e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d797b540890>]}
[0m23:21:46.471865 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:21:46.474210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93659782-90cc-439b-833a-32d647c8196e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d797a990850>]}
[0m23:21:46.478203 [info ] [MainThread]: 
[0m23:21:46.481777 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:21:46.483749 [info ] [MainThread]: 
[0m23:21:46.486725 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:21:46.490512 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:21:46.655766 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:21:46.658927 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:21:46.661421 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:21:46.680419 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.019 seconds
[0m23:21:46.682965 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:21:46.685708 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:21:46.692867 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:46.693989 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:21:46.694974 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:46.703270 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m23:21:46.704441 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:46.705575 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:21:46.711491 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:21:46.713363 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:21:46.714460 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:21:46.721447 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:46.722538 [debug] [MainThread]: On master: BEGIN
[0m23:21:46.723377 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:21:46.732179 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m23:21:46.733228 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:46.734194 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:21:46.742075 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m23:21:46.746144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93659782-90cc-439b-833a-32d647c8196e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d7979cded50>]}
[0m23:21:46.747017 [debug] [MainThread]: On master: ROLLBACK
[0m23:21:46.747885 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:46.748573 [debug] [MainThread]: On master: BEGIN
[0m23:21:46.749656 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:21:46.750622 [debug] [MainThread]: On master: COMMIT
[0m23:21:46.751250 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:46.751799 [debug] [MainThread]: On master: COMMIT
[0m23:21:46.752534 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:46.753309 [debug] [MainThread]: On master: Close
[0m23:21:46.763050 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:21:46.765903 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:21:46.770501 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:21:46.772361 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:21:46.787772 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:46.797608 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:21:46.827571 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:46.890942 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:46.893242 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:21:46.895307 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:46.914058 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m23:21:46.915657 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:46.917109 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:21:46.937985 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.019 seconds
[0m23:21:46.952112 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:46.957425 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:21:46.963676 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:21:46.973464 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:46.974869 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:21:46.977790 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:21:46.997414 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:46.999017 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:47.000582 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:47.003738 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:21:47.011093 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:21:47.016183 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:47.017961 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:21:47.032996 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.012 seconds
[0m23:21:47.037410 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:21:47.041921 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93659782-90cc-439b-833a-32d647c8196e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d797c12e5d0>]}
[0m23:21:47.044970 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.27s]
[0m23:21:47.047346 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:21:47.051643 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:47.053788 [debug] [MainThread]: On master: BEGIN
[0m23:21:47.055422 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:21:47.067715 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m23:21:47.070572 [debug] [MainThread]: On master: COMMIT
[0m23:21:47.071792 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:47.072956 [debug] [MainThread]: On master: COMMIT
[0m23:21:47.080015 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:47.082869 [debug] [MainThread]: On master: Close
[0m23:21:47.087430 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:21:47.089257 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:21:47.090944 [info ] [MainThread]: 
[0m23:21:47.092362 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m23:21:47.094320 [debug] [MainThread]: Command end result
[0m23:21:47.197447 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:47.206162 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:47.215477 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:21:47.216380 [info ] [MainThread]: 
[0m23:21:47.217665 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:21:47.218664 [info ] [MainThread]: 
[0m23:21:47.220573 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:21:47.222188 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.7727127, "process_in_blocks": "0", "process_kernel_time": 0.585902, "process_mem_max_rss": "127552", "process_out_blocks": "0", "process_user_time": 1.97486}
[0m23:21:47.223095 [debug] [MainThread]: Command `dbt run` succeeded at 23:21:47.223003 after 3.77 seconds
[0m23:21:47.223963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d79816078d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d798155ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d798155add0>]}
[0m23:21:47.224797 [debug] [MainThread]: Flushing usage events
[0m23:21:47.876861 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:21:53.284345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857fdac910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857fdaf1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857fdae490>]}


============================== 23:21:53.299097 | e7826d65-b91a-4208-81be-b2aa8d7bffc8 ==============================
[0m23:21:53.299097 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:21:53.300381 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'empty': 'False', 'debug': 'False', 'target_path': 'None', 'no_print': 'None', 'partial_parse': 'True', 'log_path': '/usr/app/dbt/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'quiet': 'False', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'version_check': 'True', 'introspect': 'True', 'use_colors': 'True', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'static_parser': 'True', 'profiles_dir': '/usr/app/dbt/dbt', 'printer_width': '80'}
[0m23:21:53.474898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7826d65-b91a-4208-81be-b2aa8d7bffc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857f16e690>]}
[0m23:21:53.530631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e7826d65-b91a-4208-81be-b2aa8d7bffc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857f4ee810>]}
[0m23:21:53.532213 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:21:53.719081 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:21:55.292732 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:21:55.295334 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:21:55.349257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e7826d65-b91a-4208-81be-b2aa8d7bffc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857e93c0d0>]}
[0m23:21:55.447241 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:55.453474 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:55.503636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e7826d65-b91a-4208-81be-b2aa8d7bffc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857dd140d0>]}
[0m23:21:55.505895 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:21:55.507835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7826d65-b91a-4208-81be-b2aa8d7bffc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857dd86c90>]}
[0m23:21:55.510864 [info ] [MainThread]: 
[0m23:21:55.515374 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:21:55.517441 [info ] [MainThread]: 
[0m23:21:55.519624 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:21:55.523321 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:21:55.671461 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:21:55.673614 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:21:55.675374 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:21:55.694176 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.019 seconds
[0m23:21:55.699215 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:21:55.702897 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:21:55.711521 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:55.713345 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:21:55.715584 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:55.724850 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m23:21:55.726926 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:21:55.728388 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:21:55.735997 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m23:21:55.740206 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:21:55.743246 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:21:55.752811 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:55.754809 [debug] [MainThread]: On master: BEGIN
[0m23:21:55.756381 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:21:55.768646 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m23:21:55.770862 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:55.772940 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:21:55.784058 [debug] [MainThread]: SQL status: SELECT 1 in 0.009 seconds
[0m23:21:55.788010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7826d65-b91a-4208-81be-b2aa8d7bffc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857d930490>]}
[0m23:21:55.790117 [debug] [MainThread]: On master: ROLLBACK
[0m23:21:55.792256 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:55.794047 [debug] [MainThread]: On master: BEGIN
[0m23:21:55.798478 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:21:55.800305 [debug] [MainThread]: On master: COMMIT
[0m23:21:55.801974 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:55.803405 [debug] [MainThread]: On master: COMMIT
[0m23:21:55.805034 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:55.806512 [debug] [MainThread]: On master: Close
[0m23:21:55.812959 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:21:55.815317 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:21:55.817527 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:21:55.819166 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:21:55.834602 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:55.845228 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:21:55.870385 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:21:55.887807 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:55.890537 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:21:55.892781 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:55.903102 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m23:21:55.904620 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:55.906246 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:21:55.926554 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.019 seconds
[0m23:21:55.935433 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:55.937082 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:21:55.940404 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:21:55.946081 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:55.947431 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:21:55.950494 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:21:55.963430 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:55.965218 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:55.966571 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:21:55.980079 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m23:21:55.988056 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:21:55.993960 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:21:55.996051 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:21:56.011489 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.013 seconds
[0m23:21:56.019472 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:21:56.022688 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7826d65-b91a-4208-81be-b2aa8d7bffc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857cc61b10>]}
[0m23:21:56.025352 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.20s]
[0m23:21:56.027101 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:21:56.031819 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:56.033227 [debug] [MainThread]: On master: BEGIN
[0m23:21:56.034103 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:21:56.057340 [debug] [MainThread]: SQL status: BEGIN in 0.023 seconds
[0m23:21:56.059777 [debug] [MainThread]: On master: COMMIT
[0m23:21:56.061927 [debug] [MainThread]: Using postgres connection "master"
[0m23:21:56.063992 [debug] [MainThread]: On master: COMMIT
[0m23:21:56.065792 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:21:56.067554 [debug] [MainThread]: On master: Close
[0m23:21:56.069504 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:21:56.071308 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:21:56.073813 [info ] [MainThread]: 
[0m23:21:56.076156 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.55 seconds (0.55s).
[0m23:21:56.078684 [debug] [MainThread]: Command end result
[0m23:21:56.160494 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:21:56.171715 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:21:56.188766 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:21:56.189998 [info ] [MainThread]: 
[0m23:21:56.191298 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:21:56.192607 [info ] [MainThread]: 
[0m23:21:56.194147 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:21:56.197007 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.980447, "process_in_blocks": "0", "process_kernel_time": 0.48502, "process_mem_max_rss": "127484", "process_out_blocks": "0", "process_user_time": 2.044016}
[0m23:21:56.198957 [debug] [MainThread]: Command `dbt run` succeeded at 23:21:56.198781 after 2.98 seconds
[0m23:21:56.200377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857fdc8950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7785846bb890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77857cbd6a90>]}
[0m23:21:56.202046 [debug] [MainThread]: Flushing usage events
[0m23:21:56.832313 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:22:05.434831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4cc96ee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4cc9761d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4cc91ac10>]}


============================== 23:22:05.442781 | 97f453d4-ba0b-4343-b0db-637cd88e34bf ==============================
[0m23:22:05.442781 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:22:05.444031 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'write_json': 'True', 'debug': 'False', 'quiet': 'False', 'use_colors': 'True', 'target_path': 'None', 'printer_width': '80', 'profiles_dir': '/usr/app/dbt/dbt', 'fail_fast': 'False', 'no_print': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'introspect': 'True', 'cache_selected_only': 'False', 'static_parser': 'True', 'warn_error': 'None', 'invocation_command': 'dbt run', 'empty': 'False'}
[0m23:22:05.599048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '97f453d4-ba0b-4343-b0db-637cd88e34bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4cf1bbdd0>]}
[0m23:22:05.644515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '97f453d4-ba0b-4343-b0db-637cd88e34bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4cf67cb10>]}
[0m23:22:05.648408 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:22:05.881081 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:22:08.170799 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:22:08.172243 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:22:08.207893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '97f453d4-ba0b-4343-b0db-637cd88e34bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4cb10b9d0>]}
[0m23:22:08.330248 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:22:08.337631 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:22:08.372256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '97f453d4-ba0b-4343-b0db-637cd88e34bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4cb124c90>]}
[0m23:22:08.373755 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:22:08.374935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '97f453d4-ba0b-4343-b0db-637cd88e34bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4ca59ecd0>]}
[0m23:22:08.377870 [info ] [MainThread]: 
[0m23:22:08.379575 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:22:08.380760 [info ] [MainThread]: 
[0m23:22:08.382149 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:22:08.384194 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:22:08.533046 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:22:08.534517 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:22:08.536334 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:22:08.547813 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.011 seconds
[0m23:22:08.550241 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:22:08.552887 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:22:08.560916 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:22:08.563145 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:22:08.564283 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:22:08.573552 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m23:22:08.575001 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:22:08.576051 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:22:08.582639 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m23:22:08.585205 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:22:08.587336 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:22:08.594968 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:08.597056 [debug] [MainThread]: On master: BEGIN
[0m23:22:08.598949 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:22:08.608167 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m23:22:08.609857 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:08.611841 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:22:08.618505 [debug] [MainThread]: SQL status: SELECT 1 in 0.005 seconds
[0m23:22:08.621682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '97f453d4-ba0b-4343-b0db-637cd88e34bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4ca14a790>]}
[0m23:22:08.622819 [debug] [MainThread]: On master: ROLLBACK
[0m23:22:08.624333 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:08.625540 [debug] [MainThread]: On master: BEGIN
[0m23:22:08.627710 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:22:08.629147 [debug] [MainThread]: On master: COMMIT
[0m23:22:08.630232 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:08.632148 [debug] [MainThread]: On master: COMMIT
[0m23:22:08.633525 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:22:08.634887 [debug] [MainThread]: On master: Close
[0m23:22:08.641766 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:22:08.644524 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:22:08.646365 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:22:08.648725 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:22:08.668402 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:22:08.681193 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:22:08.717714 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:22:08.733570 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:08.735022 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:22:08.736724 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:22:08.749849 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:22:08.751565 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:08.752871 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:22:08.763148 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m23:22:08.773033 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:08.774241 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:22:08.777026 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:22:08.784629 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:08.786292 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:22:08.789209 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:22:08.806538 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:22:08.808380 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:08.809997 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:22:08.815179 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:22:08.826056 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:22:08.833887 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:08.835956 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:22:08.843927 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m23:22:08.849293 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:22:08.853425 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '97f453d4-ba0b-4343-b0db-637cd88e34bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4c96c8890>]}
[0m23:22:08.855872 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.21s]
[0m23:22:08.857843 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:22:08.862434 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:08.864618 [debug] [MainThread]: On master: BEGIN
[0m23:22:08.867001 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:22:08.883321 [debug] [MainThread]: SQL status: BEGIN in 0.016 seconds
[0m23:22:08.887347 [debug] [MainThread]: On master: COMMIT
[0m23:22:08.889228 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:08.891033 [debug] [MainThread]: On master: COMMIT
[0m23:22:08.893623 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:22:08.896083 [debug] [MainThread]: On master: Close
[0m23:22:08.898669 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:22:08.900624 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:22:08.902486 [info ] [MainThread]: 
[0m23:22:08.904658 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m23:22:08.914457 [debug] [MainThread]: Command end result
[0m23:22:08.994451 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:22:09.004724 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:22:09.022313 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:22:09.024072 [info ] [MainThread]: 
[0m23:22:09.025982 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:22:09.027738 [info ] [MainThread]: 
[0m23:22:09.030818 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:22:09.033604 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.6764722, "process_in_blocks": "0", "process_kernel_time": 0.540809, "process_mem_max_rss": "128016", "process_out_blocks": "0", "process_user_time": 1.989848}
[0m23:22:09.035364 [debug] [MainThread]: Command `dbt run` succeeded at 23:22:09.035178 after 3.68 seconds
[0m23:22:09.037054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4cc91a650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4cc91af10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d4d1483910>]}
[0m23:22:09.038663 [debug] [MainThread]: Flushing usage events
[0m23:22:09.613998 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:22:24.487065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed0917ac150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed0917af090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed09180e490>]}


============================== 23:22:24.497177 | 57fd97bd-b604-460c-9c68-cdfaf7e91a58 ==============================
[0m23:22:24.497177 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:22:24.498813 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'fail_fast': 'False', 'static_parser': 'True', 'quiet': 'False', 'profiles_dir': '/usr/app/dbt/dbt', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'debug': 'False', 'printer_width': '80', 'use_experimental_parser': 'False', 'version_check': 'True', 'no_print': 'None', 'invocation_command': 'dbt run', 'empty': 'False', 'log_path': '/usr/app/dbt/dbt/logs', 'partial_parse': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'use_colors': 'True', 'cache_selected_only': 'False'}
[0m23:22:24.630074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '57fd97bd-b604-460c-9c68-cdfaf7e91a58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed090b230d0>]}
[0m23:22:24.670753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '57fd97bd-b604-460c-9c68-cdfaf7e91a58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed09453a690>]}
[0m23:22:24.673395 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:22:24.865956 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:22:26.868316 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:22:26.873696 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:22:26.914677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '57fd97bd-b604-460c-9c68-cdfaf7e91a58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed0907ee350>]}
[0m23:22:27.009200 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:22:27.016439 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:22:27.051739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '57fd97bd-b604-460c-9c68-cdfaf7e91a58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed08f714410>]}
[0m23:22:27.054928 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:22:27.056024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57fd97bd-b604-460c-9c68-cdfaf7e91a58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed08f784810>]}
[0m23:22:27.058339 [info ] [MainThread]: 
[0m23:22:27.059506 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:22:27.060545 [info ] [MainThread]: 
[0m23:22:27.061782 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:22:27.063865 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:22:27.173288 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:22:27.176282 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:22:27.178169 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:22:27.195248 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.017 seconds
[0m23:22:27.198500 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:22:27.207219 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:22:27.217412 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:22:27.221887 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:22:27.226284 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:22:27.245214 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m23:22:27.247072 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:22:27.249506 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:22:27.259060 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.008 seconds
[0m23:22:27.262977 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:22:27.265384 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:22:27.274268 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:27.279184 [debug] [MainThread]: On master: BEGIN
[0m23:22:27.280820 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:22:27.295290 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:22:27.299690 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:27.301559 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:22:27.312046 [debug] [MainThread]: SQL status: SELECT 1 in 0.009 seconds
[0m23:22:27.314776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57fd97bd-b604-460c-9c68-cdfaf7e91a58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed08e7d3950>]}
[0m23:22:27.316517 [debug] [MainThread]: On master: ROLLBACK
[0m23:22:27.317953 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:27.319140 [debug] [MainThread]: On master: BEGIN
[0m23:22:27.320628 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:22:27.321800 [debug] [MainThread]: On master: COMMIT
[0m23:22:27.322830 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:27.323782 [debug] [MainThread]: On master: COMMIT
[0m23:22:27.325137 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:22:27.326153 [debug] [MainThread]: On master: Close
[0m23:22:27.335685 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:22:27.337496 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:22:27.339084 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:22:27.343570 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:22:27.361737 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:22:27.379351 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:22:27.404930 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:22:27.460741 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:27.463627 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:22:27.467287 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:22:27.479964 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:22:27.483904 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:27.488024 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:22:27.503611 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m23:22:27.518045 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:27.521645 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:22:27.526882 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:22:27.532003 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:27.536462 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:22:27.543865 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:22:27.564802 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:22:27.570295 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:27.575297 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:22:27.584169 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:22:27.598892 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:22:27.610900 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:27.617239 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:22:27.635528 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.007 seconds
[0m23:22:27.643978 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:22:27.650803 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57fd97bd-b604-460c-9c68-cdfaf7e91a58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed08e6a8bd0>]}
[0m23:22:27.658114 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.31s]
[0m23:22:27.662687 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:22:27.668051 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:27.671558 [debug] [MainThread]: On master: BEGIN
[0m23:22:27.672983 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:22:27.688116 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m23:22:27.689710 [debug] [MainThread]: On master: COMMIT
[0m23:22:27.690987 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:27.692032 [debug] [MainThread]: On master: COMMIT
[0m23:22:27.693360 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:22:27.696139 [debug] [MainThread]: On master: Close
[0m23:22:27.698239 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:22:27.700019 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:22:27.701662 [info ] [MainThread]: 
[0m23:22:27.707169 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.64 seconds (0.64s).
[0m23:22:27.708936 [debug] [MainThread]: Command end result
[0m23:22:27.874077 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:22:27.884616 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:22:27.901328 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:22:27.902833 [info ] [MainThread]: 
[0m23:22:27.904759 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:22:27.906534 [info ] [MainThread]: 
[0m23:22:27.908428 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:22:27.910941 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5394034, "process_in_blocks": "0", "process_kernel_time": 0.515096, "process_mem_max_rss": "127524", "process_out_blocks": "0", "process_user_time": 1.798812}
[0m23:22:27.913632 [debug] [MainThread]: Command `dbt run` succeeded at 23:22:27.913458 after 3.54 seconds
[0m23:22:27.915813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed0960bb890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed0960d6750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed0960d7610>]}
[0m23:22:27.917782 [debug] [MainThread]: Flushing usage events
[0m23:22:28.808987 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:22:56.454538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cefc10350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cefc10990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cef8aa650>]}


============================== 23:22:56.463003 | 87dde556-782a-4980-8194-842d7ddb7f4b ==============================
[0m23:22:56.463003 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:22:56.465118 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/usr/app/dbt/dbt', 'static_parser': 'True', 'log_format': 'default', 'debug': 'False', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'printer_width': '80', 'use_colors': 'True', 'partial_parse': 'True', 'empty': 'False', 'invocation_command': 'dbt run', 'log_path': '/usr/app/dbt/dbt/logs', 'no_print': 'None'}
[0m23:22:56.617068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '87dde556-782a-4980-8194-842d7ddb7f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cee9649d0>]}
[0m23:22:56.667055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '87dde556-782a-4980-8194-842d7ddb7f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cf260e390>]}
[0m23:22:56.673385 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:22:56.831716 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:22:57.867328 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:22:57.868892 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:22:57.902011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '87dde556-782a-4980-8194-842d7ddb7f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cef8aac10>]}
[0m23:22:58.049007 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:22:58.056201 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:22:58.101087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '87dde556-782a-4980-8194-842d7ddb7f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765ced591410>]}
[0m23:22:58.103420 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:22:58.104720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87dde556-782a-4980-8194-842d7ddb7f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cee96fb50>]}
[0m23:22:58.107066 [info ] [MainThread]: 
[0m23:22:58.108383 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:22:58.109450 [info ] [MainThread]: 
[0m23:22:58.110658 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:22:58.112393 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:22:58.222789 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:22:58.228422 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:22:58.230742 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:22:58.257170 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.026 seconds
[0m23:22:58.263096 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:22:58.267416 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:22:58.303541 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:22:58.306149 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:22:58.308394 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:22:58.323817 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m23:22:58.329321 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:22:58.333099 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:22:58.345977 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.009 seconds
[0m23:22:58.350273 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:22:58.354911 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:22:58.364047 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:58.368436 [debug] [MainThread]: On master: BEGIN
[0m23:22:58.370646 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:22:58.385290 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m23:22:58.390245 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:58.392389 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:22:58.404443 [debug] [MainThread]: SQL status: SELECT 1 in 0.010 seconds
[0m23:22:58.407158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87dde556-782a-4980-8194-842d7ddb7f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cee5fadd0>]}
[0m23:22:58.408536 [debug] [MainThread]: On master: ROLLBACK
[0m23:22:58.410052 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:58.411331 [debug] [MainThread]: On master: BEGIN
[0m23:22:58.412733 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:22:58.413733 [debug] [MainThread]: On master: COMMIT
[0m23:22:58.414624 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:58.415720 [debug] [MainThread]: On master: COMMIT
[0m23:22:58.417009 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:22:58.418418 [debug] [MainThread]: On master: Close
[0m23:22:58.425604 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:22:58.426889 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:22:58.428013 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:22:58.428960 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:22:58.449155 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:22:58.461793 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:22:58.486000 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:22:58.497527 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:58.498351 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:22:58.499309 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:22:58.510941 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:22:58.512089 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:58.512921 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:22:58.521513 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m23:22:58.526853 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:58.527741 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:22:58.529464 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:22:58.533355 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:58.534503 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:22:58.538609 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:22:58.553098 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:22:58.555038 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:58.556971 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:22:58.560330 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:22:58.568686 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:22:58.573947 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:22:58.574873 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:22:58.580276 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m23:22:58.583968 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:22:58.587552 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87dde556-782a-4980-8194-842d7ddb7f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cec72b590>]}
[0m23:22:58.588833 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.16s]
[0m23:22:58.590019 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:22:58.592421 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:58.593314 [debug] [MainThread]: On master: BEGIN
[0m23:22:58.594256 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:22:58.602995 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m23:22:58.604219 [debug] [MainThread]: On master: COMMIT
[0m23:22:58.605033 [debug] [MainThread]: Using postgres connection "master"
[0m23:22:58.605771 [debug] [MainThread]: On master: COMMIT
[0m23:22:58.606708 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:22:58.607517 [debug] [MainThread]: On master: Close
[0m23:22:58.608473 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:22:58.609272 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:22:58.610110 [info ] [MainThread]: 
[0m23:22:58.611034 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.50 seconds (0.50s).
[0m23:22:58.612708 [debug] [MainThread]: Command end result
[0m23:22:58.664492 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:22:58.671178 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:22:58.679850 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:22:58.680807 [info ] [MainThread]: 
[0m23:22:58.681954 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:22:58.683285 [info ] [MainThread]: 
[0m23:22:58.685117 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:22:58.686429 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.3117805, "process_in_blocks": "0", "process_kernel_time": 0.393111, "process_mem_max_rss": "127652", "process_out_blocks": "0", "process_user_time": 1.809113}
[0m23:22:58.687400 [debug] [MainThread]: Command `dbt run` succeeded at 23:22:58.687313 after 2.31 seconds
[0m23:22:58.688201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cf4407910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cf41beb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765cf41bea50>]}
[0m23:22:58.689013 [debug] [MainThread]: Flushing usage events
[0m23:22:59.526024 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:23:52.623682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e48f6cc910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e48f72e490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e48fa5c4d0>]}


============================== 23:23:52.630201 | 37b3658d-631d-40c1-951d-0666018ca1e1 ==============================
[0m23:23:52.630201 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:23:52.632952 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'fail_fast': 'False', 'log_format': 'default', 'version_check': 'True', 'debug': 'False', 'static_parser': 'True', 'write_json': 'True', 'warn_error': 'None', 'log_path': '/usr/app/dbt/dbt/logs', 'profiles_dir': '/usr/app/dbt/dbt', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'empty': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'target_path': 'None'}
[0m23:23:52.797655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '37b3658d-631d-40c1-951d-0666018ca1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e48ed39d50>]}
[0m23:23:52.850023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '37b3658d-631d-40c1-951d-0666018ca1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e49242e750>]}
[0m23:23:52.855360 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m23:23:53.148137 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:23:54.861235 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:23:54.866904 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:23:54.905484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '37b3658d-631d-40c1-951d-0666018ca1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e48e5740d0>]}
[0m23:23:54.995791 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:23:55.001872 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:23:55.027726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '37b3658d-631d-40c1-951d-0666018ca1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e48d9557d0>]}
[0m23:23:55.028782 [info ] [MainThread]: Found 1 model, 2 data tests, 1 source, 738 macros
[0m23:23:55.029765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '37b3658d-631d-40c1-951d-0666018ca1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e491c63e50>]}
[0m23:23:55.031745 [info ] [MainThread]: 
[0m23:23:55.034823 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:23:55.035654 [info ] [MainThread]: 
[0m23:23:55.036752 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:23:55.038174 [debug] [ThreadPool]: Acquiring new postgres connection 'list_data_project_1'
[0m23:23:55.157472 [debug] [ThreadPool]: Using postgres connection "list_data_project_1"
[0m23:23:55.173660 [debug] [ThreadPool]: On list_data_project_1: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1"} */

    select distinct nspname from pg_namespace
  
[0m23:23:55.176268 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:23:55.216376 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.040 seconds
[0m23:23:55.220276 [debug] [ThreadPool]: On list_data_project_1: Close
[0m23:23:55.223465 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_data_project_1, now list_data_project_1_public)
[0m23:23:55.232786 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:23:55.234755 [debug] [ThreadPool]: On list_data_project_1_public: BEGIN
[0m23:23:55.236279 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:23:55.247157 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m23:23:55.249365 [debug] [ThreadPool]: Using postgres connection "list_data_project_1_public"
[0m23:23:55.251138 [debug] [ThreadPool]: On list_data_project_1_public: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "list_data_project_1_public"} */
select
      'data_project_1' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'data_project_1' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m23:23:55.260029 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.007 seconds
[0m23:23:55.262355 [debug] [ThreadPool]: On list_data_project_1_public: ROLLBACK
[0m23:23:55.263641 [debug] [ThreadPool]: On list_data_project_1_public: Close
[0m23:23:55.271422 [debug] [MainThread]: Using postgres connection "master"
[0m23:23:55.272963 [debug] [MainThread]: On master: BEGIN
[0m23:23:55.274185 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:23:55.284995 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m23:23:55.286492 [debug] [MainThread]: Using postgres connection "master"
[0m23:23:55.288012 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m23:23:55.299044 [debug] [MainThread]: SQL status: SELECT 1 in 0.010 seconds
[0m23:23:55.303488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '37b3658d-631d-40c1-951d-0666018ca1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e48d95a250>]}
[0m23:23:55.304988 [debug] [MainThread]: On master: ROLLBACK
[0m23:23:55.306375 [debug] [MainThread]: Using postgres connection "master"
[0m23:23:55.307460 [debug] [MainThread]: On master: BEGIN
[0m23:23:55.309133 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:23:55.310277 [debug] [MainThread]: On master: COMMIT
[0m23:23:55.311180 [debug] [MainThread]: Using postgres connection "master"
[0m23:23:55.312345 [debug] [MainThread]: On master: COMMIT
[0m23:23:55.313597 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:23:55.314478 [debug] [MainThread]: On master: Close
[0m23:23:55.324140 [debug] [Thread-1 (]: Began running node model.data_project_1.stg_air_quality_valencia
[0m23:23:55.325490 [info ] [Thread-1 (]: 1 of 1 START sql view model public.stg_air_quality_valencia .................... [RUN]
[0m23:23:55.326765 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_data_project_1_public, now model.data_project_1.stg_air_quality_valencia)
[0m23:23:55.327846 [debug] [Thread-1 (]: Began compiling node model.data_project_1.stg_air_quality_valencia
[0m23:23:55.346670 [debug] [Thread-1 (]: Writing injected SQL for node "model.data_project_1.stg_air_quality_valencia"
[0m23:23:55.356128 [debug] [Thread-1 (]: Began executing node model.data_project_1.stg_air_quality_valencia
[0m23:23:55.382686 [debug] [Thread-1 (]: Writing runtime sql for node "model.data_project_1.stg_air_quality_valencia"
[0m23:23:55.392556 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:23:55.393436 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: BEGIN
[0m23:23:55.394138 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:23:55.403465 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m23:23:55.404523 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:23:55.405440 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */

  create view "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp"
    
    
  as (
    -- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias. 
--1) DESPIVOTEAMOS:
--La tabla fuente(estaciones) tiene un formato ancho (wide), donde cada contaminante es una columna separada (so2, no2 ...)
--Necesitamos calcular promedios de forma genÃ©rica para cualquier contaminante, de modo que necesitamos un formato ancho (long) donde los contaminantes se apilan en filas. Esto lo conseguimos utilizando los UNION ALL.
-- Toma los datos directamente de la tabla fuente (estaciones) y los prepara para que se puedan consumir de forma sencilla en las capas intermedias.
WITH raw_data AS (
    SELECT
        objectid,
        nombre,
        direccion,
        tipozona,
        fecha_carg,
        so2,
        no2,
        o3,
        co,
        pm10,
        pm25,
        lon,
        lat
    FROM "data_project_1"."public"."estaciones"
),

unpivoted_data AS (

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'SO2' AS pollutant_type,
        so2 AS concentration_ug_m3
    FROM raw_data
    WHERE so2 IS NOT NULL AND so2 >= 0 AND so2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'NO2' AS pollutant_type,
        no2 AS concentration_ug_m3
    FROM raw_data
    WHERE no2 IS NOT NULL AND no2 >= 0 AND no2 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'O3' AS pollutant_type,
        o3 AS concentration_ug_m3
    FROM raw_data
    WHERE o3 IS NOT NULL AND o3 >= 0 AND o3 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'CO' AS pollutant_type,
        co AS concentration_ug_m3
    FROM raw_data
    WHERE co IS NOT NULL AND co >= 0 AND co < 50

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM10' AS pollutant_type,
        pm10 AS concentration_ug_m3
    FROM raw_data
    WHERE pm10 IS NOT NULL AND pm10 >= 0 AND pm10 < 1000

    UNION ALL

    SELECT
        objectid AS location_id,
        nombre AS station_name,
        direccion AS station_address,
        tipozona AS zona_type,
        lon,
        lat,
        fecha_carg AS measurement_timestamp,
        'PM25' AS pollutant_type,
        pm25 AS concentration_ug_m3
    FROM raw_data
    WHERE pm25 IS NOT NULL AND pm25 >= 0 AND pm25 < 1000
)

SELECT
    md5(cast(coalesce(cast(measurement_timestamp as TEXT), '') || '-' || coalesce(cast(location_id as TEXT), '') || '-' || coalesce(cast(pollutant_type as TEXT), '') as TEXT)) AS air_quality_pk,
    location_id,
    station_name,
    station_address,
    zona_type,
    measurement_timestamp,
    lon AS longitude,
    lat AS latitude,
    pollutant_type,
    concentration_ug_m3,
    CASE
        WHEN pollutant_type IN ('PM10', 'PM25') THEN 'Particulates'
        WHEN pollutant_type IN ('NO2', 'SO2') THEN 'Gases_InorgÃ¡nicos'
        WHEN pollutant_type IN ('O3', 'CO') THEN 'Gases_MonÃ³xido'
        ELSE 'Otro'
    END AS pollutant_category
FROM unpivoted_data
WHERE concentration_ug_m3 >= 0
  );
[0m23:23:55.412297 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m23:23:55.420159 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:23:55.421284 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia" rename to "stg_air_quality_valencia__dbt_backup"
[0m23:23:55.423820 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:23:55.428021 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:23:55.428789 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
alter table "data_project_1"."public"."stg_air_quality_valencia__dbt_tmp" rename to "stg_air_quality_valencia"
[0m23:23:55.430945 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:23:55.442147 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:23:55.443130 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:23:55.444125 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: COMMIT
[0m23:23:55.446954 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:23:55.454450 [debug] [Thread-1 (]: Applying DROP to: "data_project_1"."public"."stg_air_quality_valencia__dbt_backup"
[0m23:23:55.458730 [debug] [Thread-1 (]: Using postgres connection "model.data_project_1.stg_air_quality_valencia"
[0m23:23:55.459549 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "data_project_1", "target_name": "dev", "node_id": "model.data_project_1.stg_air_quality_valencia"} */
drop view if exists "data_project_1"."public"."stg_air_quality_valencia__dbt_backup" cascade
[0m23:23:55.464001 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m23:23:55.467014 [debug] [Thread-1 (]: On model.data_project_1.stg_air_quality_valencia: Close
[0m23:23:55.470886 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37b3658d-631d-40c1-951d-0666018ca1e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e48eccc3d0>]}
[0m23:23:55.472541 [info ] [Thread-1 (]: 1 of 1 OK created sql view model public.stg_air_quality_valencia ............... [[32mCREATE VIEW[0m in 0.14s]
[0m23:23:55.474037 [debug] [Thread-1 (]: Finished running node model.data_project_1.stg_air_quality_valencia
[0m23:23:55.477426 [debug] [MainThread]: Using postgres connection "master"
[0m23:23:55.479396 [debug] [MainThread]: On master: BEGIN
[0m23:23:55.481094 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:23:55.491562 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m23:23:55.493554 [debug] [MainThread]: On master: COMMIT
[0m23:23:55.494992 [debug] [MainThread]: Using postgres connection "master"
[0m23:23:55.496328 [debug] [MainThread]: On master: COMMIT
[0m23:23:55.498064 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:23:55.500311 [debug] [MainThread]: On master: Close
[0m23:23:55.503112 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:23:55.505052 [debug] [MainThread]: Connection 'model.data_project_1.stg_air_quality_valencia' was properly closed.
[0m23:23:55.506712 [info ] [MainThread]: 
[0m23:23:55.508525 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m23:23:55.510660 [debug] [MainThread]: Command end result
[0m23:23:55.619646 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/dbt/target/manifest.json
[0m23:23:55.626995 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/dbt/target/semantic_manifest.json
[0m23:23:55.641882 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/dbt/target/run_results.json
[0m23:23:55.643858 [info ] [MainThread]: 
[0m23:23:55.645506 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:23:55.646945 [info ] [MainThread]: 
[0m23:23:55.648914 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:23:55.650959 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.0960512, "process_in_blocks": "0", "process_kernel_time": 0.437612, "process_mem_max_rss": "128020", "process_out_blocks": "0", "process_user_time": 1.754538}
[0m23:23:55.652157 [debug] [MainThread]: Command `dbt run` succeeded at 23:23:55.652015 after 3.10 seconds
[0m23:23:55.653235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e48fb58410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e493fb3890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e493fce990>]}
[0m23:23:55.654299 [debug] [MainThread]: Flushing usage events
[0m23:23:56.485952 [debug] [MainThread]: An error was encountered while trying to flush usage events
